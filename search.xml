<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Swift æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜</title>
      <link href="/2018/10/27/Swift-%E6%8E%8C%E6%8E%A7Moya%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E3%80%81%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%BC%93%E5%AD%98/"/>
      <url>/2018/10/27/Swift-%E6%8E%8C%E6%8E%A7Moya%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E3%80%81%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%BC%93%E5%AD%98/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <ul><li><code>Moya</code> åœ¨Swiftå¼€å‘ä¸­èµ·ç€é‡è¦çš„ç½‘ç»œäº¤äº’ä½œç”¨ï¼Œä½†æ˜¯è¿˜æœ‰ä¸å¦‚ä¹‹å¤„ï¼Œæ¯”å¦‚ç½‘ç»œä¸å¯ç”¨æ—¶ï¼Œè¿”å›çš„ <code>Response</code> ä¸º <code>nil</code>ï¼Œè¿™æ—¶è¿˜å¾—å»è§£æç›¸åº”çš„ <code>Error</code></li><li><code>Codable</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è§£ææ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å£°æ˜çš„å±æ€§ç±»å‹ä¸jsonä¸­çš„ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£å¸¸è§£æ; è€Œä¸”å¯¹äºæ¨¡å‹ä¸­è‡ªå®šä¹‰å±æ€§åçš„å¤„ç†ä¹Ÿååˆ†ç¹ç</li></ul><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><ul><li><code>Moya</code> åœ¨Swiftå¼€å‘ä¸­èµ·ç€é‡è¦çš„ç½‘ç»œäº¤äº’ä½œç”¨ï¼Œä½†æ˜¯è¿˜æœ‰ä¸å¦‚ä¹‹å¤„ï¼Œæ¯”å¦‚ç½‘ç»œä¸å¯ç”¨æ—¶ï¼Œè¿”å›çš„ <code>Response</code> ä¸º <code>nil</code>ï¼Œè¿™æ—¶è¿˜å¾—å»è§£æç›¸åº”çš„ <code>Error</code></li><li><code>Codable</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è§£ææ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å£°æ˜çš„å±æ€§ç±»å‹ä¸jsonä¸­çš„ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£å¸¸è§£æ; è€Œä¸”å¯¹äºæ¨¡å‹ä¸­è‡ªå®šä¹‰å±æ€§åçš„å¤„ç†ä¹Ÿååˆ†ç¹ç</li></ul><p>è§£å†³çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä¸è¿‡æˆ‘æ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨ <code>MoyaMapper</code> ï¼Œä¸ä»…å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿˜æä¾›äº†å¤šç§<code>æ¨¡å‹è½¬æ¢</code>ã€<code>æ•°æ®äº’è½¬</code>ã€<code>å¤šç§æ•°æ®ç±»å‹ä»»æ„å­˜å‚¨</code>çš„ä¾¿æ·æ–¹æ³•ã€‚æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜ç®€ç›´æ˜“å¦‚åæŒã€‚</p><blockquote><p><code>MoyaMapper</code>æ˜¯åŸºäºMoyaå’ŒSwiftyJSONå°è£…çš„å·¥å…·ï¼Œä»¥Moyaçš„pluginçš„æ–¹å¼æ¥å®ç°é—´æ¥è§£æï¼Œæ”¯æŒRxSwift</p><p> GitHub: <a href="https://github.com/MoyaMapper/MoyaMapper" target="_blank" rel="noopener">MoyaMapper</a></p><p>ğŸ“– è¯¦ç»†çš„ä½¿ç”¨è¯·æŸ¥çœ‹æ‰‹å†Œ <a href="https://moyamapper.github.io/" target="_blank" rel="noopener">https://MoyaMapper.github.io</a></p></blockquote><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul><li>æ”¯æŒ<code>json</code> è½¬ <code>Model</code> è‡ªåŠ¨æ˜ å°„ ä¸ è‡ªå®šä¹‰æ˜ å°„</li><li>æ— è§† <code>json</code> ä¸­å€¼çš„ç±»å‹ï¼Œ<code>Model</code> ä¸­å±æ€§å£°æ˜çš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå®ƒå°±æ˜¯ä»€ä¹ˆç±»å‹</li><li>æ”¯æŒ <code>Data</code> <code>å­—å…¸</code> <code>JSON</code> <code>jsonå­—ç¬¦ä¸²</code> <code>Model</code> äº’è½¬</li><li>æ’ä»¶æ–¹å¼ï¼Œå…¨æ–¹ä½ä¿éšœ<code>Moya.Response</code>ï¼Œæ‹’ç»å„ç§ç½‘ç»œé—®é¢˜å¯¼è‡´ <code>Response</code> ä¸º <code>nil</code>ï¼Œå°†å„å¼å„æ ·çš„åŸå› å¯¼è‡´çš„æ•°æ®åŠ è½½å¤±è´¥è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨ <code>Response</code></li><li>å¯é€‰ - æ”¯æŒæ•°æ®éšæ„ç¼“å­˜( <code>JSON</code> ã€ <code>Number</code> ã€<code>String</code>ã€ <code>Bool</code>ã€ <code>Moya.Response</code> )</li><li>å¯é€‰ - æ”¯æŒç½‘ç»œè¯·æ±‚ç¼“å­˜</li></ul><h2 id="æ•°æ®è§£æ"><a href="#æ•°æ®è§£æ" class="headerlink" title="æ•°æ®è§£æ"></a>æ•°æ®è§£æ</h2><h5 id="ä¸€ã€æ’ä»¶æ³¨å…¥"><a href="#ä¸€ã€æ’ä»¶æ³¨å…¥" class="headerlink" title="ä¸€ã€æ’ä»¶æ³¨å…¥"></a>ä¸€ã€æ’ä»¶æ³¨å…¥</h5><p>é™„ï¼š<a href="https://moyamapper.github.io/plugin/" target="_blank" rel="noopener">æ’ä»¶ MoyaMapperPlugin çš„è¯¦ç»†ä½¿ç”¨</a></p><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p><p>1ã€å®šä¹‰é€‚ç”¨äºé¡¹ç›®æ¥å£çš„ <code>ModelableParameterType</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// statusCodeKeyã€tipStrKeyã€ modelKey å¯ä»¥ä»»æ„æŒ‡å®šçº§åˆ«çš„è·¯å¾„ï¼Œå¦‚ï¼š "error&gt;used"</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NetParameter</span> : <span class="title">ModelableParameterType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> successValue = <span class="string">"000"</span></span><br><span class="line">    <span class="keyword">var</span> statusCodeKey = <span class="string">"retStatus"</span></span><br><span class="line">    <span class="keyword">var</span> tipStrKey = <span class="string">"retMsg"</span></span><br><span class="line">    <span class="keyword">var</span> modelKey = <span class="string">"retBody"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€åœ¨ <code>MoyaProvider</code> ä¸­ä½¿ç”¨ <code>MoyaMapperPlugin</code> æ’ä»¶ï¼Œå¹¶æŒ‡å®š <code>ModelableParameterType</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lxfNetTool = <span class="type">MoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;(plugins: [<span class="type">MoyaMapperPlugin</span>(<span class="type">NetParameter</span>())])</span><br></pre></td></tr></table></figure><p>â— ä½¿ç”¨ <code>MoyaMapperPlugin</code> æ’ä»¶æ˜¯æ•´ä¸ª <code>MoyaMapper</code>  çš„æ ¸å¿ƒæ‰€åœ¨ï¼</p><h5 id="äºŒã€Modelå£°æ˜"><a href="#äºŒã€Modelå£°æ˜" class="headerlink" title="äºŒã€Modelå£°æ˜"></a>äºŒã€Modelå£°æ˜</h5><blockquote><p><code>Model</code> éœ€éµå®ˆ <code>Modelable</code> åè®®</p><ul><li><code>MoyaMapper</code> æ”¯æŒæ¨¡å‹è‡ªåŠ¨æ˜ å°„ å’Œ è‡ªå®šä¹‰æ˜ å°„</li><li>ä¸éœ€è¦è€ƒè™‘æºjsonæ•°æ®çš„çœŸå®ç±»å‹ï¼Œè¿™é‡Œç»Ÿä¸€æŒ‰ <code>Model</code> ä¸­å±æ€§å£°æ˜çš„ç±»å‹è¿›è¡Œè½¬æ¢</li></ul></blockquote><p>1ã€ä¸€èˆ¬æƒ…å†µä¸‹å¦‚ä¸‹å†™æ³•å³å¯</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CompanyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> catchPhrase : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å¦‚æœè‡ªå®šä¹‰æ˜ å°„ï¼Œåˆ™å¯ä»¥å®ç°æ–¹æ³• <code>mutating func mapping(_ json: JSON)</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CompanyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> catchPhrase : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = json[<span class="string">"nickname"</span>].stringValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€æ”¯æŒæ¨¡å‹åµŒå¥—</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> id : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> company : <span class="type">CompanyModel</span> = <span class="type">CompanyModel</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸‰ã€Response-è§£æ"><a href="#ä¸‰ã€Response-è§£æ" class="headerlink" title="ä¸‰ã€Response è§£æ"></a>ä¸‰ã€Response è§£æ</h5><blockquote><p>1ã€ä»¥ä¸‹ç¤ºä¾‹çš†ä½¿ç”¨äº† <code>MoyaMapperPlugin</code> ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®š <code>è§£æè·¯å¾„</code></p><p>2ã€å¦‚æœæ²¡æœ‰ä½¿ç”¨ <code>MoyaMapperPlugin</code> åˆ™éœ€è¦æŒ‡å®š <code>è§£æè·¯å¾„</code>ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸è§£æ</p><p>ps:  <code>è§£æè·¯å¾„</code> å¯ä»¥ä½¿ç”¨ <code>a&gt;b</code> è¿™ç§å½¢å¼æ¥è§£å†³å¤šçº§è·¯å¾„çš„é—®é¢˜</p></blockquote><p>è§£ææ–¹æ³•å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤º</p><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:left">æè¿° (æ”¯æŒRxSwift)</th></tr></thead><tbody><tr><td style="text-align:center">toJSON</td><td style="text-align:left">Response è½¬ JSON ( <a href="https://moyamapper.github.io/core/toJSON/" target="_blank" rel="noopener">toJSON</a>   <a href="https://moyamapper.github.io/rx/toJSON/" target="_blank" rel="noopener">rx.toJSON</a>)</td></tr><tr><td style="text-align:center">fetchString</td><td style="text-align:left">è·å–æŒ‡å®šè·¯å¾„çš„å­—ç¬¦ä¸²( <a href="https://moyamapper.github.io/core/fetchString/" target="_blank" rel="noopener">fetchString</a>   <a href="https://moyamapper.github.io/rx/fetchString/" target="_blank" rel="noopener">rx.fetchString</a>)</td></tr><tr><td style="text-align:center">fetchJSONString</td><td style="text-align:left">è·å–æŒ‡å®šè·¯å¾„çš„åŸå§‹jsonå­—ç¬¦ä¸² ( <a href="https://moyamapper.github.io/core/fetchJSONString/" target="_blank" rel="noopener">fetchJSONString</a>   <a href="https://moyamapper.github.io/rx/fetchJSONString/" target="_blank" rel="noopener">rx.fetchJSONString</a> )</td></tr><tr><td style="text-align:center">mapResult</td><td style="text-align:left">Response -&gt; MoyaMapperResult   <code>(Bool, String)</code> ( <a href="https://moyamapper.github.io/core/mapResult/" target="_blank" rel="noopener">mapResult</a>   <a href="https://moyamapper.github.io/rx/mapResult/" target="_blank" rel="noopener">rx.mapResult</a> )</td></tr><tr><td style="text-align:center">mapObject</td><td style="text-align:left">Response -&gt; Model ( <a href="https://moyamapper.github.io/core/mapObject/" target="_blank" rel="noopener">mapObject</a>   <a href="https://moyamapper.github.io/rx/mapObject/" target="_blank" rel="noopener">rx.mapObject</a>)</td></tr><tr><td style="text-align:center">mapObjResult</td><td style="text-align:left">Response -&gt; (MoyaMapperResult, Model) ( <a href="https://moyamapper.github.io/core/mapObjResult/" target="_blank" rel="noopener">mapObjResult</a>   <a href="https://moyamapper.github.io/rx/mapObjResult/" target="_blank" rel="noopener">rx.mapObjResult</a>)</td></tr><tr><td style="text-align:center">mapArray</td><td style="text-align:left">Response -&gt; [Model] ( <a href="https://moyamapper.github.io/core/mapArray/" target="_blank" rel="noopener">mapArray</a>  <a href="https://moyamapper.github.io/rx/mapArray/" target="_blank" rel="noopener">rx.mapArray</a>)</td></tr><tr><td style="text-align:center">mapArrayResult</td><td style="text-align:left">Response -&gt; (MoyaMapperResult, [Model]) ( <a href="https://moyamapper.github.io/core/mapArrayResult/" target="_blank" rel="noopener">mapArrayResult</a>   <a href="https://moyamapper.github.io/rx/mapArrayResult/" target="_blank" rel="noopener">rx.mapArrayResult</a>)</td></tr></tbody></table><p>â—é™¤äº† <code>fetchJSONString</code> çš„é»˜è®¤è§£æè·¯å¾„æ˜¯<code>æ ¹è·¯å¾„</code>ä¹‹å¤–ï¼Œå…¶å®ƒæ–¹æ³•çš„é»˜è®¤è§£æè·¯å¾„ä¸ºæ’ä»¶å¯¹è±¡ä¸­çš„ <code>modelKey</code></p><p>å¦‚æœæ¥å£è¯·æ±‚å <code>json</code> çš„æ•°æ®ç»“æ„ä¸ä¸‹å›¾ç±»ä¼¼ï¼Œåˆ™ä½¿ç”¨ <code>MoyaMapper</code> æ˜¯æœ€åˆé€‚ä¸è¿‡äº†</p><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> model = response.mapObject(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name -- \(model.name)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"github -- \(model.github)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°json</span></span><br><span class="line"><span class="built_in">print</span>(response.fetchJSONString())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapObject(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line">    .subscribe(onSuccess: &#123; (model) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"name -- \(model.name)"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"github -- \(model.github)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><p>é™„ï¼š <a href="https://moyamapper.github.io/core/fetchJSONString/" target="_blank" rel="noopener">fetchJSONStringçš„è¯¦ç»†ä½¿ç”¨</a></p><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-array.png" alt=""></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> models = response.mapArray(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">let</span> name = models[<span class="number">0</span>].name</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"count -- \(models.count)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name -- \(name)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å° json æ¨¡å‹æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªçš„name</span></span><br><span class="line"><span class="built_in">print</span>(response.fetchString(keys: [<span class="number">0</span>, <span class="string">"name"</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapArray(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line">    .subscribe(onSuccess: &#123; models <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> name = models[<span class="number">0</span>].name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"count -- \(models.count)"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"name -- \(name)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><p>é™„ï¼š<a href="https://moyamapper.github.io/core/mapArray/" target="_blank" rel="noopener">mapArrayçš„è¯¦ç»†ä½¿ç”¨è¯´æ˜</a></p><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/fail.png" alt=""></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> (isSuccess, tipStr) = response.mapResult()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"isSuccess -- \(isSuccess)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tipStr -- \(tipStr)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapResult()</span><br><span class="line">    .subscribe(onSuccess: &#123; (isSuccess, tipStr) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"isSuccess -- \(isSuccess)"</span>) <span class="comment">// æ˜¯å¦ä¸º "000"</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"retMsg -- \(retMsg)"</span>) <span class="comment">// "ç¼ºå°‘å¿…è¦å‚æ•°"</span></span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><p>é™„ï¼š<a href="https://moyamapper.github.io/core/mapResult/" target="_blank" rel="noopener">mapResultçš„è¯¦ç»†ä½¿ç”¨è¯´æ˜</a></p><h2 id="ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ"><a href="#ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ" class="headerlink" title="ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ"></a>ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ</h2><blockquote><p>åœ¨APPçš„å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°å„ç§å„æ ·çš„ç½‘ç»œè¯·æ±‚ç»“æœï¼Œå¦‚:æœåŠ¡å™¨æŒ‚äº†ã€æ‰‹æœºæ— ç½‘ç»œï¼Œæ­¤æ—¶ <code>Moya</code> è¿”å›çš„ <code>Response</code> ä¸º nilï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¾—ä¸å»åˆ¤æ–­ <code>Error</code>ã€‚ä½†æ˜¯ä½¿ç”¨ <code>MoyaMapperPlugin</code> å°±å¯ä»¥è®©æˆ‘ä»¬åªå…³æ³¨ <code>Response</code></p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MoyaMapperPlugin çš„åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">ModelableParameterType</span>&gt;(</span><br><span class="line">    <span class="number">_</span> type: <span class="type">T</span>,</span><br><span class="line">    transformError: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type : <span class="type">ModelableParameterType</span>  ç”¨äºå®šä¹‰å­—æ®µè·¯å¾„ï¼Œåšä¸ºå…¨å±€è§£ææ•°æ®çš„ä¾æ®</span><br><span class="line">transformError : <span class="type">Bool</span>  æ˜¯å¦å½“ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢è¯·æ±‚ç»“æœï¼Œé»˜è®¤ä¸º <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>å½“è¯·æ±‚å¤±è´¥çš„æ—¶å€™ï¼Œæ­¤æ—¶çš„ <code>result.response</code> ä¸º <code>nil</code>ï¼Œæ ¹æ®<code>transformError</code>æ˜¯å¦ä¸º<code>true</code> åˆ¤æ–­æ˜¯å¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>response</code> å¹¶è¿”å›å‡ºå»ã€‚</li></ul><p>â¡ æœ¬æ¥å¯ä»¥è¯·æ±‚åˆ°çš„æ•°æ®å†…å®¹</p><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p><p>â¡ ç°åœ¨å…³é—­ç½‘ç»œï¼Œå†è¯·æ±‚æ•°æ®</p><ul><li><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå³ä¸åšä»»ä½•ä¸å¤„ç†çš„æ—¶å€™ï¼Œ <code>Response</code> ä¸º <code>nil</code> </p></li><li><p>ç»è¿‡ <code>MoyaMapperPlugin</code> å¤„ç†çš„åå¯å¾—åˆ°è½¬æ¢åçš„ <code>Response</code> ï¼Œå¦‚å›¾</p></li></ul><p><img src="/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/plugin.png" alt=""></p><p>è¿™é‡Œå°†è¯·æ±‚å¤±è´¥è¿›è¡Œäº†ç»Ÿä¸€å¤„ç†ï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨è¿˜æ˜¯è‡ªèº«ç½‘ç»œçš„é—®é¢˜ï¼Œ<code>retStatus</code> éƒ½ä¸º MMStatusCode.loadFailï¼Œä½†æ˜¯ errorDescription ä¼šä¿æŒåŸæ¥çš„æ ·å­å¹¶èµ‹å€¼ç»™ <code>retMsg</code>ã€‚</p><blockquote><ul><li><code>retStatus</code> å€¼ä¼šä»æšä¸¾ <code>MMStatusCode</code> ä¸­å–  <code>loadFail.rawValue</code> ï¼Œå³ <code>700</code> </li><li>å– ç±»å‹ä¸º <code>ModelableParameterType</code>  çš„ <code>type</code> ä¸­ <code>statusCodeKey</code> æ‰€æŒ‡å®šçš„å€¼ ä¸ºé”®åï¼Œ<code>retMsg</code>ä¹ŸåŒç†</li></ul></blockquote><p>ps: è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡åˆ¤æ–­ <code>retStatus</code> æˆ– <code>response.statusCode</code> æ˜¯å¦ä¸ <code>MMStatusCode.loadFail.rawValue</code> ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåŠ è½½å¤±è´¥çš„ç©ºç™½é¡µå ä½å›¾</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">MMStatusCode</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> cache = <span class="number">230</span></span><br><span class="line">    <span class="keyword">case</span> loadFail = <span class="number">700</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾ <code>MMStatusCode</code> ä¸­é™¤äº† <code>loadFail</code> ï¼Œè¿˜æœ‰ <code>cache</code>ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ <code>loadFail</code> åœ¨æ•°æ®åŠ è½½å¤±è´¥çš„æ—¶å€™ä¼šå‡ºç°ï¼Œé‚£ <code>cache</code> æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‡ºæ¥å‘¢ï¼Ÿä¸æ€¥ï¼Œçœ‹ä¸‹ä¸€èŠ‚å°±çŸ¥é“äº†ã€‚</p><h2 id="æ•°æ®ç¼“å­˜"><a href="#æ•°æ®ç¼“å­˜" class="headerlink" title="æ•°æ®ç¼“å­˜"></a>æ•°æ®ç¼“å­˜</h2><h5 id="ä¸€ã€åŸºæœ¬ä½¿ç”¨"><a href="#ä¸€ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ä¸€ã€åŸºæœ¬ä½¿ç”¨"></a>ä¸€ã€åŸºæœ¬ä½¿ç”¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç¼“å­˜</span><br><span class="line">@discardableResult</span><br><span class="line">MMCache.shared.cache`XXX`(value : XXX, key: String, cacheContainer: MMCache.CacheContainer = .RAM)  -&gt; Bool</span><br><span class="line">// å–èˆ</span><br><span class="line">MMCache.shared.fetch`XXX`Cache(key: String, cacheContainer: MMCache.CacheContainer = .RAM)</span><br></pre></td></tr></table></figure><p>ç¼“å­˜æˆåŠŸä¼šè¿”å›ä¸€ä¸ª <code>Bool</code> å€¼ï¼Œè¿™é‡Œå¯ä¸æ¥æ”¶</p><table><thead><tr><th>XXX æ‰€æ”¯æŒç±»å‹</th><th></th></tr></thead><tbody><tr><td>Bool</td><td>-</td></tr><tr><td>Float</td><td>-</td></tr><tr><td>Double</td><td>-</td></tr><tr><td>String</td><td>-</td></tr><tr><td>JSON</td><td>-</td></tr><tr><td>Modelable</td><td>[Modelable]</td></tr><tr><td>Moya.Response</td><td>-</td></tr><tr><td>Int</td><td>UInt</td></tr><tr><td>Int8</td><td>UInt8</td></tr><tr><td>Int16</td><td>UInt16</td></tr><tr><td>Int32</td><td>UInt32</td></tr><tr><td>Int64</td><td>UInt64</td></tr></tbody></table><blockquote><p>å…¶ä¸­ï¼Œé™¤äº† <code>Moya.Response</code> ä¹‹å¤–ï¼Œå…¶å®ƒç±»å‹çš†æ˜¯é€šè¿‡ <code>JSON</code> æ¥å®ç°ç¼“å­˜</p></blockquote><p>æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³æ¸…é™¤è¿™äº›ç±»å‹çš„ç¼“å­˜ï¼Œåªéœ€è¦è°ƒç”¨å¦‚ä¸‹æ–¹æ³•å³å¯</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@discardableResult</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeJSONCache</span><span class="params">(<span class="number">_</span> key: String, cacheContainer: MMCache.CacheContainer = .RAM)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllJSONCache</span><span class="params">(cacheContainer: MMCache.CacheContainer = .RAM)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>æ¸…é™¤ <code>Moya.Response</code> åˆ™ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@discardableResult</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeResponseCache</span><span class="params">(<span class="number">_</span> key: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">@discardableResult</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllResponseCache</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹MMCache.CacheContainer</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CacheContainer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">RAM</span> <span class="comment">// åªç¼“å­˜äºå†…å­˜çš„å®¹å™¨</span></span><br><span class="line">    <span class="keyword">case</span> hybrid <span class="comment">// ç¼“å­˜äºå†…å­˜ä¸ç£ç›˜çš„å®¹å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸¤ç§å®¹å™¨äº’ä¸ç›¸é€šï¼Œå³ å³ä½¿keyç›¸åŒï¼Œä½¿ç”¨ <code>hybrid</code> æ¥ç¼“å­˜åï¼Œå†é€šè¿‡ <code>RAM</code> å–å€¼æ˜¯å–ä¸åˆ°çš„ã€‚</p></blockquote><ul><li>RAM : ä»…ç¼“å­˜äºå†…å­˜ä¹‹ä¸­ï¼Œç¼“å­˜çš„æ•°æ®åœ¨APPä½¿ç”¨æœŸé—´ä¸€ç›´å­˜åœ¨</li><li>hybrid ï¼šç¼“å­˜äºå†…å­˜ä¸ç£ç›˜ä¸­ï¼ŒAPPé‡å¯åä¹Ÿå¯ä»¥è·å–åˆ°æ•°æ®</li></ul><h5 id="äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚"><a href="#äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚" class="headerlink" title="äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚"></a>äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚</h5><p>å†…éƒ¨ç¼“å­˜è¿‡ç¨‹ï¼š</p><ol><li>APPé¦–æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œæ•°æ®å°†ç¼“å­˜èµ·æ¥</li><li>APPå†æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šå…ˆè¿”å›ç¼“å­˜çš„æ•°æ®ï¼Œç­‰è¯·æ±‚æˆåŠŸåå†è¿”å›ç½‘ç»œæ•°æ®</li><li>å…¶å®ƒæƒ…å†µåªä¼šåŠ è½½ç½‘ç»œæ•°æ®</li><li>æ¯æ¬¡æˆåŠŸè¯·æ±‚åˆ°æ•°æ®åï¼Œéƒ½ä¼šå¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡Œæ›´æ–°</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cacheRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> target: Target, </span></span></span><br><span class="line"><span class="function"><span class="params">    cacheType: MMCache.CacheKeyType = .<span class="keyword">default</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    callbackQueue: DispatchQueue? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    progress: Moya.ProgressBlock? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    completion: @escaping Moya.Completion</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Cancellable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cacheRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> target: Base.Target, </span></span></span><br><span class="line"><span class="function"><span class="params">    callbackQueue: DispatchQueue? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    cacheType: MMCache.CacheKeyType = .<span class="keyword">default</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Response</span>&gt;</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šæ˜¯å¯¹ <code>Moya</code> è¯·æ±‚åçš„ <code>Response</code> è¿›è¡Œç¼“å­˜ã€‚ å…¶å®ä¸ <code>Moya</code> è‡ªå¸¦çš„æ–¹æ³•ç›¸æ¯”è¾ƒåªå¤šäº†ä¸€ä¸ªå‚æ•° <code>cacheType: MMCache.CacheKeyType</code> ï¼Œå®šä¹‰ç€ç¼“å­˜ä¸­çš„ <code>key</code> ï¼Œé»˜è®¤ä¸º <code>default</code> </p></blockquote><p>ä¸‹é¢æ˜¯ <code>MMCache.CacheKeyType</code> çš„å®šä¹‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> let cacheKey = [method]baseURL/path</span><br><span class="line"> </span><br><span class="line"> - default : cacheKey + &quot;?&quot; + parameters</span><br><span class="line"> - base : cacheKey</span><br><span class="line"> - custom : cacheKey + &quot;?&quot; + customKey</span><br><span class="line"> */</span><br><span class="line">public enum CacheKeyType &#123;</span><br><span class="line">    case `default`</span><br><span class="line">    case base</span><br><span class="line">    case custom(String)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ æƒ³ç¼“å­˜<code>å¤šé¡µ</code>åˆ—è¡¨æ•°æ®çš„<code>æœ€æ–°ä¸€é¡µ</code>æ•°æ®ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>default</code> æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸º <code>default</code> ä½¿ç”¨çš„ <code>key</code> åŒ…å«äº† <code>pageIndex</code>ï¼Œè¿™æ ·å°±è¾¾ä¸åˆ°åªç¼“å­˜ <code>æœ€æ–°ä¸€é¡µæ•°æ®</code> çš„ç›®çš„ï¼Œ æ‰€ä»¥è¿™é‡Œåº”è¯¥ä½¿ç”¨ <code>base</code> æˆ–è€… <code>custom(String)</code> </p></blockquote><p>æˆ‘ä»¬å¯ä»¥æ¥è¯•ä¸€ä¸‹å¸¦ç¼“å­˜çš„è¯·æ±‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * APPç¬¬ä¸€æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œæ•°æ®å°†ç¼“å­˜èµ·æ¥</span></span><br><span class="line"><span class="comment"> * APPå†æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šå…ˆåŠ è½½ç¼“å­˜ï¼Œå†åŠ è½½ç½‘ç»œæ•°æ®</span></span><br><span class="line"><span class="comment"> * å…¶å®ƒæƒ…å†µåªä¼šåŠ è½½ç½‘ç»œæ•°æ®</span></span><br><span class="line"><span class="comment"> * æ¯æ¬¡æˆåŠŸè¯·æ±‚åˆ°æ•°æ®éƒ½ä¼šè¿›è¡Œæ•°æ®æ›´æ–°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">lxfNetTool.rx.cacheRequest(.data(type: .all, size: <span class="number">10</span>, index: <span class="number">1</span>))</span><br><span class="line">    .subscribe(onNext: &#123; response <span class="keyword">in</span></span><br><span class="line">        log.debug(<span class="string">"statusCode -- \(response.statusCode)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹å¼</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">let _ = lxfNetTool.cacheRequest(.data(type: .all, size: 10, index: 1)) &#123; result in</span></span><br><span class="line"><span class="comment">    guard let resp = result.value else &#123; return &#125;</span></span><br><span class="line"><span class="comment">    log.debug("statusCode -- \(resp.statusCode)")</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// é¦–æ¬¡ä½¿ç”¨APP</span><br><span class="line">statusCode -- 200</span><br><span class="line"></span><br><span class="line">// å…³é—­å¹¶é‡æ–°æ‰“å¼€APPï¼Œå†è¯·æ±‚ä¸€ä¸‹</span><br><span class="line">statusCode -- 230</span><br><span class="line">statusCode -- 200</span><br><span class="line"></span><br><span class="line">// ç„¶åå†è¯·æ±‚ä¸€ä¸‹</span><br><span class="line">statusCode -- 200</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>230</code> å°±æ˜¯ <code>MMStatusCode.cache.rawValue</code></p><h2 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h2><ul><li>é»˜è®¤å®‰è£…</li></ul><p>MoyaMapperé»˜è®¤åªå®‰è£…Coreä¸‹çš„æ–‡ä»¶<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper'</span></span><br></pre></td></tr></table></figure></p><ul><li><p>RxSwiftæ‹“å±•</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/Rx'</span></span><br></pre></td></tr></table></figure></li><li><p>ç¼“å­˜æ‹“å±•</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/MMCache'</span></span><br></pre></td></tr></table></figure></li><li><p>Rxç¼“å­˜</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/RxCache'</span></span><br></pre></td></tr></table></figure></li></ul></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Swift ä¼˜é›…çš„é€‚é…å¤§å°</title>
      <link href="/2018/10/24/Swift-%E4%BC%98%E9%9B%85%E7%9A%84%E9%80%82%E9%85%8D%E5%A4%A7%E5%B0%8F/"/>
      <url>/2018/10/24/Swift-%E4%BC%98%E9%9B%85%E7%9A%84%E9%80%82%E9%85%8D%E5%A4%A7%E5%B0%8F/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <blockquote><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­å¸¸å¸¸ä¼šå¯¹è®¾å¤‡è¿›è¡Œä¸€å®šçš„é€‚é…ï¼Œä¸ºäº†æ–¹ä¾¿åœ¨å¤šä¸ªé¡¹ç›®é‡Œç»Ÿä¸€ç®¡ç†å’Œä½¿ç”¨ï¼Œæ‰€ä»¥å°è£…å¹¶å¼€æºäº†<code>SwiftyFitsize</code>è¿™ä¸ªåº“ï¼Œå¯ç”¨äºé€‚é…è§†å›¾åŠå­—ä½“å¤§å°ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ xib å’Œ storyboard</p></blockquote><p>GitHub: <a href="https://github.com/LinXunFeng/SwiftyFitsize" target="_blank" rel="noopener">SwiftyFitsize</a></p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­å¸¸å¸¸ä¼šå¯¹è®¾å¤‡è¿›è¡Œä¸€å®šçš„é€‚é…ï¼Œä¸ºäº†æ–¹ä¾¿åœ¨å¤šä¸ªé¡¹ç›®é‡Œç»Ÿä¸€ç®¡ç†å’Œä½¿ç”¨ï¼Œæ‰€ä»¥å°è£…å¹¶å¼€æºäº†<code>SwiftyFitsize</code>è¿™ä¸ªåº“ï¼Œå¯ç”¨äºé€‚é…è§†å›¾åŠå­—ä½“å¤§å°ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ xib å’Œ storyboard</p></blockquote><p>GitHub: <a href="https://github.com/LinXunFeng/SwiftyFitsize" target="_blank" rel="noopener">SwiftyFitsize</a></p><p>æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/2018/10/Swift-ä¼˜é›…çš„é€‚é…å¤§å°/exhibition.png" alt="æ•ˆæœå›¾"></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä½¿ç”¨Cocoapodså®‰è£…ï¼Œæˆ–æ‰‹åŠ¨æ‹–å…¥é¡¹ç›®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;SwiftyFitsize&apos;</span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><code>SwiftyFitsize</code>åœ¨é»˜è®¤çŠ¶å†µä¸‹æ‰€ä½¿ç”¨çš„å‚ç…§å®½åº¦ä¸º<code>iphone6</code>çš„<code>375</code><br>å¦‚æœè®¾è®¡å›¾æ‰€é€‰ç”¨è®¾å¤‡çš„å®½åº¦ä¸é»˜è®¤å€¼ä¸åŒï¼Œå¯ä»¥åœ¨<code>AppDelegate</code>ä¸‹åˆå§‹åŒ–æ‰€å‚ç…§çš„å®½åº¦</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SwiftyFitsize</span>.reference(width: <span class="number">414</span>)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢åˆ—å‡ºä¸€äº›è®¾å¤‡å¯¹åº”çš„åˆ†è¾¨ç‡ï¼Œæ–¹ä¾¿æŸ¥æ‰¾</p><table><thead><tr><th>è®¾å¤‡</th><th>é€»è¾‘åˆ†è¾¨ç‡(point)</th><th>è®¾å¤‡åˆ†è¾¨ç‡(pixel)</th></tr></thead><tbody><tr><td>SE</td><td>320x568</td><td>640x1136</td></tr><tr><td>6(S)ï¼7ï¼8</td><td>375x667</td><td>750x1334</td></tr><tr><td>6(S)+ï¼7+ï¼8+</td><td>414x736</td><td>1080x1920</td></tr><tr><td>X(S)</td><td>375x812</td><td>1125x2436</td></tr><tr><td>XR</td><td>414x896</td><td>828x1792</td></tr><tr><td>XS Max</td><td>414x896</td><td>1242x2688</td></tr></tbody></table><p>ä½¿ç”¨ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œåªéœ€è¦åœ¨<code>Number</code>ã€<code>UIFont</code>ã€<code>CGPoint</code>ã€<code>CGSize</code>ã€<code>UIEdgeInsetsMake</code>è¿™äº›ç±»å‹çš„å€¼åé¢åŠ ä¸Š<code>~</code>å³å¯<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">100</span>~</span><br><span class="line"><span class="type">UIFont</span>.systemFont(ofSize: <span class="number">14</span>)~</span><br><span class="line"><span class="type">CGPoint</span>(x: <span class="number">10</span>, y: <span class="number">10</span>)~</span><br><span class="line"><span class="type">CGSize</span>(width: <span class="number">100</span>, height: <span class="number">100</span>)~</span><br><span class="line"><span class="type">CGRect</span>(x: <span class="number">10</span>, y: <span class="number">10</span>, width: <span class="number">100</span>, height: <span class="number">100</span>)~</span><br><span class="line"><span class="type">UIEdgeInsetsMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)~</span><br></pre></td></tr></table></figure></p><h5 id="xib-storyboard-å­—ä½“é€‚é…"><a href="#xib-storyboard-å­—ä½“é€‚é…" class="headerlink" title="xib / storyboard å­—ä½“é€‚é…"></a>xib / storyboard å­—ä½“é€‚é…</h5><p>æ”¯æŒæ§ä»¶ <code>UILabel</code> <code>UIButton</code> <code>UITextView</code> <code>UITextField</code></p><p><img src="https://github.com/LinXunFeng/SwiftyFitsize/raw/master/Screenshots/xib-font.png" alt="xib-font"></p><h5 id="xib-storyboard-çº¦æŸé€‚é…"><a href="#xib-storyboard-çº¦æŸé€‚é…" class="headerlink" title="xib / storyboard çº¦æŸé€‚é…"></a>xib / storyboard çº¦æŸé€‚é…</h5><p><img src="https://github.com/LinXunFeng/SwiftyFitsize/raw/master/Screenshots/xib-constraint.png" alt="xib-font"></p><p>##### </p><p>æ³¨ï¼š<code>~</code>è¯·ä¸è¦ç›¸äº’åµŒå¥—ä½¿ç”¨ï¼Œå¦‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CGPoint</span>(x: <span class="number">10</span>~, y: <span class="number">10</span>~)~</span><br></pre></td></tr></table></figure></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS é¢å‘åè®®å°è£…å…¨å±æ—‹è½¬åŠŸèƒ½</title>
      <link href="/2018/09/15/iOS-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E5%B0%81%E8%A3%85%E5%85%A8%E5%B1%8F%E6%97%8B%E8%BD%AC%E5%8A%9F%E8%83%BD/"/>
      <url>/2018/09/15/iOS-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E5%B0%81%E8%A3%85%E5%85%A8%E5%B1%8F%E6%97%8B%E8%BD%AC%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <blockquote><p>å…³äºä½¿ç”¨é¢å‘åè®®æ¥å°è£…åŠŸèƒ½çš„å®æˆ˜å¯ä»¥å‚è€ƒæˆ‘ä¸Šç¯‡æ–‡ç«  <a href="/2018/04/07/iOS-é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½/">ã€iOS é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½ã€‘</a>ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥ä½¿ç”¨é˜¶æ®µå§ã€‚<br>æœ¬ç¯‡æ–‡ç« åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œé‚£å°±æ˜¯åªè¦éµå®ˆåè®®ï¼Œä¸€è¡Œä»£ç éšæ„åˆ‡æ¢å…¨å±ï½</p></blockquote><p>å¦‚æœå¯¹é¢å‘åè®®æœ‰ç–‘é—®çš„åŒå­¦å¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a> </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a></p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>å…³äºä½¿ç”¨é¢å‘åè®®æ¥å°è£…åŠŸèƒ½çš„å®æˆ˜å¯ä»¥å‚è€ƒæˆ‘ä¸Šç¯‡æ–‡ç«  <a href="/2018/04/07/iOS-é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½/">ã€iOS é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½ã€‘</a>ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥ä½¿ç”¨é˜¶æ®µå§ã€‚<br>æœ¬ç¯‡æ–‡ç« åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œé‚£å°±æ˜¯åªè¦éµå®ˆåè®®ï¼Œä¸€è¡Œä»£ç éšæ„åˆ‡æ¢å…¨å±ï½</p></blockquote><p>å¦‚æœå¯¹é¢å‘åè®®æœ‰ç–‘é—®çš„åŒå­¦å¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a> </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a></p><h2 id="å¼€æºåº“"><a href="#å¼€æºåº“" class="headerlink" title="å¼€æºåº“"></a>å¼€æºåº“</h2><table><thead><tr><th>Name</th><th>Link</th></tr></thead><tbody><tr><td>GitHub</td><td><a href="https://github.com/LinXunFeng/LXFProtocolTool" target="_blank" rel="noopener">LXFProtocolTool</a></td></tr><tr><td>Wiki</td><td><a href="https://github.com/LinXunFeng/LXFProtocolTool/wiki" target="_blank" rel="noopener">Wikié¦–é¡µ</a></td></tr><tr><td>æœ¬æ–‡ Demo</td><td><a href="https://github.com/LinXunFeng/LXFProtocolTool/tree/master/Example/LXFProtocolTool/Demo/LXFFullScreenable" target="_blank" rel="noopener">LXFFullScreenable</a></td></tr></tbody></table><p>ä½¿ç”¨Cocoapodsçš„æ–¹å¼æ¥å®‰è£…å³å¯</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'LXFProtocolTool/FullScreenable'</span></span><br></pre></td></tr></table></figure><h2 id="ä¸€ã€é…ç½®"><a href="#ä¸€ã€é…ç½®" class="headerlink" title="ä¸€ã€é…ç½®"></a>ä¸€ã€é…ç½®</h2><p>åœ¨AppDelegateä¸­å®ç°å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, supportedInterfaceOrientationsFor window: UIWindow?)</span></span> -&gt; <span class="type">UIInterfaceOrientationMask</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">UIApplication</span>.shared.lxf.currentVcOrientationMask</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨æ¡ˆä¾‹"><a href="#äºŒã€ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="äºŒã€ä½¿ç”¨æ¡ˆä¾‹"></a>äºŒã€ä½¿ç”¨æ¡ˆä¾‹</h2><blockquote><p>æ–¹æ³•ä¸å±æ€§çš„è°ƒç”¨éƒ½éœ€è¦å‘½åç©ºé—´åŠ ä¸Š <code>lxf</code>ï¼Œå¦‚<code>isFullScreen</code> -&gt; <code>lxf.isFullScreen</code></p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isFullScreen : è·å–å½“å‰éµå®ˆåè®®è€…æ˜¯å¦ä¸ºå…¨å±çŠ¶æ€</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    isEnter: Bool? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    specifiedView: UIView? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    superView: UIView? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    completed: <span class="params">(<span class="params">(<span class="number">_</span> isFullScreen: Bool)</span></span></span></span>-&gt;<span class="type">Void</span>)? = <span class="literal">nil</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><table><thead><tr><th>Name</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>isEnter</td><td><code>Bool?</code></td><td>æ˜¯å¦è¿›å…¥å…¨å±</td></tr><tr><td>specifiedView</td><td><code>UIView?</code></td><td>æŒ‡å®šå³å°†å…¨å±çš„è§†å›¾</td></tr><tr><td>superView</td><td><code>UIView?</code></td><td>ä½œä¸ºé€€å‡ºå…¨å±åspecifiedViewçš„çˆ¶è§†å›¾</td></tr><tr><td>config</td><td><code>FullScreenableConfig?</code></td><td>é…ç½®</td></tr><tr><td>completed</td><td><code>((_ isFullScreen: Bool)-&gt;Void)?</code></td><td>è¿›å…¥/é€€å‡º å…¨å±åçš„å›è°ƒ</td></tr></tbody></table><blockquote><p>å½“<code>switchFullScreen</code>çš„è°ƒç”¨è€…ä¸º<code>UIView</code>æ—¶ï¼Œå¦‚æœ<code>specifiedView</code>ä¸º<code>nil</code>ä¼šè‡ªåŠ¨å¡«å†™ï¼Œ<code>superView</code>ä¹Ÿæ˜¯å¦‚æ­¤</p></blockquote><blockquote><p><code>switchFullScreen</code>æ–¹æ³•ä¸æ¨èç›´æ¥ä½¿ç”¨ï¼Œä¸è¿‡å½“éµå®ˆåè®®è€…ä¸º<code>UIViewController</code>æ—¶ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨é»˜è®¤å‚æ•°æ¥åˆ‡æ¢å±å¹•æ–¹å‘<code>lxf.switchFullScreen()</code></p></blockquote><p><img src="/images/2018/09/iOS é¢å‘åè®®å°è£…å…¨å±æ—‹è½¬åŠŸèƒ½/lxf_FullScreenable_1.gif" alt="lxf_FullScreenable_1"></p><p>ä»¥ä¸‹åˆ†ä¸¤ç§æƒ…å†µè¯´æ˜</p><h3 id="UIViewController"><a href="#UIViewController" class="headerlink" title="UIViewController"></a>UIViewController</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">enterFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    specifiedView: UIView,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    completed: FullScreenableCompleteType? = <span class="literal">nil</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exitFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    superView: UIView,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    completed: FullScreenableCompleteType? = <span class="literal">nil</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•æ˜¯å¯¹<code>switchFullScreen</code>çš„æŠ½ç¦»ï¼Œä½¿è°ƒç”¨æ—¶å¯¹å‚æ•°çš„ä¼ é€’æ›´åŠ æ¸…æ™°</p></blockquote><p>1ã€éµå®ˆåè®® <code>FullScreenable</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LXFFullScreenableController</span>: <span class="title">UIViewController</span>, <span class="title">FullScreenable</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><p>2ã€æŒ‡å®šè§†å›¾è¿›å…¥å…¨å±<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxf.enterFullScreen(specifiedView: cyanView)</span><br></pre></td></tr></table></figure></p><p>3ã€æŒ‡å®šè§†å›¾é€€å‡ºå…¨å±ï¼Œå¹¶æ·»åŠ åˆ°å½“å‰æ§åˆ¶å™¨çš„<code>view</code>ä¸Š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxf.exitFullScreen(superView: <span class="keyword">self</span>.view)</span><br></pre></td></tr></table></figure></p><h4 id="ğŸ”¥è‡ªåŠ¨è¿›å…¥-é€€å‡ºå…¨å±"><a href="#ğŸ”¥è‡ªåŠ¨è¿›å…¥-é€€å‡ºå…¨å±" class="headerlink" title="ğŸ”¥è‡ªåŠ¨è¿›å…¥|é€€å‡ºå…¨å±"></a>ğŸ”¥è‡ªåŠ¨è¿›å…¥|é€€å‡ºå…¨å±</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">autoFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    specifiedView: UIView,</span></span></span><br><span class="line"><span class="function"><span class="params">    superView: UIView,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><ul><li>æ§åˆ¶å™¨å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•æ¥æ³¨å†Œè‡ªåŠ¨è¿›å…¥æˆ–é€€å‡ºå…¨å±ï¼Œå„æ§åˆ¶å™¨ä¹‹é—´äº’ä¸å½±å“ã€‚</li><li><code>view</code>æ‰‹åŠ¨è¿›å…¥å…¨å±ä¼šå±è”½å½“å‰æ§åˆ¶å™¨çš„è‡ªåŠ¨å…¨å±åŠŸèƒ½ï¼Œé€€å‡ºæ–¹å¯æ¢å¤</li></ul><h3 id="UIView"><a href="#UIView" class="headerlink" title="UIView"></a>UIView</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">enterFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    specifiedView: UIView? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    completed: FullScreenableCompleteType? = <span class="literal">nil</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exitFullScreen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    superView: UIView? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    config: FullScreenableConfig? = <span class="literal">nil</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    completed: FullScreenableCompleteType? = <span class="literal">nil</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•æ˜¯å¯¹<code>switchFullScreen</code>çš„æŠ½ç¦»ï¼Œä½¿è°ƒç”¨æ—¶å¯¹å‚æ•°çš„ä¼ é€’æ›´åŠ æ¸…æ™°</p></blockquote><p>1ã€éµå®ˆåè®® <code>FullScreenable</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LXFFullScreenView</span>: <span class="title">UIButton</span>, <span class="title">FullScreenable</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cyanView = <span class="type">LXFFullScreenView</span>()</span><br></pre></td></tr></table></figure><p>2ã€è¿›å…¥å…¨å±</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyanView.lxf.enterFullScreen()</span><br></pre></td></tr></table></figure><p>3ã€é€€å‡ºå…¨å±<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cyanView.lxf.exitFullScreen()</span><br></pre></td></tr></table></figure></p><blockquote><p>è¿™é‡Œæ˜¯å¯¹éµå®ˆäº†<code>FullScreenable</code>åè®®çš„è§†å›¾è¿›å…¥å…¨å±åˆ‡æ¢ï¼Œç”±äºä»£ç å†…éƒ¨å·²ç»ç»è¿‡è‡ªåŠ¨è§†å›¾å¡«å†™ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š<code>specifiedView</code>å’Œ<code>superView</code></p></blockquote><p><img src="/images/2018/09/iOS é¢å‘åè®®å°è£…å…¨å±æ—‹è½¬åŠŸèƒ½/lxf_FullScreenable_2.gif" alt="lxf_FullScreenable_2"></p><h2 id="ä¸‰ã€FullScreenableConfigè¯´æ˜"><a href="#ä¸‰ã€FullScreenableConfigè¯´æ˜" class="headerlink" title="ä¸‰ã€FullScreenableConfigè¯´æ˜"></a>ä¸‰ã€FullScreenableConfigè¯´æ˜</h2><blockquote><p>ä¸Šè¿°çš„æ–¹æ³•éƒ½æœ‰ä¸€ä¸ª<code>config</code>å‚æ•°ï¼Œé»˜è®¤ä¸ºnilï¼Œå³ä¸ºé»˜è®¤é…ç½®</p></blockquote><p>ç›¸å…³å±æ€§è¯´æ˜<br>| Name                       | Type                     | Desc                           | Default        |<br>| â€”â€”â€”â€”â€”â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€“ |<br>| animateDuration            | <code>Double</code>                 | è¿›å…¥/é€€å‡º å…¨å±æ—¶çš„æ—‹è½¬åŠ¨ç”»æ—¶é—´ | 0.25           |<br>| enterFullScreenOrientation | <code>UIInterfaceOrientation</code> | è¿›å…¥å…¨å±æ—¶çš„åˆå§‹æ–¹å‘           | landscapeRight |</p><p>è¿™é‡Œæˆ‘ä»¬æŠŠåŠ¨ç”»æ—¶é—´è®¾ç½®ä¸º<code>1s</code>ï¼Œåˆå§‹æ–¹å‘ä¸º<code>å·¦</code>åæ¥çœ‹çœ‹æ•ˆæœ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FullScreenableConfig</span>(</span><br><span class="line">    animateDuration: <span class="number">1</span>,</span><br><span class="line">    enterFullScreenOrientation : .landscapeLeft</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cyanView.lxf.enterFullScreen(config: diyConfig)</span><br><span class="line">cyanView.lxf.exitFullScreen(config: diyConfig)</span><br></pre></td></tr></table></figure><p><img src="/images/2018/09/iOS é¢å‘åè®®å°è£…å…¨å±æ—‹è½¬åŠŸèƒ½/lxf_FullScreenable_3.gif" alt="lxf_FullScreenable_3"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>åˆ°è¿™é‡Œç›¸å…³çš„è¯´æ˜å·²ç½—åˆ—å®Œæ¯•ï¼Œæœ‰ä»€ä¹ˆä¸æ¸…æ¥šçš„å¯ä»¥ä¸‹è½½<a href="https://github.com/LinXunFeng/LXFProtocolTool/tree/master/Example/LXFProtocolTool/Demo/LXFFullScreenable" target="_blank" rel="noopener">Demo</a>çœ‹çœ‹ï¼Œæˆ–è€…åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€æé—®</p><p><a href="https://github.com/LinXunFeng/LXFProtocolTool" target="_blank" rel="noopener">LXFProtocolTool</a> ä¸»è¦æ˜¯é€šè¿‡åè®®çš„æ–¹å¼æ¥æ–¹ä¾¿å¿«æ·åœ°å®ç°ä¸€äº›çš„å®ç”¨åŠŸèƒ½ï¼Œé™¤äº†æœ¬æ–‡æåŠçš„å…¨å±æ—‹è½¬åŠŸèƒ½å¤–è¿˜æœ‰å…¶å®ƒå®ç”¨åŠŸèƒ½çš„å°è£…ï¼Œå…·ä½“å†…å®¹å¯ä»¥åˆ° <a href="https://github.com/LinXunFeng/LXFProtocolTool/wiki" target="_blank" rel="noopener">Wikié¦–é¡µ</a>  æŸ¥æ‰¾ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆæƒ³å®ç°çš„åŠŸèƒ½ä¹Ÿå¯ä»¥æå‡ºæ¥ï¼Œå–œæ¬¢çš„å°±ç»™ä¸ªStaré¼“åŠ±ä¸‹æˆ‘å§ ğŸš€ ğŸš€ ğŸš€ï¼Œæ„Ÿè°¢æ”¯æŒï¼</p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>AppRTCå®æˆ˜</title>
      <link href="/2018/06/07/AppRTC%E5%AE%9E%E6%88%98/"/>
      <url>/2018/06/07/AppRTC%E5%AE%9E%E6%88%98/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>è®°å½•AppRTCçš„æ­å»ºè¿‡ç¨‹ï¼Œå®ç°iOSã€Androidã€BrowseråŒå¼‚è®¾å¤‡çš„è§†é¢‘é€šä¿¡</p><a id="more"></a><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>1ã€è®°å½•AppRTCçš„æ­å»ºè¿‡ç¨‹ï¼Œå®ç°iOSã€å®‰å“ã€browseråŒå¼‚è®¾å¤‡çš„è§†é¢‘é€šä¿¡<br>2ã€ä»¥ä¸‹ç›´æ¥ä»¥rootèº«ä»½è¿›è¡Œæ“ä½œï¼Œæ‰€æœ‰çš„éœ€è¦ä¸‹è½½çš„æ–‡ä»¶å‡æ”¾ç½®äº<code>/root</code>ç›®å½•ä¸‹ï¼Œéœ€è¦çš„è¯ï¼Œå¯ä»¥è‡ªè¡Œå†³å®šå­˜æ”¾ä½ç½®ï¼Œä½†æ˜¯è¦æ³¨æ„ä¿®æ”¹ç›¸å…³çš„é…ç½®è·¯å¾„ï½</p></blockquote><h2 id="ä¸€ã€è®¾å¤‡é…ç½®"><a href="#ä¸€ã€è®¾å¤‡é…ç½®" class="headerlink" title="ä¸€ã€è®¾å¤‡é…ç½®"></a>ä¸€ã€è®¾å¤‡é…ç½®</h2><ul><li>é˜¿é‡Œäº‘ESCæœåŠ¡å™¨ Ubuntu 16.04 64ä½</li><li>è…¾è®¯äº‘åŸŸå</li></ul><h2 id="äºŒã€ç›¸å…³ç¯å¢ƒ"><a href="#äºŒã€ç›¸å…³ç¯å¢ƒ" class="headerlink" title="äºŒã€ç›¸å…³ç¯å¢ƒ"></a>äºŒã€ç›¸å…³ç¯å¢ƒ</h2><h3 id="1ã€JDK"><a href="#1ã€JDK" class="headerlink" title="1ã€JDK"></a>1ã€JDK</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add-apt-repository ppa:openjdk-r/ppa </span><br><span class="line">apt-get update </span><br><span class="line">apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h3 id="2ã€nodejs"><a href="#2ã€nodejs" class="headerlink" title="2ã€nodejs"></a>2ã€nodejs</h3><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">nodejså®˜ç½‘</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// è¿™é‡Œçš„ç‰ˆæœ¬8.xå¯ä»¥æŒ‰è‡ªå·±çš„éœ€æ±‚å»ä¿®æ”¹</span><br><span class="line">curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -</span><br><span class="line">apt-get install -y nodejs</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆçš„nodejså’Œnpmäº†,å¯ä»¥ä½¿ç”¨<code>-v</code>æ¥æŸ¥çœ‹å½“å‰ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><p>å®‰è£…<code>grunt-cli</code>ï¼Œåé¢éœ€è¦<code>grunt</code>æ¥æ„å»ºæˆ¿é—´æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm -g install grunt-cli</span><br></pre></td></tr></table></figure><h3 id="3ã€pythonä¸python-webtest"><a href="#3ã€pythonä¸python-webtest" class="headerlink" title="3ã€pythonä¸python-webtest"></a>3ã€pythonä¸python-webtest</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python </span><br><span class="line">apt-get install python-webtest</span><br></pre></td></tr></table></figure><h3 id="libevent"><a href="#libevent" class="headerlink" title="libevent"></a>libevent</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-cache search libevent</span><br><span class="line">apt-get install libevent-dev</span><br></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€Room-Server-æˆ¿é—´æœåŠ¡å™¨"><a href="#ä¸‰ã€Room-Server-æˆ¿é—´æœåŠ¡å™¨" class="headerlink" title="ä¸‰ã€Room Server æˆ¿é—´æœåŠ¡å™¨"></a>ä¸‰ã€Room Server æˆ¿é—´æœåŠ¡å™¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone  https://github.com/webrtc/apprtc.git   </span><br><span class="line">cd apprtc</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><h3 id="1ã€é…ç½®-constants-py"><a href="#1ã€é…ç½®-constants-py" class="headerlink" title="1ã€é…ç½® constants.py"></a>1ã€é…ç½® constants.py</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰ç›®å½• -- apprtc</span><br><span class="line">vim src/app_engine/constants.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™éƒ¨åˆ†ä¸º æ·»åŠ </span></span><br><span class="line">TURN_BASE_URL = <span class="string">'https://linxunfeng.top'</span> <span class="comment"># ä¿®æ”¹ä¸ºä½ è‡ªå·±å½“å‰æœåŠ¡å™¨çš„åŸŸåï¼Œä¸‹é¢çš„äº¦æ˜¯å¦‚æ­¤</span></span><br><span class="line">TURN_URL_TEMPLATE = <span class="string">'%s/turn.php?username=%s&amp;key=%s'</span> <span class="comment">#å¦‚æœturn.phpæœªå®ç°ï¼Œå¯ä½¿ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line">CEOD_KEY = <span class="string">'lxf'</span> <span class="comment"># è¿™ä¸ªå¾ˆé‡è¦ï¼Œåé¢é…ç½®turnæ—¶éœ€è¦ç”¨åˆ°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™éƒ¨åˆ†ä¸º ä¿®æ”¹</span></span><br><span class="line">ICE_SERVER_BASE_URL = <span class="string">'https://linxunfeng.top'</span></span><br><span class="line">ICE_SERVER_URL_TEMPLATE = <span class="string">'%s/iceconfig.php?key=%s'</span> <span class="comment">#å¦‚æœiceconfig.phpæœªå®ç°ï¼Œå¯ç”¨é»˜è®¤é…ç½®ï¼Œä½†æ˜¯Android Apkä¼šæœ‰é—®é¢˜</span></span><br><span class="line">ICE_SERVER_API_KEY = os.environ.get(<span class="string">'ICE_SERVER_API_KEY'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dictionary keys in the collider instance info constant.</span></span><br><span class="line">WSS_INSTANCE_HOST_KEY = <span class="string">'linxunfeng.top:8089'</span> <span class="comment">#ä¿¡ä»¤æœåŠ¡å™¨ç«¯å£å·8089  </span></span><br><span class="line">WSS_INSTANCE_NAME_KEY = <span class="string">'vm_name'</span></span><br><span class="line">WSS_INSTANCE_ZONE_KEY = <span class="string">'zone'</span></span><br><span class="line">WSS_INSTANCES = [&#123;</span><br><span class="line">    WSS_INSTANCE_HOST_KEY: <span class="string">'linxunfeng.top:8089'</span>,</span><br><span class="line">    WSS_INSTANCE_NAME_KEY: <span class="string">'wsserver-std'</span>,</span><br><span class="line">    WSS_INSTANCE_ZONE_KEY: <span class="string">'us-central1-a'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    WSS_INSTANCE_HOST_KEY: <span class="string">'linxunfeng.top:8089'</span>,</span><br><span class="line">    WSS_INSTANCE_NAME_KEY: <span class="string">'wsserver-std-2'</span>,</span><br><span class="line">    WSS_INSTANCE_ZONE_KEY: <span class="string">'us-central1-f'</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h3 id="2ã€ç¼–è¯‘"><a href="#2ã€ç¼–è¯‘" class="headerlink" title="2ã€ç¼–è¯‘"></a>2ã€ç¼–è¯‘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰ç›®å½• -- apprtc</span><br><span class="line">grunt build</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å¥½å<code>apprtc</code>ç›®å½•ä¸‹å°±ä¼šå¤šå‡ºä¸€ä¸ªåä¸º<code>out</code>çš„ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾çš„å°±æ˜¯ç¼–è¯‘å¥½çš„<code>room server</code></p><h3 id="3ã€GoogleAppEngineçš„å®‰è£…ä¸é…ç½®"><a href="#3ã€GoogleAppEngineçš„å®‰è£…ä¸é…ç½®" class="headerlink" title="3ã€GoogleAppEngineçš„å®‰è£…ä¸é…ç½®"></a>3ã€GoogleAppEngineçš„å®‰è£…ä¸é…ç½®</h3><p>å®˜ç½‘ï¼š<a href="https://cloud.google.com/appengine/downloads#Google_App_Engine_SDK_for_Python" target="_blank" rel="noopener">GoogleAppEngine</a></p><p>å¯ä»¥åœ¨æ­¤è·¯å¾„æ‰¾æœ€æ–°ç‰ˆæœ¬</p><blockquote><p>GoogleAppEngine -&gt; Python -&gt; Download and install the original App Engine SDK for Python.</p></blockquote><p>ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸ºï¼š<a href="https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.70.zip" target="_blank" rel="noopener">google_appengine_1.9.70.zip</a></p><ul><li>ä¸‹è½½ GoogleAppEngine</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.70.zip</span><br></pre></td></tr></table></figure><ul><li>è§£å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip google_appengine_1.9.70.zip</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH="$PATH:/root/google_appengine/"</span><br></pre></td></tr></table></figure><ul><li>åº”ç”¨ç¯å¢ƒå˜é‡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="4ã€å¼€å¯-Room-Server"><a href="#4ã€å¼€å¯-Room-Server" class="headerlink" title="4ã€å¼€å¯ Room Server"></a>4ã€å¼€å¯ Room Server</h3><ul><li>åŸºæœ¬å‘½ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰è·¯å¾„ -- /root/google_appengine</span><br><span class="line">./dev_appserver.py --host=linxunfeng.top ../apprtc/out/app_engine/</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œè¿™é‡Œå°±ä¸èƒ½ç”¨åŸŸå<code>linxunfeng.top</code>æ¥å¯åŠ¨<code>room server</code>ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°ç½‘å¡åœ°å€</strong>ï¼Œå¦åˆ™å°±ä¼šæç¤º</p><blockquote><p>raise BindError(â€˜Unable to bind %s:%sâ€™ % self.bind_addr)<br>google.appengine.tools.devappserver2.wsgi_server.BindError: Unable to bind linxunfeng.top:8080</p></blockquote><ul><li>æŸ¥çœ‹ç½‘å¡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@xxx:~/google_appengine# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:16:3e:08:b4:02  </span><br><span class="line">          inet addr:172.18.141.108  Bcast:172.18.143.255  Mask:255.255.240.0</span><br><span class="line">          ...</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dev_appserver.py --host=172.18.141.108 ../apprtc/out/app_engine/</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¥½äº†å—ï¼Ÿä¸ï¼Œè™½ç„¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯ä½ ç”¨æµè§ˆå™¨æ‰“å¼€ä½ çš„åŸŸåçœ‹çœ‹â€¦<br>è¿™é‡Œç›´æ¥ç»™å‡ºæœ€ç»ˆå‘½ä»¤ï¼Œå…·ä½“åŸå› çœ‹ <a href="#1ã€Request-host-is-not-whitelist-enabled">ç–‘éš¾æ‚ç—‡ - 1</a></p><ul><li>æœ€ç»ˆå‘½ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./dev_appserver.py --enable_host_checking=false --host=172.18.141.108 ../apprtc/out/app_engine/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å¦‚æœæƒ³ç›´æ¥åå°è¿è¡Œï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</span><br><span class="line">nohup ./dev_appserver.py --enable_host_checking=false --host=172.18.141.108 ../apprtc/out/app_engine/ &amp;</span><br></pre></td></tr></table></figure><ul><li>è®¿é—® room server</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://åŸŸå:8080</span><br></pre></td></tr></table></figure><h2 id="å››ã€Collider-Server-ä¿¡ä»¤æœåŠ¡å™¨"><a href="#å››ã€Collider-Server-ä¿¡ä»¤æœåŠ¡å™¨" class="headerlink" title="å››ã€Collider Server ä¿¡ä»¤æœåŠ¡å™¨"></a>å››ã€Collider Server ä¿¡ä»¤æœåŠ¡å™¨</h2><h3 id="1ã€æ‹·è´collideræºç "><a href="#1ã€æ‹·è´collideræºç " class="headerlink" title="1ã€æ‹·è´collideræºç "></a>1ã€æ‹·è´collideræºç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰è·¯å¾„ -- /root</span><br><span class="line">mkdir -p goWorkspace/src</span><br></pre></td></tr></table></figure><p>æŠŠ<code>apprtc/src/collider/</code>ç›®å½•ä¸‹çš„ä¸‰ä¸ªç›®å½•ï¼ˆcolliderã€collidermainã€collidertestï¼‰å¤åˆ¶åˆ°<code>goWorkspace/src/</code>ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rf apprtc/src/collider/* /goWorkspace/src</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹ä»£ç "><a href="#2ã€ä¿®æ”¹ä»£ç " class="headerlink" title="2ã€ä¿®æ”¹ä»£ç "></a>2ã€ä¿®æ”¹ä»£ç </h3><ul><li>ä¿®æ”¹æˆ¿é—´æœåŠ¡å™¨çš„åœ°å€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> goWorkspace/src/collidermain/main.go</span><br><span class="line">var roomSrv = flag.String("room-server", "https://åŸŸå", "The origin of the room server")</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ç½‘ç«™è¯ä¹¦è·¯å¾„</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> goWorkspace/src/collider/collider.go</span><br><span class="line"></span><br><span class="line">e = server.ListenAndServeTLS("/etc/letsencrypt/live/åŸŸå/fullchain.pem", "/etc/letsencrypt/live/åŸŸå/privkey.pem")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å¦‚ï¼š</span><br><span class="line">e = server.ListenAndServeTLS("/etc/letsencrypt/live/linxunfeng.top/fullchain.pem", "/etc/letsencrypt/live/linxunfeng.top/privkey.pem")</span><br></pre></td></tr></table></figure><p>ç›¸å…³çš„SSLè¯ä¹¦<code>fullchain.pem</code>å’Œ<code>privkey.pem</code>åœ¨åé¢çš„nginxé…ç½®ä¸­ä¼šæåˆ°ï¼Œè¿™é‡Œå…ˆå†™ä¸Š</p><h3 id="3ã€å®‰è£…ä¸é…ç½®ç¯å¢ƒ"><a href="#3ã€å®‰è£…ä¸é…ç½®ç¯å¢ƒ" class="headerlink" title="3ã€å®‰è£…ä¸é…ç½®ç¯å¢ƒ"></a>3ã€å®‰è£…ä¸é…ç½®ç¯å¢ƒ</h3><ul><li>ä¸‹è½½GOè¯­è¨€ç¯å¢ƒ</li></ul><p>FQ åˆ° <a href="https://golang.org/dl/" target="_blank" rel="noopener">GOå®˜ç½‘</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬</p><p>å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼š<a href="https://dl.google.com/go/go1.10.2.linux-amd64.tar.gz" target="_blank" rel="noopener">go1.10.2.linux-amd64.tar.gz</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰è·¯å¾„ -- /root</span><br><span class="line">wget https://dl.google.com/go/go1.10.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹profile</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>profile</code>åæ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GOROOT=/root/go</span><br><span class="line">export GOPATH=/root/goWorkspace</span><br><span class="line">export PATH=$PATH:$GOROOT/bin:$GOPATH/bin</span><br></pre></td></tr></table></figure><ul><li>åº”ç”¨ç¯å¢ƒå˜é‡</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–è¯‘"><a href="#4ã€ç¼–è¯‘" class="headerlink" title="4ã€ç¼–è¯‘"></a>4ã€ç¼–è¯‘</h3><p>è¿›å…¥ç›®å½• <code>goWorkspace/src/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get collidermain</span><br><span class="line">go install collidermain</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç¼–è¯‘è¿‡ç¨‹éœ€è¦ç¿»å¢™ï¼Œå¦‚æœæ— æ³•ç¿»å¢™ï¼Œè¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼Œå¦‚æœå¯ä»¥åˆ™ç›´æ¥è·³è‡³ç¬¬5å°ç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰è·¯å¾„ -- /root/goWorkspace/src</span><br><span class="line">mkdir -p golang.org/x </span><br><span class="line">cd golang.org/x/</span><br><span class="line">git clone https://github.com/golang/net</span><br></pre></td></tr></table></figure><p><code>git clone</code>æˆåŠŸåå†æ‰§è¡Œä¸Šé¢çš„ä¸¤è¡Œç¼–è¯‘å‘½ä»¤</p><h3 id="5ã€å¼€å¯-Collider-Server"><a href="#5ã€å¼€å¯-Collider-Server" class="headerlink" title="5ã€å¼€å¯ Collider Server"></a>5ã€å¼€å¯ Collider Server</h3><p>è¿›å…¥<code>goWorkspace</code>ä¸‹çš„<code>bin</code>ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å½“å‰è·¯å¾„ -- /root/goWorkspace/bin</span><br><span class="line"><span class="meta">#</span> -tls=true : æŒ‡éœ€è¦æ•°å­—è¯ä¹¦</span><br><span class="line">./collidermain -port=8089 -tls=true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å¦‚æœæƒ³ç›´æ¥åå°è¿è¡Œï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</span><br><span class="line">nohup ./collidermain -port=8089 -tls=true &amp;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€STUN-TURNæœåŠ¡å™¨"><a href="#äº”ã€STUN-TURNæœåŠ¡å™¨" class="headerlink" title="äº”ã€STUN\TURNæœåŠ¡å™¨"></a>äº”ã€STUN\TURNæœåŠ¡å™¨</h2><h3 id="1ã€å®‰è£…coturn"><a href="#1ã€å®‰è£…coturn" class="headerlink" title="1ã€å®‰è£…coturn"></a>1ã€å®‰è£…<code>coturn</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install coturn</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹é…ç½®"><a href="#2ã€ä¿®æ”¹é…ç½®" class="headerlink" title="2ã€ä¿®æ”¹é…ç½®"></a>2ã€ä¿®æ”¹é…ç½®</h3><ul><li>coturn</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/coturn</span><br></pre></td></tr></table></figure><p>æŠŠTURNSERVER_ENABLED=1çš„æ³¨é‡Šå»æ‰</p><ul><li>turnserver.conf</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/turnserver.conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">listening-device=eth0 #æ­¤å¤„eth0æ˜¯ç”µè„‘ç½‘å¡åç§°</span><br><span class="line">listening-port=3478 #turnæœåŠ¡å™¨çš„ç«¯å£å·</span><br><span class="line">relay-device=eth0 #æ­¤å¤„eth0æ˜¯ç”µè„‘ç½‘å¡åç§°</span><br><span class="line">min-port=49152</span><br><span class="line">max-port=65535</span><br><span class="line">Verbose</span><br><span class="line">fingerprint</span><br><span class="line">lt-cred-mech</span><br><span class="line">use-auth-secret</span><br><span class="line">static-auth-secret=lxf #æ­¤å¤„è¦å’Œæˆ¿é—´æœåŠ¡å™¨é…ç½®æ—¶constants.pyæ–‡ä»¶ä¸­çš„CODE_KEYä¿æŒä¸€è‡´ã€‚</span><br><span class="line">user=lxf:0x8638170519dd1309044bca55319ff929</span><br><span class="line">user=lxf:lxf</span><br><span class="line">stale-nonce</span><br><span class="line">cert=/usr/local/etc/turn_server_cert.pem</span><br><span class="line">pkey=/usr/local/etc/turn_server_pkey.pem</span><br><span class="line">no-loopback-peers</span><br><span class="line">no-multicast-peers</span><br><span class="line">mobility</span><br><span class="line">no-cli</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–‡ä»¶ä¸­ 0x8638170519dd1309044bca55319ff929ï¼š </p><p><code>turnadmin -k -u lxf -r north.gov -p lxf</code></p><blockquote><p>-k è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªlong-term credential key<br>-u è¡¨ç¤ºç”¨æˆ·å<br>-p è¡¨ç¤ºå¯†ç <br>-r è¡¨ç¤ºRealmåŸŸ</p></blockquote><p>coturnçš„è¯ä¹¦ç”Ÿæˆï¼ˆå³é…ç½®æ–‡ä»¶ä¸­certå’Œpkey)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -newkey rsa:2048 -keyout /usr/local/etc/turn_server_pkey.pem -out /usr/local/etc/turn_server_cert.pem -days 99999 -nodes</span><br></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨coturnæœåŠ¡å™¨"><a href="#3ã€å¯åŠ¨coturnæœåŠ¡å™¨" class="headerlink" title="3ã€å¯åŠ¨coturnæœåŠ¡å™¨"></a>3ã€å¯åŠ¨coturnæœåŠ¡å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service coturn start</span><br></pre></td></tr></table></figure><p>ç”¨æµè§ˆå™¨æ‰“å¼€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://åŸŸå:3478</span><br></pre></td></tr></table></figure></p><p>æ˜¾ç¤ºå¦‚ä¸‹å†…å®¹åˆ™è¯´æ˜æˆåŠŸå¼€å¯æœåŠ¡</p><blockquote><p>TURN Server<br>use https connection for the admin session</p></blockquote><h2 id="å…­ã€é…ç½®nginxæœåŠ¡å™¨"><a href="#å…­ã€é…ç½®nginxæœåŠ¡å™¨" class="headerlink" title="å…­ã€é…ç½®nginxæœåŠ¡å™¨"></a>å…­ã€é…ç½®nginxæœåŠ¡å™¨</h2><h3 id="1ã€ç”ŸæˆSSLè¯ä¹¦"><a href="#1ã€ç”ŸæˆSSLè¯ä¹¦" class="headerlink" title="1ã€ç”ŸæˆSSLè¯ä¹¦"></a>1ã€ç”ŸæˆSSLè¯ä¹¦</h3><p>è¿™é‡Œä½¿ç”¨letâ€™s encrypté¢å‘çš„å…è´¹SSLè¯ä¹¦ <a href="https://certbot.eff.org" target="_blank" rel="noopener">certbot.eff.org</a></p><ul><li>å®‰è£…è½¯ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update  </span><br><span class="line">apt-get install software-properties-common  </span><br><span class="line">add-apt-repository ppa:certbot/certbot  </span><br><span class="line">apt-get update </span><br><span class="line">apt-get install python-certbot-nginx</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿæˆè¯ä¹¦</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --nginx certonly</span><br></pre></td></tr></table></figure><p>SSLè¯ä¹¦ç”Ÿæˆçš„ç›®å½•ä¸ºï¼š<code>/etc/letsencrypt/live/åŸŸå/</code>ï¼Œé‡Œé¢å­˜æ”¾ç€å››ä¸ªæ–‡ä»¶<code>cert.pem,chain.pem,fullchain.pem,privkey.pem</code></p><h3 id="2ã€å®‰è£…phpå’Œphp-fpm"><a href="#2ã€å®‰è£…phpå’Œphp-fpm" class="headerlink" title="2ã€å®‰è£…phpå’Œphp-fpm"></a>2ã€å®‰è£…phpå’Œphp-fpm</h3><ul><li>å®‰è£…phpå’Œphp-fpm</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install php  </span><br><span class="line">apt-get install php7.0-fpm</span><br></pre></td></tr></table></figure><h3 id="3ã€å®‰è£…ä¸é…ç½®nginx"><a href="#3ã€å®‰è£…ä¸é…ç½®nginx" class="headerlink" title="3ã€å®‰è£…ä¸é…ç½®nginx"></a>3ã€å®‰è£…ä¸é…ç½®nginx</h3><ul><li>å®‰è£…nginx</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nginx</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹nginxé…ç½®</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p>å°†ä¸‹é¢çš„<code>linxunfeng.top</code>ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„åŸŸå</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">upstream roomserver &#123;</span><br><span class="line">       server linxunfeng.top:8080;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">       listen 80 ;</span><br><span class="line">       server_name linxunfeng.top; </span><br><span class="line">       return  301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        #listen 80 default_server;</span><br><span class="line">        #listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">        # SSL configuration</span><br><span class="line">        #</span><br><span class="line">        # listen 443 ssl default_server;</span><br><span class="line">        # listen [::]:443 ssl default_server;</span><br><span class="line">        listen 443;</span><br><span class="line">        #</span><br><span class="line">        # Note: You should disable gzip for SSL traffic.</span><br><span class="line">        # See: https://bugs.debian.org/773332</span><br><span class="line">        #</span><br><span class="line">        # Read up on ssl_ciphers to ensure a secure configuration.</span><br><span class="line">        # See: https://bugs.debian.org/765782</span><br><span class="line">        #</span><br><span class="line">        # Self signed certs generated by the ssl-cert package</span><br><span class="line">        # Don't use them in a production server!</span><br><span class="line">        #</span><br><span class="line">        # include snippets/snakeoil.conf;</span><br><span class="line"></span><br><span class="line">        root /var/www/html;</span><br><span class="line"></span><br><span class="line">        # Add index.php to the list if you are using PHP</span><br><span class="line">        index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        server_name linxunfeng.top; # æ·»åŠ åŸŸåï¼Œå¦‚ä¸æ·»åŠ ï¼Œç”ŸæˆSSLè¯ä¹¦æ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜</span><br><span class="line"></span><br><span class="line">        #location / &#123;</span><br><span class="line">                # First attempt to serve request as file, then</span><br><span class="line">                # as directory, then fall back to displaying a 404.</span><br><span class="line">        #       try_files $uri $uri/ =404;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">                include snippets/fastcgi-php.conf;</span><br><span class="line">        #</span><br><span class="line">        #       # With php7.0-cgi alone:</span><br><span class="line">        #       fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        #       # With php7.0-fpm:</span><br><span class="line">                fastcgi_pass unix:/run/php/php7.0-fpm.sock;</span><br><span class="line">        &#125;</span><br><span class="line">        location / &#123; </span><br><span class="line">                proxy_pass http://roomserver$request_uri;</span><br><span class="line">                proxy_set_header Host $host;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate /etc/letsencrypt/live/linxunfeng.top/fullchain.pem;</span><br><span class="line">        ssl_certificate_key /etc/letsencrypt/live/linxunfeng.top/privkey.pem;</span><br><span class="line">        </span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #       deny all;</span><br><span class="line">        #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="turn-php-ä¸-iceconfig-php"><a href="#turn-php-ä¸-iceconfig-php" class="headerlink" title="turn.php ä¸ iceconfig.php"></a>turn.php ä¸ iceconfig.php</h3><p>åœ¨<code>/var/www/html/</code>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch turn.php iceconfig.php</span><br></pre></td></tr></table></figure><h4 id="turn-php"><a href="#turn-php" class="headerlink" title="turn.php"></a>turn.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $request_username = $_GET[<span class="string">"username"</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($request_username)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username == null"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $request_key = $_GET[<span class="string">"key"</span>];</span><br><span class="line">    $time_to_live = <span class="number">600</span>;</span><br><span class="line">    $timestamp = time() + $time_to_live;<span class="comment">//å¤±æ•ˆæ—¶é—´</span></span><br><span class="line">    $response_username = $timestamp.<span class="string">":"</span>.$_GET[<span class="string">"username"</span>];</span><br><span class="line">    $response_key = $request_key;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($response_key)) &#123;</span><br><span class="line">        $response_key = <span class="string">"code_key"</span>;</span><br><span class="line">    &#125; <span class="comment">//constants.pyä¸­CEOD_KEY</span></span><br><span class="line">    $response_password = getSignature($response_username, $response_key);</span><br><span class="line">    $jsonObj = <span class="keyword">new</span> Response();</span><br><span class="line">    $jsonObj-&gt;username = $response_username;</span><br><span class="line">    $jsonObj-&gt;password = $response_password;</span><br><span class="line">    $jsonObj-&gt;ttl = <span class="number">86400</span>;</span><br><span class="line">    <span class="comment">//æ­¤å¤„éœ€é…ç½®è‡ªå·±çš„æœåŠ¡å™¨</span></span><br><span class="line">    $jsonObj-&gt;uris= <span class="keyword">array</span>(<span class="string">"stun:linxunfeng.top:3478"</span>,<span class="string">"turn:linxunfeng.top:3478?transport=udp"</span>,<span class="string">"turn:linxunfeng.top?transport=tcp"</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode($jsonObj);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨HMAC-SHA1ç®—æ³•ç”Ÿæˆç­¾åå€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $str æºä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $key å¯†é’¥</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç­¾åå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSignature</span><span class="params">($str, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $signature = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (function_exists(<span class="string">'hash_hmac'</span>)) &#123;</span><br><span class="line">        $signature = base64_encode(hash_hmac(<span class="string">"sha1"</span>, $str, $key, <span class="keyword">true</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $blocksize = <span class="number">64</span>;</span><br><span class="line">        $hashfunc = <span class="string">'sha1'</span>;</span><br><span class="line">        <span class="keyword">if</span> (strlen($key) &gt; $blocksize) &#123;</span><br><span class="line">            $key = pack(<span class="string">'H*'</span>, $hashfunc($key));</span><br><span class="line">        &#125;</span><br><span class="line">        $key = str_pad($key, $blocksize, chr(<span class="number">0x00</span>));</span><br><span class="line">        $ipad = str_repeat(chr(<span class="number">0x36</span>), $blocksize);</span><br><span class="line">        $opad = str_repeat(chr(<span class="number">0x5c</span>), $blocksize);</span><br><span class="line">        $hmac = pack(</span><br><span class="line"><span class="string">'H*'</span>,</span><br><span class="line">    $hashfunc(</span><br><span class="line">($key ^ $opad) . pack(</span><br><span class="line"><span class="string">'H*'</span>,</span><br><span class="line">    $hashfunc(</span><br><span class="line">($key ^ $ipad) . $str</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">);</span><br><span class="line">        $signature = base64_encode($hmac);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $signature;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Response</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $username = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $password = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $ttl = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $uris = <span class="keyword">array</span>(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>iceconfig.php</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $request_username = <span class="string">"lxf"</span>;  <span class="comment">//é…ç½®æˆè‡ªå·±çš„turnæœåŠ¡å™¨ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($request_username)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username == null"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $request_key = <span class="string">"lxf"</span>;  <span class="comment">//é…ç½®æˆè‡ªå·±çš„turnæœåŠ¡å™¨å¯†ç </span></span><br><span class="line">    $time_to_live = <span class="number">600</span>;</span><br><span class="line">    $timestamp = time() + $time_to_live;<span class="comment">//å¤±æ•ˆæ—¶é—´</span></span><br><span class="line">    $response_username = $timestamp.<span class="string">":"</span>.$_GET[<span class="string">"username"</span>];</span><br><span class="line">    $response_key = $request_key;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($response_key)) &#123;</span><br><span class="line">        $response_key = <span class="string">"CEOD_KEY"</span>;</span><br><span class="line">    &#125;<span class="comment">//constants.pyä¸­CEOD_KEY</span></span><br><span class="line">    $response_password = getSignature($response_username, $response_key);</span><br><span class="line">    $arrayObj = <span class="keyword">array</span>();</span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'username'</span>] = $response_username;</span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'credential'</span>] = $response_password;</span><br><span class="line">    <span class="comment">//é…ç½®æˆè‡ªå·±çš„stun/turnæœåŠ¡å™¨</span></span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'urls'</span>][<span class="number">0</span>] = <span class="string">"stun:linxunfeng.top:3478"</span>;</span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'urls'</span>][<span class="number">1</span>] = <span class="string">"turn:linxunfeng.top:3478?transport=tcp"</span>;</span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'uris'</span>][<span class="number">0</span>] = <span class="string">"stun:linxunfeng.top:3478"</span>;</span><br><span class="line">    $arrayObj[<span class="number">0</span>][<span class="string">'uris'</span>][<span class="number">1</span>] = <span class="string">"turn:linxunfeng.top:3478?transport=tcp"</span>;</span><br><span class="line">    $jsonObj = <span class="keyword">new</span> Response();</span><br><span class="line">    $jsonObj-&gt;lifetimeDuration = <span class="string">"300.000s"</span>;</span><br><span class="line">    $jsonObj-&gt;iceServers = $arrayObj;</span><br><span class="line">    <span class="keyword">echo</span> json_encode($jsonObj);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨HMAC-SHA1ç®—æ³•ç”Ÿæˆç­¾åå€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $str æºä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $key å¯†é’¥</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç­¾åå€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSignature</span><span class="params">($str, $key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $signature = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (function_exists(<span class="string">'hash_hmac'</span>)) &#123;</span><br><span class="line">        $signature = base64_encode(hash_hmac(<span class="string">"sha1"</span>, $str, $key, <span class="keyword">true</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $blocksize = <span class="number">64</span>;</span><br><span class="line">        $hashfunc = <span class="string">'sha1'</span>;</span><br><span class="line">        <span class="keyword">if</span> (strlen($key) &gt; $blocksize) &#123;</span><br><span class="line">            $key = pack(<span class="string">'H*'</span>, $hashfunc($key));</span><br><span class="line">        &#125;</span><br><span class="line">        $key = str_pad($key, $blocksize, chr(<span class="number">0x00</span>));</span><br><span class="line">        $ipad = str_repeat(chr(<span class="number">0x36</span>), $blocksize);</span><br><span class="line">        $opad = str_repeat(chr(<span class="number">0x5c</span>), $blocksize);</span><br><span class="line">        $hmac = pack(</span><br><span class="line"><span class="string">'H*'</span>,</span><br><span class="line">    $hashfunc(</span><br><span class="line">($key ^ $opad) . pack(</span><br><span class="line"><span class="string">'H*'</span>,</span><br><span class="line">    $hashfunc(</span><br><span class="line">($key ^ $ipad) . $str</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">);</span><br><span class="line">        $signature = base64_encode($hmac);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $signature;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Response</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $username = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $password = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $ttl = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">public</span> $uris = <span class="keyword">array</span>(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é‡å¯NginxæœåŠ¡å™¨å’Œphp7.0-fpm</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart </span><br><span class="line">service php7.0-fpm restart</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€å„ç«¯è¿è¡Œæµ‹è¯•"><a href="#ä¸ƒã€å„ç«¯è¿è¡Œæµ‹è¯•" class="headerlink" title="ä¸ƒã€å„ç«¯è¿è¡Œæµ‹è¯•"></a>ä¸ƒã€å„ç«¯è¿è¡Œæµ‹è¯•</h2><h3 id="1ã€Browser"><a href="#1ã€Browser" class="headerlink" title="1ã€Browser"></a>1ã€Browser</h3><p>æµè§ˆå™¨ç›´æ¥æ‰“å¼€å³å¯ï¼Œå¦‚æœä¸èƒ½è®¿é—®æ‘„åƒå¤´ä¹‹ç±»çš„ï¼Œè¯·æŸ¥çœ‹<a href="#2ã€æµè§ˆå™¨æ— æ³•è®¿é—®æ‘„åƒå¤´">ç–‘éš¾æ‚ç—‡ - 2</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://åŸŸå</span><br></pre></td></tr></table></figure><h3 id="2ã€Android"><a href="#2ã€Android" class="headerlink" title="2ã€Android"></a>2ã€Android</h3><p><a href="https://github.com/duqian291902259/webrtc-android-demo-apprtc" target="_blank" rel="noopener">webrtc-android-demo-apprtc</a></p><p>ç›´æ¥å®‰è£…æ‰‹æœºï¼Œæ‰“å¼€è½¯ä»¶ï¼Œç‚¹å‡»å³ä¸Šè§’çš„æ‰³æ‰‹è·³è½¬è‡³è®¾ç½®ç•Œé¢ï¼Œæ»šåˆ°ç•Œé¢æœ€ä¸‹æ–¹ï¼Œæ‰¾åˆ°<code>Room server URL.</code>ï¼Œå°†å…¶ä¿®æ”¹ä¸ºåˆšåˆšæ­å»ºå¥½çš„æœåŠ¡å™¨åŸŸåå³å¯ï¼Œå¦‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://linxunfeng.top</span><br></pre></td></tr></table></figure><h3 id="3ã€iOS"><a href="#3ã€iOS" class="headerlink" title="3ã€iOS"></a>3ã€iOS</h3><p><a href="https://github.com/ISBX/apprtc-ios" target="_blank" rel="noopener">GitHub - ISBX/apprtc-ios</a></p><p>æ‰“å¼€<code>AppRTC</code>é¡¹ç›®ï¼Œåˆ†åˆ«ä¿®æ”¹ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶</p><p><code>ARTCVideoChatViewController.m</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define SERVER_HOST_URL @<span class="meta-string">"https://linxunfeng.top"</span></span></span><br></pre></td></tr></table></figure><p><code>Pods -&gt; Development Pods -&gt; AppRTC -&gt; Lib -&gt; ARDAppClient.m</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *kARDRoomServerHostUrl =</span><br><span class="line">    <span class="string">@"https://linxunfeng.top"</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *kARDDefaultSTUNServerUrl =</span><br><span class="line">    <span class="string">@"stun:linxunfeng.top:3478"</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *kARDTurnRequestUrl =</span><br><span class="line">    <span class="string">@"https://linxunfeng.top"</span></span><br><span class="line">    <span class="string">@"/turn?username=lxf&amp;key=lxf"</span>;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœç´¢ kARDDefaultSTUNServerUrl </span></span><br><span class="line">- (RTCICEServer *)defaultSTUNServer &#123;</span><br><span class="line">  <span class="built_in">NSURL</span> *defaultSTUNServerURL = [<span class="built_in">NSURL</span> URLWithString:kARDDefaultSTUNServerUrl];</span><br><span class="line">  <span class="keyword">return</span> [[RTCICEServer alloc] initWithURI:defaultSTUNServerURL</span><br><span class="line">                                  username:<span class="string">@"lxf"</span></span><br><span class="line">                                  password:<span class="string">@"lxf"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç–‘éš¾æ‚ç—‡"><a href="#ç–‘éš¾æ‚ç—‡" class="headerlink" title="ç–‘éš¾æ‚ç—‡"></a>ç–‘éš¾æ‚ç—‡</h2><h3 id="1ã€Request-host-is-not-whitelist-enabled"><a href="#1ã€Request-host-is-not-whitelist-enabled" class="headerlink" title="1ã€Request host is not whitelist enabled"></a>1ã€Request host is not whitelist enabled</h3><blockquote><p>å…·ä½“æç¤º<br>Request host is not whitelist enabled for this server. Please use the â€“host command-line flag to whitelist a specific host (recommended) or use â€“enable_host_checking to disable host checking. See the command-line flags help text for more information. </p></blockquote><p><a href="https://stackoverflow.com/questions/47988810/use-ngrok-url-as-callback-url-for-facebook-webhook-but-is-recognized-not-white" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a></p><p>æ‰§è¡Œdev_appserver.pyæ—¶ï¼ŒåŠ ä¸Šå¦‚ä¸‹å‚æ•°<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--enable_host_checking=false</span><br></pre></td></tr></table></figure></p><p>å®Œæ•´æŒ‡ä»¤<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dev_appserver.py --enable_host_checking=false --host=172.18.141.108 ../apprtc/out/app_engine/</span><br></pre></td></tr></table></figure></p><h3 id="2ã€æµè§ˆå™¨æ— æ³•è®¿é—®æ‘„åƒå¤´"><a href="#2ã€æµè§ˆå™¨æ— æ³•è®¿é—®æ‘„åƒå¤´" class="headerlink" title="2ã€æµè§ˆå™¨æ— æ³•è®¿é—®æ‘„åƒå¤´"></a>2ã€æµè§ˆå™¨æ— æ³•è®¿é—®æ‘„åƒå¤´</h3><p>æµè§ˆå™¨è®¿é—®è®¾å¤‡çš„æ‘„åƒå¤´æ˜¯éœ€è¦ä½¿ç”¨<code>https</code>é“¾æ¥æˆ–è€…<code>localhost</code>æ¥è®¿é—®</p><h3 id="3ã€ç«¯å£"><a href="#3ã€ç«¯å£" class="headerlink" title="3ã€ç«¯å£"></a>3ã€ç«¯å£</h3><p>é˜¿é‡Œäº‘ç­‰å›½å†…å¤§å‚æä¾›çš„æœåŠ¡å™¨åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ä¸ªå«å®‰å…¨ç»„çš„ç©æ„å„¿ï¼Œæˆ‘ä»¬æ­å»ºAppRTCæœåŠ¡å™¨çš„æ‰€æœ‰æœåŠ¡æ‰€éœ€çš„ç«¯å£å‡è¦æ·»åŠ è‡³å®‰å…¨ç»„</p><h3 id="4ã€Failed-to-execute-â€˜pushStateâ€™-on-â€˜Historyâ€™"><a href="#4ã€Failed-to-execute-â€˜pushStateâ€™-on-â€˜Historyâ€™" class="headerlink" title="4ã€Failed to execute â€˜pushStateâ€™ on â€˜Historyâ€™"></a>4ã€Failed to execute â€˜pushStateâ€™ on â€˜Historyâ€™</h3><blockquote><p>Failed to start signaling: Failed to execute â€˜pushStateâ€™ on â€˜Historyâ€™: A history state object with URL â€˜<a href="http://linxunfeng.top/r/598600855â€™">http://linxunfeng.top/r/598600855â€™</a> cannot be created in a document with origin â€˜<a href="https://linxunfeng.topâ€™" target="_blank" rel="noopener">https://linxunfeng.topâ€™</a> and URL â€˜<a href="https://linxunfeng.top/">https://linxunfeng.top/</a></p></blockquote><p>è§£å†³æ–¹æ³•æœ‰ä¸¤ç§</p><ul><li>è§£å†³æ–¹æ³•1ï¼š </li></ul><blockquote><p> æˆ¿é—´æœåŠ¡å™¨ç¼–è¯‘å®Œæˆåï¼Œåœ¨/root/apprtc/out/app_engine/js/apprtc.debug.jsæ–‡ä»¶ä¸­æ‰¾åˆ°window.history.pushState({â€˜roomIdâ€™: roomId, â€˜roomLinkâ€™: roomLink}, roomId, roomLink)ï¼ŒæŠŠè¿™å¥è¯æ³¨é‡Šæ‰ï¼Œé‡æ–°è¿è¡Œå³å¯ã€‚ï¼ˆå¦‚æœé‡æ–°ç¼–è¯‘ï¼Œéœ€è¦é‡æ–°ä¿®æ”¹ï¼‰</p></blockquote><ul><li>è§£å†³æ–¹æ³•2ï¼š </li></ul><blockquote><p> åœ¨/root/apprtc/src/web_app/js/appcontroller.jsæ–‡ä»¶ä¸­æ‰¾åˆ°window.history.pushState({â€˜roomIdâ€™: roomId, â€˜roomLinkâ€™: roomLink}, roomId, roomLink)ï¼ŒæŠŠè¿™å¥è¯æ³¨é‡Šæ‰ï¼Œç„¶åé‡æ–°ç¼–è¯‘ï¼Œé‡æ–°è¿è¡Œæˆ¿é—´æœåŠ¡å™¨å³å¯ã€‚</p></blockquote></the></excerpt>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Android </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ‰“é€ Moyaä¾¿æ·è§£æåº“ï¼Œæä¾›RxSwiftæ‹“å±•</title>
      <link href="/2018/05/24/%E6%89%93%E9%80%A0Moya%E4%BE%BF%E6%8D%B7%E8%A7%A3%E6%9E%90%E5%BA%93%EF%BC%8C%E6%8F%90%E4%BE%9BRxSwift%E6%8B%93%E5%B1%95/"/>
      <url>/2018/05/24/%E6%89%93%E9%80%A0Moya%E4%BE%BF%E6%8D%B7%E8%A7%A3%E6%9E%90%E5%BA%93%EF%BC%8C%E6%8F%90%E4%BE%9BRxSwift%E6%8B%93%E5%B1%95/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>MoyaMapperæ˜¯åŸºäºMoyaå’ŒSwiftyJSONå°è£…çš„å·¥å…·ï¼Œä»¥Moyaçš„pluginçš„æ–¹å¼æ¥å®ç°é—´æ¥è§£æï¼Œæ”¯æŒRxSwift</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>1ã€ç›¸ä¿¡å¤§å®¶åœ¨ä½¿ç”¨Swiftå¼€å‘æ—¶ï¼Œ<a href="https://github.com/Moya/Moya" target="_blank" rel="noopener">Moya</a>æ˜¯é¦–é€‰çš„ç½‘ç»œå·¥å…·ï¼Œåœ¨æ¨¡å‹è§£æè¿™ä¸€å—ï¼ŒSwiftç‰ˆæ¨¡å‹è§£æçš„ç›¸å…³ç¬¬ä¸‰æ–¹åº“æœ‰å¾ˆå¤šï¼Œæœ¬äººæœ€ä¹ æƒ¯ç”¨çš„å°±æ˜¯<a href="https://github.com/SwiftyJSON/SwiftyJSON" target="_blank" rel="noopener">SwiftyJSON</a>ã€‚</p><p>2ã€ä¸‹é¢ä¼šå¼€å§‹è®²è§£æ•´ä¸ªä¸»è¦çš„å¼€å‘åŠŸèƒ½ä¸æ€æƒ³ã€‚</p><p>3ã€ä»¥ä¸‹å†…å®¹æ˜¯åŸºäºå¤§å®¶ä¼šä½¿ç”¨Moyaå’ŒSwiftJSONçš„å‰æä¸‹æ‰€è‘—ï¼Œè¿˜ä¸ä¼šçš„åŒå­¦å¯ä»¥å…ˆç®€å•äº†è§£åå†æ¥é˜…è¯»æœ¬ç¯‡æ–‡ç« å“¦ï½</p><h2 id="äºŒã€åŠŸèƒ½å¼€å‘ä¸æ€æƒ³è®²è§£"><a href="#äºŒã€åŠŸèƒ½å¼€å‘ä¸æ€æƒ³è®²è§£" class="headerlink" title="äºŒã€åŠŸèƒ½å¼€å‘ä¸æ€æƒ³è®²è§£"></a>äºŒã€åŠŸèƒ½å¼€å‘ä¸æ€æƒ³è®²è§£</h2><h3 id="1ã€å°è¯•æ¨¡å‹è§£æ"><a href="#1ã€å°è¯•æ¨¡å‹è§£æ" class="headerlink" title="1ã€å°è¯•æ¨¡å‹è§£æ"></a>1ã€å°è¯•æ¨¡å‹è§£æ</h3><p>Moyaè¯·æ±‚æœåŠ¡å™¨è¿”å›çš„æ•°æ®ä»¥Responseç±»è¿”å›ç»™æˆ‘ä»¬ï¼Œé‚£æˆ‘ä»¬å°±ç»™Responseç±»åšä¸€ä¸ªæ‰©å±•ï¼Œè¿™é‡Œä»¥è§£ææ¨¡å‹ä¸ºä¾‹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œå‘ŠçŸ¥æˆ‘ä»¬è¦è½¬æ¢å‡ºä»€ä¹ˆæ¨¡å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapObject</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="comment">// æ¨¡å‹è§£æè¿‡ç¨‹</span></span><br><span class="line">    ã€‚ã€‚ã€‚</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="type">T</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Q: é‚£ä¸­é—´çš„è§£æè¿‡ç¨‹è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿ</p><p>A: <strong>å¯ä»¥è®©å¼€å‘è€…éµå®ˆæŸä¸ªåè®®ï¼Œå®ç°æŒ‡å®šçš„è½¬æ¢æ–¹æ³•å¹¶æè¿°è½¬æ¢å…³ç³»ã€‚å…¶è½¬æ¢è¿‡ç¨‹æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ï¼Œäº¤ç»™å¼€å‘è€…å³å¯ã€‚</strong></p><p>é‚£æ¥ç€æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªåè®®Modelableï¼Œå¹¶å£°æ˜è½¬æ¢æ–¹æ³•<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¼€å‘è€…åˆ›å»ºä¸€ä¸ª<code>MyMoel</code>çš„ç»“æ„ä½“ï¼Œéµå®ˆåè®®<code>Modelable</code>,å¹¶å®ç°<code>mapping</code>ï¼Œä¹¦å†™è½¬æ¢å…³ç³»<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _id = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>._id = json[<span class="string">"_id"</span>].stringValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ç›®å‰çš„ç°çŠ¶æ¥åˆ†æä¸€ä¸‹ï¼š<code>mapObject</code>å¯ä»¥è®©å¼€å‘è€…ä¼ å…¥<code>æ¨¡å‹ç±»å‹</code>ï¼Œè€Œæˆ‘ä»¬çš„åè®®æ–¹æ³•å´å¹¶éæ˜¯ä¸ªç±»æ–¹æ³•ã€‚é‚£æˆ‘ä»¬éœ€è¦å…ˆå¾—åˆ°è¿™ä¸ª<code>æ¨¡å‹ç±»å‹</code>çš„å¯¹è±¡ï¼Œå†æ¥è°ƒç”¨<code>mapping</code>æ–¹æ³•</p><h3 id="2ã€æ¨¡å‹è§£æçš„é©±åŠ¨å¼€å‘"><a href="#2ã€æ¨¡å‹è§£æçš„é©±åŠ¨å¼€å‘" class="headerlink" title="2ã€æ¨¡å‹è§£æçš„é©±åŠ¨å¼€å‘"></a>2ã€æ¨¡å‹è§£æçš„é©±åŠ¨å¼€å‘</h3><p>Q: æ€ä¹ˆå¾—åˆ°è¿™ä¸ªå¯¹è±¡ï¼Ÿ</p><p>A: <strong>å¯ä»¥åœ¨åè®®ä¸­å£°æ˜ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬åœ¨mapObjectä¸­åˆ›å»ºå¯¹åº”æ¨¡å‹ç±»å‹çš„å¯¹è±¡ï¼Œè°ƒç”¨mappingæ–¹æ³•æ¥è½¬æ¢æ•°æ®ï¼Œå†æŠŠæ¨¡å‹å¯¹è±¡ä¼ å‡ºå»å³å¯ã€‚</strong></p><p>é‚£æˆ‘ä»¬åœ¨<code>Modelable</code>ä¸­å£°æ˜ä¸€ä¸ªinitæ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ŒåŒºåˆ«äºå…¶å®ƒåˆå§‹åŒ–æ–¹æ³•<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> json: <span class="type">JSON</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>OKï¼Œç°åœ¨æŠŠ<code>mapObject</code>æ–¹æ³•è¡¥é½æ¨¡å‹è§£æè¿‡ç¨‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapObject</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> modelJson = <span class="type">JSON</span>(data)[<span class="string">"modelKey"</span>]</span><br><span class="line">    <span class="comment">// æ¨¡å‹è§£æè¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">var</span> obj = <span class="type">T</span>.<span class="keyword">init</span>(modelJson)</span><br><span class="line">    obj.mapping(modelJson)</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è‡ªå®šä¹‰è§£æé”®å"><a href="#3ã€è‡ªå®šä¹‰è§£æé”®å" class="headerlink" title="3ã€è‡ªå®šä¹‰è§£æé”®å"></a>3ã€è‡ªå®šä¹‰è§£æé”®å</h3><p>Q: è¿™æ ·æ˜¯æå®šè§£æäº†ï¼Œä½†æ˜¯ç½‘ç»œè¯·æ±‚å›æ¥çš„jsonæ ¼å¼é”™ç»¼å¤æ‚ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è®©å¼€å‘è€…æ¥è‡ªè¡ŒæŒ‡å®šmodelå¯¹åº”çš„é”®åå‘¢ï¼Ÿ</p><p>A: <strong>å—¯å—¯ï¼Œæ—¢ç„¶è§£æè¿‡ç¨‹æ˜¯åœ¨ Response æ‰©å±•é‡Œæ“ä½œçš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡åè®®å®šä¹‰é”®åå±æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨ Runtime ç»™ResponseåŠ¨æ€æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œæ¥è®°å½•éµå®ˆåè®®åçš„ç›¸åº”ç±»å</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">ModelableParameterType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// è¯·æ±‚æˆåŠŸæ—¶çŠ¶æ€ç å¯¹åº”çš„å€¼</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> successValue: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">/// çŠ¶æ€ç å¯¹åº”çš„é”®</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> statusCodeKey: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">/// è¯·æ±‚åçš„æç¤ºè¯­å¯¹åº”çš„é”®</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> tipStrKey: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">/// è¯·æ±‚åçš„ä¸»è¦æ¨¡å‹æ•°æ®çš„é”®</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> modelKey: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:- runtime</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Response</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> lxf_modelableParameterKey = <span class="string">"lxf_modelableParameterKey"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lxf_modelableParameter: <span class="type">ModelableParameterType</span>.<span class="type">Type</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> value = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.lxf_modelableParameterKey) <span class="keyword">as</span> <span class="type">AnyObject</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> type = value <span class="keyword">as</span>? <span class="type">ModelableParameterType</span>.<span class="type">Type</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="type">NullParameter</span>.<span class="keyword">self</span> &#125;</span><br><span class="line">            <span class="keyword">return</span> type</span><br><span class="line">        &#125; <span class="keyword">set</span> &#123;</span><br><span class="line">            objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.lxf_modelableParameterKey, newValue, .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¿™é‡Œæœ‰ä¸ªå‘ï¼š_SwiftValueé—®é¢˜</strong> (çŒ®ä¸Š <a href="https://stackoverflow.com/questions/42033735/failing-cast-in-swift-from-any-to-protocol/42034523#42034523" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a>)<br>å¦‚æœæˆ‘ä»¬å­˜å‚¨çš„ä¸æ˜¯OCå¯¹è±¡ï¼Œé‚£ä¹ˆ<code>objc_getAssociatedObject</code>å–å‡ºæ¥çš„å€¼çš„ç±»å‹ç»Ÿç»Ÿä¸º<code>_SwiftValue</code>ï¼Œç›´æ¥<code>as? ModelableParameterType.Type</code>ç»å¯¹æ˜¯nilï¼Œéœ€è¦åœ¨å–å‡ºæ¥å<code>as AnyObject</code>å†è½¬æ¢ä¸ºå…¶å®ƒç±»å‹æ‰ä¼šæˆåŠŸï½ï½ </p></blockquote><p>ç°åœ¨å¼€å‘è€…å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»æ¥éµå®ˆ<code>ModelableParameterType</code>åè®®ï¼Œå¹¶è‡ªå®šä¹‰è§£æé”®å<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NetParameter</span> : <span class="title">ModelableParameterType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> successValue: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"false"</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> statusCodeKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"error"</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> tipStrKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"errMsg"</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> modelKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"results"</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4ã€æ’ä»¶æ³¨å…¥"><a href="#4ã€æ’ä»¶æ³¨å…¥" class="headerlink" title="4ã€æ’ä»¶æ³¨å…¥"></a>4ã€æ’ä»¶æ³¨å…¥</h3><p>Q: å‰å®³äº†ï¼Œä¸è¿‡è¦åœ¨ä»€ä¹ˆæ—¶æœºä¸‹å­˜å‚¨è¿™ä¸ªè‡ªå®šä¹‰é”®åçš„<code>NetParameter</code>ï¼Ÿ</p><p>A: é¢ï¼Œè¿™ä¸ªï½ï½ï½ å“¦ï¼Œå¯¹äº†ï¼Œå¯ä»¥é€šè¿‡Moyaæä¾›çš„æ’ä»¶æœºåˆ¶ï¼</p><p>ç¿»å‡ºMoyaä¸­çš„Plugin.Swiftï¼Œæ‰¾åˆ°è¿™ä¸ª<code>process</code>æ–¹æ³•ï¼Œçœ‹çœ‹æ–¹æ³•è¯´æ˜ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// åœ¨ç»“æŸä¹‹å‰ï¼Œå¯ä»¥è¢«ç”¨æ¥ä¿®æ”¹è¯·æ±‚ç»“æœ</span></span><br><span class="line"><span class="comment">/// Called to modify a result before completion.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(<span class="number">_</span> result: Result&lt;Moya.Response, MoyaError&gt;, target: TargetType)</span></span> -&gt; <span class="type">Result</span>&lt;<span class="type">Moya</span>.<span class="type">Response</span>, <span class="type">MoyaError</span>&gt;</span><br></pre></td></tr></table></figure></p><p>é‚£å¥½ï¼Œæˆ‘ä»¬ä¹Ÿåšä¸€ä¸ªæ’ä»¶<code>MoyaMapperPlugin</code>ç»™å¼€å‘è€…ä½¿ç”¨ï¼Œåœ¨åˆ›å»º<code>MoyaMapperPlugin</code>æ—¶æŠŠè‡ªå®šä¹‰è§£æé”®åçš„ç±»å‹ä¼ è¿›æ¥<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">MoyaMapperPlugin</span>: <span class="title">PluginType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parameter: <span class="type">ModelableParameterType</span>.<span class="type">Type</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">ModelableParameterType</span>&gt;(<span class="number">_</span> type: <span class="type">T</span>.<span class="type">Type</span>) &#123;</span><br><span class="line">        parameter = type</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// modify response</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(<span class="number">_</span> result: Result&lt;Response, MoyaError&gt;, target: TargetType)</span></span> -&gt; <span class="type">Result</span>&lt;<span class="type">Response</span>, <span class="type">MoyaError</span>&gt; &#123;</span><br><span class="line">        <span class="number">_</span> = result.<span class="built_in">map</span> &#123; (response) -&gt; <span class="type">Response</span> <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// è¶æœºæ·»åŠ ç›¸å…³æ•°æ® </span></span><br><span class="line">            response.lxf_modelableParameter = parameter</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨ï¼šå¼€å‘è€…åœ¨åˆ›å»º<code>MoyaProvider</code>å¯¹è±¡æ—¶ï¼Œé¡ºä¾¿æ³¨å…¥æ’ä»¶ã€‚(OS: è¿™ä¸€æ­¥å ªç§°â€œæ³¨å…¥çµé­‚â€)<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;(plugins: [<span class="type">MoyaMapperPlugin</span>(<span class="type">NetParameter</span>.<span class="keyword">self</span>)])</span><br></pre></td></tr></table></figure></p><h3 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h3><blockquote><p>ä»¥ä¸Šå°±æ˜¯ä¸»è¦çš„è¸©å‘è¿‡ç¨‹äº†ã€‚æ¨¡å‹æ•°ç»„è§£æå’ŒæŒ‡å®šè§£æä¹Ÿè·Ÿè¿™äº›å·®ä¸å¤šçš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚æœ¬äººå·²ç»å°†å…¶å°è£…æˆä¸€ä¸ªå¼€æºåº“ <a href="https://github.com/LinXunFeng/MoyaMapper" target="_blank" rel="noopener">MoyaMapper</a>ï¼ŒåŒ…å«äº†ä¸Šè¿°å·²ç»å’Œæœªæ›¾è¯´æ˜çš„åŠŸèƒ½ï¼Œä¸‹é¢ä¼šè®²è§£å¦‚ä½•å»ä½¿ç”¨ã€‚ä»¥ä¸Šéƒ¨åˆ†å¯ä»¥ç§°ä¸ºå¼€èƒƒèœï¼Œç›®çš„å°±æ˜¯å¹³æ»‘è¿‡æ¸¡åˆ°ä¸‹é¢MoyaMapperçš„å…·ä½“ä½¿ç”¨ã€‚</p></blockquote><p>å¯èƒ½å•å•ä½¿ç”¨<code>MoyaMapper</code>çš„é»˜è®¤å­åº“<code>Core</code>ï¼Œä½œç”¨ä½“ä¼šä¸Šå¹¶ä¸ä¼šå¾ˆæ·±ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¹Ÿæ˜¯ä½¿ç”¨RxSwiftæ¥å¼€å‘é¡¹ç›®çš„è¯ï¼Œè¯·å®‰è£…<code>&#39;MoyaMapper/Rx&#39;</code>å§ï¼Œç»å¯¹ä¸€ä¸ªå­—ï¼šã€Œçˆ½ã€</p><h2 id="äºŒã€MoyaMapperçš„ä½¿ç”¨"><a href="#äºŒã€MoyaMapperçš„ä½¿ç”¨" class="headerlink" title="äºŒã€MoyaMapperçš„ä½¿ç”¨"></a>äºŒã€MoyaMapperçš„ä½¿ç”¨</h2><p><img src="/images/2018/05/æ‰“é€ Moyaä¾¿æ·è§£æåº“ï¼Œæä¾›RxSwiftæ‹“å±•/MoyaMapper.png" alt="MoyaMapper"></p><p>MoyaMapperæ˜¯åŸºäºMoyaå’ŒSwiftyJSONå°è£…çš„å·¥å…·ï¼Œä»¥Moyaçš„pluginçš„æ–¹å¼æ¥å®ç°é—´æ¥è§£æï¼Œæ”¯æŒRxSwift</p><p><img src="/images/2018/05/æ‰“é€ Moyaä¾¿æ·è§£æåº“ï¼Œæä¾›RxSwiftæ‹“å±•/JSONæ•°æ®å¯¹ç…§.png" alt="JSONæ•°æ®å¯¹ç…§"></p><h3 id="1ã€å®šä¹‰å¹¶æ³¨å…¥è‡ªå®šä¹‰é”®åç±»"><a href="#1ã€å®šä¹‰å¹¶æ³¨å…¥è‡ªå®šä¹‰é”®åç±»" class="headerlink" title="1ã€å®šä¹‰å¹¶æ³¨å…¥è‡ªå®šä¹‰é”®åç±»"></a>1ã€å®šä¹‰å¹¶æ³¨å…¥è‡ªå®šä¹‰é”®åç±»</h3><ol><li>å®šä¹‰ä¸€ä¸ªéµå®ˆModelableParameterTypeåè®®çš„ç»“æ„ä½“</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å„å‚æ•°è¿”å›çš„å†…å®¹è¯·å‚è€ƒä¸Šé¢JSONæ•°æ®å¯¹ç…§å›¾</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NetParameter</span> : <span class="title">ModelableParameterType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> successValue: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"false"</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> statusCodeKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"error"</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> tipStrKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">""</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> modelKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"results"</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¤å¤–ï¼Œè¿™é‡Œè¿˜å¯ä»¥åšç®€å•çš„è·¯å¾„å¤„ç†ï¼Œä»¥åº”ä»˜å„ç§æƒ…å†µï¼Œä»¥â€™&gt;â€™éš”å¼€</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å‡è®¾è¿”å›çš„jsonæ•°æ®å…³äºè¯·æ±‚çŠ¶æ€çš„ç›¸å…³æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼Œ</span><br><span class="line">error: &#123;</span><br><span class="line">    'errorStatus':false</span><br><span class="line">    'errMsg':'error Argument type'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬æŒ‡æ˜è§£æè·¯å¾„ï¼šerrorå¯¹è±¡ä¸‹çš„errMsgå­—æ®µï¼Œä¸€å±‚å±‚è¡¨ç¤ºä¸‹å»å³å¯</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">var</span> tipStrKey: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">"error&gt;errMsg"</span> &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä»¥pluginçš„æ–¹å¼ä¼ é€’ç»™MoyaProvider</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MoyaMapperPluginè¿™é‡Œåªéœ€è¦ä¼ å…¥ç±»å‹</span></span><br><span class="line"><span class="type">MoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;(plugins: [<span class="type">MoyaMapperPlugin</span>(<span class="type">NetParameter</span>.<span class="keyword">self</span>)])</span><br></pre></td></tr></table></figure><h3 id="2ã€å®šä¹‰è§£ææ¨¡å‹"><a href="#2ã€å®šä¹‰è§£ææ¨¡å‹" class="headerlink" title="2ã€å®šä¹‰è§£ææ¨¡å‹"></a>2ã€å®šä¹‰è§£ææ¨¡å‹</h3><p>åˆ›å»ºä¸€ä¸ªéµå®ˆModelableåè®®çš„ç»“æ„ä½“</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> _id = <span class="string">""</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> json: <span class="type">JSON</span>) &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>._id = json[<span class="string">"_id"</span>].stringValue</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">éµå®ˆ<span class="type">Modelable</span>åè®®ï¼Œå®ç°åè®®çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨`mapping`æ–¹æ³•ä¸­æè¿°æ¨¡å‹å­—æ®µçš„å…·ä½“è§£æ</span><br></pre></td></tr></table></figure><h3 id="3ã€è§£ææ•°æ®"><a href="#3ã€è§£ææ•°æ®" class="headerlink" title="3ã€è§£ææ•°æ®"></a>3ã€è§£ææ•°æ®</h3><h4 id="0x00-è¯·æ±‚ç»“æœä¸æ¨¡å‹è§£æ"><a href="#0x00-è¯·æ±‚ç»“æœä¸æ¨¡å‹è§£æ" class="headerlink" title="0x00 è¯·æ±‚ç»“æœä¸æ¨¡å‹è§£æ"></a>0x00 è¯·æ±‚ç»“æœä¸æ¨¡å‹è§£æ</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Result</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapResult</span><span class="params">(params: ModelableParamsBlock? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">MoyaMapperResult</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Model</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapObject</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>, modelKey: String? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">T</span></span><br><span class="line"><span class="comment">// Result+Model</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapObjResult</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>, params: ModelableParamsBlock? = <span class="literal">nil</span>)</span></span> -&gt; (<span class="type">MoyaMapperResult</span>, <span class="type">T</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Models</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapArray</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>, modelKey: String? = <span class="literal">nil</span>)</span></span> -&gt; [<span class="type">T</span>]</span><br><span class="line"><span class="comment">// Result+Models</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">mapArrayResult</span>&lt;T: Modelable&gt;<span class="params">(<span class="number">_</span> type: T.<span class="keyword">Type</span>, params: ModelableParamsBlock? = <span class="literal">nil</span>)</span></span> -&gt; (<span class="type">MoyaMapperResult</span>, [<span class="type">T</span>])</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„äº”ä¸ªæ–¹æ³•ï¼Œè§‚å…¶åï¼ŒçŸ¥å…¶æ„ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ï¼Œä¸»è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li><p>result</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ƒç¥–ç±»å‹</span></span><br><span class="line"><span class="comment">// å‚æ•°1ï¼šæ ¹æ®statusCodeKeyå–å‡ºçš„å€¼ä¸successValueæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">// å‚æ•°2ï¼šæ ¹æ®tipStrKeyå–å‡ºçš„å€¼</span></span><br><span class="line">resultï¼š(<span class="type">Bool</span>, <span class="type">String</span>)</span><br></pre></td></tr></table></figure></li><li><p>params</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// params: ModelableParamsBlock? = nil</span></span><br><span class="line"><span class="comment">// è¿™é‡Œåªæœ‰åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹æ‰éœ€è¦ä½¿ç”¨åˆ°ã€‚å¦‚ï¼šé¡¹ç›®ä¸­éœ€è¦åœ¨æŸå¤„ä½¿ç”¨ç‰¹å®šæ¥å£ï¼Œä½†æ˜¯è¿”å›çš„jsonæ ¼å¼è·Ÿè‡ªå·±é¡¹ç›®çš„ä¸ä¸€æ ·ï¼Œå¹¶ä¸”åªæœ‰è¿™ä¹ˆä¸€ä¸¤å¤„ç”¨å¾—ç€è¯¥é¢å¤–æ¥å£ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬è¿™ä¸ªå‚æ•°äº†ï¼Œä»¥Blockçš„æ–¹å¼è¿”å›è§£æå‚æ•°ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="0x01ã€ç‰¹å®šè§£æ"><a href="#0x01ã€ç‰¹å®šè§£æ" class="headerlink" title="0x01ã€ç‰¹å®šè§£æ"></a>0x01ã€ç‰¹å®šè§£æ</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">toJSON</span><span class="params">(modelKey: String? = <span class="literal">nil</span>)</span></span> -&gt; <span class="type">JSON</span></span><br><span class="line"><span class="comment">// è·å–æŒ‡å®šè·¯å¾„çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">fetchJSONString</span><span class="params">(path: String? = <span class="literal">nil</span>, keys: [JSONSubscriptType])</span></span> -&gt; <span class="type">String</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè·¯å¾„ï¼Œé»˜è®¤éƒ½æ˜¯é’ˆå¯¹modelKeyçš„<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fetchJSONString(keys: &lt;[JSONSubscriptType]&gt;)</span></span><br><span class="line"><span class="number">1</span>ã€é€šè¿‡ keys ä¼ é€’æ•°ç»„, è¯¥æ•°ç»„å¯ä¼ å…¥çš„ç±»å‹ä¸º <span class="type">Int</span> å’Œ <span class="type">String</span></span><br><span class="line"><span class="number">2</span>ã€é»˜è®¤æ˜¯ä»¥ modelKey æ‰€ç¤ºè·¯å¾„ï¼Œæ¥è·å–ç›¸åº”çš„æ•°å€¼ã€‚å¦‚æœmodelKeyå¹¶éæ˜¯ä½ æ‰€æƒ³è¦ä½¿ç”¨çš„è§£æè·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„é‡è½½æ–¹æ³•é‡æ–°æŒ‡å®šè·¯å¾„å³å¯</span><br><span class="line"></span><br><span class="line"><span class="comment">// response.fetchJSONString(path: &lt;String?&gt;, keys: &lt;[JSONSubscriptType]&gt;)</span></span><br></pre></td></tr></table></figure></p><p><strong>MoyaMapperä¹Ÿæä¾›äº†Rxå­åº“ï¼Œä¸ºæ–¹ä¾¿RxSwiftçš„æµå¼ç¼–ç¨‹ä¸‹ä¾¿æ·è§£ææ•°æ®</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MoyaMapperé»˜è®¤åªå®‰è£…Coreä¸‹çš„æ–‡ä»¶</span><br><span class="line">pod <span class="string">'MoyaMapper'</span></span><br><span class="line"></span><br><span class="line">RxSwiftæ‹“å±•</span><br><span class="line">pod <span class="string">'MoyaMapper/Rx'</span></span><br></pre></td></tr></table></figure><p>å…·ä½“ä½¿ç”¨è¿˜ä¸æ˜¯å¾ˆæ˜ç™½çš„åŒå­¦å¯ä»¥ä¸‹è½½å¹¶è¿è¡Œ<code>Example</code>çœ‹çœ‹</p><p><strong>å¦‚æœ<a href="https://github.com/LinXunFeng/MoyaMapper" target="_blank" rel="noopener">MoyaMapper</a>æœ‰ä»€ä¹ˆä¸è¶³çš„åœ°æ–¹ï¼Œæ¬¢è¿æå‡ºissuesï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒ</strong></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
            <tag> RxSwift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½</title>
      <link href="/2018/04/07/iOS-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E6%96%B9%E5%BC%8F%E5%B0%81%E8%A3%85%E7%A9%BA%E7%99%BD%E9%A1%B5%E5%8A%9F%E8%83%BD/"/>
      <url>/2018/04/07/iOS-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E6%96%B9%E5%BC%8F%E5%B0%81%E8%A3%85%E7%A9%BA%E7%99%BD%E9%A1%B5%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ä¸ºäº†è‰¯å¥½çš„äº¤äº’ä½“éªŒï¼Œç›¸ä¿¡å¤§å®¶åœ¨å¯¹å¾…<code>scrollView</code>æ— æ•°æ®æ—¶çš„æç¤ºé¡µéƒ½ä¼šä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹æ¥å®šåˆ¶ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ä½¿ç”¨<a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a>ã€‚ä½†æ˜¯æ¯ä¸ªç•Œé¢éƒ½å†™ä¸€å †ä¸<code>DZNEmptyDataSetDelegate</code>ï¼Œ<code>DZNEmptyDataSetSource</code>ç›¸å…³çš„ä»£ç å°±ä¸å¤ªå¥½ï¼Œé‚£ä¸€èˆ¬æƒ…å†µä¸‹è‡ªç„¶çš„å°±ä¼šé‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥é¿å…ã€‚è€ŒSwifté™¤äº†å¯ä»¥é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå®ƒè¿˜å¯ä»¥é¢å‘åè®®ç¼–ç¨‹ã€‚é‚£å¯ä¸å¯ä»¥ä¹Ÿç”¨åè®®æ¥è§£å†³æƒ…å†µå‘¢ï¼Ÿå˜¿å˜¿ï¼Œè¿™ä¸ªå¯ä»¥æœ‰ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥è¯•è¯•æ€ä¹ˆé€šè¿‡åè®®çš„æ–¹å¼æ¥é¿å…ä¸Šè¿°æƒ…å†µï¼Œå¹¶ä¸”å®ç°ä¸€è¡Œä»£ç æ·»åŠ ç©ºç™½é¡µåŠŸèƒ½</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>ä¸ºäº†è‰¯å¥½çš„äº¤äº’ä½“éªŒï¼Œç›¸ä¿¡å¤§å®¶åœ¨å¯¹å¾…<code>scrollView</code>æ— æ•°æ®æ—¶çš„æç¤ºé¡µéƒ½ä¼šä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹æ¥å®šåˆ¶ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ä½¿ç”¨<a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a>ã€‚ä½†æ˜¯æ¯ä¸ªç•Œé¢éƒ½å†™ä¸€å †ä¸<code>DZNEmptyDataSetDelegate</code>ï¼Œ<code>DZNEmptyDataSetSource</code>ç›¸å…³çš„ä»£ç å°±ä¸å¤ªå¥½ï¼Œé‚£ä¸€èˆ¬æƒ…å†µä¸‹è‡ªç„¶çš„å°±ä¼šé‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥é¿å…ã€‚è€ŒSwifté™¤äº†å¯ä»¥é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå®ƒè¿˜å¯ä»¥é¢å‘åè®®ç¼–ç¨‹ã€‚é‚£å¯ä¸å¯ä»¥ä¹Ÿç”¨åè®®æ¥è§£å†³æƒ…å†µå‘¢ï¼Ÿå˜¿å˜¿ï¼Œè¿™ä¸ªå¯ä»¥æœ‰ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥è¯•è¯•æ€ä¹ˆé€šè¿‡åè®®çš„æ–¹å¼æ¥é¿å…ä¸Šè¿°æƒ…å†µï¼Œå¹¶ä¸”å®ç°ä¸€è¡Œä»£ç æ·»åŠ ç©ºç™½é¡µåŠŸèƒ½</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœå¯¹é¢å‘åè®®æœ‰ç–‘é—®çš„åŒå­¦å¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a> </p><p><a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a></p><p>ä¹‹å‰çš„æ–‡ç« ä¸­æåˆ°äº†ï¼Œåè®®é™¤äº†èµ·è§„èŒƒä½œç”¨ï¼Œè¿˜æœ‰åˆ«ä¸€ä¸ªç”¨å¤„ï¼Œå°±æ˜¯èµ‹äºˆèƒ½åŠ›ã€‚æˆ‘ä»¬ç°åœ¨çš„ç›®çš„å°±æ˜¯è®©ç›®æ ‡æ§åˆ¶å™¨æˆ–è€…ç›®æ ‡è§†å›¾åœ¨éµå®ˆæˆ‘ä»¬çš„åè®®åï¼Œå°±å¯ä»¥æœ‰å®ç°ç©ºç™½é¡µçš„åŠŸèƒ½ã€‚</p><h2 id="ä¸€ã€åŸºæœ¬å®ç°"><a href="#ä¸€ã€åŸºæœ¬å®ç°" class="headerlink" title="ä¸€ã€åŸºæœ¬å®ç°"></a>ä¸€ã€åŸºæœ¬å®ç°</h2><h3 id="1ã€åˆ›å»ºåè®®"><a href="#1ã€åˆ›å»ºåè®®" class="headerlink" title="1ã€åˆ›å»ºåè®®"></a>1ã€åˆ›å»ºåè®®</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:- ç©ºè§†å›¾å ä½åè®®</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">LXFEmptyDataSetable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç¡®å®šé¢å‘ç±»"><a href="#2ã€ç¡®å®šé¢å‘ç±»" class="headerlink" title="2ã€ç¡®å®šé¢å‘ç±»"></a>2ã€ç¡®å®šé¢å‘ç±»</h3><p>ç¡®å®šæˆ‘ä»¬é¢å‘çš„ç±»ï¼Œä¸€èˆ¬<code>tableView</code>æˆ–è€…<code>collectionView</code>éƒ½æ˜¯å†™åœ¨æ§åˆ¶å™¨é‡Œï¼Œé‚£æˆ‘ä»¬é¢å‘çš„ç±»å°±è§„å®šä¸º<code>UIViewController</code>ï¼Œæˆ–è®¸ä¹Ÿæœ‰äººå†™åœ¨<code>UIView</code>é‡Œï¼Œä¸è¿‡è¿™é‡Œå…ˆæŒ‰<code>UIViewController</code>æ¥å†™å§<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:- UIViewController - ç©ºè§†å›¾å ä½åè®®</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">LXFEmptyDataSetable</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 3ã€çš„å®ç°çš„æ–¹æ³•å†™åœ¨è¿™é‡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3ã€å®šä¹‰åŠŸèƒ½æ–¹æ³•"><a href="#3ã€å®šä¹‰åŠŸèƒ½æ–¹æ³•" class="headerlink" title="3ã€å®šä¹‰åŠŸèƒ½æ–¹æ³•"></a>3ã€å®šä¹‰åŠŸèƒ½æ–¹æ³•</h3><p>å°†<code>scrollView</code>ä¼ é€’è¿›æ¥ï¼Œè®©æˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•æ¥æš—åœ°é‡Œåšäº›æ“ä½œ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lxf_EmptyDataSet</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line">    scrollView.emptyDataSetDelegate = <span class="keyword">self</span></span><br><span class="line">    scrollView.emptyDataSetSource = <span class="keyword">self</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4ã€è®¾ç½®æ•°æ®æºå’Œä»£ç†"><a href="#4ã€è®¾ç½®æ•°æ®æºå’Œä»£ç†" class="headerlink" title="4ã€è®¾ç½®æ•°æ®æºå’Œä»£ç†"></a>4ã€è®¾ç½®æ•°æ®æºå’Œä»£ç†</h3><p>åœ¨<code>3ã€å®šä¹‰åŠŸèƒ½æ–¹æ³•</code>ä¸­å°†<code>delegate</code>å’Œ<code>source</code>è®¾ç½®ä¸ºäº†<code>self</code> ï¼Œè€Œåè®®æ˜¯æ— æ³•éµå®ˆå†æ¬¡éµå®ˆå…¶å®ƒåè®®çš„ï¼Œé‚£è®©ä»€ä¹ˆæ¥éµå®ˆå¯¹åº”çš„åè®®å‘¢ï¼Ÿè¦æ˜ç™½è¿™é‡Œçš„<code>self</code>æŒ‡çš„æ˜¯<code>UIViewController</code>,è€ƒè™‘åˆ°<code>UIView</code>çš„å¯èƒ½ï¼Œè¿™é‡Œæˆ‘å°±è®©ä¸‡ç‰©å¯¹è±¡ä¹‹çˆ¶<code>NSObject</code>æ¥éµå®ˆï¼Œå¹¶å®ç°å¯¹åº”çš„æ•°æ®æºæ–¹æ³•å’Œä»£ç†æ–¹æ³•<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSObject</span> : <span class="title">DZNEmptyDataSetDelegate</span>, <span class="title">DZNEmptyDataSetSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">image</span><span class="params">(forEmptyDataSet scrollView: UIScrollView!)</span></span> -&gt; <span class="type">UIImage</span>! &#123;</span><br><span class="line">        <span class="comment">// è¿”å›æç¤ºå›¾ç‰‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">title</span><span class="params">(forEmptyDataSet scrollView: UIScrollView!)</span></span> -&gt; <span class="type">NSAttributedString</span>! &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®å¯Œæ–‡æœ¬æ ‡é¢˜</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">verticalOffset</span><span class="params">(forEmptyDataSet scrollView: UIScrollView!)</span></span> -&gt; <span class="type">CGFloat</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®çºµå‘åç§»</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="äºŒã€å®šåˆ¶ç©ºç™½é¡µ"><a href="#äºŒã€å®šåˆ¶ç©ºç™½é¡µ" class="headerlink" title="äºŒã€å®šåˆ¶ç©ºç™½é¡µ"></a>äºŒã€å®šåˆ¶ç©ºç™½é¡µ</h2><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤åï¼Œåªè¦è®©<code>UIViewController</code>éµå®ˆæˆ‘ä»¬çš„åè®®ï¼Œå†è°ƒç”¨ä¸€ä¸‹<code>lxf_EmptyDataSet</code>æ–¹æ³•å°±å¯ä»¥å®ç°æ•°æ®ç©ºç™½é¡µäº†ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ç›´æ¥å†™æ­»çš„æ–¹å¼å¾ˆä¸å¥½ï¼Œæœ‰æ—¶å€™ä¸€äº›åœºæ™¯æ˜¯éœ€è¦æˆ‘ä»¬åšå‡ºå®šåˆ¶çš„ï¼Œé‚£æ€ä¹ˆå®ç°å®šåˆ¶å‘¢ï¼Ÿåè®®åˆä¸èƒ½æœ‰è‡ªå·±çš„å˜é‡æ¥å­˜æ”¾æˆ‘ä»¬çš„å®šåˆ¶ã€‚</p><font color="red"><em>è¿™é‡Œå…ˆåšå‡ºä¸€ä¸ªé™å®šï¼Œæˆ‘ä»¬è¦ä½¿ç”¨é‡è½½æ–¹æ³•æ¥å®Œæˆè¯¥åŠŸèƒ½ï¼Œå®ç°å³å¯é«˜å®šåˆ¶ï¼Œåˆå¯ä½¿ç”¨é»˜è®¤å®šåˆ¶ã€‚</em></font><p>å›åˆ°åˆšåˆšçš„è¯é¢˜ï¼Œä½¿ç”¨UserDefaultsæ¥å®ç°å¯ä»¥å—ï¼Ÿå¯ä»¥ï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºUserDefaultsæ˜¯å•ä¾‹ï¼Œæ•´ä¸ªè¿›ç¨‹å…±ç”¨è¿™ä¸€ä»½èµ„æºï¼Œå¦‚æœä½ å½“å‰<code>controller</code>éµå®ˆäº†æˆ‘ä»¬çš„åè®®<code>LXFEmptyDataSetable</code>å¹¶åšå‡ºäº†å®šåˆ¶ï¼Œé‚£ä¹ˆå½“ä¸‹ä¸€ä¸ª<code>controller</code>åœ¨éµå®ˆåè®®åä½¿ç”¨äº†<code>é»˜è®¤å®šåˆ¶</code>æ—¶ï¼Œé‚£ä½ è¦æ€ä¹ˆåŠï¼Ÿè¿˜è¦åŒºåˆ†<code>scrollView</code>ï¼Œé‚£å°±å¾—ä¿å­˜å½“å‰<code>scrollView</code>ï¼Œåœ¨é€€å‡ºå½“å‰<code>controller</code>åè¿˜è¦æŠŠå¯¹åº”çš„ä¸œè¥¿ç½®ç©ºã€‚å¥½å’¯å¥½å’¯ï¼Œé‚£ä½ è¯´åˆ°åº•è¦æ€ä¹ˆææ‰æœ€åˆé€‚ï¼Ÿ</p><blockquote><p>è§£å†³æ–¹æ¡ˆï¼šæ‹“å±•<code>UIScrollView</code>ï¼ï¼ï¼æœ‰æ²¡æœ‰å‘ç°ï¼Ÿï¼Œéå¸¸åœ°æ°å·§ï¼Œæˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•<code>lxf_EmptyDataSet</code>éœ€è¦å¤–ç•Œå°†<code>UIScrollView</code>ä¼ é€’è¿›æ¥ï¼Œåœ¨<code>DZNEmptyDataSet</code>çš„æ•°æ®æºæ–¹æ³•å’Œä»£ç†æ–¹æ³•ä¹Ÿæœ‰<code>scrollView</code>ã€‚é‚£è®©<code>UIScrollView</code>æ¥æºå¸¦æˆ‘ä»¬çš„å®šåˆ¶å°±å¥½å•¦ã€‚</p></blockquote><h3 id="1ã€å®šä¹‰å®šåˆ¶ç›¸å…³çš„æšä¸¾"><a href="#1ã€å®šä¹‰å®šåˆ¶ç›¸å…³çš„æšä¸¾" class="headerlink" title="1ã€å®šä¹‰å®šåˆ¶ç›¸å…³çš„æšä¸¾"></a>1ã€å®šä¹‰å®šåˆ¶ç›¸å…³çš„æšä¸¾</h3><p>è¿™é‡Œæˆ‘å®šä¹‰äº†å¸¸ç”¨çš„å®šåˆ¶ç›¸å…³çš„æšä¸¾<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">LXFEmptyDataSetAttributeKeyType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// çºµå‘åç§»(-50)  CGFloat</span></span><br><span class="line">    <span class="keyword">case</span> verticalOffset</span><br><span class="line">    <span class="comment">/// æç¤ºè¯­(æš‚æ— æ•°æ®)  String</span></span><br><span class="line">    <span class="keyword">case</span> tipStr</span><br><span class="line">    <span class="comment">/// æç¤ºè¯­çš„font(system15)  UIFont</span></span><br><span class="line">    <span class="keyword">case</span> tipFont</span><br><span class="line">    <span class="comment">/// æç¤ºè¯­é¢œè‰²(D2D2D2)  UIColor</span></span><br><span class="line">    <span class="keyword">case</span> tipColor</span><br><span class="line">    <span class="comment">/// æç¤ºå›¾(LXFEmptyDataPic) UIImage</span></span><br><span class="line">    <span class="keyword">case</span> tipImage</span><br><span class="line">    <span class="comment">/// å…è®¸æ»šåŠ¨(true) Bool</span></span><br><span class="line">    <span class="keyword">case</span> allowScroll</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2ã€æ‹“å±•UIScrollView"><a href="#2ã€æ‹“å±•UIScrollView" class="headerlink" title="2ã€æ‹“å±•UIScrollView"></a>2ã€æ‹“å±•UIScrollView</h3><p>ä¸º<code>UIScrollView</code>å®šä¹‰ä¸€ä¸ªå®šåˆ¶ç›¸å…³çš„å±æ€§å­—å…¸<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIScrollView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKeys</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> lxf_emptyAttributeDict:[<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]?</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/// å±æ€§å­—å…¸</span></span><br><span class="line">    <span class="keyword">var</span> lxf_emptyAttributeDict: [<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.lxf_emptyAttributeDict) <span class="keyword">as</span>? [<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKeys</span>.lxf_emptyAttributeDict, newValue <span class="keyword">as</span> [<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]?, objc_AssociationPolicy.<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3ã€å®Œå–„lxf-EmptyDataSetæ–¹æ³•"><a href="#3ã€å®Œå–„lxf-EmptyDataSetæ–¹æ³•" class="headerlink" title="3ã€å®Œå–„lxf_EmptyDataSetæ–¹æ³•"></a>3ã€å®Œå–„lxf_EmptyDataSetæ–¹æ³•</h3><p>è¿™é‡Œæˆ‘ä»¬è®©å¤–ç•Œé€šè¿‡é—­åŒ…çš„æ–¹å¼æ¥å®šåˆ¶è‡ªå·±çš„ç©ºç™½é¡µ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:- UIViewController - ç©ºè§†å›¾å ä½åè®®</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">LXFEmptyDataSetable</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">lxf_EmptyDataSet</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView, attributeBlock: <span class="params">(<span class="params">()</span></span></span></span>-&gt;([<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]))? = <span class="literal">nil</span>) &#123;</span><br><span class="line">        scrollView.lxf_emptyAttributeDict = attributeBlock != <span class="literal">nil</span> ? attributeBlock!() : <span class="literal">nil</span></span><br><span class="line">        scrollView.emptyDataSetDelegate = <span class="keyword">self</span></span><br><span class="line">        scrollView.emptyDataSetSource = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4ã€ä½¿ç”¨å®šåˆ¶å±æ€§å­—å…¸"><a href="#4ã€ä½¿ç”¨å®šåˆ¶å±æ€§å­—å…¸" class="headerlink" title="4ã€ä½¿ç”¨å®šåˆ¶å±æ€§å­—å…¸"></a>4ã€ä½¿ç”¨å®šåˆ¶å±æ€§å­—å…¸</h3><p>è¿™é‡Œä»¥è¿”å›æç¤ºå›¾ç‰‡çš„æ–¹æ³•ä¸ºä¾‹å§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public func image(forEmptyDataSet scrollView: UIScrollView!) -&gt; UIImage! &#123;</span><br><span class="line">    guard let tipImg = scrollView.lxf_emptyAttributeDict?[.tipImage] as? UIImage else &#123;</span><br><span class="line">        return UIImage(named: &quot;LXFEmptyDataPic&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    return tipImg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="5ã€å¤–ç•Œçš„ä½¿ç”¨å§¿åŠ¿"><a href="#5ã€å¤–ç•Œçš„ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="5ã€å¤–ç•Œçš„ä½¿ç”¨å§¿åŠ¿"></a>5ã€å¤–ç•Œçš„ä½¿ç”¨å§¿åŠ¿</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LXFEmptyDemoController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        initUI()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFEmptyDemoController</span>: <span class="title">LXFEmptyDataSetable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="function"><span class="keyword">func</span> <span class="title">initUI</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tableView = <span class="type">UITableView</span>()</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é«˜å®šåˆ¶</span></span><br><span class="line">        <span class="keyword">self</span>.lxf_EmptyDataSet(tableView) &#123; () -&gt; ([<span class="type">LXFEmptyDataSetAttributeKeyType</span> : <span class="type">Any</span>]) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                .tipStr:<span class="string">"å“Ÿå“Ÿå“Ÿ"</span>,</span><br><span class="line">                .verticalOffset:-<span class="number">150</span>,</span><br><span class="line">                .allowScroll: <span class="literal">false</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é»˜è®¤å®šåˆ¶</span></span><br><span class="line">        <span class="comment">// self.lxf_EmptyDataSet(tableView)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS é¢å‘åè®®æ–¹å¼å°è£…ç©ºç™½é¡µåŠŸèƒ½/lxf_EmptyDataSet.png" alt="å¤§åŠŸå‘Šæˆ"></p><h2 id="ä¸‰ã€å¼€æºåº“"><a href="#ä¸‰ã€å¼€æºåº“" class="headerlink" title="ä¸‰ã€å¼€æºåº“"></a>ä¸‰ã€å¼€æºåº“</h2><p>æˆ‘å¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œä¸€æ¬¡æ•´ç†ï¼Œå¹¶åšæˆä¸€ä¸ªåä¸º <a href="https://github.com/LinXunFeng/LXFProtocolTool" target="_blank" rel="noopener">LXFProtocolTool</a> çš„åº“å¹¶ä¸Šä¼ è‡³gitHubã€‚å¯ä»¥ä½¿ç”¨<code>Cocoapods</code>çš„æ–¹å¼æ¥å®‰è£…ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFProtocolTool&apos;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¹Ÿå°† <a href="http://linxunfeng.top/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a> ä¸­æåŠçš„é€šè¿‡åè®®ä¾¿æ·åŠ è½½xibçš„åŠŸèƒ½ä¹Ÿé›†æˆäº†è¿›æ¥ã€‚å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦åœ¨Podfileå†™æ˜è¦å®‰è£…çš„åŠŸèƒ½</p><ul><li>XibåŠ è½½</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFProtocolTool/LXFNibloadable&apos;</span><br></pre></td></tr></table></figure><ul><li>ç©ºç™½è§†å›¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFProtocolTool/LXFEmptyDataSetable&apos;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¿™ä¸ªåº“çš„ç›®çš„æ˜¯ä¸ºäº†é€šè¿‡åè®®çš„æ–¹å¼æ¥æ–¹ä¾¿å¿«æ·åœ°å®ç°ä¸€äº›çš„å®ç”¨åŠŸèƒ½ï¼Œç›®å‰åŠŸèƒ½ä¸å¤šï¼Œä¸è¿‡å¾€åä¼šé€æ¸å¢åŠ ï¼Œæˆ–è®¸ä½ æœ‰ä»€ä¹ˆæƒ³å®ç°çš„åŠŸèƒ½ä¹Ÿå¯ä»¥æå‡ºæ¥ï¼Œå–œæ¬¢çš„å°±ç»™ä¸ªStaré¼“åŠ±ä¸‹æˆ‘å§ ğŸš€ ğŸš€ ğŸš€ </p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–</title>
      <link href="/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Afastlane%E5%AE%9E%E7%8E%B0pod%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
      <url>/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Afastlane%E5%AE%9E%E7%8E%B0pod%E8%87%AA%E5%8A%A8%E5%8C%96/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>åœ¨ç¬¬ä¸€æ¬¡ç»„ä»¶åŒ–çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œå¾ˆå¤šæ“ä½œï¼Œè¿™äº›æ“ä½œå¯ä»¥åœ¨ã€<a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</a>ã€‘ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œåœ¨ç»„ä»¶åŒ–åçš„é‡å¤æ€§æ“ä½œå°±æ˜¯å‡çº§ï¼Œè€Œå‡çº§è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„æå®šè¿™ä¸€è¿‡ç¨‹æ¥èŠ‚çº¦æˆ‘ä»¬å¤§é‡çš„æ—¶é—´å‘¢ï¼Ÿ</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/fastlane.png" alt=""></p><blockquote><p>åœ¨ç¬¬ä¸€æ¬¡ç»„ä»¶åŒ–çš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œå¾ˆå¤šæ“ä½œï¼Œè¿™äº›æ“ä½œå¯ä»¥åœ¨ã€<a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</a>ã€‘ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œåœ¨ç»„ä»¶åŒ–åçš„é‡å¤æ€§æ“ä½œå°±æ˜¯å‡çº§ï¼Œè€Œå‡çº§è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„æå®šè¿™ä¸€è¿‡ç¨‹æ¥èŠ‚çº¦æˆ‘ä»¬å¤§é‡çš„æ—¶é—´å‘¢ï¼Ÿ</p></blockquote><h2 id="ä¸€ã€å‡çº§å¿…å¤‡æ“ä½œ"><a href="#ä¸€ã€å‡çº§å¿…å¤‡æ“ä½œ" class="headerlink" title="ä¸€ã€å‡çº§å¿…å¤‡æ“ä½œ"></a>ä¸€ã€å‡çº§å¿…å¤‡æ“ä½œ</h2><p>ä¿®æ”¹å®Œæ ¸å¿ƒä»£ç åï¼Œä¸€å…±è¿˜éœ€è¦åšä»¥ä¸‹å‡ æ­¥ï¼š<br><br>1ã€ä¿®æ”¹specæ–‡ä»¶ï¼ˆä¿®æ”¹s.versionï¼Œs.descriptionç­‰ï¼‰<br><br>2ã€<code>pod install</code> ï¼ˆä½¿Exampleä¸podä¸‹æ¥çš„åº“äº§ç”Ÿå…³è”ï¼‰<br><br>3ã€æäº¤æœ¬åœ°ä»“åº“ä»£ç è‡³è¿œç¨‹ä»“åº“<br><br>4ã€æ‰“æ ‡ç­¾ï¼Œå¹¶æäº¤è‡³è¿œç¨‹<br><br>5ã€éªŒè¯specï¼Œå¹¶æè‡³ç§æœ‰ç´¢å¼•åº“</p><h2 id="äºŒã€Fastlane"><a href="#äºŒã€Fastlane" class="headerlink" title="äºŒã€Fastlane"></a>äºŒã€Fastlane</h2><h3 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h3><p><a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">Fastlaneæ–‡æ¡£è¯´æ˜ </a><br>Fastlaneæ˜¯ä¸€ä¸ªrubyè„šæœ¬é›†åˆï¼Œå®ƒå¯ä»¥æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è·¯çº¿ï¼Œåœ¨æŒ‡å®šä½ç½®æ‰§è¡Œæˆ‘ä»¬æ‰€è¦æ‰§è¡Œçš„æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬ç§°è¿™æ ·çš„è·¯çº¿ä¸ºã€Œèˆªé“(lane)ã€ï¼Œè¿™æ ·çš„æ“ä½œç§°ä¸ºã€ŒActionã€</p><p>Actionæ˜¯Fastlaneè‡ªåŠ¨åŒ–æµç¨‹ä¸­çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œç”¨æ¥æ‰§è¡ŒFastlaneè„šæœ¬ä¸­çš„å‘½ä»¤ï¼Œå…³äºæ›´å¤šçš„æè¿°å¯ä»¥åˆ°<a href="https://docs.fastlane.tools/actions/Actions/" target="_blank" rel="noopener">Actions - fastlane docs</a>æŸ¥çœ‹ï¼Œé‡Œé¢ä¹Ÿä»‹ç»äº†å¸¸ç”¨çš„actionæœ‰å“ªäº›ï¼Œé¡ºå¸¦é™„ä¸Š<a href="https://github.com/fastlane/fastlane/tree/master/fastlane/lib/fastlane/actions" target="_blank" rel="noopener">actionçš„æºç åœ°å€</a>ï¼Œè¿™ä¸ªæºç åœ¨åé¢è‡ªå®šä¹‰èµ·å‚è€ƒä½œç”¨</p><h3 id="2ã€-å®‰è£…"><a href="#2ã€-å®‰è£…" class="headerlink" title="2ã€ å®‰è£…"></a>2ã€ å®‰è£…</h3><ul><li><p>ç¡®ä¿rubyä¸ºæœ€æ–°ç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install ruby</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…fastlane</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install -n /usr/local/bin fastlane</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å‰fastlaneç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane --version</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ‰€æœ‰action</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane actions</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¸‰ã€fastlaneåˆå§‹åŒ–"><a href="#ä¸‰ã€fastlaneåˆå§‹åŒ–" class="headerlink" title="ä¸‰ã€fastlaneåˆå§‹åŒ–"></a>ä¸‰ã€fastlaneåˆå§‹åŒ–</h3><p>cdåˆ°ä½ çš„æœ¬åœ°ç»„ä»¶ä»“åº“çš„æ ¹ç›®å½•</p><ul><li><del>åˆå§‹åŒ–fastlane</del><br><del><code>fastlane init</code></del><br><del>ä¸è¿‡è¿™ä¸ªæ­¥éª¤å¯¹æˆ‘ä»¬æ¥è¯´å¯ä»¥è·³è¿‡ï¼Œåœ¨initåæç¤ºä½ è¾“å…¥ä¸€äº›ä¸œè¥¿ï¼ŒåŒ…æ‹¬ä¸Šä¼ éœ€è¦ç”¨åˆ°çš„APPLE IDä»€ä¹ˆçš„ä¸€å †ä¸œè¥¿ï¼Œç”±äºæˆ‘ä»¬å¹¶ä¸æ¶‰åŠè¿™äº›ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨æ›´æ–¹ä¾¿çš„æ–¹å¼</del></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªfastlaneæ–‡ä»¶å¤¹</span><br><span class="line"># è¿›å…¥fastlaneç›®å½•</span><br><span class="line"># åˆ›å»ºä¸€ä¸ªFastfileæ–‡ä»¶</span><br><span class="line">mkdir fastlane</span><br><span class="line">cd fastlane</span><br><span class="line">touch Fastfile</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/ç›®å½•ç»“æ„.png" alt="ç›®å½•ç»“æ„"></p><h3 id="1ã€ä¿®æ”¹Fastfile"><a href="#1ã€ä¿®æ”¹Fastfile" class="headerlink" title="1ã€ä¿®æ”¹Fastfile"></a>1ã€ä¿®æ”¹Fastfile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">desc &apos;æè¿°èˆªé“ä½œç”¨&apos;</span><br><span class="line">lane :èˆªé“åç§° do |options|</span><br><span class="line"></span><br><span class="line">// options å¯ä»¥ç”¨æ¥ä¼ é€’å‚æ•°</span><br><span class="line">// ç¤ºä¾‹ï¼švarName = options[:name]</span><br><span class="line"></span><br><span class="line">// èˆªé“ä¸Šéœ€è¦æ‰§è¡Œçš„æ“ä½œ</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>èˆªé“ä¸Šè¦æ‰«æçš„æ“ä½œå¯ä»¥åˆ°<a href="https://docs.fastlane.tools/actions" target="_blank" rel="noopener">Actions</a>ä¸ŠæŸ¥æ‰¾ï¼Œå¯ä»¥é€šè¿‡å…³é”®å­—æœç´¢ï¼Œå¦‚ä¸‹å›¾<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/cocoapods.png" alt="cocoapods"><br>ç‚¹è¿›å»å¯ä»¥çœ‹åˆ°å…·ä½“çš„ä½¿ç”¨åŠå‚æ•°è¯´æ˜</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/ä½¿ç”¨è¯´æ˜.png" alt="ä½¿ç”¨è¯´æ˜"></p><p>è¿™é‡Œé™„ä¸Šæœ¬äººçš„Fastfileå†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">desc &apos;LXFUpdatePodTool èˆªé“ç”¨æ¥è‡ªåŠ¨åŒ–å‡çº§ç»´æŠ¤ç§æœ‰åº“&apos;</span><br><span class="line">lane : LXFUpdatePodTool do |options|</span><br><span class="line"></span><br><span class="line">tagNum = options[:tag]</span><br><span class="line">podspecName = options[:specName]</span><br><span class="line"></span><br><span class="line"># èˆªé“ä¸Šéœ€è¦æ‰§è¡Œçš„æ“ä½œ</span><br><span class="line"># å…·ä½“actionåˆ° https://docs.fastlane.tools/actions ä¸Šé¢æŸ¥æ‰¾</span><br><span class="line"># è¿™é‡Œçš„è·¯å¾„ä»¥ä»“åº“æ ¹ç›®å½•ä¸ºå‡†</span><br><span class="line"></span><br><span class="line"># 1ã€ä¿®æ”¹specæ–‡ä»¶ï¼ˆä¿®æ”¹s.versionï¼Œs.descriptionç­‰ï¼‰</span><br><span class="line"># 2ã€pod install ï¼ˆä½¿Exampleä¸podä¸‹æ¥çš„åº“äº§ç”Ÿå…³è”ï¼‰</span><br><span class="line">cocoapods(</span><br><span class="line">  clean: true,</span><br><span class="line">  podfile: &quot;./Example/Podfile&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 3ã€æäº¤æœ¬åœ°ä»“åº“ä»£ç è‡³è¿œç¨‹ä»“åº“</span><br><span class="line">git_add(path: &quot;.&quot;)</span><br><span class="line">git_commit(path: &quot;.&quot;, message: &quot;upgrade repo&quot;)</span><br><span class="line">push_to_git_remote</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 4ã€æ‰“æ ‡ç­¾ï¼Œå¹¶æäº¤è‡³è¿œç¨‹</span><br><span class="line">add_git_tag(</span><br><span class="line">  tag: tagNum</span><br><span class="line">)</span><br><span class="line">push_git_tags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 5ã€éªŒè¯specï¼Œå¹¶æè‡³ç§æœ‰ç´¢å¼•åº“</span><br><span class="line">pod_lib_lint(allow_warnings: true)</span><br><span class="line"># å› ä¸ºæœ¬åœ°ç´¢å¼•åº“repoçš„åå­—æ˜¯åŸºæœ¬ä¸Šä¸ä¼šå»æ”¹å˜çš„ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å†™æ­» LXFSpecs</span><br><span class="line"># podspecçš„åå­—éœ€è¦ç”±å¤–ç•Œä¼ å…¥</span><br><span class="line">pod_push(path: &quot;#&#123;podspecName&#125;.podspec&quot;, repo: &quot;LXFSpecs&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure></p><h3 id="2ã€éªŒè¯Fastfile"><a href="#2ã€éªŒè¯Fastfile" class="headerlink" title="2ã€éªŒè¯Fastfile"></a>2ã€éªŒè¯Fastfile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane lanes</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/FastfileéªŒè¯æˆåŠŸ.png" alt="FastfileéªŒè¯æˆåŠŸ"></p><h3 id="3ã€æ‰§è¡Œfastlane"><a href="#3ã€æ‰§è¡Œfastlane" class="headerlink" title="3ã€æ‰§è¡Œfastlane"></a>3ã€æ‰§è¡Œfastlane</h3><p><strong>éœ€è¦åœ¨ç»„ä»¶ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</strong><br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/æ ¹ç›®å½•.png" alt="æ ¹ç›®å½•"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane LXFUpdatePodTool tag:0.1.1 specName:LXFMain</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/å¼€å§‹æ‰§è¡Œ.png" alt="å¼€å§‹æ‰§è¡Œ"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/ä¸Šä¼ å®Œæˆ.png" alt="ä¸Šä¼ å®Œæˆ"></p><p>æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸è¶…è¿‡30ç§’ï½</p><h2 id="å››ã€è‡ªå®šä¹‰Action"><a href="#å››ã€è‡ªå®šä¹‰Action" class="headerlink" title="å››ã€è‡ªå®šä¹‰Action"></a>å››ã€è‡ªå®šä¹‰Action</h2><p>ä»¥ä¸Šçš„è¿‡ç¨‹å·²ç»å¯ä»¥å®Œæˆä¸€æ•´ä¸ªè‡ªåŠ¨åŒ–æ›´æ–°äº†ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè¾“å…¥çš„tagå¯èƒ½ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æœ¬åœ°å’Œè¿œç¨‹éƒ½å¯èƒ½å·²ç»å­˜åœ¨ï¼Œå³å‘ç”Ÿå†²çªï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹©è‡ªåŠ¨åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹å†²çªçš„é‚£ä¸ªtagï¼Œå†é‡æ–°ä¸Šä¼ å½“å‰tag</p><h3 id="1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„action"><a href="#1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„action" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„action"></a>1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„action</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane new_action</span><br></pre></td></tr></table></figure><p>æŒ‰è¦æ±‚è¾“å…¥Actionåç§°<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/è¾“å…¥actionåç§°.png" alt="è¾“å…¥actionåç§°"></p><p>å®Œæˆåfastlaneç›®å½•ä¸‹å°±ä¼šå¤šå‡ºä¸€ä¸ªåä¸ºactionsçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜æ”¾çš„å°±æ˜¯ä½ è‡ªå®šä¹‰action<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/actionsæ–‡ä»¶å¤¹.png" alt=""></p><h3 id="2ã€ç¼–è¾‘è‡ªå®šä¹‰action"><a href="#2ã€ç¼–è¾‘è‡ªå®šä¹‰action" class="headerlink" title="2ã€ç¼–è¾‘è‡ªå®šä¹‰action"></a>2ã€ç¼–è¾‘è‡ªå®šä¹‰action</h3><p>æ‰“å¼€remove_git_tag.rbï¼Œå¼€å§‹è‡ªå®šä¹‰æˆ‘ä»¬çš„actionå§ï¼Œä»€ä¹ˆï¼Ÿä¸ä¼šè¯­æ³•æ€ä¹ˆåŠï¼Ÿå¯ä»¥å‚è€ƒåˆ«äººçš„å˜›ï¼Œä¸Šé¢ç»™å‡ºçš„<a href="https://github.com/fastlane/fastlane/tree/master/fastlane/lib/fastlane/actions" target="_blank" rel="noopener">actionçš„æºç åœ°å€</a>å°±æœ‰ç”¨æ­¦ä¹‹åœ°äº†ï¼Œæ¯”å¦‚<a href="https://github.com/fastlane/fastlane/blob/master/fastlane/lib/fastlane/actions/pod_push.rb" target="_blank" rel="noopener">pod_push</a>ã€‚è¿™é‡Œæˆ‘ç›´æ¥è´´å‡ºæˆ‘å·²ç»å®Œæˆçš„ä¸»è¦ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># å¯ä»¥ä½¿ç”¨ fastlane action remove_git_tag æ¥å‚çœ‹è¯¦ç»†æè¿°</span><br><span class="line"></span><br><span class="line">def self.run(params)</span><br><span class="line">  # è¿™é‡Œå†™è¦æ‰§è¡Œçš„æ“ä½œ </span><br><span class="line">  # params[:å‚æ•°åç§°] å‚æ•°åç§°ä¸ä¸‹é¢self.available_optionsä¸­çš„ä¿æŒä¸€è‡´</span><br><span class="line">  tagNum = params[:tagNum]</span><br><span class="line">  rmLocalTag = params[:rmLocalTag]</span><br><span class="line">  rmRemoteTag = params[:rmRemoteTag]</span><br><span class="line"></span><br><span class="line">  command = []</span><br><span class="line">  if rmLocalTag</span><br><span class="line">    # åˆ é™¤æœ¬åœ°æ ‡ç­¾</span><br><span class="line">    # git tag -d æ ‡ç­¾åç§°</span><br><span class="line">    command &lt;&lt; &quot;git tag -d #&#123;tagNum&#125;&quot;</span><br><span class="line">  end</span><br><span class="line">  if rmRemoteTag</span><br><span class="line">    # åˆ é™¤è¿œç¨‹æ ‡ç­¾</span><br><span class="line">    # git push origin :æ ‡ç­¾åç§°</span><br><span class="line">    command &lt;&lt; &quot;git push origin :#&#123;tagNum&#125;&quot;</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  result = Actions.sh(command.join(&apos;&amp;&apos;))</span><br><span class="line">  UI.success(&quot;Successfully remove tag ğŸš€ &quot;)</span><br><span class="line">  return result</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def self.description</span><br><span class="line">  # å¯¹å½“å‰è„šæœ¬çš„ç®€å•æè¿°</span><br><span class="line">  &quot;åˆ é™¤tag&quot;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def self.details</span><br><span class="line">  # å¯¹å½“å‰è„šæœ¬çš„å…·ä½“æè¿°</span><br><span class="line">  &quot;ä½¿ç”¨å½“å‰actionæ¥åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹å†²çªçš„tag&quot;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def self.available_options</span><br><span class="line">  # ç”¨æ¥ä¼ é€’å‚æ•°</span><br><span class="line">  [ </span><br><span class="line">    FastlaneCore::ConfigItem.new(key: :tagNum,</span><br><span class="line">                                  description: &quot;è¾“å…¥å³å°†åˆ é™¤çš„tag&quot;,</span><br><span class="line">                                  is_string: true),</span><br><span class="line">    FastlaneCore::ConfigItem.new(key: :rmLocalTag,</span><br><span class="line">                                  description: &quot;æ˜¯å¦åˆ é™¤æœ¬åœ°tag&quot;,</span><br><span class="line">                                  optional:true,</span><br><span class="line">                                  is_string: false,</span><br><span class="line">                                  default_value: true),</span><br><span class="line">    FastlaneCore::ConfigItem.new(key: :rmRemoteTag,</span><br><span class="line">                                  description: &quot;æ˜¯å¦åˆ é™¤è¿œç¨‹tag&quot;,</span><br><span class="line">                                  optional:true,</span><br><span class="line">                                  is_string: false,</span><br><span class="line">                                  default_value: true)</span><br><span class="line">  ]</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def self.authors</span><br><span class="line">  # ä½œè€…å§“å</span><br><span class="line">  [&quot;LinXunFeng&quot;]</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="3ã€æŸ¥çœ‹actionæè¿°"><a href="#3ã€æŸ¥çœ‹actionæè¿°" class="headerlink" title="3ã€æŸ¥çœ‹actionæè¿°"></a>3ã€æŸ¥çœ‹actionæè¿°</h3><p>åŒæ ·ï¼Œè¿™é‡Œå…ˆcdåˆ°ç»„ä»¶åº“çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼ŒåŸå› æ˜¯è¿™ä¸ªè‡ªå®šä¹‰actionåªå­˜åœ¨å½“å‰æ ¹ç›®å½•ä¸‹çš„fastlaneä¸­ï¼Œå…¶å®ƒfastlaneçš„éè‡ªå®šä¹‰çš„actionå°±ä¸ç”¨åœ¨å½“å‰æ ¹ç›®å½•ä¸‹æ“ä½œï½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane action remove_git_tag</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/æŸ¥çœ‹å…·ä½“æè¿°.png" alt="æŸ¥çœ‹å…·ä½“æè¿°"></p><h3 id="4ã€æµ‹è¯•æ‰§è¡Œ"><a href="#4ã€æµ‹è¯•æ‰§è¡Œ" class="headerlink" title="4ã€æµ‹è¯•æ‰§è¡Œ"></a>4ã€æµ‹è¯•æ‰§è¡Œ</h3><p>å…ˆæ¥çœ‹çœ‹å½“å‰ç»„ä»¶åº“å·²å­˜åœ¨çš„tag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/å·²å­˜åœ¨çš„tag.png" alt="å·²å­˜åœ¨çš„tag"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æ˜¯å·²ç»æœ‰ä¸€ä¸ª<code>0.1.1</code>ç‰ˆæœ¬çš„äº†ã€‚è¿™æ—¶æˆ‘ä»¬å†æ¥æ‰§è¡Œä¸€æ¬¡LXFUpdatePodToolèˆªé“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane LXFUpdatePodTool tag:0.1.1 specName:LXFMain</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆå››ï¼‰ï¼šfastlaneå®ç°podè‡ªåŠ¨åŒ–/è‡ªåŠ¨æ¸…é™¤.png" alt="è‡ªåŠ¨æ¸…é™¤"></p><h2 id="äº”ã€å·¥å…·æ‹¿èµ°"><a href="#äº”ã€å·¥å…·æ‹¿èµ°" class="headerlink" title="äº”ã€å·¥å…·æ‹¿èµ°"></a>äº”ã€å·¥å…·æ‹¿èµ°</h2><p><a href="https://github.com/LinXunFeng/LXFUpdatePodTool" target="_blank" rel="noopener">LXFUpdatePodTool</a> å·²ç»ä¼ åˆ°æˆ‘çš„GitHubä¸Šï¼Œéœ€è¦çš„åŒå­¦å°±æ‹¿èµ°å§ï¼Œé¡ºæ‰‹ç»™ä¸ªStarå’¯ Orz</p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
            <tag> Cocoapods </tag>
            
            <tag> ç»„ä»¶åŒ– </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶</title>
      <link href="/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/"/>
      <url>/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ç»è¿‡å‰ä¸¤ç¯‡æ–‡ç« çš„å­¦ä¹ ï¼Œç›¸ä¿¡å¯¹ç»„ä»¶åŒ–å¼€å‘æœ‰äº†å¤§è‡´çš„äº†è§£ï¼Œé‚£æˆ‘ä»¬è¿™ç¯‡æ–‡ç« å°±æ¥è®²è®²èµ„æºæ–‡ä»¶çš„åŠ è½½å§</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>ç»è¿‡å‰ä¸¤ç¯‡æ–‡ç« çš„å­¦ä¹ ï¼Œç›¸ä¿¡å¯¹ç»„ä»¶åŒ–å¼€å‘æœ‰äº†å¤§è‡´çš„äº†è§£ï¼Œé‚£æˆ‘ä»¬è¿™ç¯‡æ–‡ç« å°±æ¥è®²è®²èµ„æºæ–‡ä»¶çš„åŠ è½½å§</p></blockquote><p>è¿™é‡Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªLXFMainç»„ä»¶åº“ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ˜¾ç¤ºTabBarçš„ç©æ„ï¼Œç„¶åå†è¿›è¡Œç»„ä»¶åŒ–æŠ½ç¦»å‡ºæ¥ï¼Œå…¶ä¸­çš„è¿‡ç¨‹è¿™é‡Œä¸å†èµ˜è¿°ï¼Œè¿˜æ²¡äº†è§£è¿‡çš„åŒå­¦å»ºè®®å…ˆé˜…è¯»ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« å§</p><p><a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</a></p><p><a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“</a></p><p>è¿™é‡Œè·Ÿä¹‹å‰ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºå¤šäº†å›¾ç‰‡èµ„æºï¼Œç»„ä»¶çš„æ ¸å¿ƒä»£ç æ”¾åœ¨Classesæ–‡ä»¶å¤¹ä¸­ï¼Œè€Œå›¾ç‰‡æˆ‘ä»¬åˆ™å­˜æ”¾äºAssetsç›®å½•ä¸‹ï¼Œå¦‚å›¾æ‰€ç¤º </p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/å­˜æ”¾ä½ç½®.png" alt="å­˜æ”¾ä½ç½®"></p><h3 id="ä¸€ã€ä¿®æ”¹Spec"><a href="#ä¸€ã€ä¿®æ”¹Spec" class="headerlink" title="ä¸€ã€ä¿®æ”¹Spec"></a>ä¸€ã€ä¿®æ”¹Spec</h3><p>å°†å…³äºèµ„æºåŠ è½½çš„æ³¨é‡Šå»æ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s.resource_bundles = &#123;</span><br><span class="line"> # &apos;LXFMain&apos; =&gt; [&apos;LXFMain/Assets/*.png&apos;]</span><br><span class="line"> &apos;LXFMain&apos; =&gt; [&apos;LXFMain/Assets/*&apos;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å›åˆ°LXFMainçš„æ¨¡æ¿åº“ï¼Œæˆ‘ä»¬è¿›è¡Œä¸€æ¬¡æœ¬åœ°çš„å®‰è£…å’Œæµ‹è¯•(<code>pod install</code>)</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/ä¿®æ”¹Spec-podInstall.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå›¾ç‰‡èµ„æºä¹Ÿå®‰è£…è¿›æ¥äº†ï¼Œä½†æ˜¯è¿è¡Œçš„æ•ˆæœå¦‚ä¸‹å›¾ï¼Œå›¾ç‰‡å¹¶ä¸èƒ½æˆåŠŸåŠ è½½å‡ºæ¥</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/æ²¡æœ‰å›¾æ ‡.png" alt="æ²¡æœ‰å›¾æ ‡"></p><h2 id="äºŒã€ä¿®æ”¹åŠ è½½èµ„æºä»£ç "><a href="#äºŒã€ä¿®æ”¹åŠ è½½èµ„æºä»£ç " class="headerlink" title="äºŒã€ä¿®æ”¹åŠ è½½èµ„æºä»£ç "></a>äºŒã€ä¿®æ”¹åŠ è½½èµ„æºä»£ç </h2><p>è¿™æ˜¯å½“å‰åŠ è½½å›¾ç‰‡çš„ç›¸å…³ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[UIImage imageNamed:@&quot;å›¾ç‰‡åç§°&quot;];</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/showInFinder.png" alt="show in finder"></p><p>å³å‡»æ˜¾ç¤ºåŒ…å†…å®¹<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/LXFMain.framework.png" alt="LXFMain.framework"></p><p>å›¾ç‰‡å°±åœ¨è¿™ä¸ª<code>LXFMain.bundle</code>é‡Œé¢(è¿™é‡Œå°±ä¸æˆªå›¾çœ‹äº†)ï¼Œè¿™é‡Œä¸»è¦æ˜¯è®©å¤§å®¶å¯¹è¿™ä¸ªç›®å½•ç»“æ„æœ‰ä¸ªäº†è§£</p><p>æˆ‘ä»¬å¯¹<code>imageNamed</code>è¿›è¡Œè·³è½¬åˆ°å®šä¹‰æ“ä½œ<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/imageNamed.png" alt="imageNamed"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// load from main bundle</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå®˜æ–¹æ³¨é‡Šç€<code>imageNamed</code>åŠ è½½çš„æ˜¯main bundleä¸­çš„èµ„æº,mainBundleçš„ä½ç½®å¦‚ä¸‹å›¾<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/mainBundle.png" alt="mainBundle"></p><p>è¿™æ ·å½“ç„¶å°±æ— æ³•åŠ è½½åˆ°å›¾ç‰‡å•¦ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒåŠ è½½è‡ªå·±å½“å‰æ‰€åœ¨bundleé‡Œçš„å›¾ç‰‡ ï¼Œæ‰€ä»¥åŠ è½½å›¾ç‰‡çš„ä»£ç éœ€è¦è¿›è¡Œä¿®æ”¹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *normalImgName = <span class="string">@"ä¸ªäºº@2x.png"</span>;</span><br><span class="line"><span class="built_in">NSBundle</span> *curBundle = [<span class="built_in">NSBundle</span> bundleForClass:<span class="keyword">self</span>.class]; <span class="comment">// è·å–å½“å‰bundle</span></span><br><span class="line"><span class="built_in">NSString</span> *normalImgPath = [curBundle pathForResource:normalImgName ofType:<span class="literal">nil</span> inDirectory:<span class="string">@"LXFMain.bundle"</span>];</span><br><span class="line"><span class="built_in">UIImage</span> *normalImage = [<span class="built_in">UIImage</span> imageWithContentsOfFile:normalImgPath];</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ç›´æ¥å†™<code>LXFMain.bundle</code>å¹¶ä¸å¥½ï¼Œä¸å¯æ§ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ”¹è¿›ä¸€ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NSString *normalImgName = [NSString stringWithFormat:@&quot;%@@2x.png&quot;, normalImg];</span><br><span class="line">NSBundle *curBundle = [NSBundle bundleForClass:self.class];</span><br><span class="line">//  *********** é‡ç‚¹ ***********   //</span><br><span class="line">NSString *curBundleName = curBundle.infoDictionary[@&quot;CFBundleName&quot;];</span><br><span class="line">NSString *curBundleDirectory = [NSString stringWithFormat:@&quot;%@.bundle&quot;, curBundleName];</span><br><span class="line">NSString *normalImgPath = [curBundle pathForResource:normalImgName ofType:nil inDirectory:curBundleDirectory];</span><br><span class="line">//  ***************************   //</span><br><span class="line">UIImage *normalImage = [UIImage imageWithContentsOfFile:normalImgPath];</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/æˆåŠŸåŠ è½½.png" alt="æˆåŠŸåŠ è½½"></p><h2 id="ä¸‰ã€èŠèŠxib"><a href="#ä¸‰ã€èŠèŠxib" class="headerlink" title="ä¸‰ã€èŠèŠxib"></a>ä¸‰ã€èŠèŠxib</h2><p>Xibçš„åŠ è½½ä¹Ÿæ˜¯å¦‚æ­¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSBundle *curBundle = [NSBundle bundleForClass:self.class];</span><br><span class="line">LXFCenterView *centerView = (LXFCenterView *)[curBundle loadNibNamed:@&quot;LXFCenterView&quot; owner:nil options:nil].firstObject;</span><br><span class="line">centerView.frame = CGRectMake(30, 140, 200, 100);</span><br><span class="line">[self.view addSubview:centerView];</span><br></pre></td></tr></table></figure></p><p>ä¸è¿‡xibä¸­å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæ˜¯ç›´æ¥åœ¨xibä¸­æ‹–å…¥ä¸€ä¸ªimageViewæ§ä»¶æ¥è®¾ç½®å›¾ç‰‡çš„åŠ è½½ï¼Œæˆ‘ä»¬åˆ™éœ€è¦åœ¨å›¾ç‰‡åå­—å‰åŠ ä¸Šå½“å‰bundleåç§°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LXFMain.bundle/ä¸ªäºº</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œé™¤äº†å½“å‰xibè¦åŠ è½½çš„å›¾ç‰‡ä¸å±äºmainBundleè¿™ä¸ªåŸå› ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯xibæ–‡ä»¶ä¸bundleå­˜æ”¾ä½ç½®å±äºåŒä¸€çº§åˆ«ï¼Œæ•…ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„æ–¹å¼ï¼Œåœ¨å›¾ç‰‡åå­—å‰åŠ ä¸Šbundleåç§°å³å¯ã€‚</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/åŒä¸€ç›®å½•çº§åˆ«.png" alt="åŒä¸€ç›®å½•çº§åˆ«"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/xibä¸Šçš„æ“ä½œ.png" alt="xibä¸Šçš„æ“ä½œ"></p><p>è™½ç„¶æ— æ³•åœ¨xibä¸Šç›´æ¥çœ‹åˆ°æ•ˆæœï¼Œä¸è¿‡ç¡®å®æ˜¯æœ‰æ•ˆçš„<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸‰ï¼‰ï¼šåŠ è½½èµ„æºæ–‡ä»¶/xibæˆåŠŸæ˜¾ç¤ºå›¾ç‰‡.png" alt="xibæˆåŠŸæ˜¾ç¤ºå›¾ç‰‡"></p><h2 id="å››ã€é‡åˆ°çš„å°é—®é¢˜"><a href="#å››ã€é‡åˆ°çš„å°é—®é¢˜" class="headerlink" title="å››ã€é‡åˆ°çš„å°é—®é¢˜"></a>å››ã€é‡åˆ°çš„å°é—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!] Unable to find a pod with name, author, summary, or description matching `lxfmain`</span><br></pre></td></tr></table></figure><p>æˆ‘åšå®Œä¸€åˆ‡æ“ä½œåå‘ç°æœç´¢æŠ¥ä¸Šé¢é‚£ä¸ªé”™ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯åˆ é™¤æœ¬åœ°ç´¢å¼•æ–‡ä»¶ï¼Œç„¶åå†æœç´¢ä¸€éï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ å†ç”Ÿæˆä¸€åˆ‡æœ¬åœ°ç´¢å¼•æ–‡ä»¶ï¼Œç„¶åå°±æå®šäº†ï½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/Library/Caches/CocoaPods/search_index.json </span><br><span class="line">pod search lxfmain</span><br></pre></td></tr></table></figure></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
            <tag> Cocoapods </tag>
            
            <tag> ç»„ä»¶åŒ– </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“</title>
      <link href="/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%BF%9C%E7%A8%8B%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%AD%90%E5%BA%93/"/>
      <url>/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%BF%9C%E7%A8%8B%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E6%9B%B4%E6%96%B0%E4%B8%8E%E5%AD%90%E5%BA%93/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>åœ¨ä¸Šä¸€ç¯‡ã€<a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</a>ã€‘ä¸­æˆ‘ä»¬å·²ç»å®æˆ˜äº†è¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬æ“ä½œï¼Œä½†æ˜¯ç»„ä»¶ä¸å¯èƒ½ä¸Šä¼ ä¸€æ¬¡å°±å®Œäº‹äº†ï¼Œéšç€ä¸šåŠ¡çš„å¢åŠ ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½è¿˜éœ€è¦æ·»åŠ æ›´å¤šçš„ä¸œè¥¿ï¼Œæˆ–è€…ä¿®å¤ä¸€äº›é—®é¢˜ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¯¹ç§æœ‰åº“ä»£ç è¿›è¡Œå‡çº§ä¸ç»´æŠ¤</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>åœ¨ä¸Šä¸€ç¯‡ã€<a href="http://linxunfeng.top/2018/04/06/iOS-ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/">iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</a>ã€‘ä¸­æˆ‘ä»¬å·²ç»å®æˆ˜äº†è¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬æ“ä½œï¼Œä½†æ˜¯ç»„ä»¶ä¸å¯èƒ½ä¸Šä¼ ä¸€æ¬¡å°±å®Œäº‹äº†ï¼Œéšç€ä¸šåŠ¡çš„å¢åŠ ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½è¿˜éœ€è¦æ·»åŠ æ›´å¤šçš„ä¸œè¥¿ï¼Œæˆ–è€…ä¿®å¤ä¸€äº›é—®é¢˜ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¯¹ç§æœ‰åº“ä»£ç è¿›è¡Œå‡çº§ä¸ç»´æŠ¤</p></blockquote><p>è¿™é‡Œä»¥å¯¹åŸºç¡€ç»„ä»¶é‡Œæ·»åŠ äº†ä¸€ä¸ªCacheå·¥å…·ä¸ºä¾‹</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/æ·»åŠ Cacheå·¥å…·.png" alt="æ·»åŠ Cacheå·¥å…·"></p><p>æ·»åŠ å®Œæˆåæˆ‘ä»¬éœ€è¦æ›´æ–°åˆ°è¿œç¨‹ä»“åº“</p><h2 id="ä¸€ã€æ›´æ–°è¿œç¨‹ä»“åº“"><a href="#ä¸€ã€æ›´æ–°è¿œç¨‹ä»“åº“" class="headerlink" title="ä¸€ã€æ›´æ–°è¿œç¨‹ä»“åº“"></a>ä¸€ã€æ›´æ–°è¿œç¨‹ä»“åº“</h2><p>cd åˆ°æœ¬åœ°ä»“åº“çš„ä½ç½®ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><h3 id="1ã€ä»£ç æ›´æ–°"><a href="#1ã€ä»£ç æ›´æ–°" class="headerlink" title="1ã€ä»£ç æ›´æ–°"></a>1ã€ä»£ç æ›´æ–°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &apos;æ›´æ–°æè¿°&apos;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/ä»£ç å‡çº§.png" alt="ä»£ç å‡çº§"></p><h3 id="2ã€ç‰ˆæœ¬æ›´æ–°"><a href="#2ã€ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="2ã€ç‰ˆæœ¬æ›´æ–°"></a>2ã€ç‰ˆæœ¬æ›´æ–°</h3><p><strong>ç‰ˆæœ¬æ›´æ–° è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œä¸ºæ›´æ–°ç´¢å¼•åº“åšå‡†å¤‡</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag -a &apos;æ–°ç‰ˆæœ¬å·&apos; -m &apos;æ³¨é‡Š&apos;</span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/ç‰ˆæœ¬å‡çº§.png" alt="ç‰ˆæœ¬å‡çº§"></p><p>æŸ¥çœ‹è¿œç¨‹ä»“åº“ï¼Œæ ‡ç­¾æ•°å·²ç»æœ‰2ä¸ªäº†ï¼Œç‚¹è¿›å»å°±å¯ä»¥çœ‹åˆ°0.2.0ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸å»çœ‹äº†<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/2ä¸ªæ ‡ç­¾.png" alt=""></p><h2 id="äºŒã€ä¿®æ”¹æè¿°æ–‡ä»¶å¹¶æ›´æ–°ç´¢å¼•åº“"><a href="#äºŒã€ä¿®æ”¹æè¿°æ–‡ä»¶å¹¶æ›´æ–°ç´¢å¼•åº“" class="headerlink" title="äºŒã€ä¿®æ”¹æè¿°æ–‡ä»¶å¹¶æ›´æ–°ç´¢å¼•åº“"></a>äºŒã€ä¿®æ”¹æè¿°æ–‡ä»¶å¹¶æ›´æ–°ç´¢å¼•åº“</h2><h3 id="1ã€ä¿®æ”¹Sepc"><a href="#1ã€ä¿®æ”¹Sepc" class="headerlink" title="1ã€ä¿®æ”¹Sepc"></a>1ã€ä¿®æ”¹Sepc</h3><p>æ‰“å¼€ä½ çš„<code>xx.podspec</code>æ–‡ä»¶ï¼Œå°†åŸæœ¬çš„ç‰ˆæœ¬å·æ”¹ä¸º<code>0.2.0</code>ï¼Œä¸åˆšåˆšçš„tagä¿æŒä¸€è‡´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.version = &apos;0.2.0&apos;</span><br></pre></td></tr></table></figure></p><h3 id="2ã€éªŒè¯è¿œç¨‹Spec"><a href="#2ã€éªŒè¯è¿œç¨‹Spec" class="headerlink" title="2ã€éªŒè¯è¿œç¨‹Spec"></a>2ã€éªŒè¯è¿œç¨‹Spec</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint --private</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/éªŒè¯è¿œç¨‹Spec.png" alt="éªŒè¯è¿œç¨‹Spec"></p><h3 id="3ã€æ›´æ–°ç´¢å¼•åº“"><a href="#3ã€æ›´æ–°ç´¢å¼•åº“" class="headerlink" title="3ã€æ›´æ–°ç´¢å¼•åº“"></a>3ã€æ›´æ–°ç´¢å¼•åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo push ç´¢å¼•åº“åç§° xxx.podspec</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/æ›´æ–°ç´¢å¼•åº“.png" alt="æ›´æ–°ç´¢å¼•åº“"></p><h2 id="ä¸‰ã€æ›´æ–°ä½¿ç”¨"><a href="#ä¸‰ã€æ›´æ–°ä½¿ç”¨" class="headerlink" title="ä¸‰ã€æ›´æ–°ä½¿ç”¨"></a>ä¸‰ã€æ›´æ–°ä½¿ç”¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// --no-repo-update ä¸æ›´æ–°æœ¬åœ°ç´¢å¼•åº“</span><br><span class="line">// å› ä¸ºåˆšåˆšå·²ç»è‡ªå·±æ‰‹åŠ¨æ›´æ–°è¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰æ‹©è·³è¿‡æ›´æ–°</span><br><span class="line">pod update --no-repo-update</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/æ›´æ–°æ¡†æ¶.png" alt="æ›´æ–°æ¡†æ¶"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/æ›´æ–°æˆåŠŸ.png" alt="æ›´æ–°æˆåŠŸ"></p><hr><h2 id="å››ã€ç¬¬ä¸‰æ–¹ä¾èµ–"><a href="#å››ã€ç¬¬ä¸‰æ–¹ä¾èµ–" class="headerlink" title="å››ã€ç¬¬ä¸‰æ–¹ä¾èµ–"></a>å››ã€ç¬¬ä¸‰æ–¹ä¾èµ–</h2><p>å½“æˆ‘ä»¬çš„ç§æœ‰åº“éœ€è¦ä¾èµ–å…¶å®ƒç¬¬ä¸‰æ–¹æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨specæ–‡ä»¶ä¸­å¼€å¯ä¾èµ–ï¼Œä¾‹å¦‚ä¸‹é¢æ‰€ç¤ºä»£ç ï¼Œè¡¨æ˜å½“å‰ä»“åº“éœ€è¦ä¾èµ–AFNå’ŒSDWebImage<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.dependency &apos;AFNetworking&apos;, &apos;~&gt; 3.2.0&apos;</span><br><span class="line">s.dependency &apos;SDWebImage&apos;, &apos;~&gt; 4.3.3&apos;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹åæ›´æ–°æ“ä½œåŒä¸Šæ‰€è¿°ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p><p>ä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ¥äº†ä¸€ä½æ–°çš„å°ä¼™ä¼´ï¼Œä»–æ‰€è´Ÿè´£çš„éƒ¨åˆ†åªéœ€è¦LXFBaseä¸‹çš„Categoryï¼Œè€ŒLXFBaseä¸‹çš„Cacheæ‰éœ€è¦ä¾èµ–SDWebImageï¼Œæ­¤æ—¶ä»–è‹¥æ˜¯podä¸€æ•´ä¸ªLXFBaseå²‚ä¸æ˜¯å¹³ç™½æ— æ•…å®‰è£…äº†ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼Œé‚£åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><blockquote><p>æ–¹æ¡ˆå°±æ˜¯å¯ä»¥é€šè¿‡å­åº“Subspecsæ¥è§£å†³å› éœ€è¦ä¸€ä¸ªå°å°çš„å·¥å…·è€Œä¾èµ–æ•´ä¸ªåŸºç¡€ç»„ä»¶çš„é—®é¢˜</p></blockquote><h2 id="äº”ã€å­åº“Subspecs"><a href="#äº”ã€å­åº“Subspecs" class="headerlink" title="äº”ã€å­åº“Subspecs"></a>äº”ã€å­åº“Subspecs</h2><p>ä»€ä¹ˆæ˜¯Subspecsï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥æœç´¢ä¸€ä¸‹SDWebImage</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod search &apos;SDWebImage&apos;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/Subspecs.png" alt="Subspecs"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬åªéœ€è¦ç”¨åˆ°SDWebImageä¸­çš„GIFåŠŸèƒ½ï¼Œé‚£ä¹ˆå¹¶ä¸éœ€è¦å°†æ•´ä¸ªSDWebImageéƒ½ä¸‹è½½ä¸‹æ¥ï¼Œåœ¨Podfileä¸­å°†<del><code>pod &#39;SDWebImage&#39;</code></del> æ”¹ä¸º <code>pod SDWebImage/GIF</code>å³å¯å•ç‹¬ä½¿ç”¨è¿™ä¸€åŠŸèƒ½</p><p>é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹æ€ä¹ˆæè¿°ä¸€ä¸ªå­åº“å§</p><h3 id="å­åº“æ ¼å¼"><a href="#å­åº“æ ¼å¼" class="headerlink" title="å­åº“æ ¼å¼"></a>å­åº“æ ¼å¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s.subspec &apos;å­åº“åç§°&apos; do |åˆ«å|</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œå·²ç»åˆ†ç¦»å‡ºå­åº“äº†ï¼Œæ‰€ä»¥<code>s.source_files</code>å’Œ<code>s.dependency</code>å°±ä¸èƒ½è¿™ä¹ˆä½¿ç”¨äº†ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å­åº“é‡Œåˆ†åˆ«æŒ‡å®šï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠåŸæ¥çš„<code>s.source_files</code>å’Œ<code>s.dependency</code>éƒ½æ³¨é‡Šæ‰ã€‚å†™æ³•å‚è€ƒå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># s.source_files = &apos;LXFBase/Classes/**/*&apos;</span><br><span class="line"># s.dependency &apos;SDWebImage&apos;, &apos;~&gt; 4.3.3&apos;</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Cache&apos; do |c|</span><br><span class="line">  c.source_files = &apos;LXFBase/Classes/Cache/**/*&apos;</span><br><span class="line">  c.dependency &apos;SDWebImage&apos;, &apos;~&gt; 4.3.3&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Category&apos; do |c|</span><br><span class="line">  c.source_files = &apos;LXFBase/Classes/Category/**/*&apos;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">s.subspec &apos;Tool&apos; do |t|</span><br><span class="line">  t.source_files = &apos;LXFBase/Classes/Tool/**/*&apos;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åå†æŒ‰ä¹‹å‰çš„æ­¥éª¤æ›´æ–°ç´¢å¼•åº“å’Œç»„ä»¶åº“å°±å¯ä»¥äº†</p><p><strong>ps: åœ¨æ·»åŠ ç¬¬ä¸‰æ–¹ä¾èµ–æè¿°ååšéªŒè¯æˆ–è€…ä¸Šä¼ æ“ä½œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºå®ƒåœ¨å…‹éš†ç¬¬ä¸‰æ–¹åº“å¦‚SDWebImageï¼Œæœ‰å…´è¶£çš„å¯ä»¥åœ¨å‘½ä»¤åé¢åŠ å…¥<code>--verbose</code>æ¥æŸ¥çœ‹è¯¦æƒ…æƒ…å†µ</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint --private --verbose</span><br></pre></td></tr></table></figure></p><p>åœ¨æˆåŠŸæ›´æ–°ç»„ä»¶åº“å’Œç´¢å¼•åº“åæˆ‘ä»¬å†æ¥æœç´¢ä¸€ä¸‹è¯•è¯•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod search &apos;LXFBase&apos;</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/subspecæ·»åŠ æˆåŠŸ.png" alt="subspecæ·»åŠ æˆåŠŸ"></p><p>ç°åœ¨å°±å¯ä»¥çˆ±è£…å“ªä¸ªå°±è£…å“ªä¸ªäº†ï¼Œåœ¨Podfileä¸­æŒ‡å®šè¦å®‰è£…çš„å­åº“å°±è¡Œäº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFBase/Cache&apos;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„æ›´æ–°ä¸å­åº“/å®‰è£…æŒ‡å®šå­åº“ä¸ä¾èµ–åº“.png" alt="å®‰è£…æŒ‡å®šå­åº“ä¸ä¾èµ–åº“"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
            <tag> Cocoapods </tag>
            
            <tag> ç»„ä»¶åŒ– </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨</title>
      <link href="/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%BF%9C%E7%A8%8B%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/04/06/iOS-%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%BF%9C%E7%A8%8B%E7%A7%81%E6%9C%89%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>éšç€é¡¹ç›®åŠŸèƒ½çš„ä¸æ–­å¢åŠ ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜åŠ å…¥ï¼Œä¸šåŠ¡ä¸»çº¿ä¹Ÿéšä¹‹è¶Šæ¥è¶Šå¤šï¼Œé€ æˆè€¦åˆè¶Šæ¥è¶Šä¸¥é‡ï¼Œç¼–è¯‘è¶Šæ¥è¶Šæ…¢ï¼Œæµ‹è¯•ä¸ç‹¬ç«‹ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚ä¸ºäº†è§£å†³æ­¤ç±»æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ°ä½¿ç”¨ç»„ä»¶åŒ–å¼€å‘</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>éšç€é¡¹ç›®åŠŸèƒ½çš„ä¸æ–­å¢åŠ ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜åŠ å…¥ï¼Œä¸šåŠ¡ä¸»çº¿ä¹Ÿéšä¹‹è¶Šæ¥è¶Šå¤šï¼Œé€ æˆè€¦åˆè¶Šæ¥è¶Šä¸¥é‡ï¼Œç¼–è¯‘è¶Šæ¥è¶Šæ…¢ï¼Œæµ‹è¯•ä¸ç‹¬ç«‹ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚ä¸ºäº†è§£å†³æ­¤ç±»æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ°ä½¿ç”¨ç»„ä»¶åŒ–å¼€å‘</p></blockquote><p>1.æ¦‚å¿µ<br>ç»„ä»¶åŒ–å°±æ˜¯å°†ä¸€ä¸ªå•ä¸€å·¥ç¨‹çš„é¡¹ç›®, åˆ†è§£æˆä¸ºå„ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œ ç„¶åæŒ‰ç…§æŸç§æ–¹å¼, ä»»æ„ç»„ç»‡æˆä¸€ä¸ªæ‹¥æœ‰å®Œæ•´ä¸šåŠ¡é€»è¾‘çš„å·¥ç¨‹ã€‚</p><p>2.ä¼˜åŠ¿</p><ul><li>ç‹¬ç«‹ï¼šç‹¬ç«‹ç¼–å†™ã€ç¼–è¯‘ã€è¿è¡Œã€æµ‹è¯•</li><li>é‡ç”¨ï¼šåŠŸèƒ½ä»£ç çš„é‡å¤ä½¿ç”¨ã€‚æ¯”å¦‚ä¸åŒé¡¹ç›®ä½¿ç”¨åŒä¸€åŠŸèƒ½æ¨¡å—</li><li>é«˜æ•ˆï¼šä»»æ„å¢åˆ æ¨¡å—ï¼Œå®ç°é«˜æ•ˆè¿­ä»£</li><li>ç»„ä»¶åŒ–è¿˜å¯ä»¥é…åˆäºŒè¿›åˆ¶åŒ–, æé«˜é¡¹ç›®ç¼–è¯‘é€Ÿåº¦</li></ul><p>3.ç»„ä»¶åˆ†ç±»<br>å¤§ä½“ä¸Šåˆ†ä¸‰ç±»ï¼šåŸºç¡€ç»„ä»¶ã€åŠŸèƒ½ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶<br></p><ul><li>åŸºç¡€ç»„ä»¶ï¼šä¹Ÿç§°ä¸ºå…¬å…±ç»„ä»¶ï¼Œå­˜æ”¾å¹³æ—¶å®šä¹‰çš„å®ã€å¸¸é‡ã€åè®®ã€åˆ†ç±»ã€å¯¹å¿…è¦çš„ç¬¬ä¸‰æ–¹çš„å°è£…ç±»ï¼Œä»¥åŠå„ç§å¤„ç†å·¥å…·ç±»ï¼Œå¦‚ï¼šæ—¶é—´ã€æ—¥æœŸã€è®¾å¤‡ä¿¡æ¯ã€æ–‡ä»¶å¤„ç†ã€æ²™ç›’ç®¡ç†ç­‰</li><li>åŠŸèƒ½ç»„ä»¶ï¼š è‡ªå®šä¹‰è§†å›¾æ§ä»¶ã€ä¸€äº›ç‰¹å®šåŠŸèƒ½çš„å°è£…ï¼ˆå¦‚å½•éŸ³ã€æ’­æ”¾éŸ³é¢‘å°è£…ï¼‰</li><li>ä¸šåŠ¡ç»„ä»¶ï¼šå„ç§ä¸šåŠ¡çº¿</li></ul><hr><blockquote><p>æœ¬ç¯‡å…ˆæ¥ä»‹ç»ä¸‹è¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨ï¼Œå»ºè®®æŒ‰é¡ºåºçœ‹å®Œä¹‹åï¼Œå›æ¥å†çœ‹ä¸€éæ­¥éª¤å½’çº³ï¼ŒåŠ æ·±äº†è§£ï¼Œå¦‚æœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡å‡ºï¼Œæ„Ÿè°¢ : )</p></blockquote><h2 id="æ­¥éª¤å½’çº³"><a href="#æ­¥éª¤å½’çº³" class="headerlink" title="æ­¥éª¤å½’çº³"></a>æ­¥éª¤å½’çº³</h2><ol><li><p>åˆ›å»ºè¿œç¨‹ç´¢å¼•åº“å’Œç§æœ‰åº“</p></li><li><p>å°†è¿œç¨‹ç´¢å¼•åº“æ·»åŠ åˆ°æœ¬åœ° <code>pod repo add ç´¢å¼•åº“åç§° ç´¢å¼•åº“åœ°å€</code></p></li><li><p>åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªpodæ¨¡æ¿åº“ <code>pod lib create ç»„ä»¶åç§°</code><br>å°†æ¡†æ¶çš„æ ¸å¿ƒä»£ç æ·»åŠ åˆ°Classesç›®å½•ä¸‹<br>æœ¬åœ°å®‰è£…æµ‹è¯•æ ¸å¿ƒä»£ç æ˜¯å¦å¯ç”¨ <code>pod install</code><br>ä¿®æ”¹Specæè¿°æ–‡ä»¶<br>å°†ä¿®æ”¹å¥½çš„æ¨¡æ¿åº“ä¸Šä¼ è‡³è¿œç¨‹ç§æœ‰åº“</p></li><li><p>ä¸Šä¼ ä»£ç å’Œæ‰“æ ‡ç­¾<br><br><code>git init</code><br><br><code>git add .</code><br><br><code>git commit -m &quot;æäº¤æè¿°&quot;</code><br><br><code>git remote add origin è¿œç¨‹ç§æœ‰åº“åœ°å€</code><br><br><code>git push origin master</code><br><br><code>git tag &#39;0.1.0&#39;</code><br><br><code>git push --tags</code></p></li><li><p>æäº¤specè‡³ç§æœ‰ç´¢å¼•åº“<br><br><code>pod lib lint --private</code><br><br><code>pod spec lint --private</code><br><br><code>pod repo push ç´¢å¼•åº“çš„æœ¬åœ°åç§° xx.podspec</code></p></li><li><p>ä½¿ç”¨<br><br><code>source å®˜æ–¹ç´¢å¼•åº“url</code><br><br><code>source ç§æœ‰ç´¢å¼•åº“url</code><br><br><code>pod &#39;ç»„ä»¶åç§°&#39;</code><br><br><code>pod install</code></p></li></ol><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®æˆ˜å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ç§æœ‰åº“</strong></p><h2 id="ä¸€ã€åˆ›å»ºç§æœ‰ç´¢å¼•åº“"><a href="#ä¸€ã€åˆ›å»ºç§æœ‰ç´¢å¼•åº“" class="headerlink" title="ä¸€ã€åˆ›å»ºç§æœ‰ç´¢å¼•åº“"></a>ä¸€ã€åˆ›å»ºç§æœ‰ç´¢å¼•åº“</h2><p>è¿™é‡Œä»¥ç äº‘ä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªLXFSpecsçš„ç§æœ‰ç´¢å¼•åº“ï¼Œè¿™ç©æ„çš„ä½œç”¨å¦‚å…¶åï¼Œå°±æ˜¯ç”¨æ¥ç´¢å¼•çš„</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ç§æœ‰ç´¢å¼•åº“.png" alt="ç§æœ‰ç´¢å¼•åº“"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/LXFSpecs.png" alt="LXFSpecs"></p><h2 id="äºŒã€æœ¬åœ°æ·»åŠ ç§æœ‰ç´¢å¼•åº“"><a href="#äºŒã€æœ¬åœ°æ·»åŠ ç§æœ‰ç´¢å¼•åº“" class="headerlink" title="äºŒã€æœ¬åœ°æ·»åŠ ç§æœ‰ç´¢å¼•åº“"></a>äºŒã€æœ¬åœ°æ·»åŠ ç§æœ‰ç´¢å¼•åº“</h2><h3 id="1ã€æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“"><a href="#1ã€æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“" class="headerlink" title="1ã€æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“"></a>1ã€æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“.png" alt="æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“"></p><p>å¦‚å›¾ï¼Œç›®å‰æœ¬åœ°ä»…æœ‰githubä¸Šçš„é‚£ä¸ªå…¬æœ‰ç´¢å¼•åº“</p><h3 id="2ã€æ·»åŠ ç§æœ‰ç´¢å¼•åº“"><a href="#2ã€æ·»åŠ ç§æœ‰ç´¢å¼•åº“" class="headerlink" title="2ã€æ·»åŠ ç§æœ‰ç´¢å¼•åº“"></a>2ã€æ·»åŠ ç§æœ‰ç´¢å¼•åº“</h3><p>å°†æˆ‘ä»¬åˆšåˆšæ–°å»ºçš„ç§æœ‰ç´¢å¼•åº“LXFSpecsæ·»åŠ åˆ°æœ¬åœ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// pod repo add ç´¢å¼•åº“åç§° ç´¢å¼•åº“åœ°å€</span><br><span class="line">pod repo add LXFSpecs https://gitee.com/LinXunFeng/LXFSpecs.git</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æ·»åŠ ç§æœ‰ç´¢å¼•åº“.png" alt=""></p><p>ç°åœ¨æœ¬åœ°å°±æœ‰ä¸¤ä¸ªç´¢å¼•åº“ï¼Œå¥½ï¼Œç´¢å¼•åº“çš„äº‹æƒ…å°±å…ˆæ”¾ä¸€è¾¹å»äº†ï½</p><h2 id="ä¸‰ã€åˆ›å»ºç»„ä»¶åº“"><a href="#ä¸‰ã€åˆ›å»ºç»„ä»¶åº“" class="headerlink" title="ä¸‰ã€åˆ›å»ºç»„ä»¶åº“"></a>ä¸‰ã€åˆ›å»ºç»„ä»¶åº“</h2><p>ç äº‘ä¸Šçš„åˆ›å»ºæ“ä½œåŒä¸Šï¼Œè¿™é‡Œä»¥LXFBaseä¸ºä¾‹ï¼Œåˆ›å»ºåŸºç¡€ç»„ä»¶åº“<br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/LXFBase.png" alt="LXFBase"></p><h3 id="1ã€å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“"><a href="#1ã€å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“" class="headerlink" title="1ã€å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“"></a>1ã€å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“</h3><p>åˆ°åˆé€‚çš„ä½ç½®åˆ›å»ºä¸€ä¸ªä¸ç»„ä»¶åç›¸åŒçš„æ–‡ä»¶å¤¹ï¼Œcdè¿›å»åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// pod lib create ç»„ä»¶å</span><br><span class="line">pod lib create LXFBase</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“.png" alt=""></p><p>è¿™é‡Œä¼šè®©ä½ é…ç½®ä¸€äº›ä¿¡æ¯ï¼Œæ ¹æ®è‡ªå·±çš„æƒ…å†µè‡ªè¡Œé…ç½®å³å¯ã€‚</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/å¿«é€Ÿåˆ›å»ºæ¨¡ç‰ˆåº“-é…ç½®.png" alt="é…ç½®"></p><h3 id="2ã€æ·»åŠ ç»„ä»¶å†…å®¹"><a href="#2ã€æ·»åŠ ç»„ä»¶å†…å®¹" class="headerlink" title="2ã€æ·»åŠ ç»„ä»¶å†…å®¹"></a>2ã€æ·»åŠ ç»„ä»¶å†…å®¹</h3><p>åˆ›å»ºå®Œæˆåä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ‰“å¼€ç›¸åº”çš„Exampleé¡¹ç›®ï¼ŒLXFBaseç›®å½•ä¸­ä¼šå‡ºç°å¦‚å›¾è¿™äº›æ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠåŸºç¡€ç»„ä»¶ç›¸å…³çš„ä¸œè¥¿ä¸¢åˆ°Classesæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸”æŠŠ<code>ReplaceMe.m</code>æ–‡ä»¶åˆ é™¤</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ç›®å½•ç»“æ„.png" alt="ç›®å½•ç»“æ„"></p><p>é»˜è®¤Classesæ–‡ä»¶å¤¹ä¸­å­˜æ”¾çš„æ–‡ä»¶å°±æ˜¯pod installæ—¶è¦ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ä¿®æ”¹specæ–‡ä»¶çš„é…ç½®æ¥æ›´æ”¹ä½ç½®</p><h3 id="3ã€å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“"><a href="#3ã€å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“" class="headerlink" title="3ã€å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“"></a>3ã€å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“</h3><p>åœ¨Exampleé¡¹ç›®çš„Podfileæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFBase&apos;, :path =&gt; &apos;../&apos;</span><br></pre></td></tr></table></figure></p><p>æ¨¡æ¿åº“å·²ç»é»˜è®¤å¸®æˆ‘ä»¬åœ¨Podfileä¸­æŒ‡å®šäº†LXFBase.podspecçš„ä½ç½®ï¼Œä½¿ç»„ä»¶LXFBaseå¯ä»¥æ­£å¸¸å®‰è£…ä½¿ç”¨å’Œæ–¹ä¾¿æµ‹è¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“-podinstall.png" alt="pod install"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/å®‰è£…ä¸æµ‹è¯•æœ¬åœ°åº“-pod.png" alt="pod"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»å°†æœ¬åœ°çš„ç»„ä»¶æ·»åŠ è¿›Exampleä¸­äº†ï¼Œç°åœ¨å¯ä»¥å°½æƒ…åœ°åšä½ æƒ³åšçš„æµ‹è¯•ï¼Œç¡®ä¿ç»„ä»¶çš„å¯ç”¨ã€‚</p><p>æµ‹è¯•ç»„ä»¶æ²¡æœ‰é—®é¢˜åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦å°†podspecæ–‡ä»¶ä¸Šä¼ è‡³ç§æœ‰ç´¢å¼•åº“ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦å¯¹specè¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="4ã€-ä¿®æ”¹Spec"><a href="#4ã€-ä¿®æ”¹Spec" class="headerlink" title="4ã€ ä¿®æ”¹Spec"></a>4ã€ ä¿®æ”¹Spec</h3><p>å…·ä½“çš„é…ç½®è¯´æ˜å¯ä»¥å‚è€ƒ<a href="https://juejin.im/post/5ac446b8f265da238d50ecfa" target="_blank" rel="noopener">Cocoapods åˆ›å»ºç¬¬ä¸‰æ–¹æ¡†æ¶</a></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä¿®æ”¹Spec-podspec.png" alt="podspec"></p><p>ä¸»è¦çš„ä¿®æ”¹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  s.name             = &apos;LXFBase&apos;</span><br><span class="line">  s.version          = &apos;0.1.0&apos;</span><br><span class="line">  s.summary          = &apos;LXFBase.&apos;</span><br><span class="line">  s.description      = &lt;&lt;-DESC</span><br><span class="line">LXFBaseæ˜¯åŸºç¡€ç»„ä»¶åº“ï¼ŒåŒ…æ‹¬åˆ†ç±»å’Œå¸¸ç”¨å·¥å…·</span><br><span class="line">                       DESC</span><br><span class="line">  s.homepage         = &apos;https://gitee.com/LinXunFeng/LXFBase&apos;</span><br><span class="line">  s.source           = &#123; :git =&gt; &apos;https://gitee.com/LinXunFeng/LXFBase.git&apos;, :tag =&gt; s.version.to_s &#125;</span><br><span class="line">  s.source_files = &apos;LXFBase/Classes/**/*&apos;</span><br></pre></td></tr></table></figure><h2 id="å››ã€ä¸Šä¼ ç»„ä»¶ä»£ç "><a href="#å››ã€ä¸Šä¼ ç»„ä»¶ä»£ç " class="headerlink" title="å››ã€ä¸Šä¼ ç»„ä»¶ä»£ç "></a>å››ã€ä¸Šä¼ ç»„ä»¶ä»£ç </h2><h3 id="1ã€å°†ä»£ç æäº¤åˆ°ç»„ä»¶ä»“åº“"><a href="#1ã€å°†ä»£ç æäº¤åˆ°ç»„ä»¶ä»“åº“" class="headerlink" title="1ã€å°†ä»£ç æäº¤åˆ°ç»„ä»¶ä»“åº“"></a>1ã€å°†ä»£ç æäº¤åˆ°ç»„ä»¶ä»“åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &apos;firstCommit&apos;</span><br><span class="line">git remote add origin https://gitee.com/LinXunFeng/LXFBase.git</span><br><span class="line">// ç¬¬ä¸€æ¬¡pushå¦‚æœæŠ¥é”™çš„è¯å¯ä»¥åŠ ä¸Š-f</span><br><span class="line">// git push -f origin master</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h3 id="2ã€æ‰“æ ‡ç­¾"><a href="#2ã€æ‰“æ ‡ç­¾" class="headerlink" title="2ã€æ‰“æ ‡ç­¾"></a>2ã€æ‰“æ ‡ç­¾</h3><p>æ ‡ç­¾<code>0.1.0</code>ä¸specä¸­çš„<code>s.version</code>ä¿æŒä¸€è‡´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag &apos;0.1.0&apos;</span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä¸Šä¼ ç»„ä»¶ä»£ç -tag.png" alt="tag"></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä¸Šä¼ ç»„ä»¶ä»£ç -æ ‡ç­¾ä¸Šä¼ æˆåŠŸ.png" alt="æ ‡ç­¾ä¸Šä¼ æˆåŠŸ"></p><h2 id="äº”ã€æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“"><a href="#äº”ã€æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“" class="headerlink" title="äº”ã€æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“"></a>äº”ã€æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“</h2><p>åœ¨ä¸Šä¼ specæ–‡ä»¶å‰æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªéªŒè¯æ¥èŠ‚çœæ—¶é—´ï¼Œä¸ç„¶æ¯æ¬¡éƒ½æ¨é€å¾ˆä¹…ç»“æœè¿˜æ˜¯éªŒè¯å¤±è´¥ï¼Œä¼šæ°”æ­»äººçš„ï½</p><h3 id="1ã€æœ¬åœ°éªŒè¯Specçš„å¿…å¡«å­—æ®µ"><a href="#1ã€æœ¬åœ°éªŒè¯Specçš„å¿…å¡«å­—æ®µ" class="headerlink" title="1ã€æœ¬åœ°éªŒè¯Specçš„å¿…å¡«å­—æ®µ"></a>1ã€æœ¬åœ°éªŒè¯Specçš„å¿…å¡«å­—æ®µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// æœ¬åœ°éªŒè¯ä¸ä¼šéªŒè¯ s.source ä¸­çš„tag</span><br><span class="line">pod lib lint</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-podLibLint.png" alt="pod lib lint"></p><h3 id="2ã€è¿œç¨‹éªŒè¯"><a href="#2ã€è¿œç¨‹éªŒè¯" class="headerlink" title="2ã€è¿œç¨‹éªŒè¯"></a>2ã€è¿œç¨‹éªŒè¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// è¿œç¨‹éªŒè¯ä¼šéªŒè¯ s.source ä¸­çš„tagï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰æ‰“ä¸Šç›¸åº”çš„æ ‡ç­¾åˆ™ä¼šæŠ¥é”™</span><br><span class="line">pod spec lint</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åˆšæ‰æ²¡æœ‰æ‰“æ ‡ç­¾å¹¶ä¸Šä¼ è‡³è¿œç¨‹ç§æœ‰åº“å°±æ¥è¿›è¡Œè¿œç¨‹éªŒè¯ï¼Œè‚¯å®šæ˜¯ä¼šæŠ¥é”™çš„</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-tagError.png" alt="tag Error"></p><p>åœ¨æ‰“å®Œå¹¶ä¸Šä¼ tagåå†è¿›è¡Œè¿œç¨‹éªŒè¯ï¼Œå°±ä¼šéªŒè¯æˆåŠŸäº†ï¼ŒéªŒè¯æˆåŠŸåæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼šæäº¤podspecæ–‡ä»¶åˆ°ç´¢å¼•åº“</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-podSpecLint.png" alt="pod spec lint"></p><ul><li>éªŒè¯ç§æœ‰åº“æç¤º<br>å¦‚æœéªŒè¯çš„æ˜¯ç§æœ‰åº“ï¼Œåˆ™åœ¨åé¢åŠ ä¸Š<code>--private</code>,å¦åˆ™ä¼šæœ‰è­¦å‘Šï¼Œä½ å¯ä»¥é€‰æ‹©<code>--allow-warnings</code>æ¥å¿½ç•¥è¯¥è­¦å‘Š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod lib lint --private</span><br><span class="line">pod spec lint --private</span><br></pre></td></tr></table></figure></li></ul><h3 id="3ã€æäº¤podspec"><a href="#3ã€æäº¤podspec" class="headerlink" title="3ã€æäº¤podspec"></a>3ã€æäº¤podspec</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// pod repo push ç§æœ‰ç´¢å¼•åº“åç§° specåç§°.podspec </span><br><span class="line">pod repo push LXFSpecs LXFBase.podspec</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ“ä½œè¿‡ç¨‹ï¼šå…ˆå°†æˆ‘ä»¬çš„ä»£ç ç›´æ¥pushåˆ°æœ¬åœ°ç´¢å¼•åº“LXFSpecsï¼Œæ¨é€åä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åŒæ­¥åˆ°è¿œç¨‹ç´¢å¼•åº“</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-æäº¤æˆåŠŸ.png" alt="æäº¤æˆåŠŸ"></p><p>å†æ¥çœ‹çœ‹ç äº‘ä¸Šçš„ç§æœ‰ç´¢å¼•åº“LXFSpecs</p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-LXFBase.podspec.png" alt="LXFBase.podspec"></p><p>æ¥æµ‹è¯•ä¸‹æœç´¢æˆ‘ä»¬çš„ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod search &apos;LXFBase&apos;</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/æäº¤podspecåˆ°ç§æœ‰ç´¢å¼•åº“-æœç´¢æˆåŠŸ.png" alt="æœç´¢æˆåŠŸ"></p><h2 id="å…­ã€ä½¿ç”¨ç§æœ‰åº“"><a href="#å…­ã€ä½¿ç”¨ç§æœ‰åº“" class="headerlink" title="å…­ã€ä½¿ç”¨ç§æœ‰åº“"></a>å…­ã€ä½¿ç”¨ç§æœ‰åº“</h2><p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¥è¯•è¯•é€šè¿‡podå½¢å¼æ¥æ·»åŠ ç»„ä»¶LXFBaseï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p><h3 id="1ã€æ·»åŠ Podfileæ–‡ä»¶"><a href="#1ã€æ·»åŠ Podfileæ–‡ä»¶" class="headerlink" title="1ã€æ·»åŠ Podfileæ–‡ä»¶"></a>1ã€æ·»åŠ Podfileæ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod init</span><br></pre></td></tr></table></figure><h3 id="2ã€åœ¨Podfileçš„æœ€é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹æè¿°"><a href="#2ã€åœ¨Podfileçš„æœ€é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹æè¿°" class="headerlink" title="2ã€åœ¨Podfileçš„æœ€é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹æè¿°"></a>2ã€åœ¨Podfileçš„æœ€é¡¶éƒ¨æ·»åŠ å¦‚ä¸‹æè¿°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ç¬¬äºŒè¡Œæ˜¯ä¸ºäº†ä¿è¯å…¬æœ‰åº“çš„æ­£å¸¸ä½¿ç”¨</span><br><span class="line">source &apos;https://gitee.com/LinXunFeng/LXFSpecs.git&apos;</span><br><span class="line">source &apos;https://github.com/CocoaPods/Specs.git&apos;</span><br></pre></td></tr></table></figure><h3 id="3ã€æ·»åŠ ä½¿ç”¨ç»„ä»¶LXFBase"><a href="#3ã€æ·»åŠ ä½¿ç”¨ç»„ä»¶LXFBase" class="headerlink" title="3ã€æ·»åŠ ä½¿ç”¨ç»„ä»¶LXFBase"></a>3ã€æ·»åŠ ä½¿ç”¨ç»„ä»¶LXFBase</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &apos;LXFBase&apos;</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä½¿ç”¨ç§æœ‰åº“-LXFBase.png" alt=""></p><h3 id="4ã€å®‰è£…ç»„ä»¶"><a href="#4ã€å®‰è£…ç»„ä»¶" class="headerlink" title="4ã€å®‰è£…ç»„ä»¶"></a>4ã€å®‰è£…ç»„ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod install</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä½¿ç”¨ç§æœ‰åº“-å®‰è£…æˆåŠŸ.png" alt="å®‰è£…æˆåŠŸ"><br><img src="/images/2018/04/iOS ç»„ä»¶åŒ–å¼€å‘ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç§æœ‰åº“çš„åŸºæœ¬ä½¿ç”¨/ä½¿ç”¨ç§æœ‰åº“-æˆåŠŸæ·»åŠ ç»„ä»¶å†…å®¹.png" alt="æˆåŠŸæ·»åŠ ç»„ä»¶å†…å®¹"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
            <tag> Cocoapods </tag>
            
            <tag> ç»„ä»¶åŒ– </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Cocoapods åˆ›å»ºç¬¬ä¸‰æ–¹æ¡†æ¶</title>
      <link href="/2018/04/06/Cocoapods-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"/>
      <url>/2018/04/06/Cocoapods-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/</url>
      <content type="html"><![CDATA[<p><excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""><br>å°†æ¡†æ¶ä¸­çš„ä¸»è¦æ–‡ä»¶æ”¾å…¥åˆ°ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶å¤¹ä¸­ï¼Œæ¯”å¦‚å«Classesæˆ–è€…Libéƒ½å¯ä»¥</excerpt></p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="ä¸€ã€ä¸Šä¼ é¡¹ç›®åˆ°github"><a href="#ä¸€ã€ä¸Šä¼ é¡¹ç›®åˆ°github" class="headerlink" title="ä¸€ã€ä¸Šä¼ é¡¹ç›®åˆ°github"></a>ä¸€ã€ä¸Šä¼ é¡¹ç›®åˆ°github</h2><p>å°†æ¡†æ¶ä¸­çš„ä¸»è¦æ–‡ä»¶æ”¾å…¥åˆ°ä¸€ä¸ªæŒ‡å®šæ–‡ä»¶å¤¹ä¸­ï¼Œæ¯”å¦‚å«Classesæˆ–è€…Libéƒ½å¯ä»¥<br><img src="/images/2018/04/Cocoapods åˆ›å»ºç¬¬ä¸‰æ–¹æ¡†æ¶/ç›®å½•ç»“æ„.png" alt="ç›®å½•ç»“æ„"></p><ul><li>æ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°æ¡†æ¶ç›®å½• </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/lxf/xxxx/LXFPhotoHelper</span><br></pre></td></tr></table></figure><ul><li>åˆå§‹åŒ–ä»“åº“</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><ul><li>å°†å½“å‰ç›®å½•æ·»åŠ åˆ°ç¼“å­˜åŒº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure><ul><li>æäº¤åˆ°æœ¬åœ°ä»“åº“</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &apos;æè¿°&apos;</span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/LinXunFeng/xxx.git</span><br></pre></td></tr></table></figure><ul><li>æäº¤åˆ°è¿œç¨‹ä»“åº“</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°å¦‚ä¸‹æç¤º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access &apos;https://github.com/xxx/xxx.git/&apos;: The requested URL returned error: 403</span><br></pre></td></tr></table></figure></p><p>åŸå› æ˜¯æœ¬åœ°ç¼“å­˜äº†ç”¨æˆ·åå’Œå¯†ç <br>ç¼–è¾‘.gitç›®å½•ä¸‹çš„configæ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi .git/config</span><br></pre></td></tr></table></figure></p><p>æ‰¾åˆ°urlé‚£ä¸€è¡Œï¼Œåœ¨github.comå‰åŠ ä¸Šç”¨æˆ·ååä¿å­˜ï¼Œå†é‡æ–°æ‰§è¡Œæ¨é€æ“ä½œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = https://LinXunFeng@github.com/LinXunFeng/xxx.git</span><br></pre></td></tr></table></figure></p><ul><li>æ‰“æ ‡ç­¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// å…·ä½“è¯´æ˜å¯ä»¥æ‰§è¡Œ`git tag --help`åæŸ¥çœ‹</span><br><span class="line">// git tag -a &apos;ç‰ˆæœ¬å·&apos; -m &apos;tagæè¿°&apos;</span><br><span class="line">// æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œæ‰“çš„æ ‡ç­¾åªæ˜¯åœ¨æœ¬åœ°</span><br><span class="line">git tag &apos;0.0.1&apos;</span><br></pre></td></tr></table></figure><ul><li>æ¨ç€æ‰€æœ‰æ ‡ç­¾è‡³è¿œç¨‹ä»“åº“</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åªæ¨ç€æŒ‡å®šç‰ˆæœ¬</span><br><span class="line">// git push origin ç‰ˆæœ¬å· </span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure><h2 id="äºŒã€åˆ›å»ºå¹¶ä¿®æ”¹podspecæ–‡ä»¶"><a href="#äºŒã€åˆ›å»ºå¹¶ä¿®æ”¹podspecæ–‡ä»¶" class="headerlink" title="äºŒã€åˆ›å»ºå¹¶ä¿®æ”¹podspecæ–‡ä»¶"></a>äºŒã€åˆ›å»ºå¹¶ä¿®æ”¹podspecæ–‡ä»¶</h2><ul><li>åˆ›å»ºSpecæ–‡ä»¶<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// åç§°ä¸€èˆ¬ä¸å·¥ç¨‹åç§°ä¿æŒä¸€è‡´</span><br><span class="line">pod spec create æ¡†æ¶åç§°</span><br></pre></td></tr></table></figure></li></ul><p><img src="/images/2018/04/Cocoapods åˆ›å»ºç¬¬ä¸‰æ–¹æ¡†æ¶/podspecæ–‡ä»¶.png" alt="podspecæ–‡ä»¶"></p><ul><li>ä¿®æ”¹Specæ–‡ä»¶<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">s.name         = &quot;LXFPhotoHelperï¼ˆä»“åº“åç§°ï¼‰&quot;</span><br><span class="line">s.version      = &quot;0.0.1ï¼ˆç‰ˆæœ¬å·ï¼Œè¿™é‡Œè·Ÿä¸‹é¢s.sourceä¸­çš„tagæœ‰å…³ï¼‰&quot;</span><br><span class="line">s.summary      = &quot;å¯¹ä½ è‡ªå·±ä»“åº“çš„ç®€å•æè¿°ï¼Œä¸è¦å†™å¤ªå¤šå­—&quot;</span><br><span class="line">s.description  = &quot;è¿™ä¸ªæ˜¯è¯¦ç»†æè¿°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ–‡å­—çš„é•¿åº¦éœ€è¦æ¯”  </span><br><span class="line">s.summaryçš„è¦é•¿ï¼Œä¸ç„¶ä¼šå‡ºç°è­¦å‘Š&quot;</span><br><span class="line">s.homepage     = &quot;ä»“åº“é¦–é¡µåœ°å€ï¼Œå¦‚https://github.com/LinXunFeng/LXFPhotoHelper&quot;</span><br><span class="line">s.license      = &quot;MIT&quot;</span><br><span class="line">s.author       = &#123; &quot;LinXunFeng&quot; =&gt; &quot;598600855@qq.com&quot; &#125;</span><br><span class="line"># sourceå­˜æ”¾çš„åœ°å€æ˜¯ä»£ç çš„çœŸæ­£åœ°å€</span><br><span class="line">s.source       = &#123; :git =&gt; &quot;ä»“åº“å¯¹åº”çš„gitåœ°å€ï¼Œå¦‚https://github.com/LinXunFeng/LXFPhotoHelper.git&quot;, :tag =&gt; &quot;#&#123;s.version&#125;&quot; &#125;</span><br><span class="line"># pod installæ—¶çœŸæ­£ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡ŒæŒ‡å®šçš„æ˜¯ä½ ä»“åº“ä¸‹çš„Classesç›®å½•ä¸­çš„æ‰€æœ‰.hå’Œ.mæ–‡ä»¶ï¼ˆå¡«å†™çš„æ˜¯ç›¸å¯¹åœ°å€ï¼‰</span><br><span class="line"># ** é€šé…ç›®å½•</span><br><span class="line">s.source_files  = &quot;Classes&quot;, &quot;Classes/**/*.&#123;h,m&#125;&quot;</span><br><span class="line"></span><br><span class="line"># s.library = &quot;sqlite3&quot; # æ¡†æ¶ä¾èµ–ç³»ç»Ÿçš„sqlite3</span><br></pre></td></tr></table></figure></li></ul><p>ä¹Ÿå¯ä»¥ä¸Šå®˜ç½‘çš„æ‰‹å†Œã€<a href="https://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="noopener">Podspec Syntax Reference</a>ã€‘ä¸ŠæŸ¥çœ‹</p><p>è¿™é‡Œéœ€è¦æˆ‘ä»¬æ³¨æ„çš„æ˜¯<code>s.version= &quot;0.0.1&quot;</code>ï¼Œè¿™é‡Œçš„ç‰ˆæœ¬å·è¦ä¸åˆšåˆšæ‰“çš„tagä¸€è‡´</p><h2 id="ä¸‰ã€æ³¨å†Œtrunk"><a href="#ä¸‰ã€æ³¨å†Œtrunk" class="headerlink" title="ä¸‰ã€æ³¨å†Œtrunk"></a>ä¸‰ã€æ³¨å†Œtrunk</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// --verbose æ‰“å°è¯¦æƒ…ä¿¡æ¯</span><br><span class="line">// pod trunk register é‚®ç®± &apos;ä½ çš„åç§°&apos; --verbose</span><br><span class="line">pod trunk register 598600855@qq.com &apos;LinXunFeng&apos; --verbose</span><br></pre></td></tr></table></figure><p>ç„¶åå»éªŒè¯é‚®ç®±<br><img src="/images/2018/04/Cocoapods åˆ›å»ºç¬¬ä¸‰æ–¹æ¡†æ¶/éªŒè¯æˆåŠŸ.png" alt="éªŒè¯æˆåŠŸ"><br>éªŒè¯æˆåŠŸåä¼šæç¤ºæˆ‘ä»¬å›åˆ°ç»ˆç«¯ï¼Œå¹¶æ•²å…¥<code>pod trunk push åç§°.podspec</code></p><h2 id="å››ã€ä¸Šä¼ Spec"><a href="#å››ã€ä¸Šä¼ Spec" class="headerlink" title="å››ã€ä¸Šä¼ Spec"></a>å››ã€ä¸Šä¼ Spec</h2><p>æ‰§è¡Œ<code>pod trunk push</code>åä¼šæœ‰ä¸€ä¸ªå®¡æ ¸çš„è¿‡ç¨‹ï¼Œå¦‚æœæç¤ºæ²¡æœ‰é€šè¿‡ï¼Œæœ‰ERRORå°±ä¿®æ”¹å¥½åé‡æ–°pushï¼Œå¦‚æœåªæ˜¯WARNå¯ä»¥é€‰æ‹©åœ¨<code>pod trunk push</code>åé¢åŠ ä¸Š<code>--allow-warnings</code>æ¥å¿½ç•¥å®ƒä»¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push LXFPhotoHelper.podspec --allow-warnings</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œåˆ™è¯´æ˜ä½ çš„æ¡†æ¶åå­—å·²è¢«å ç”¨ï¼Œå¾—é‡æ–°æ”¹ä¸ªåå­—ï½<br>æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºä½ è‡ªå·±çš„cocoapodsä»“åº“æ—¶æœ€å¥½æ˜¯åˆ°<a href="https://cocoapods.org/" target="_blank" rel="noopener">cocoapods.org</a>ä¸Šå…ˆæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰ç›¸åŒåå­—çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!] You (xxx@qq.com) are not allowed to push new versions for this pod. The owners of this pod are yyy@qq.com.</span><br></pre></td></tr></table></figure></p><p>ä¸Šä¼ æˆåŠŸåä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ›´æ–°æœ¬åœ°ä»“åº“ï¼Œå¦‚æœæ— æ³•æœç´¢åˆ°è‡ªå·±çš„æ¡†æ¶ï¼Œå¯ä»¥å…ˆåˆ æ‰æœ¬åœ°çš„ç´¢å¼•æ–‡ä»¶åå†æœç´¢ä¸€æ¬¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm ~/Library/Caches/CocoaPods/search_index.json</span><br></pre></td></tr></table></figure></p><p>å½“ä½¿ç”¨pod search å‘½ä»¤å¯ä»¥æœç´¢è‡ªå·±çš„æ¡†æ¶æ—¶, é‚£ä¹ˆå°±æ„å‘³ç€å®¡æ ¸é€šè¿‡äº†</p></the>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
            <tag> Cocoapods </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python - è™šæ‹Ÿç¯å¢ƒ</title>
      <link href="/2018/04/02/Python-%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/"/>
      <url>/2018/04/02/Python-%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>å¹³æ—¶åœ¨å¼€å‘æ—¶æˆ‘ä»¬éƒ½ä¼šå…ˆå®‰è£…ä¸€äº›pythonéœ€è¦çš„åŒ…ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦‚æœä¸åŒé¡¹ç›®éœ€è¦ä¸åŒç‰ˆæœ¬çš„åŒ…æ—¶å°±ä¼šå‡ºç°ä¸å…¼å®¹çš„æƒ…å†µã€‚åº”å¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥æ­å»ºå¤šä¸ªè™šæ‹Ÿç¯å¢ƒæ¥åº”å¯¹ä¸åŒçš„ç¯å¢ƒéœ€æ±‚ï¼Œåœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ­å»ºä¸€ä¸ªPythoné¡¹ç›®è¿è¡Œæ‰€éœ€è¦çš„é‚£äº›åŒ…ï¼Œå°†æ¥æ ¹æ®è¿è¡Œçš„é¡¹ç›®æ¥åˆ‡æ¢ä¸åŒç¯å¢ƒå³å¯</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>å¹³æ—¶åœ¨å¼€å‘æ—¶æˆ‘ä»¬éƒ½ä¼šå…ˆå®‰è£…ä¸€äº›pythonéœ€è¦çš„åŒ…ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦‚æœä¸åŒé¡¹ç›®éœ€è¦ä¸åŒç‰ˆæœ¬çš„åŒ…æ—¶å°±ä¼šå‡ºç°ä¸å…¼å®¹çš„æƒ…å†µã€‚åº”å¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥æ­å»ºå¤šä¸ªè™šæ‹Ÿç¯å¢ƒæ¥åº”å¯¹ä¸åŒçš„ç¯å¢ƒéœ€æ±‚ï¼Œåœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ­å»ºä¸€ä¸ªPythoné¡¹ç›®è¿è¡Œæ‰€éœ€è¦çš„é‚£äº›åŒ…ï¼Œå°†æ¥æ ¹æ®è¿è¡Œçš„é¡¹ç›®æ¥åˆ‡æ¢ä¸åŒç¯å¢ƒå³å¯</p></blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨å½“å‰ç”¨æˆ·çš„å®¶ç›®å½•ä¸­æ‰¾åˆ°ã€.virtualenvsã€‘æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹å½“å‰æ‰€æœ‰çš„è™šæ‹Ÿç¯å¢ƒ</p><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/virtualenvs.png" alt="virtualenvs"></p><h2 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h2><ul><li>åˆ›å»ºï¼šmkvirtualenv [è™šæ‹Ÿç¯å¢ƒåç§°]</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv lxfenv1</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/mkvirtualenv.png" alt="å®‰è£…æˆåŠŸ"></p><p>æ³¨ï¼šåˆ›å»ºçš„è¿‡ç¨‹éœ€è¦è”ç½‘</p><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/ç›®å½•ç»“æ„.png" alt="ç›®å½•ç»“æ„"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Installing setuptools, pkg_resources, pip, wheel...done.</span><br></pre></td></tr></table></figure><p>åˆšåˆšå®‰è£…æ—¶æç¤ºå®‰è£…çš„è¿™äº›ä¸œè¥¿å°±å­˜æ”¾åœ¨ä½ åˆ›å»ºå¥½çš„è™šæ‹Ÿç¯å¢ƒä¸‹çš„ã€lib/python2.7/site-packages/ã€‘ç›®å½•ä¸­</p><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/libç›®å½•.png" alt="libç›®å½•"></p><ul><li>é€€å‡ºï¼šdeactivate<br>å½“æˆ‘ä»¬å®‰è£…å¥½è™šæ‹Ÿç¯å¢ƒåé»˜è®¤å°±ä½¿ç”¨äº†è¯¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚å›¾æ ‡è¯†å¤„å¯ä»¥çœ‹å‡º</li></ul><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/å½“å‰ç¯å¢ƒ.png" alt="å½“å‰ç¯å¢ƒ"></p><p>å¦‚æœä½ æƒ³é€€å‡ºå½“å‰çš„è™šæ‹Ÿç¯å¢ƒï¼Œæˆ–ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/é€€å‡ºç¯å¢ƒ.png" alt="é€€å‡ºç¯å¢ƒ"></p><ul><li>è¿›å…¥ï¼šworkon [è™šæ‹Ÿç¯å¢ƒåç§°]</li></ul><p>ä½¿ç”¨æŒ‡å®šçš„è™šæ‹Ÿç¯å¢ƒåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workon lxfenv1</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/workon.png" alt="workon"></p><ul><li>åˆ é™¤ï¼šrmvirtualenv [è™šæ‹Ÿç¯å¢ƒåç§°]</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmvirtualenv lxfenv1</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…æ‹“å±•åŒ…"><a href="#å®‰è£…æ‹“å±•åŒ…" class="headerlink" title="å®‰è£…æ‹“å±•åŒ…"></a>å®‰è£…æ‹“å±•åŒ…</h2><ul><li>æŸ¥çœ‹å½“å‰å®‰è£…å¥½çš„åŒ…</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br><span class="line">æˆ–è€…</span><br><span class="line">pip freeze</span><br></pre></td></tr></table></figure><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/æŸ¥çœ‹å½“å‰å®‰è£…å¥½çš„åŒ….png" alt="æŸ¥çœ‹å½“å‰å®‰è£…å¥½çš„åŒ…"></p><p>ps: ä¸Šå›¾<code>pip list</code>ä¸­åˆ—å‡ºçš„å››ä¸ªåŒ…æ˜¯å®‰è£…è™šæ‹Ÿç¯å¢ƒå¿…å®šä¼šå®‰è£…çš„åŒ…<br>å¦‚å›¾ï¼Œ<code>pip list</code>ä¼šåˆ—å‡ºæ‰€æœ‰çš„åŒ…ï¼Œè€Œ<code>pip freeze</code>åªä¼šåˆ—å‡ºæ‰©å±•çš„åŒ…</p><ul><li>å®‰è£…æŒ‡å®šåŒ…<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install django==1.8.2</span><br><span class="line"># ==1.8.2 ä¸ºæŒ‡å®šç‰ˆæœ¬å·ï¼Œä¸å†™åˆ™ç›´æ¥å®‰è£…æœ€æ–°çš„åŒ…</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ³¨ï¼š pip install xxx ä¼šè‡ªåŠ¨åˆ é™¤æ—§ç‰ˆæœ¬ï¼Œå†å®‰è£…æ–°ç‰ˆæœ¬</strong></p><p>å¦‚æœä¸çŸ¥é“åŒ…åå¯ä»¥åˆ°<a href="https://pypi.python.org" target="_blank" rel="noopener">pypi</a>ä¸Šæœç´¢</p><p><img src="/images/2018/04/Python - è™šæ‹Ÿç¯å¢ƒ/å®‰è£…æŒ‡å®šçš„åŒ….png" alt="å®‰è£…æŒ‡å®šçš„åŒ…"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>RxSwift + MJRefresh æ‰“é€ è‡ªåŠ¨å¤„ç†åˆ·æ–°æ§ä»¶çŠ¶æ€</title>
      <link href="/2017/10/24/RxSwift-MJRefresh-%E6%89%93%E9%80%A0%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86%E5%88%B7%E6%96%B0%E6%8E%A7%E4%BB%B6%E7%8A%B6%E6%80%81/"/>
      <url>/2017/10/24/RxSwift-MJRefresh-%E6%89%93%E9%80%A0%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86%E5%88%B7%E6%96%B0%E6%8E%A7%E4%BB%B6%E7%8A%B6%E6%80%81/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>MVVMçš„æ¨¡å¼ä¸­ï¼Œå¤šå‡ºäº†ViewModelè¿™ä¸ªè§’è‰²ï¼Œå°†é€»è¾‘å¤„ç†ã€ç½‘ç»œè¯·æ±‚ç­‰ç¹æ‚æ“ä½œä¸­ViewControllerä¸­æŠ½ç¦»å‡ºæ¥ï¼ŒViewControllerå¾—ä»¥ç˜¦èº«ã€‚<br>ç»“åˆRxSwiftæ¶æ„ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°±ä¼šåœ¨ViewModelä¸­å®šä¹‰ä¸€ä¸ªinputæ”¶é›†ç¹æ‚æ“ä½œæ‰€éœ€çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¸€ä¸ªtransformæ–¹æ³•å°†inputä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿›è€Œå¾—åˆ°ä¸€ä¸ªoutputä¾›controllerä½¿ç”¨ã€‚</p><p>åœ¨ä½¿ç”¨RxSwiftå¼€å‘æ—¶ä¼šå¤§é‡çš„ä½¿ç”¨åˆ°è¿™ç§å½¢å¼ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬çš„ç½‘ç»œè¯·æ±‚ã€‚</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>æœ¬æ–‡æ˜¯åŸºäº <a href="http://linxunfeng.top/2017/09/12/iOS-RxSwift-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/">iOS - RxSwift é¡¹ç›®å®æˆ˜è®°å½•</a> æ‰€è¿°ï¼Œå¦‚æœä½ è¿˜æœªé˜…è¯»è¿‡ï¼Œå»ºè®®ä½ æœ€å¥½è¿˜å…ˆé˜…è¯»ä¸€éï¼Œå¹¶ä¸‹è½½Demoç†Ÿæ‚‰ä¸€ä¸‹ : )</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>MVVMçš„æ¨¡å¼ä¸­ï¼Œå¤šå‡ºäº†ViewModelè¿™ä¸ªè§’è‰²ï¼Œå°†é€»è¾‘å¤„ç†ã€ç½‘ç»œè¯·æ±‚ç­‰ç¹æ‚æ“ä½œä¸­ViewControllerä¸­æŠ½ç¦»å‡ºæ¥ï¼ŒViewControllerå¾—ä»¥ç˜¦èº«ã€‚<br>ç»“åˆRxSwiftæ¶æ„ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°±ä¼šåœ¨ViewModelä¸­å®šä¹‰ä¸€ä¸ªinputæ”¶é›†ç¹æ‚æ“ä½œæ‰€éœ€çš„ä¿¡æ¯ï¼Œé€šè¿‡ä¸€ä¸ªtransformæ–¹æ³•å°†inputä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿›è€Œå¾—åˆ°ä¸€ä¸ªoutputä¾›controllerä½¿ç”¨ã€‚</p><p>åœ¨ä½¿ç”¨RxSwiftå¼€å‘æ—¶ä¼šå¤§é‡çš„ä½¿ç”¨åˆ°è¿™ç§å½¢å¼ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬çš„ç½‘ç»œè¯·æ±‚ã€‚<br>ç»“åˆ <a href="http://linxunfeng.top/2017/09/12/iOS-RxSwift-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/">iOS - RxSwift é¡¹ç›®å®æˆ˜è®°å½•</a> ä¸­æ‰€è¿°çš„â€œMJRefreshåœ¨RxSwiftä¸­çš„ä½¿ç”¨â€ï¼Œåœ¨outputä¸­å®šä¹‰äº†ä¸€ä¸ªå˜é‡<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> refreshStatus = <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt;(.<span class="keyword">none</span>)</span><br></pre></td></tr></table></figure></p><p>controlleré€šè¿‡outputå°†å…¶è¿›è¡Œç›‘å¬ï¼Œä»è€Œå½“å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œcontrollerå°±èƒ½å®æ—¶è·å–å½“å‰åº”æ‰€å¤„çš„åˆ·æ–°çŠ¶æ€<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vmOutput.refreshStatus.asObservable().subscribe(onNext: &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] status <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> status &#123;</span><br><span class="line">    <span class="keyword">case</span> .beingHeaderRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_header.beginRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .endHeaderRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_header.endRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .beingFooterRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.beginRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .endFooterRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .noMoreData:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshingWithNoMoreData()</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).addDisposableTo(rx_disposeBag)</span><br></pre></td></tr></table></figure></p><p>å¦‚æœåœ¨ä¸€ä¸ªé¡¹ç›®å¤šå¤„ä½¿ç”¨åˆ°äº†è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¼Šç«¯â€”â€”é‡å¤ä»£ç ï¼Œè¿‡äºå†—ä½™ã€‚</p><p>éš¾é“æˆ‘ä»¬æ¯æ¬¡éƒ½è¦åœ¨controllerä¸­è¿›è¡Œå¦‚æ­¤æ“ä½œå—ï¼Ÿ</p><h2 id="é¢å‘åè®®"><a href="#é¢å‘åè®®" class="headerlink" title="é¢å‘åè®®"></a>é¢å‘åè®®</h2><p>å…³äºåè®®çš„å†…å®¹å¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„è¿™ä¸¤ç¯‡æ–‡ç« <br><a href="http://linxunfeng.top/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a></p><p> <a href="http://linxunfeng.top/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a></p><p>æ€»ç»“åè®®çš„ä¸¤å¤§ä½œç”¨ï¼š1ã€è§„èŒƒ  2ã€å®šåˆ¶èƒ½åŠ›</p><p>å®šä¹‰åè®® Refreshable </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ============================ Refreshable ================================ */</span></span><br><span class="line"><span class="comment">// éœ€è¦ä½¿ç”¨ MJExtension çš„æ§åˆ¶å™¨ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Refreshable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Refreshable</span> <span class="title">where</span> <span class="title">Self</span> : <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">initRefreshHeader</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView, <span class="number">_</span> action: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">MJRefreshHeader</span> &#123;</span><br><span class="line">        scrollView.mj_header = <span class="type">MJRefreshNormalHeader</span>(refreshingBlock: &#123; action() &#125;)</span><br><span class="line">        <span class="keyword">return</span> scrollView.mj_header</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">initRefreshFooter</span><span class="params">(<span class="number">_</span> scrollView: UIScrollView, <span class="number">_</span> action: @escaping <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">MJRefreshFooter</span> &#123;</span><br><span class="line">        scrollView.mj_footer = <span class="type">MJRefreshAutoNormalFooter</span>(refreshingBlock: &#123; action() &#125;)</span><br><span class="line">        <span class="keyword">return</span> scrollView.mj_footer</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨controllerä¸­éµå¾ª Refreshable åè®®ï¼Œé€šè¿‡initRefreshHeaderæ–¹æ³•æˆ–è€…initRefreshFooteræ–¹æ³•ç»™tableViewæˆ–è€…collectionViewèµ‹äºˆå¤´éƒ¨æˆ–å°¾éƒ¨åˆ·æ–°çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¹¦å†™ä¸‹æ‹‰åˆ·æ–°æ—¶éœ€è¦æ‰§è¡Œçš„ä»£ç <br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸‹æ‹‰åˆ·æ–°ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> refreshHeader = initRefreshHeader(liveCollectionView) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// ä¸‹æ‹‰åéœ€è¦æ‰§è¡Œçš„æ“ä½œ </span></span><br><span class="line">    <span class="keyword">self</span>?.vmOutput?.requestCommand.onNext(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥å†è®²è®²outputï¼Œåªè¦æœ‰ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ï¼Œå°±ä¼šéœ€è¦éœ€è¦ç›‘å¬è¯·æ±‚çŠ¶æ€ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ºoutputå®šä¹‰ä¸€ä¸ªåè®®OutputRefreshProtocolï¼Œä¸“é—¨ç”¨æ¥è§„èŒƒå¿…éœ€å£°æ˜çš„å±æ€§<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ============================ OutputRefreshProtocol ================================ */</span></span><br><span class="line"><span class="comment">// viewModel ä¸­ outputä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">OutputRefreshProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‘Šè¯‰å¤–ç•Œçš„tableViewå½“å‰çš„åˆ·æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">var</span> refreshStatus : <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt; &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ç€è®©outputå»éµå¾ªè¯¥åè®®ï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–åˆ·æ–°çŠ¶æ€çš„å€¼ä¸º.none<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct LXFLiveOutput: OutputRefreshProtocol &#123;</span><br><span class="line">    var refreshStatus: Variable&lt;LXFRefreshStatus&gt;</span><br><span class="line">    </span><br><span class="line">    let sections: Driver&lt;[LXFLiveSection]&gt;</span><br><span class="line">    init(sections: Driver&lt;[LXFLiveSection]&gt;) &#123;</span><br><span class="line">        self.sections = sections</span><br><span class="line">        refreshStatus = Variable&lt;LXFRefreshStatus&gt;(.none)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®è·Ÿä¹‹å‰æ²¡å•¥ä¸¤æ ·ï¼Œåªæ˜¯ä½¿controlleræ›´æ–¹ä¾¿åˆå§‹åŒ–åˆ·æ–°æ§ä»¶è€Œå·²ã€‚æ¥ä¸‹æ¥æ‰æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚</p><h2 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="headerlink" title="é‡ç‚¹"></a>é‡ç‚¹</h2><p>åˆ·æ–°çš„çŠ¶æ€æ— éä¹Ÿå°±é‚£ä¹ˆå‡ ç§ï¼Œä¸‹æ‹‰é‡è½½æ•°æ®ï¼Œä¸Šæ‹‰åŠ è½½æ›´å¤šï¼Œè¯·æ±‚å®Œæˆæ—¶ç»“æŸä¸‹æ‹‰æˆ–ä¸Šæ‹‰ç­‰ç­‰ã€‚ã€‚ã€‚é‚£æˆ‘ä»¬ä½•å¿…è¦åœ¨æ¯ä¸ªcontrollerä¸­å†å»ç®¡ç†è¿™ç­‰çäº‹ï¼Ÿï¼Ÿ<br>è€Œè‡³æ­¤ï¼Œåˆ·æ–°æ§ä»¶çš„çŠ¶æ€æ˜¯ç”±å˜é‡ refreshStatus æ¥å†³å®šï¼Œæ­¤æ—¶ refreshStatus åˆå£°æ˜åœ¨ OutputRefreshProtocol åè®®ä¸­ï¼Œæˆ‘ä»¬ä½•ä¸å†å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°†åˆ·æ–°æ§ä»¶çš„çŠ¶æ€äº¤ç»™refreshStatusè‡ªå·±æ¥å¸®æˆ‘ä»¬å¤„ç†å‘¢ï½</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">OutputRefreshProtocol</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">autoSetRefreshHeaderStatus</span><span class="params">(header: MJRefreshHeader?, footer: MJRefreshFooter?)</span></span> -&gt; <span class="type">Disposable</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> refreshStatus.asObservable().subscribe(onNext: &#123; (status) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">switch</span> status &#123;</span><br><span class="line">            <span class="keyword">case</span> .beingHeaderRefresh:</span><br><span class="line">                header?.beginRefreshing()</span><br><span class="line">            <span class="keyword">case</span> .endHeaderRefresh:</span><br><span class="line">                header?.endRefreshing()</span><br><span class="line">            <span class="keyword">case</span> .beingFooterRefresh:</span><br><span class="line">                footer?.beginRefreshing()</span><br><span class="line">            <span class="keyword">case</span> .endFooterRefresh:</span><br><span class="line">                footer?.endRefreshing()</span><br><span class="line">            <span class="keyword">case</span> .noMoreData:</span><br><span class="line">                footer?.endRefreshingWithNoMoreData()</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶éœ€è¦æˆ‘ä»¬å°†åˆ·æ–°æ§ä»¶çš„å¯¹è±¡ header / footer ä¼ å…¥åˆ°æ–¹æ³•ä¸­ï¼Œå®ç°è‡ªåŠ¨æ§åˆ¶åˆ·æ–°æ§ä»¶çŠ¶æ€ã€‚</p><h2 id="æ€»ç»“ä½¿ç”¨"><a href="#æ€»ç»“ä½¿ç”¨" class="headerlink" title="æ€»ç»“ä½¿ç”¨"></a>æ€»ç»“ä½¿ç”¨</h2><p>ä¸€ã€outputä¸­éµå®ˆåè®® OutputRefreshProtocolï¼Œ å¹¶åˆå§‹åŒ– refreshStatus çš„å€¼ä¸º none</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LXFLiveOutput</span>: <span class="title">OutputRefreshProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> refreshStatus: <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> sections: <span class="type">Driver</span>&lt;[<span class="type">LXFLiveSection</span>]&gt;</span><br><span class="line">    <span class="keyword">init</span>(sections: <span class="type">Driver</span>&lt;[<span class="type">LXFLiveSection</span>]&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sections = sections</span><br><span class="line">        refreshStatus = <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt;(.<span class="keyword">none</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒã€controller éµå®ˆåè®® Refreshableï¼Œé€šè¿‡åè®®ä¸­çš„æ–¹æ³•åˆå§‹åŒ–åˆ·æ–°æ§ä»¶åŠå¯¹åº”çš„æ“ä½œï¼Œå¹¶å°†åˆ·æ–°æ§ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥åˆ°è‡ªåŠ¨å¤„ç†çŠ¶æ€æ–¹æ³•ä¸­<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFLiveViewController</span>: <span class="title">Refreshable</span></span></span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> refreshHeader = initRefreshHeader(liveCollectionView) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>?.vmOutput?.requestCommand.onNext(())</span><br><span class="line">&#125;</span><br><span class="line">vmOutput?.autoSetRefreshHeaderStatus(header: refreshHeader, footer: <span class="literal">nil</span>).disposed(by: rx.disposeBag)</span><br></pre></td></tr></table></figure><p>ä¸‰ã€viewModelä¸­æ ¹æ®å®é™…æƒ…å†µå®æ—¶æ›´æ–° refreshStatus çš„åˆ·æ–°çŠ¶æ€</p><p><img src="/images/2017/10/RxSwift-MJExtension-æ‰“é€ è‡ªåŠ¨å¤„ç†åˆ·æ–°æ§ä»¶çŠ¶æ€/1.png" alt="image.png"></p><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>åè®®ï¼š<a href="https://github.com/LinXunFeng/LXFBiliBili/blob/master/LXFBiliBili/LXFBiliBili/Classes/Common/Protocol/Lib/Refreshable.swift" target="_blank" rel="noopener">Refreshable.swift</a><br>ViewModelï¼š<a href="https://github.com/LinXunFeng/LXFBiliBili/blob/master/LXFBiliBili/LXFBiliBili/Classes/Main/Home/Controller/Live/ViewModel/LXFLiveViewModel.swift" target="_blank" rel="noopener">LXFLiveViewModel</a><br>Controllerï¼š<a href="https://github.com/LinXunFeng/LXFBiliBili/blob/master/LXFBiliBili/LXFBiliBili/Classes/Main/Home/Controller/Live/LXFLiveViewController.swift" target="_blank" rel="noopener">LXFLiveViewController</a></p><p><a href="https://github.com/LinXunFeng/LXFBiliBili" target="_blank" rel="noopener">LXFBiliBili</a></p><p><img src="/images/2017/10/RxSwift-MJExtension-æ‰“é€ è‡ªåŠ¨å¤„ç†åˆ·æ–°æ§ä»¶çŠ¶æ€/2.gif" alt="LXFBiliBili"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
            <tag> RxSwift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - è§†é¢‘é‡‡é›†è¯¦è§£</title>
      <link href="/2017/10/16/iOS-%E8%A7%86%E9%A2%91%E9%87%87%E9%9B%86%E8%AF%A6%E8%A7%A3/"/>
      <url>/2017/10/16/iOS-%E8%A7%86%E9%A2%91%E9%87%87%E9%9B%86%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p><a href="https://developer.apple.com/library/content/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/04_MediaCapture.html#//apple_ref/doc/uid/TP40010188-CH5-SW2" target="_blank" rel="noopener">è‹¹æœå®˜æ–¹æ–‡æ¡£-AVFoundation</a></p><p>ä¸ºäº†ç®¡ç†ä»ç›¸æœºæˆ–è€…éº¦å…‹é£ç­‰è¿™æ ·çš„è®¾å¤‡æ•è·åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥å¯¹è±¡(input)å’Œè¾“å‡ºå¯¹è±¡(output)ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªä¼šè¯(AVCaptureSession)æ¥ç®¡ç† input å’Œ output ä¹‹å‰çš„æ•°æ®æµ</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><p><a href="https://developer.apple.com/library/content/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/04_MediaCapture.html#//apple_ref/doc/uid/TP40010188-CH5-SW2" target="_blank" rel="noopener">è‹¹æœå®˜æ–¹æ–‡æ¡£-AVFoundation</a></p><p>ä¸ºäº†ç®¡ç†ä»ç›¸æœºæˆ–è€…éº¦å…‹é£ç­‰è¿™æ ·çš„è®¾å¤‡æ•è·åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥å¯¹è±¡(input)å’Œè¾“å‡ºå¯¹è±¡(output)ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªä¼šè¯(AVCaptureSession)æ¥ç®¡ç† input å’Œ output ä¹‹å‰çš„æ•°æ®æµï¼š</p><table><thead><tr><th>ç±»å</th><th style="text-align:left">ç®€ä»‹</th></tr></thead><tbody><tr><td>AVCaptureDevice</td><td style="text-align:left">è¾“å…¥è®¾å¤‡ï¼Œä¾‹å¦‚ æ‘„åƒå¤´ éº¦å…‹é£</td></tr><tr><td>AVCaptureInput</td><td style="text-align:left">è¾“å…¥ç«¯å£ [ä½¿ç”¨å…¶å­ç±»]</td></tr><tr><td>AVCaptureOutput</td><td style="text-align:left">è®¾å¤‡è¾“å‡º [ä½¿ç”¨å…¶å­ç±»]ï¼Œè¾“å‡ºè§†é¢‘æ–‡ä»¶æˆ–è€…é™æ€å›¾åƒ</td></tr><tr><td>AVCaptureSession</td><td style="text-align:left">ç®¡ç†è¾“å…¥åˆ°è¾“å‡ºçš„æ•°æ®æµ</td></tr><tr><td>AVCaptureVideoPreviewLayer</td><td style="text-align:left">å±•ç¤ºé‡‡é›† é¢„è§ˆView</td></tr></tbody></table><p>å¦‚å›¾ï¼Œé€šè¿‡å•ä¸ª sessionï¼Œä¹Ÿå¯ä»¥ç®¡ç†å¤šä¸ª input å’Œ output å¯¹è±¡ä¹‹é—´çš„æ•°æ®æµï¼Œä»è€Œå¾—åˆ°è§†é¢‘ã€é™æ€å›¾åƒå’Œé¢„è§ˆè§†å›¾<br><img src="/images/2017/10/iOS-è§†é¢‘é‡‡é›†è¯¦è§£/1.png" alt="å¤šä¸ªè¾“å…¥è¾“å‡ºè®¾å¤‡"></p><p>å¦‚å›¾ï¼Œinput å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥ç«¯å£ï¼Œoutput ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æ¥æºï¼ˆå¦‚ï¼šä¸€ä¸ª <a href="https://developer.apple.com/documentation/avfoundation/avcapturemoviefileoutput" target="_blank" rel="noopener">AVCaptureMovieFileOutput</a> å¯¹è±¡å¯ä»¥æ¥æ”¶è§†é¢‘æ•°æ®å’ŒéŸ³é¢‘æ•°æ®ï¼‰</p><p>å½“æ·»åŠ  input å’Œ output åˆ° session ä¸­æ—¶ï¼Œsession ä¼šè‡ªåŠ¨å»ºç«‹èµ·ä¸€ä¸ªè¿æ¥(AVCaptureConnection)ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª connection æ¥è®¾ç½®ä» input æˆ–è€… ä» output å¾—åˆ°çš„æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç›‘æ§åœ¨éŸ³é¢‘ä¿¡é“ä¸­åŠŸç‡çš„å¹³å‡å€¼å’Œå³°å€¼ã€‚</p><p><img src="/images/2017/10/iOS-è§†é¢‘é‡‡é›†è¯¦è§£/2.png" alt="AVCaptureConnection"></p><h2 id="ä½¿ç”¨-Session-æ¥ç®¡ç†æ•°æ®æµ"><a href="#ä½¿ç”¨-Session-æ¥ç®¡ç†æ•°æ®æµ" class="headerlink" title="ä½¿ç”¨ Session æ¥ç®¡ç†æ•°æ®æµ"></a>ä½¿ç”¨ Session æ¥ç®¡ç†æ•°æ®æµ</h2><p>åˆ›å»ºä¸€ä¸ª session ç”¨æ¥ç®¡ç†æ•è·åˆ°çš„æ•°æ®ï¼Œéœ€è¦å…ˆå°† inputs å’Œ outputs æ·»åŠ åˆ° session ä¸­ï¼Œå½“ session æ‰§è¡Œ [startRunning] æ–¹æ³•åå°±ä¼šå¼€å§‹å°†æ•°æ®æµå‘é€è‡³ sessionï¼Œé€šè¿‡æ‰§è¡Œ[stopRunning] æ–¹æ³•æ¥ç»“æŸæ•°æ®æµçš„å‘é€ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVCaptureSession</span> *captureSession = [[<span class="built_in">AVCaptureSession</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ  inputs å’Œ outputs</span></span><br><span class="line"></span><br><span class="line">[session startRunning];</span><br></pre></td></tr></table></figure></p><p>åœ¨ [session startRunning] ä¹‹å‰æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬çš„é…ç½® (å¦‚ï¼šè®¾å¤‡åˆ†è¾¨ç‡ï¼Œæ·»åŠ è¾“å…¥è¾“å‡ºå¯¹è±¡ç­‰)</p><h3 id="è®¾ç½®åˆ†è¾¨ç‡"><a href="#è®¾ç½®åˆ†è¾¨ç‡" class="headerlink" title="è®¾ç½®åˆ†è¾¨ç‡"></a>è®¾ç½®åˆ†è¾¨ç‡</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®åˆ†è¾¨ç‡ 720P æ ‡æ¸…</span></span><br><span class="line"><span class="keyword">if</span> ([captureSession canSetSessionPreset:<span class="built_in">AVCaptureSessionPreset1280x720</span>]) &#123;</span><br><span class="line">    captureSession.sessionPreset = <span class="built_in">AVCaptureSessionPreset1280x720</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™„è‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­å¯ä¾›é…ç½®çš„åˆ†è¾¨ç‡åˆ—è¡¨</p><p><img src="/images/2017/10/iOS-è§†é¢‘é‡‡é›†è¯¦è§£/3.png" alt="åˆ†è¾¨ç‡åˆ—è¡¨"></p><p>å…¶ä¸­é«˜åˆ†è¾¨ç‡(AVCaptureSessionPresetHigh) ä¸ºé»˜è®¤å€¼ï¼Œä¼šæ ¹æ®å½“å‰è®¾å¤‡è¿›è¡Œè‡ªé€‚åº”ï¼Œä½†æ˜¯è¿™æ ·ä¹‹åå¯¼å‡ºæ¥çš„æ–‡ä»¶å°±ä¼šå¾ˆå¤§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è®¾ç½®ä¸ºæ ‡æ¸…(AVCaptureSessionPreset1280x720) å°±å¯ä»¥äº†</p><h3 id="è¾“å…¥å¯¹è±¡"><a href="#è¾“å…¥å¯¹è±¡" class="headerlink" title="è¾“å…¥å¯¹è±¡"></a>è¾“å…¥å¯¹è±¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ç›´æ¥ä½¿ç”¨åç½®æ‘„åƒå¤´</span><br><span class="line">AVCaptureDevice *videoDevice = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™ä¸ªæ–¹æ³•ä¸­çš„ mediaType æœ‰ä¸‰ä¸ªé€‰é¡¹ä¾›æˆ‘ä»¬ä½¿ç”¨</span><br><span class="line">// AVMediaTypeVideo è§†é¢‘</span><br><span class="line">// AVMediaTypeAudio éŸ³é¢‘</span><br><span class="line">// AVMediaTypeMuxed æ··åˆ(è§†é¢‘ + éŸ³é¢‘)</span><br><span class="line">+ (nullable AVCaptureDevice *)defaultDeviceWithMediaType:(AVMediaType)mediaType;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹å¼åªèƒ½è·å–åˆ°åç½®æ‘„åƒå¤´ï¼Œå¦‚æœæƒ³è¦è·å–å‰ç½®æ‘„åƒå¤´ï¼Œå¯ä½¿ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AVCaptureDevice *videoDevice;</span><br><span class="line">NSArray *devices = [AVCaptureDevice devices];</span><br><span class="line">for (AVCaptureDevice *device in devices) &#123;</span><br><span class="line">   if(device.position == AVCaptureDevicePositionFront) &#123;</span><br><span class="line">        // å‰ç½®æ‘„åƒå¤´</span><br><span class="line">        videoDevice = device;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é€šè¿‡è®¾å¤‡è·å–è¾“å…¥å¯¹è±¡</span><br><span class="line">AVCaptureDeviceInput *videoInput = [AVCaptureDeviceInput deviceInputWithDevice:videoDevice error:nil];</span><br><span class="line">// ç»™ä¼šè¯æ·»åŠ è¾“å…¥</span><br><span class="line">if([captureSession canAddInput:videoInput]) &#123;</span><br><span class="line">    [captureSession addInput:videoInput];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºå¯¹è±¡"><a href="#è¾“å‡ºå¯¹è±¡" class="headerlink" title="è¾“å‡ºå¯¹è±¡"></a>è¾“å‡ºå¯¹è±¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// è§†é¢‘è¾“å‡ºï¼šè®¾ç½®è§†é¢‘åŸæ•°æ®æ ¼å¼ï¼šYUV, RGB </span><br><span class="line">// è‹¹æœä¸æ”¯æŒYUVçš„æ¸²æŸ“ï¼Œåªæ”¯æŒRGBæ¸²æŸ“ï¼Œè¿™æ„å‘³ç€ï¼š YUV =&gt; RGB</span><br><span class="line">AVCaptureVideoDataOutput *videoOutput = [[AVCaptureVideoDataOutput alloc] init];</span><br><span class="line"></span><br><span class="line">// videoSettings: è®¾ç½®è§†é¢‘åŸæ•°æ®æ ¼å¼ YUV FULL</span><br><span class="line">videoOutput.videoSettings = @&#123;(NSString *)kCVPixelBufferPixelFormatTypeKey:@(kCVPixelFormatType_420YpCbCr8BiPlanarFullRange)&#125;;</span><br><span class="line"></span><br><span class="line">// è®¾ç½®ä»£ç†ï¼šè·å–å¸§æ•°æ®</span><br><span class="line">// é˜Ÿåˆ—ï¼šä¸²è¡Œ/å¹¶è¡Œï¼Œè¿™é‡Œä½¿ç”¨ä¸²è¡Œï¼Œä¿è¯æ•°æ®é¡ºåº </span><br><span class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;LinXunFengSerialQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">[videoOutput setSampleBufferDelegate:self queue:queue];</span><br><span class="line"></span><br><span class="line">// ç»™ä¼šè¯æ·»åŠ è¾“å‡ºå¯¹è±¡</span><br><span class="line">if([captureSession canAddOutput:videoOutput]) &#123;</span><br><span class="line">    // ç»™ä¼šè¯æ·»åŠ è¾“å…¥è¾“å‡ºå°±ä¼šè‡ªåŠ¨å»ºç«‹èµ·è¿æ¥</span><br><span class="line">    [captureSession addOutput:videoOutput];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œè¾“å‡ºå¯¹è±¡å¯ä»¥è®¾ç½®å¸§ç‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¸§ç‡ï¼š1ç§’10å¸§å°±å·®ä¸å¤šæ¯”è¾ƒæµç•…äº†</span><br><span class="line">videoOutput.minFrameDuration = CMTimeMake(1, 10);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¯¹è±¡åœ¨è®¾ç½®è§†é¢‘åŸæ•°æ®æ ¼å¼æ—¶ä½¿ç”¨ videoSettings å±æ€§ï¼Œéœ€è¦èµ‹å€¼çš„ç±»å‹æ˜¯å­—å…¸<br>æ ¼å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯YUVï¼Œå¦ä¸€ç§æ˜¯RGBï¼ˆä¸€èˆ¬æˆ‘ä»¬éƒ½ä½¿ç”¨YUVï¼Œå› ä¸ºä½“ç§¯æ¯”RGBå°ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// key</span><br><span class="line">kCVPixelBufferPixelFormatTypeKey æŒ‡å®šè§£ç åçš„å›¾åƒæ ¼å¼</span><br><span class="line"></span><br><span class="line">// value</span><br><span class="line">kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange  : YUV420 ç”¨äºæ ‡æ¸…è§†é¢‘[420v]</span><br><span class="line">kCVPixelFormatType_420YpCbCr8BiPlanarFullRange   : YUV422 ç”¨äºé«˜æ¸…è§†é¢‘[420f] </span><br><span class="line">kCVPixelFormatType_32BGRA : è¾“å‡ºçš„æ˜¯BGRAçš„æ ¼å¼ï¼Œé€‚ç”¨äºOpenGLå’ŒCoreImage</span><br><span class="line"></span><br><span class="line">åŒºåˆ«ï¼š</span><br><span class="line">1ã€å‰ä¸¤ç§æ˜¯ç›¸æœºè¾“å‡ºYUVæ ¼å¼ï¼Œç„¶åè½¬æˆRGBAï¼Œæœ€åä¸€ç§æ˜¯ç›´æ¥è¾“å‡ºBGRAï¼Œç„¶åè½¬æˆRGBA;</span><br><span class="line">2ã€420v è¾“å‡ºçš„è§†é¢‘æ ¼å¼ä¸ºNV12ï¼›èŒƒå›´ï¼š (luma=[16,235] chroma=[16,240])</span><br><span class="line">3ã€420f è¾“å‡ºçš„è§†é¢‘æ ¼å¼ä¸ºNV12ï¼›èŒƒå›´ï¼š (luma=[0,255] chroma=[1,255])</span><br></pre></td></tr></table></figure><h3 id="é¢„è§ˆå›¾å±‚"><a href="#é¢„è§ˆå›¾å±‚" class="headerlink" title="é¢„è§ˆå›¾å±‚"></a>é¢„è§ˆå›¾å±‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AVCaptureVideoPreviewLayer *previewLayer = [AVCaptureVideoPreviewLayer layerWithSession:captureSession];</span><br><span class="line">previewLayer.frame = self.view.bounds;</span><br><span class="line">[self.view.layer  addSublayer:previewLayer];</span><br></pre></td></tr></table></figure><p>å®æ—¶æ˜¾ç¤ºæ‘„åƒå¤´æ•è·åˆ°çš„å›¾åƒï¼Œä½†ä¸é€‚ç”¨äºæ»¤é•œæ¸²æŸ“</p><h3 id="ä»£ç†æ–¹æ³•"><a href="#ä»£ç†æ–¹æ³•" class="headerlink" title="ä»£ç†æ–¹æ³•"></a>ä»£ç†æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - AVCaptureVideoDataOutputSampleBufferDelegate</span><br><span class="line">/*</span><br><span class="line"> CMSampleBufferRef: å¸§ç¼“å­˜æ•°æ®ï¼Œæè¿°å½“å‰å¸§ä¿¡æ¯</span><br><span class="line"> CMSampleBufferGetXXX : è·å–å¸§ç¼“å­˜ä¿¡æ¯</span><br><span class="line"> CMSampleBufferGetDuration : è·å–å½“å‰å¸§æ’­æ”¾æ—¶é—´</span><br><span class="line"> CMSampleBufferGetImageBuffer : è·å–å½“å‰å¸§å›¾ç‰‡ä¿¡æ¯</span><br><span class="line"> */</span><br><span class="line">// è·å–å¸§æ•°æ®</span><br><span class="line">- (void)captureOutput:(AVCaptureOutput *)output didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection &#123;</span><br><span class="line">    // captureSession ä¼šè¯å¦‚æœæ²¡æœ‰å¼ºå¼•ç”¨ï¼Œè¿™é‡Œä¸ä¼šå¾—åˆ°æ‰§è¡Œ</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;----- sampleBuffer ----- %@&quot;, sampleBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¸§æ’­æ”¾æ—¶é—´</span></span><br><span class="line"><span class="built_in">CMTime</span> duration = <span class="built_in">CMSampleBufferGetDuration</span>(sampleBuffer);</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç†æ–¹æ³•ä¸­ï¼Œå¯ä»¥æŠŠ sampleBuffer æ•°æ®æ¸²æŸ“å‡ºæ¥å»æ˜¾ç¤ºç”»é¢ã€‚é€‚ç”¨äºæ»¤é•œæ¸²æŸ“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// è·å–å›¾ç‰‡å¸§æ•°æ®</span><br><span class="line">CVImageBufferRef imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);</span><br><span class="line">CIImage *ciImage = [CIImage imageWithCVImageBuffer:imageBuffer];</span><br><span class="line">UIImage *image = [UIImage imageWithCIImage:ciImage];</span><br><span class="line"></span><br><span class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    self.imageView.image = image;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä»£ç†æ–¹æ³•ä¸­çš„æ‰€æœ‰åŠ¨ä½œæ‰€åœ¨é˜Ÿåˆ—éƒ½æ˜¯åœ¨å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥æ›´æ–°UIçš„æ“ä½œéœ€è¦å›åˆ°ä¸»é˜Ÿåˆ—ä¸­è¿›è¡Œï¼ï¼</p><p>ä½†æ˜¯æ­¤æ—¶ä¼šå‘ç°ï¼Œç”»é¢æ˜¯å‘å·¦æ—‹è½¬äº†90åº¦ï¼Œå› ä¸ºé»˜è®¤é‡‡é›†çš„è§†é¢‘æ˜¯æ¨ªå±çš„ï¼Œéœ€è¦æˆ‘ä»¬è¿›ä¸€æ­¥åšè°ƒæ•´ã€‚ä»¥ä¸‹æ­¥éª¤æ·»åŠ åœ¨[session startRunning];ä¹‹å‰å³å¯ï¼Œä½†æ˜¯ä¸€å®šè¦åœ¨æ·»åŠ äº† input å’Œ outputä¹‹åï½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// è·å–è¾“å…¥ä¸è¾“å‡ºä¹‹é—´çš„è¿æ¥</span><br><span class="line">AVCaptureConnection *connection = [videoOutput connectionWithMediaType:AVMediaTypeVideo];</span><br><span class="line">// è®¾ç½®é‡‡é›†æ•°æ®çš„æ–¹å‘</span><br><span class="line">connection.videoOrientation = AVCaptureVideoOrientationPortrait;</span><br><span class="line">// è®¾ç½®é•œåƒæ•ˆæœé•œåƒ</span><br><span class="line">connection.videoMirrored = YES;</span><br></pre></td></tr></table></figure></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p><a href="https://github.com/LinXunFeng/LXFAudioVideo" target="_blank" rel="noopener">LXFAudioVideo</a></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - é‡‡é›†éŸ³è§†é¢‘åŠå†™å…¥æ–‡ä»¶</title>
      <link href="/2017/09/26/iOS-%E9%87%87%E9%9B%86%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8F%8A%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6/"/>
      <url>/2017/09/26/iOS-%E9%87%87%E9%9B%86%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8F%8A%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>éŸ³è§†é¢‘é‡‡é›†åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šè§†é¢‘é‡‡é›†å’ŒéŸ³é¢‘é‡‡é›†ã€‚åœ¨iOSä¸­å¯ä»¥åŒæ­¥é‡‡é›†è§†é¢‘ä¸éŸ³é¢‘ï¼Œé€šè¿‡ç³»ç»Ÿæ¡†æ¶AVFoundationï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é‡‡é›†éŸ³é¢‘ä¸è§†é¢‘ï¼Œå¯¹äºè§†é¢‘è¿˜å¯ä»¥è¿›è¡Œåˆ‡æ¢å‰åæ‘„åƒå¤´ï¼Œæœ€ç»ˆæˆ‘ä»¬å°†å½•åˆ¶å¥½çš„è§†é¢‘å†™å…¥æ²™ç›’ä¸­</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>éŸ³è§†é¢‘é‡‡é›†åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šè§†é¢‘é‡‡é›†å’ŒéŸ³é¢‘é‡‡é›†ã€‚åœ¨iOSä¸­å¯ä»¥åŒæ­¥é‡‡é›†è§†é¢‘ä¸éŸ³é¢‘ï¼Œé€šè¿‡ç³»ç»Ÿæ¡†æ¶AVFoundationï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é‡‡é›†éŸ³é¢‘ä¸è§†é¢‘ï¼Œå¯¹äºè§†é¢‘è¿˜å¯ä»¥è¿›è¡Œåˆ‡æ¢å‰åæ‘„åƒå¤´ï¼Œæœ€ç»ˆæˆ‘ä»¬å°†å½•åˆ¶å¥½çš„è§†é¢‘å†™å…¥æ²™ç›’ä¸­</p></blockquote><p><img src="/images/2017/09/iOS - é‡‡é›†éŸ³è§†é¢‘åŠå†™å…¥æ–‡ä»¶/1.gif" alt="ç›®å½•"></p><h2 id="éŸ³è§†é¢‘æ•°æ®çš„é‡‡é›†ä¸å±•ç¤º"><a href="#éŸ³è§†é¢‘æ•°æ®çš„é‡‡é›†ä¸å±•ç¤º" class="headerlink" title="éŸ³è§†é¢‘æ•°æ®çš„é‡‡é›†ä¸å±•ç¤º"></a>éŸ³è§†é¢‘æ•°æ®çš„é‡‡é›†ä¸å±•ç¤º</h2><h3 id="ä¸€ã€åˆå§‹åŒ–è§†é¢‘çš„è¾“å…¥ä¸è¾“å‡º"><a href="#ä¸€ã€åˆå§‹åŒ–è§†é¢‘çš„è¾“å…¥ä¸è¾“å‡º" class="headerlink" title="ä¸€ã€åˆå§‹åŒ–è§†é¢‘çš„è¾“å…¥ä¸è¾“å‡º"></a>ä¸€ã€åˆå§‹åŒ–è§†é¢‘çš„è¾“å…¥ä¸è¾“å‡º</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‡’åŠ è½½ä¸€ä¸ªsessionï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦sessionæ¥æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="built_in">lazy</span> <span class="keyword">var</span> session: <span class="type">AVCaptureSession</span> = <span class="type">AVCaptureSession</span>()</span><br><span class="line"><span class="comment">// ä¿å­˜è§†é¢‘è¾“å‡º</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> videoOutput: <span class="type">AVCaptureVideoDataOutput</span>?</span><br><span class="line"><span class="comment">// ä¿å­˜è§†é¢‘è¾“å…¥</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> videoInput: <span class="type">AVCaptureDeviceInput</span>?</span><br><span class="line"><span class="comment">// ä¿å­˜é¢„è§ˆå›¾å±‚</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> previewLayer: <span class="type">AVCaptureVideoPreviewLayer</span>?</span><br></pre></td></tr></table></figure><p>è®¾ç½®è§†é¢‘è¾“å…¥æºä¸è¾“å‡ºæº<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®è§†é¢‘è¾“å…¥æº</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> devices = <span class="type">AVCaptureDevice</span>.devices() <span class="keyword">as</span>? [<span class="type">AVCaptureDevice</span>] <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="comment">// è·å–æˆ‘ä»¬çš„å‰ç½®æ‘„åƒå¤´(åç½®ä¸º.back)</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> device = devices.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.position == .front &#125;).first <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> input = <span class="keyword">try</span>? <span class="type">AVCaptureDeviceInput</span>(device: device) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">self</span>.videoInput = input</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è§†é¢‘è¾“å‡ºæº</span></span><br><span class="line"><span class="keyword">let</span> output = <span class="type">AVCaptureVideoDataOutput</span>()</span><br><span class="line"><span class="keyword">let</span> queue = <span class="type">DispatchQueue</span>.global()</span><br><span class="line"><span class="comment">// è®¾ç½®ä»£ç†ï¼Œå¹¶åœ¨ä»£ç†ä¸­è·å–é‡‡é›†åˆ°çš„æ•°æ®ï¼Œéœ€è¦éµå®ˆ AVCaptureVideoDataOutputSampleBufferDelegate</span></span><br><span class="line">output.setSampleBufferDelegate(<span class="keyword">self</span>, queue: queue)</span><br><span class="line"><span class="keyword">self</span>.videoOutput = output</span><br></pre></td></tr></table></figure></p><p>è®¾ç½®éŸ³é¢‘çš„è¾“å…¥æºä¸è¾“å‡ºæº<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®éŸ³é¢‘çš„è¾“å…¥æº</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> device = <span class="type">AVCaptureDevice</span>.defaultDevice(withMediaType: <span class="type">AVMediaTypeAudio</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> input = <span class="keyword">try</span>? <span class="type">AVCaptureDeviceInput</span>(device: device) <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®éŸ³é¢‘è¾“å‡ºæº</span></span><br><span class="line"><span class="keyword">let</span> output = <span class="type">AVCaptureAudioDataOutput</span>()</span><br><span class="line"><span class="keyword">let</span> queue = <span class="type">DispatchQueue</span>.global()</span><br><span class="line"><span class="comment">// éœ€è¦éµå®ˆ AVCaptureAudioDataOutputSampleBufferDelegate</span></span><br><span class="line">output.setSampleBufferDelegate(<span class="keyword">self</span>, queue: queue)</span><br></pre></td></tr></table></figure></p><p>æ·»åŠ éŸ³é¢‘ä¸è§†é¢‘çš„è¾“å…¥ä¸è¾“å‡ºåˆ°sessionä¸­ï¼Œä½†æ˜¯æ¯æ¬¡æ·»åŠ ä¹‹å‰éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦å¯ä»¥æ·»åŠ </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ è¾“å…¥ä¸è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šæ¯æ¬¡å¯¹sessionè¿›è¡Œè®¾ç½®ä¹‹å‰éƒ½éœ€è¦è°ƒç”¨sessionçš„ã€beginConfigurationã€‘æ–¹æ³•</span></span><br><span class="line"><span class="comment">// æ¥å‘Šè¯‰ç³»ç»Ÿä½ ç°åœ¨è¦å¼€å§‹è¿›è¡Œé…ç½®ï¼Œç»“æŸé…ç½®åå†è°ƒç”¨ã€commitConfigurationã€‘æ–¹æ³•æ¥æäº¤é…ç½®</span></span><br><span class="line">session.beginConfiguration()</span><br><span class="line"><span class="keyword">if</span> session.canAddInput(input) &#123;</span><br><span class="line">    session.addInput(input)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> session.canAddOutput(output) &#123;</span><br><span class="line">    session.addOutput(output)</span><br><span class="line">&#125;</span><br><span class="line">session.commitConfiguration()</span><br></pre></td></tr></table></figure><h3 id="äºŒã€å®ç°éŸ³è§†é¢‘çš„é‡‡é›†ä»£ç†"><a href="#äºŒã€å®ç°éŸ³è§†é¢‘çš„é‡‡é›†ä»£ç†" class="headerlink" title="äºŒã€å®ç°éŸ³è§†é¢‘çš„é‡‡é›†ä»£ç†"></a>äºŒã€å®ç°éŸ³è§†é¢‘çš„é‡‡é›†ä»£ç†</h3><p>éŸ³è§†é¢‘è™½ç„¶éœ€è¦éµå®ˆçš„ä»£ç†åç§°ä¸ä¸€æ ·ï¼Œä½†æ˜¯éœ€è¦å®ç°çš„æ–¹æ³•æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥è¦æ‹¿åˆ°éŸ³é¢‘æˆ–è€…è§†é¢‘å°±å¾—å…ˆè¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ç”¨åˆ°AVCaptureOutputçš„è¿™ä¸ªæ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// This convenience method returns the first AVCaptureConnection in the receiver&apos;s</span><br><span class="line">// connections array that has an AVCaptureInputPort of the specified mediaType. If </span><br><span class="line">// no connection with the specified mediaType is found, nil is returned.</span><br><span class="line"></span><br><span class="line">open func connection(withMediaType mediaType: String!) -&gt; AVCaptureConnection!</span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ViewController</span>: <span class="title">AVCaptureVideoDataOutputSampleBufferDelegate</span>, <span class="title">AVCaptureAudioDataOutputSampleBufferDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">captureOutput</span><span class="params">(<span class="number">_</span> captureOutput: AVCaptureOutput!, didOutputSampleBuffer sampleBuffer: CMSampleBuffer!, from connection: AVCaptureConnection!)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> videoOutput?.connection(withMediaType: <span class="type">AVMediaTypeVideo</span>) == connection &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"è§†é¢‘æ•°æ®"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"éŸ³é¢‘æ•°æ®"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€åˆå§‹åŒ–ä¸€ä¸ªé¢„è§ˆå›¾å±‚ç”¨æ¥æ˜¾ç¤ºé‡‡é›†åˆ°çš„è§†é¢‘ï¼ˆéé‡‡é›†æ‰€å¿…é¡»çš„æ­¥éª¤ï¼‰"><a href="#ä¸‰ã€åˆå§‹åŒ–ä¸€ä¸ªé¢„è§ˆå›¾å±‚ç”¨æ¥æ˜¾ç¤ºé‡‡é›†åˆ°çš„è§†é¢‘ï¼ˆéé‡‡é›†æ‰€å¿…é¡»çš„æ­¥éª¤ï¼‰" class="headerlink" title="ä¸‰ã€åˆå§‹åŒ–ä¸€ä¸ªé¢„è§ˆå›¾å±‚ç”¨æ¥æ˜¾ç¤ºé‡‡é›†åˆ°çš„è§†é¢‘ï¼ˆéé‡‡é›†æ‰€å¿…é¡»çš„æ­¥éª¤ï¼‰"></a>ä¸‰ã€åˆå§‹åŒ–ä¸€ä¸ªé¢„è§ˆå›¾å±‚ç”¨æ¥æ˜¾ç¤ºé‡‡é›†åˆ°çš„è§†é¢‘ï¼ˆéé‡‡é›†æ‰€å¿…é¡»çš„æ­¥éª¤ï¼‰</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºé¢„è§ˆå›¾å±‚</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> previewLayer = <span class="type">AVCaptureVideoPreviewLayer</span>(session: session) <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line">previewLayer.frame = view.bounds</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å›¾å±‚æ·»åŠ åˆ°æ§åˆ¶å™¨çš„viewçš„layerä¸­</span></span><br><span class="line">view.layer.insertSublayer(previewLayer, at: <span class="number">0</span>)</span><br><span class="line"><span class="keyword">self</span>.previewLayer = previewLayer</span><br></pre></td></tr></table></figure><p>ç°åœ¨åŸºæœ¬åŠŸèƒ½éƒ½æœ‰äº†ï¼Œå¦‚æœæƒ³è¦å¼€å§‹é‡‡é›†éŸ³è§†é¢‘åªéœ€è¦è°ƒç”¨<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹å½•åˆ¶</span></span><br><span class="line">session.startRunning()</span><br><span class="line"><span class="comment">// ç»“æŸå½•åˆ¶</span></span><br><span class="line">session.stopRunning()</span><br></pre></td></tr></table></figure></p><h3 id="åˆ‡æ¢é•œå¤´"><a href="#åˆ‡æ¢é•œå¤´" class="headerlink" title="åˆ‡æ¢é•œå¤´"></a>åˆ‡æ¢é•œå¤´</h3><p>å…¶å®å°±æ˜¯æ¢æ‰å½“å‰çš„è§†é¢‘è¾“å…¥æ³•åˆ¶ï¼Œè¿™é‡Œçš„è¿‡ç¨‹è·Ÿä¸Šé¢çš„è®¾ç½®è¾“å…¥æºä¸€æ ·ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.å–å‡ºä¹‹å‰é•œå¤´çš„æ–¹å‘</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> videoInput = videoInput <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">let</span> position: <span class="type">AVCaptureDevicePosition</span> = videoInput.device.position == .front ? .back : .front</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> devices = <span class="type">AVCaptureDevice</span>.devices() <span class="keyword">as</span>? [<span class="type">AVCaptureDevice</span>] <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> device = devices.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.position == position &#125;).first <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> newInput = <span class="keyword">try</span>? <span class="type">AVCaptureDeviceInput</span>(device: device) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.ç§»é™¤ä¹‹å‰çš„inputï¼Œæ·»åŠ æ–°çš„input</span></span><br><span class="line">session.beginConfiguration()</span><br><span class="line">session.removeInput(videoInput)</span><br><span class="line"><span class="keyword">if</span> session.canAddInput(newInput) &#123;</span><br><span class="line">    session.addInput(newInput)</span><br><span class="line">&#125;</span><br><span class="line">session.commitConfiguration()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.ä¿å­˜æœ€æ–°çš„input</span></span><br><span class="line"><span class="keyword">self</span>.videoInput = newInput</span><br></pre></td></tr></table></figure></p><h2 id="å½•åˆ¶è§†é¢‘å†™å…¥æ–‡ä»¶"><a href="#å½•åˆ¶è§†é¢‘å†™å…¥æ–‡ä»¶" class="headerlink" title="å½•åˆ¶è§†é¢‘å†™å…¥æ–‡ä»¶"></a>å½•åˆ¶è§†é¢‘å†™å…¥æ–‡ä»¶</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> movieOutput: <span class="type">AVCaptureMovieFileOutput</span>?</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å¼€å§‹é‡‡é›†éŸ³è§†é¢‘çš„æ—¶å€™å°±è¦å¼€å§‹å†™å…¥æ–‡ä»¶</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹å†™å…¥æ–‡ä»¶ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1ã€åˆ›å»ºå†™å…¥æ–‡ä»¶çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">let</span> fileOutput = <span class="type">AVCaptureMovieFileOutput</span>()</span><br><span class="line"><span class="keyword">self</span>.movieOutput = fileOutput <span class="comment">// ä¿å­˜èµ·æ¥ï¼Œç”¨äºåœæ­¢å†™å…¥æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ç±»å‹ï¼Œä¸ç„¶æŠ¥é”™(è¿™ä¸¤å¥å¾ˆé‡è¦)</span></span><br><span class="line"><span class="keyword">let</span> connection = fileOutput.connection(withMediaType: <span class="type">AVMediaTypeVideo</span>)</span><br><span class="line">connection?.automaticallyAdjustsVideoMirroring = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> session.canAddOutput(fileOutput) &#123;</span><br><span class="line">    session.addOutput(fileOutput)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ã€ç›´æ¥å¼€å§‹å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">let</span> filePath = <span class="type">NSSearchPathForDirectoriesInDomains</span>(.documentDirectory, .userDomainMask, <span class="literal">true</span>).first! + <span class="string">"/abc.mp4"</span></span><br><span class="line"><span class="keyword">let</span> fileUrl = <span class="type">URL</span>(fileURLWithPath: filePath)</span><br><span class="line">fileOutput.startRecording(toOutputFileURL: fileUrl, recordingDelegate: <span class="keyword">self</span>)</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨åœæ­¢é‡‡é›†éŸ³è§†é¢‘çš„æ—¶å€™åœæ­¢å†™å…¥æ–‡ä»¶</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// åœæ­¢å†™å…¥æ–‡ä»¶</span><br><span class="line">movieOutput?.stopRecording()</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…è¯·çœ‹ <a href="https://github.com/LinXunFeng/LXFRecordAndWriteMediaDemo" target="_blank" rel="noopener">DEMO</a></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - LXFDrawBoard å¤šåŠŸèƒ½å°ç”»æ¿</title>
      <link href="/2017/09/25/iOS-LXFDrawBoard-%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%B0%8F%E7%94%BB%E6%9D%BF/"/>
      <url>/2017/09/25/iOS-LXFDrawBoard-%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%B0%8F%E7%94%BB%E6%9D%BF/</url>
      <content type="html"><![CDATA[<p><excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""><br>å°†LXFDrawBoardæ‹–å…¥é¡¹ç›®ä¸­ï¼Œå¯¼å…¥å¤´æ–‡ä»¶LXFDrawBoard.hï¼Œéœ€è¦ä»€ä¹ˆç¬”åˆ·å¯ä»¥åœ¨Brushæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å³å¯ä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒDemo<br>+<a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h1 id="LXFDrawBoard"><a href="#LXFDrawBoard" class="headerlink" title="LXFDrawBoard"></a>LXFDrawBoard</h1><p>å¤šåŠŸèƒ½å°ç”»æ¿ GitHub: <a href="https://github.com/LinXunFeng/LXFDrawBoard" target="_blank" rel="noopener">Demo</a></p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><blockquote><p>å°†LXFDrawBoardæ‹–å…¥é¡¹ç›®ä¸­ï¼Œå¯¼å…¥å¤´æ–‡ä»¶LXFDrawBoard.hï¼Œéœ€è¦ä»€ä¹ˆç¬”åˆ·å¯ä»¥åœ¨Brushæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å³å¯ä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒDemo</p></blockquote><p><strong>LXFDrawBoardDelegate</strong></p><p>è¿”å›éœ€è¦æ·»åŠ çš„æè¿°</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)LXFDrawBoard:(LXFDrawBoard *)drawBoard textForDescLabel:(<span class="built_in">UILabel</span> *)descLabel;</span><br></pre></td></tr></table></figure><p>å½“æ·»åŠ æˆ–ä¿®æ”¹æè¿°æ—¶è°ƒç”¨</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)LXFDrawBoard:(LXFDrawBoard *)drawBoard clickDescLabel:(<span class="built_in">UILabel</span> *)descLabel;</span><br></pre></td></tr></table></figure><h2 id="ç¬”åˆ·"><a href="#ç¬”åˆ·" class="headerlink" title="ç¬”åˆ·"></a>ç¬”åˆ·</h2><h3 id="2017â€“09-25-æ›´æ–°"><a href="#2017â€“09-25-æ›´æ–°" class="headerlink" title="2017â€“09-25 æ›´æ–°"></a>2017â€“09-25 æ›´æ–°</h3><p>æ©¡çš®æ“¦ LXFEraserBrush<br><img src="https://github.com/LinXunFeng/LXFDrawBoard/raw/master/Screenshots/æ©¡çš®æ“¦.gif" alt="LXFEraserBrush"></p><hr><p>é“…ç¬” LXFPencilBrush<br><img src="http://upload-images.jianshu.io/upload_images/2144614-db7ee9b3b6dc7d3c.gif?imageMogr2/auto-orient/strip" alt="LXFPencilBrush"></p><p>ç®­å¤´ LXFArrowBrush<br><img src="http://upload-images.jianshu.io/upload_images/2144614-52f9e8c9b036669a.gif?imageMogr2/auto-orient/strip" alt="LXFArrowBrush"></p><p>ç›´çº¿ LXFLineBrush<br><img src="http://upload-images.jianshu.io/upload_images/2144614-17043979b48ec450.gif?imageMogr2/auto-orient/strip" alt="LXFLineBrush"></p><p>æ–‡æœ¬ LXFTextBrush<br><img src="http://upload-images.jianshu.io/upload_images/2144614-9b9e9406b075d68a.gif?imageMogr2/auto-orient/strip" alt="LXFTextBrush"></p><p>çŸ©å½¢ LXFRectangleBrush</p><p><img src="http://upload-images.jianshu.io/upload_images/2144614-d4bfbe94682acafb.gif?imageMogr2/auto-orient/strip" alt="LXFRectangleBrush"></p><p>é©¬èµ›å…‹ LXFMosaicBrush<br><img src="http://upload-images.jianshu.io/upload_images/2144614-a0d920442de28de4.gif?imageMogr2/auto-orient/strip" alt="LXFMosaicBrush"></p><p>æ’¤é”€ä¸åæ’¤é”€<br><img src="http://upload-images.jianshu.io/upload_images/2144614-5e0390d0baff8047.gif?imageMogr2/auto-orient/strip" alt="æ’¤é”€ä¸åæ’¤é”€"></p></the>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Objective-C </tag>
            
            <tag> iOSé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - RxSwift é¡¹ç›®å®æˆ˜è®°å½•</title>
      <link href="/2017/09/12/iOS-RxSwift-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2017/09/12/iOS-RxSwift-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æœ€è¿‘åˆšåˆšæŠŠæ¥æ‰‹çš„OCé¡¹ç›®æå®šï¼Œç»è¿‡æ·±æ€ç†Ÿè™‘åï¼Œæœ¬äººå†³å®šä¸‹ä¸ªé¡¹ç›®èµ·å°±ä½¿ç”¨Swift(å­¦äº†è¿™ä¹ˆä¹…çš„Swiftè¿˜æ²¡çœŸæ­£ç”¨åˆ°å®é™…é¡¹ç›®é‡Œã€‚ã€‚ã€‚)ï¼Œè€Œæ°å·§RxSwiftå·²ç»å‡ºæ¥æœ‰ä¸€äº›æ—¶é—´äº†ï¼Œè¯­æ³•ä¹ŸåŸºæœ¬ä¸Šç¨³å®šï¼Œé‚åªèº«å‰æ¥è¯•æ¢è¯•æ¢è¿™RxSwiftï¼Œæ¥ç€å°±åšäº†ä¸ªå°Demoï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç§ä¸€ç§~</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><p><img src="/images/2017/09/iOS - RxSwift é¡¹ç›®å®æˆ˜è®°å½•/1.png" alt="ReactiveX"></p><blockquote><p>æœ€è¿‘åˆšåˆšæŠŠæ¥æ‰‹çš„OCé¡¹ç›®æå®šï¼Œç»è¿‡æ·±æ€ç†Ÿè™‘åï¼Œæœ¬äººå†³å®šä¸‹ä¸ªé¡¹ç›®èµ·å°±ä½¿ç”¨Swift(å­¦äº†è¿™ä¹ˆä¹…çš„Swiftè¿˜æ²¡çœŸæ­£ç”¨åˆ°å®é™…é¡¹ç›®é‡Œã€‚ã€‚ã€‚)ï¼Œè€Œæ°å·§RxSwiftå·²ç»å‡ºæ¥æœ‰ä¸€äº›æ—¶é—´äº†ï¼Œè¯­æ³•ä¹ŸåŸºæœ¬ä¸Šç¨³å®šï¼Œé‚åªèº«å‰æ¥è¯•æ¢è¯•æ¢è¿™RxSwiftï¼Œæ¥ç€å°±åšäº†ä¸ªå°Demoï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç§ä¸€ç§~</p></blockquote><p><img src="/images/2017/09/iOS - RxSwift é¡¹ç›®å®æˆ˜è®°å½•/2.gif" alt="Exhibition"></p><h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Controller</span><br><span class="line">â”‚Â Â  â””â”€â”€ LXFViewController.swift// ä¸»è§†å›¾æ§åˆ¶å™¨</span><br><span class="line">â”œâ”€â”€ Extension</span><br><span class="line">â”‚Â Â  â””â”€â”€ Response+ObjectMapper.swift// Responseåˆ†ç±»ï¼ŒMoyaè¯·æ±‚å®Œè¿›è¡ŒJsonè½¬æ¨¡å‹æˆ–æ¨¡å‹æ•°ç»„</span><br><span class="line">â”œâ”€â”€ Model</span><br><span class="line">â”‚Â Â  â””â”€â”€ LXFModel.swift// æ¨¡å‹</span><br><span class="line">â”œâ”€â”€ Protocol</span><br><span class="line">â”‚Â Â  â””â”€â”€ LXFViewModelType.swift// å®šä¹‰äº†æ¨¡å‹åè®®</span><br><span class="line">â”œâ”€â”€ Tool</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ LXFNetworkTool.swift// å°è£…Moyaè¯·æ±‚</span><br><span class="line">â”‚Â Â  â””â”€â”€ LXFProgressHUD.swift// å°è£…çš„HUD</span><br><span class="line">â”œâ”€â”€ View</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ LXFViewCell.swift// è‡ªå®šä¹‰cell</span><br><span class="line">â”‚Â Â  â””â”€â”€ LXFViewCell.xib// cellçš„xibæ–‡ä»¶</span><br><span class="line">â””â”€â”€ ViewModel</span><br><span class="line">    â””â”€â”€ LXFViewModel.swift// è§†å›¾æ¨¡å‹</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹åº“"><a href="#ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“"></a>ç¬¬ä¸‰æ–¹åº“</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RxSwift// æƒ³ç©RxSwiftçš„å¿…å¤‡åº“</span><br><span class="line">RxCocoa // å¯¹ UIKit Foundation è¿›è¡Œ Rx åŒ–</span><br><span class="line">NSObject+Rx// ä¸ºæˆ‘ä»¬æä¾› rx_disposeBag </span><br><span class="line">Moya/RxSwift // ä¸ºRxSwiftä¸“ç”¨æä¾›ï¼Œå¯¹Alamofireè¿›è¡Œå°è£…çš„ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“</span><br><span class="line">ObjectMapper // Jsonè½¬æ¨¡å‹ä¹‹å¿…å¤‡è‰¯å“</span><br><span class="line">RxDataSources// å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„ä½¿ç”¨tableViewçš„æ•°æ®æºæ–¹æ³•</span><br><span class="line">Then // æä¾›å¿«é€Ÿåˆå§‹åŒ–çš„è¯­æ³•ç³–</span><br><span class="line">Kingfisher// å›¾ç‰‡åŠ è½½åº“</span><br><span class="line">SnapKit// è§†å›¾çº¦æŸåº“</span><br><span class="line">Reusable // å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„ä½¿ç”¨è‡ªå®šä¹‰cellå’Œview,ä¸å†å‡ºç°Optional</span><br><span class="line">MJRefresh // ä¸Šæ‹‰åŠ è½½ã€ä¸‹æ‹‰åˆ·æ–°çš„åº“</span><br><span class="line">SVProgressHUD // ç®€å•æ˜“ç”¨çš„HUD</span><br></pre></td></tr></table></figure><h2 id="æ•²é»‘æ¿"><a href="#æ•²é»‘æ¿" class="headerlink" title="æ•²é»‘æ¿"></a>æ•²é»‘æ¿</h2><h3 id="Moyaçš„ä½¿ç”¨"><a href="#Moyaçš„ä½¿ç”¨" class="headerlink" title="Moyaçš„ä½¿ç”¨"></a>Moyaçš„ä½¿ç”¨</h3><p>Moyaæ˜¯åŸºäºAlamofireçš„ç½‘ç»œè¯·æ±‚åº“ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†Moya/Swiftï¼Œå®ƒåœ¨Moyaçš„åŸºç¡€ä¸Šæ·»åŠ äº†å¯¹RxSwiftçš„æ¥å£æ”¯æŒã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´ä¸‹Moyaçš„ä½¿ç”¨</p><p>ä¸€ã€åˆ›å»ºä¸€ä¸ªæšä¸¾ï¼Œç”¨æ¥å­˜æ”¾è¯·æ±‚ç±»å‹ï¼Œè¿™é‡Œæˆ‘é¡ºä¾¿è®¾ç½®ç›¸åº”çš„è·¯å¾„ï¼Œç­‰ä¸‹ç»Ÿä¸€å–å‡ºæ¥ç›´æ¥èµ‹å€¼å³å¯<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">LXFNetworkTool</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">LXFNetworkCategory</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> all     = <span class="string">"all"</span></span><br><span class="line">        <span class="keyword">case</span> android = <span class="string">"Android"</span></span><br><span class="line">        <span class="keyword">case</span> ios     = <span class="string">"iOS"</span></span><br><span class="line">        <span class="keyword">case</span> welfare = <span class="string">"ç¦åˆ©"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> data(type: <span class="type">LXFNetworkCategory</span>, size:<span class="type">Int</span>, index:<span class="type">Int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>äºŒã€ä¸ºè¿™ä¸ªæšä¸¾å†™ä¸€ä¸ªæ‰©å±•ï¼Œå¹¶éµå¾ªå¡„ TargetTypeï¼Œè¿™ä¸ªåè®®çš„Moyaè¿™ä¸ªåº“è§„å®šçš„åè®®ï¼Œå¯ä»¥æŒ‰ä½Commondé”®+å•å‡»å·¦é”®è¿›å…¥ç›¸åº”çš„æ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFNetworkTool</span>: <span class="title">TargetType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// baseURL ç»Ÿä¸€åŸºæœ¬çš„URL</span></span><br><span class="line">    <span class="keyword">var</span> baseURL: <span class="type">URL</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">URL</span>(string: <span class="string">"http://gank.io/api/data/"</span>)!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// pathå­—æ®µä¼šè¿½åŠ è‡³baseURLåé¢</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .data(<span class="keyword">let</span> type, <span class="keyword">let</span> size, <span class="keyword">let</span> index):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"\(type.rawValue)/\(size)/\(index)"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// HTTPçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="keyword">var</span> method: <span class="type">Moya</span>.<span class="type">Method</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .<span class="keyword">get</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è¯·æ±‚å‚æ•°(ä¼šåœ¨è¯·æ±‚æ—¶è¿›è¡Œç¼–ç )</span></span><br><span class="line">    <span class="keyword">var</span> parameters: [<span class="type">String</span>: <span class="type">Any</span>]? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// å‚æ•°ç¼–ç æ–¹å¼(è¿™é‡Œä½¿ç”¨URLçš„é»˜è®¤æ–¹å¼)</span></span><br><span class="line">    <span class="keyword">var</span> parameterEncoding: <span class="type">ParameterEncoding</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">URLEncoding</span>.<span class="keyword">default</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// è¿™é‡Œç”¨äºå•å…ƒæµ‹è¯•ï¼Œä¸éœ€è¦çš„å°±åƒæˆ‘ä¸€æ ·éšä¾¿å†™å†™</span></span><br><span class="line">    <span class="keyword">var</span> sampleData: <span class="type">Data</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"LinXunFeng"</span>.data(using: .utf8)!</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// å°†è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡(è¯·æ±‚ï¼šrequest ä¸‹è½½ï¼šupload ä¸Šä¼ ï¼šdownload)</span></span><br><span class="line">    <span class="keyword">var</span> task: <span class="type">Task</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .request</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// æ˜¯å¦æ‰§è¡ŒAlamofireéªŒè¯ï¼Œé»˜è®¤å€¼ä¸ºfalse</span></span><br><span class="line">    <span class="keyword">var</span> validate: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸‰ã€å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ç”¨äºæ•´ä¸ªé¡¹ç›®çš„ç½‘ç»œè¯·æ±‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lxfNetTool = <span class="type">RxMoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;()</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…¨å±€å˜é‡æ¥è¯·æ±‚æ•°æ®äº†</p><h3 id="RxDataSources"><a href="#RxDataSources" class="headerlink" title="RxDataSources"></a>RxDataSources</h3><p>å¦‚æœä½ æƒ³ç”¨ä¼ ç»Ÿçš„æ–¹å¼ä¹Ÿè¡Œï¼Œä¸è¿‡è¿™å°±å¤±å»äº†ä½¿ç”¨RxSwiftçš„æ„ä¹‰ã€‚å¥½å§ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¯´è¯´å¦‚ä½•ä¼˜é›…çš„æ¥å®ç°tableViewçš„æ•°æ®æºã€‚å…¶å®<a href="https://github.com/RxSwiftCommunity/RxDataSources" target="_blank" rel="noopener">RxDataSources</a>å®˜ç½‘ä¸Šå·²ç»æœ‰å¾ˆæ˜ç¡®çš„ä½¿ç”¨è¯´æ˜ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ€»ç»“ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å§ã€‚</p><p>æ¦‚å¿µç‚¹<br>RxDataSourcesæ˜¯ä»¥sectionæ¥åšä¸ºæ•°æ®ç»“æ„æ¥ä¼ è¾“ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦ä¼šæ¯”è¾ƒç–‘æƒ‘è¿™å¥è¯å§ï¼Œæˆ‘åœ¨æ­¤ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¼ ç»Ÿçš„æ•°æ®æºå®ç°çš„æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªnumberOfSectionï¼Œæˆ‘ä»¬åœ¨å¾ˆå¤šæƒ…å†µä¸‹åªéœ€è¦ä¸€ä¸ªsectionï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•å¯å®ç°ï¼Œä¹Ÿå¯ä»¥ä¸å®ç°ï¼Œé»˜è®¤è¿”å›çš„å°±æ˜¯1ï¼Œè¿™ç»™æˆ‘ä»¬å¸¦æ¥çš„ä¸€ä¸ªè¿·æƒ‘ç‚¹ï¼šã€tableViewæ˜¯ç”±rowæ¥ç»„æˆçš„ã€‘ï¼Œä¸çŸ¥é“åœ¨åçš„å„ä½ä¸­æœ‰æ²¡æœ‰æ˜¯è¿™ä¹ˆæƒ³çš„å‘¢ï¼Ÿï¼Ÿæœ‰çš„è¯é‚£ä»ä»Šå¤©å¼€å§‹å°±è¦è®¤æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œã€tableViewå…¶å®æ˜¯ç”±sectionç»„æˆçš„ã€‘ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨RxDataSourcesçš„è¿‡ç¨‹ä¸­ï¼Œå³ä½¿ä½ çš„setionåªæœ‰ä¸€ä¸ªï¼Œé‚£ä½ ä¹Ÿå¾—è¿”å›ä¸€ä¸ªsectionçš„æ•°ç»„å‡ºå»ï¼ï¼ï¼</p><p>ä¸€ã€è‡ªå®šä¹‰Section<br>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Modelä¸­åˆ›å»ºä¸€ä¸ªSectionçš„ç»“æ„ä½“ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œéµå¾ªSectionModelTypeåè®®ï¼Œå®ç°ç›¸åº”çš„åè®®æ–¹æ³•ã€‚çº¦å®šä¿—æˆçš„å†™æ³•å‘¢è¯·å‚è€ƒå¦‚ä¸‹æ–¹å¼<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LXFModel</span>.swift</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LXFSection</span> </span>&#123;</span><br><span class="line">    <span class="comment">// itemså°±æ˜¯rows</span></span><br><span class="line">    <span class="keyword">var</span> items: [<span class="type">Item</span>]</span><br><span class="line">  <span class="comment">// ä½ ä¹Ÿå¯ä»¥è¿™é‡ŒåŠ ä½ éœ€è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ headerView çš„ title</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFSection</span>: <span class="title">SectionModelType</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é‡å®šä¹‰ Item çš„ç±»å‹ä¸º LXFModel</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Item</span> = <span class="type">LXFModel</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å®ç°åè®®ä¸­çš„æ–¹å¼</span></span><br><span class="line">    <span class="keyword">init</span>(original: <span class="type">LXFSection</span>, items: [<span class="type">LXFSection</span>.<span class="type">Item</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span> = original</span><br><span class="line">        <span class="keyword">self</span>.items = items</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>äºŒã€åœ¨æ§åˆ¶å™¨ä¸‹åˆ›å»ºä¸€ä¸ªæ•°æ®æºå±æ€§</p><p>ä»¥ä¸‹ä»£ç å‡åœ¨ LXFViewController.swift æ–‡ä»¶ä¸­<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ•°æ®æºå±æ€§ï¼Œç±»å‹ä¸ºè‡ªå®šä¹‰çš„Sectionç±»å‹</span></span><br><span class="line"><span class="keyword">let</span> dataSource = <span class="type">RxTableViewSectionedReloadDataSource</span>&lt;<span class="type">LXFSection</span>&gt;()</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ•°æ®æºå±æ€§ç»‘å®šæˆ‘ä»¬çš„cell<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»‘å®šcell</span></span><br><span class="line">dataSource.configureCell = &#123; ds, tv, ip, item <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªåœ°æ–¹ä½¿ç”¨äº†Reusableè¿™ä¸ªåº“ï¼Œåœ¨LXFViewCellä¸­éµå®ˆäº†ç›¸åº”çš„åè®®</span></span><br><span class="line"><span class="comment">// ä½¿å…¶æ–¹ä¾¿è½¬æ¢cellä¸ºéå¯é€‰å‹çš„ç›¸åº”çš„cellç±»å‹</span></span><br><span class="line">    <span class="keyword">let</span> cell = tv.dequeueReusableCell(<span class="keyword">for</span>: ip) <span class="keyword">as</span> <span class="type">LXFViewCell</span></span><br><span class="line">    cell.picView.kf.setImage(with: <span class="type">URL</span>(string: item.url))</span><br><span class="line">    cell.descLabel.text = <span class="string">"æè¿°: \(item.desc)"</span></span><br><span class="line">    cell.sourceLabel.text = <span class="string">"æ¥æº: \(item.source)"</span></span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸‰ã€å°†sectionsåºåˆ—ç»‘å®šç»™æˆ‘ä»¬çš„rows<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output.sections.asDriver().drive(tableView.rx.items(dataSource:dataSource)).addDisposableTo(rx_disposeBag)</span><br></pre></td></tr></table></figure></p><p>å¤§åŠŸå‘Šæˆï¼Œæ¥ä¸‹æ¥è¯´è¯´sectionåºåˆ—çš„äº§ç”Ÿ</p><h3 id="ViewModelçš„è§„èŒƒ"><a href="#ViewModelçš„è§„èŒƒ" class="headerlink" title="ViewModelçš„è§„èŒƒ"></a>ViewModelçš„è§„èŒƒ</h3><p>æˆ‘ä»¬çŸ¥é“MVVMæ€æƒ³å°±æ˜¯å°†åŸæœ¬åœ¨ViewControllerçš„è§†å›¾æ˜¾ç¤ºé€»è¾‘ã€éªŒè¯é€»è¾‘ã€ç½‘ç»œè¯·æ±‚ç­‰ä»£ç å­˜æ”¾äºViewModelä¸­ï¼Œè®©æˆ‘ä»¬æ‰‹ä¸­çš„ViewControllerç˜¦èº«ã€‚è¿™äº›é€»è¾‘ç”±ViewModelè´Ÿè´£ï¼Œå¤–ç•Œä¸éœ€è¦å…³å¿ƒï¼Œå¤–ç•Œåªéœ€è¦ç»“æœï¼ŒViewModelä¹Ÿåªéœ€è¦å°†ç»“æœç»™åˆ°å¤–ç•Œï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåè®®LXFViewModelType</p><p>ä¸€ã€åˆ›å»ºä¸€ä¸ªLXFViewModelType.swift<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LXFViewModelType</span>.swift</span><br><span class="line"></span><br><span class="line"><span class="comment">// associatedtype å…³é”®å­— ç”¨æ¥å£°æ˜ä¸€ä¸ªç±»å‹çš„å ä½ç¬¦ä½œä¸ºåè®®å®šä¹‰çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">LXFViewModelType</span> </span>&#123;</span><br><span class="line">    associatedtype <span class="type">Input</span></span><br><span class="line">    associatedtype <span class="type">Output</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transform</span><span class="params">(input: Input)</span></span> -&gt; <span class="type">Output</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>äºŒã€viewModeléµå®ˆLXFViewModelTypeåè®®</p><ol><li>æˆ‘ä»¬å¯ä»¥ä¸ºXFViewModelTypeçš„Inputå’ŒOutputå®šä¹‰åˆ«åï¼Œä»¥ç¤ºåŒºåˆ†ï¼Œå¦‚ï¼šä½ è¿™ä¸ªviewModelçš„ç”¨äºè¯·æ±‚é¦–é¡µæ¨¡å—ç›¸å…³è”çš„ï¼Œåˆ™å¯ä»¥å‘½åä¸ºï¼šHomeInput å’Œ HomeOutput</li><li>æˆ‘ä»¬å¯ä»¥ä¸°å¯Œæˆ‘ä»¬çš„ Input å’Œ Output ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä¸ºOutputæ·»åŠ äº†ä¸€ä¸ªåºåˆ—ï¼Œç±»å‹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„LXFSectionæ•°ç»„ï¼Œåœ¨Inputé‡Œé¢æ·»åŠ äº†ä¸€ä¸ªè¯·æ±‚ç±»å‹(å³è¦è¯·æ±‚ä»€ä¹ˆæ•°æ®ï¼Œæ¯”å¦‚é¦–é¡µçš„æ•°æ®)</li><li>æˆ‘ä»¬é€šè¿‡ transform æ–¹æ³•å°†inputæºå¸¦çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆäº†ä¸€ä¸ªOutput</li></ol><p><strong>æ³¨æ„ï¼š ä»¥ä¸‹ä»£ç ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œè¿›è¡Œäº†éƒ¨åˆ†åˆ å‡</strong></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LXFViewModel</span>.swift</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LXFViewModel</span>: <span class="title">LXFViewModelType</span> </span>&#123;</span><br><span class="line">   <span class="comment">// å­˜æ”¾ç€è§£æå®Œæˆçš„æ¨¡å‹æ•°ç»„</span></span><br><span class="line">   <span class="keyword">let</span> models = <span class="type">Variable</span>&lt;[<span class="type">LXFModel</span>]&gt;([])</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä¸ºLXFViewModelTypeçš„Inputå’ŒOutputå®šä¹‰åˆ«å</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Input</span> = <span class="type">LXFInput</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Output</span> = <span class="type">LXFOutput</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸°å¯Œæˆ‘ä»¬çš„Inputå’ŒOutput</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LXFInput</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç½‘ç»œè¯·æ±‚ç±»å‹</span></span><br><span class="line">        <span class="keyword">let</span> category: <span class="type">LXFNetworkTool</span>.<span class="type">LXFNetworkCategory</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">init</span>(category: <span class="type">LXFNetworkTool</span>.<span class="type">LXFNetworkCategory</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.category = category</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LXFOutput</span> </span>&#123;</span><br><span class="line">        <span class="comment">// tableViewçš„sectionsæ•°æ®</span></span><br><span class="line">        <span class="keyword">let</span> sections: <span class="type">Driver</span>&lt;[<span class="type">LXFSection</span>]&gt;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">init</span>(sections: <span class="type">Driver</span>&lt;[<span class="type">LXFSection</span>]&gt;) &#123;</span><br><span class="line">            <span class="keyword">self</span>.sections = sections</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transform</span><span class="params">(input: LXFViewModel.LXFInput)</span></span> -&gt; <span class="type">LXFViewModel</span>.<span class="type">LXFOutput</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> sections = models.asObservable().<span class="built_in">map</span> &#123; (models) -&gt; [<span class="type">LXFSection</span>] <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// å½“modelsçš„å€¼è¢«æ”¹å˜æ—¶ä¼šè°ƒç”¨ï¼Œè¿™æ˜¯Variableçš„ç‰¹æ€§</span></span><br><span class="line">            <span class="keyword">return</span> [<span class="type">LXFSection</span>(items: models)] <span class="comment">// è¿”å›sectionæ•°ç»„</span></span><br><span class="line">        &#125;.asDriver(onErrorJustReturn: [])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> output = <span class="type">LXFOutput</span>(sections: sections)</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// æ¥ä¸‹æ¥çš„ä»£ç æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œè¯·ç»“åˆé¡¹ç›®æŸ¥çœ‹ï¼Œä¸ç„¶ä¼šä¸æ–¹ä¾¿é˜…è¯»å’Œç†è§£</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬åœ¨ViewControllerä¸­åˆå§‹åŒ–æˆ‘ä»¬çš„inputï¼Œé€šè¿‡transformå¾—åˆ°outputï¼Œç„¶åå°†æˆ‘ä»¬outputä¸­çš„sectionsåºåˆ—ç»‘å®štableViewçš„items<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LXFViewController</span>.swift</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–input</span></span><br><span class="line"><span class="keyword">let</span> vmInput = <span class="type">LXFViewModel</span>.<span class="type">LXFInput</span>(category: .welfare)</span><br><span class="line"><span class="comment">// é€šè¿‡transformå¾—åˆ°output</span></span><br><span class="line"><span class="keyword">let</span> vmOutput = viewModel.transform(input: vmInput)</span><br><span class="line"></span><br><span class="line">vmOutput.sections.asDriver().drive(tableView.rx.items(dataSource: dataSource)).addDisposableTo(rx_disposeBag)</span><br></pre></td></tr></table></figure></p><h3 id="RxSwiftä¸­ä½¿ç”¨MJRefresh"><a href="#RxSwiftä¸­ä½¿ç”¨MJRefresh" class="headerlink" title="RxSwiftä¸­ä½¿ç”¨MJRefresh"></a>RxSwiftä¸­ä½¿ç”¨MJRefresh</h3><p>ä¸€ã€å®šä¹‰ä¸€ä¸ªæšä¸¾LXFRefreshStatusï¼Œç”¨äºæ ‡å¿—å½“å‰åˆ·æ–°çŠ¶æ€<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">LXFRefreshStatus</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">none</span></span><br><span class="line">    <span class="keyword">case</span> beingHeaderRefresh</span><br><span class="line">    <span class="keyword">case</span> endHeaderRefresh</span><br><span class="line">    <span class="keyword">case</span> beingFooterRefresh</span><br><span class="line">    <span class="keyword">case</span> endFooterRefresh</span><br><span class="line">    <span class="keyword">case</span> noMoreData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>äºŒã€åœ¨LXFOutputæ·»åŠ ä¸€ä¸ªrefreshStatusåºåˆ—ï¼Œç±»å‹ä¸ºLXFRefreshStatus<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»™å¤–ç•Œè®¢é˜…ï¼Œå‘Šè¯‰å¤–ç•Œçš„tableViewå½“å‰çš„åˆ·æ–°çŠ¶æ€</span></span><br><span class="line"><span class="keyword">let</span> refreshStatus = <span class="type">Variable</span>&lt;<span class="type">LXFRefreshStatus</span>&gt;(.<span class="keyword">none</span>)</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬åœ¨è¿›è¡Œç½‘ç»œè¯·æ±‚å¹¶å¾—åˆ°ç»“æœä¹‹åï¼Œä¿®æ”¹refreshStatusçš„valueä¸ºç›¸åº”çš„LXFRefreshStatusé¡¹</p><p>ä¸‰ã€å¤–ç•Œè®¢é˜…outputçš„refreshStatus</p><p>å¤–ç•Œè®¢é˜…outputçš„refreshStatusï¼Œå¹¶ä¸”æ ¹æ®æ¥æ”¶åˆ°çš„å€¼è¿›è¡Œç›¸åº”çš„æ“ä½œ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vmOutput.refreshStatus.asObservable().subscribe(onNext: &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] status <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> status &#123;</span><br><span class="line">    <span class="keyword">case</span> .beingHeaderRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_header.beginRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .endHeaderRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_header.endRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .beingFooterRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.beginRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .endFooterRefresh:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshing()</span><br><span class="line">    <span class="keyword">case</span> .noMoreData:</span><br><span class="line">        <span class="keyword">self</span>?.tableView.mj_footer.endRefreshingWithNoMoreData()</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).addDisposableTo(rx_disposeBag)</span><br></pre></td></tr></table></figure></p><p>å››ã€outputæä¾›ä¸€ä¸ªrequestCommondç”¨äºè¯·æ±‚æ•°æ®</p><p>PublishSubject çš„ç‰¹ç‚¹ï¼šå³å¯ä»¥ä½œä¸ºObservableï¼Œä¹Ÿå¯ä»¥ä½œä¸ºObserverï¼Œè¯´ç™½äº†å°±æ˜¯å¯ä»¥å‘é€ä¿¡å·ï¼Œä¹Ÿå¯ä»¥è®¢é˜…ä¿¡å·<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–ç•Œé€šè¿‡è¯¥å±æ€§å‘Šè¯‰viewModelåŠ è½½æ•°æ®ï¼ˆä¼ å…¥çš„å€¼æ˜¯ä¸ºäº†æ ‡å¿—æ˜¯å¦é‡æ–°åŠ è½½ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> requestCommond = <span class="type">PublishSubject</span>&lt;<span class="type">Bool</span>&gt;()</span><br></pre></td></tr></table></figure></p><p>åœ¨transformä¸­ï¼Œæˆ‘ä»¬å¯¹ç”Ÿæˆçš„outputçš„requestCommondè¿›è¡Œè®¢é˜…<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">output.requestCommond.subscribe(onNext: &#123;[<span class="keyword">unowned</span> <span class="keyword">self</span>] isReloadData <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">self</span>.index = isReloadData ? <span class="number">1</span> : <span class="keyword">self</span>.index+<span class="number">1</span></span><br><span class="line">    lxfNetTool.request(.data(type: input.category, size: <span class="number">10</span>, index: <span class="keyword">self</span>.index)).mapArray(<span class="type">LXFModel</span>.<span class="keyword">self</span>).subscribe(&#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (event) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> event &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .next(modelArr):</span><br><span class="line">            <span class="keyword">self</span>?.models.value = isReloadData ? modelArr : (<span class="keyword">self</span>?.models.value ?? []) + modelArr</span><br><span class="line">            <span class="type">LXFProgressHUD</span>.showSuccess(<span class="string">"åŠ è½½æˆåŠŸ"</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .error(error):</span><br><span class="line">            <span class="type">LXFProgressHUD</span>.showError(error.localizedDescription)</span><br><span class="line">        <span class="keyword">case</span> .completed:</span><br><span class="line">            output.refreshStatus.value = isReloadData ? .endHeaderRefresh : .endFooterRefresh</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).addDisposableTo(<span class="keyword">self</span>.rx_disposeBag)</span><br><span class="line">&#125;).addDisposableTo(rx_disposeBag)</span><br></pre></td></tr></table></figure></p><p>äº”ã€åœ¨ViewControllerä¸­åˆå§‹åŒ–åˆ·æ–°æ§ä»¶</p><p>ä¸ºtableViewè®¾ç½®åˆ·æ–°æ§ä»¶ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºåˆ·æ–°æ§ä»¶çš„å›è°ƒä¸­ä½¿ç”¨outputçš„requestCommondå‘å°„ä¿¡å·<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tableView.mj_header = <span class="type">MJRefreshNormalHeader</span>(refreshingBlock: &#123; </span><br><span class="line">    vmOutput.requestCommond.onNext(<span class="literal">true</span>)</span><br><span class="line">&#125;)</span><br><span class="line">tableView.mj_footer = <span class="type">MJRefreshAutoNormalFooter</span>(refreshingBlock: &#123; </span><br><span class="line">    vmOutput.requestCommond.onNext(<span class="literal">false</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>æ€»ç»“æµç¨‹ï¼š</p><ol><li><p>ViewControllerå·²ç»æ‹¿åˆ°outputï¼Œå½“ä¸‹æ‹‰åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨outputçš„requestCommondå‘å°„ä¿¡æ¯ï¼Œå‘Šè¯‰viewModelæˆ‘ä»¬è¦åŠ è½½æ•°æ®</p></li><li><p>viewModelè¯·æ±‚æ•°æ®ï¼Œåœ¨å¤„ç†å®Œjsonè½¬æ¨¡å‹æˆ–æ¨¡å‹æ•°ç»„åä¿®æ”¹modelsï¼Œå½“modelsçš„å€¼è¢«ä¿®æ”¹çš„æ—¶å€™ä¼šå‘ä¿¡å·ç»™sectionsï¼Œsectionsåœ¨ViewControllerå·²ç»ç»‘å®šåˆ°tableViewçš„itemsäº†ï¼Œæ‰€ä»¥æ­¤æ—¶tableViewçš„æ•°æ®ä¼šè¢«æ›´æ–°ã€‚æ¥ç€æˆ‘ä»¬æ ¹æ®è¯·æ±‚ç»“æœï¼Œä¿®æ”¹outputçš„refreshStatuså±æ€§çš„å€¼</p></li><li><p>å½“outputçš„refreshStatuså±æ€§çš„å€¼æ”¹å˜åï¼Œä¼šå‘å°„ä¿¡å·ï¼Œç”±äºå¤–ç•Œä¹‹å‰å·²ç»è®¢é˜…äº†outputçš„refreshStatusï¼Œæ­¤æ—¶å°±ä¼šæ ¹æ®refreshStatusçš„æ–°å€¼æ¥å¤„ç†åˆ·æ–°æ§ä»¶çš„çŠ¶æ€</p></li></ol><p>å¥½äº†ï¼Œé™„ä¸Š<a href="https://github.com/LinXunFeng/RxSwiftDemo" target="_blank" rel="noopener">RxSwiftDemo</a>ã€‚å®Œç»“æ’’èŠ±</p><div class="github-widget" data-repo="LinXunFeng/RxSwiftDemo"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
            <tag> RxSwift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨</title>
      <link href="/2017/09/12/Ubuntu-%E5%AE%89%E8%A3%85nginx-%E6%9D%A5%E6%90%AD%E5%BB%BA%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2017/09/12/Ubuntu-%E5%AE%89%E8%A3%85nginx-%E6%9D%A5%E6%90%AD%E5%BB%BA%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>å¦‚æœå®‰è£…å‘½ä»¤å›è½¦ä¹‹åå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href="http://www.linuxidc.com/Linux/2009-07/20740.htm" target="_blank" rel="noopener">ã€Ubuntu â€œæ— æ³•è·å¾—é”â€è§£å†³æ–¹æ¡ˆã€‘</a>è§£å†³ï¼Œä½†æ˜¯æˆ‘äº²æµ‹å¯¹æˆ‘æ²¡ç”¨ï¼Œç›´æ¥é‡å¯æå®š</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a>å®‰è£…nginx</h2><p>å®‰è£…ä¸¤ä¸ªä¾èµ–åº“<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install autoconf automake</span><br><span class="line">sudo apt-get install libpcre3 libpcre3-dev</span><br></pre></td></tr></table></figure></p><p>å®‰è£…zlibåº“<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssl</span><br><span class="line">sudo apt-get install libssl-dev</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå®‰è£…å‘½ä»¤å›è½¦ä¹‹åå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a href="http://www.linuxidc.com/Linux/2009-07/20740.htm" target="_blank" rel="noopener">ã€Ubuntu â€œæ— æ³•è·å¾—é”â€è§£å†³æ–¹æ¡ˆã€‘</a>è§£å†³ï¼Œä½†æ˜¯æˆ‘äº²æµ‹å¯¹æˆ‘æ²¡ç”¨ï¼Œç›´æ¥é‡å¯æå®š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E: æ— æ³•è·å¾—é” /var/lib/dpkg/lock - open (11: èµ„æºæš‚æ—¶ä¸å¯ç”¨)</span><br><span class="line">E: æ— æ³•é”å®šç®¡ç†ç›®å½•(/var/lib/dpkg/)ï¼Œæ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹æ­£å ç”¨å®ƒï¼Ÿ</span><br></pre></td></tr></table></figure></p><p>è¿›å…¥å®¶ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œä»¥lxfä¸ºä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir lxf</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½æ‰€éœ€æºç <br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ä¸‹è½½nginx-rtmpæºç </span><br><span class="line">wget https://github.com/arut/nginx-rtmp-module/archive/master.zip</span><br><span class="line">// ä¿®æ”¹å‹ç¼©åŒ…çš„åå­—</span><br><span class="line">mv master.zip module.zip</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä¸‹è½½nginx</span><br><span class="line">wget https://github.com/nginx/nginx/archive/master.zip</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä¸‹è½½nginxçš„ä¾èµ–pcreæºç </span><br><span class="line">wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.39.tar.gz</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆä¹‹åä½¿ç”¨unzipå‘½ä»¤è¿›è¡Œè§£å‹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip master.zip </span><br><span class="line">unzip module.zip</span><br><span class="line">tar -zxvf pcre-8.39.tar.gz</span><br></pre></td></tr></table></figure></p><p>é…ç½®ç¼–è¯‘æ–‡ä»¶ï¼Œå‡†å¤‡ç¼–è¯‘å®‰è£…<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å…ˆè¿›å…¥nginx-masterç›®å½•</span><br><span class="line">cd nginx-master/</span><br></pre></td></tr></table></figure></p><p>åœ¨nginx-masterç›®å½•ä¸‹æœ‰ä¸€ä¸ªautoæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåä¸ºconfigureçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆæ¥é€šè¿‡å®ƒè¿›è¡Œä¸€äº›é…ç½®<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// prefix:æŒ‡å®šå®‰è£…ç›®å½•</span><br><span class="line">// add-module:æŒ‡å®šæ¨¡å—æ–‡ä»¶å¤¹</span><br><span class="line">auto/configure --prefix=/usr/local/nginx --with-pcre=../pcre-8.39 --with-http_ssl_module --with-http_v2_module --with-http_flv_module --with-http_mp4_module --add-module=../nginx-rtmp-module-master/</span><br></pre></td></tr></table></figure></p><p>é…ç½®å¥½ä¹‹åä¼šå¤šå‡ºä¸€ä¸ªMakefileæ–‡ä»¶(ä¸€ç§é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—çš„è§„åˆ™æ¥æŒ‡å®šç¼–è¯‘æ“ä½œ)ä¸objsæ–‡ä»¶å¤¹<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/1.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ç¼–è¯‘</span><br><span class="line">make</span><br><span class="line">// å®‰è£…</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>å½“ä½ makeåï¼Œçœ‹åˆ°åˆ™ä»£è¡¨ç¼–è¯‘æˆåŠŸ<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/2.png" alt="makeæˆåŠŸ"><br>å†æ‰§è¡Œã€sudo make installã€‘ï¼Œçœ‹åˆ°è¿™ä¸ªåˆ™ä»£è¡¨å®‰è£…å®Œæˆ<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/3.png" alt="å®‰è£…å®Œæˆ"></p><p>ç°åœ¨æˆ‘ä»¬å»æµ‹è¯•ä¸€ä¸‹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> cd /usr/local/nginx/sbin/</span><br><span class="line">sudo ./nginx -t</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°successfulè¯´æ˜é…ç½®æ–‡ä»¶æ­£ç¡®ï¼ï¼Œå¦‚æœæ˜¯failedçš„è¯çœ‹çœ‹ä½ æ˜¯ä¸æ˜¯æ²¡åŠ sudo<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/4.png" alt="é…ç½®æ–‡ä»¶æ­£ç¡®"></p><p>å¯åŠ¨nginxæœåŠ¡å™¨<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./nginx</span><br></pre></td></tr></table></figure></p><p>é»˜è®¤ç«¯å£æ˜¯80ï¼Œæ‰€ä»¥ç›´æ¥åˆ°æµè§ˆå™¨ä¸­ç›´æ¥æ•²å…¥æœ¬åœ°åœ°å€ 127.0.0.1ï¼Œæ˜¾ç¤ºã€Welcome to nginx!ã€‘å°±ä»£è¡¨nginxå·²ç»æˆåŠŸå®‰è£…<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/5.png" alt=""></p><h2 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h2><p>åˆ›å»ºæ¨æµå­˜æ”¾æ–‡ä»¶å¤¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ä¸ºé‡Œä»¥ /usr/local/var/www/hls ä¸ºä¾‹</span><br><span class="line">cd /usr/local</span><br><span class="line">sudo mkdir -p var/www/hls</span><br></pre></td></tr></table></figure></p><p>è¿›å…¥nginxçš„confç›®å½•ï¼Œä½¿ç”¨vimç¼–è¾‘nginx.confæ–‡ä»¶<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/conf</span><br><span class="line">sudo vim nginx.conf</span><br></pre></td></tr></table></figure></p><p>é…ç½®Nginxï¼Œæ”¯æŒhttpåè®®æ‹‰æµ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location /hls &#123;</span><br><span class="line">  types &#123;</span><br><span class="line">    application/vnd.apple.mpegurl    m3u8;</span><br><span class="line">    video/mp2t ts;</span><br><span class="line">  &#125;</span><br><span class="line">  root /usr/local/var/www;</span><br><span class="line">   add_header Cache-Control    no-cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é…ç½®Nginxï¼Œæ”¯æŒrtmpåè®®æ¨æµ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rtmp &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 1935;</span><br><span class="line">        application rtmplive &#123;</span><br><span class="line">            live on;</span><br><span class="line">            max_connections 1024;</span><br><span class="line">        &#125;</span><br><span class="line">        application hls&#123;</span><br><span class="line">            live on;</span><br><span class="line">            hls on;</span><br><span class="line">            hls_path /usr/local/var/www/hls;</span><br><span class="line">            hls_fragment 1s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/6.png" alt="hls"></p><p><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/7.png" alt="rtmp"></p><p>é‡å¯nginxæœåŠ¡å™¨<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin/</span><br><span class="line">sudo ./nginx -s reload</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ‰§è¡Œã€sudo ./nginx -s reloadã€‘å‡ºç°ä¸‹é¢è¿™ä¸ªé—®é¢˜<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [error] open() "/usr/local/nginx/logs/nginx.pid" failed (2: No such file or directory)</span><br></pre></td></tr></table></figure></p><p>å°±ä½¿ç”¨nginx -cçš„å‚æ•°æŒ‡å®šnginx.confæ–‡ä»¶çš„ä½ç½®ï¼Œæ¥ç€å†reloadä¸€ä¸‹å°±å¥½äº†<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><p>æˆ‘Ubuntuåœ°å€ä¸º192.168.123.191</p><p>æ¨æµè‡³RTMPåˆ°æœåŠ¡å™¨  <a href="rtmp://192.168.123.191:1935/rtmplive/lxf" target="_blank" rel="noopener">rtmp://192.168.123.191:1935/rtmplive/lxf</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i å¼‚å½¢.å¥‘çº¦.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv -s 1280x720 -q 10 rtmp://192.168.123.191:1935/rtmplive/lxf</span><br></pre></td></tr></table></figure></p><p>æ¨æµè‡³HLSåˆ°æœåŠ¡å™¨  <a href="http://192.168.123.191/hls/lxf.m3u8" target="_blank" rel="noopener">http://192.168.123.191/hls/lxf.m3u8</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i å¼‚å½¢.å¥‘çº¦.mp4 -vcodec libx264 -vprofile baseline -acodec aac -ar 44100 -strict -2 -ac 1 -f flv -s 1280x720 -q 10 rtmp://192.168.123.191:1935/hls/lxf</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯è¯´æ˜ä½ çš„ç”µè„‘æ²¡å®‰è£…ffmpeg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-bash: ffmpeg: command not found</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨Homebrewæ¥å®‰è£…FFmpeg<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…Homebrew</span><br><span class="line">ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span><br><span class="line">// å®‰è£…FFmpeg</span><br><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure></p><p>å¼€å§‹æ¨æµï¼Œç»ˆç«¯ä¸Šå°±å¼€å§‹ä¸æ–­çš„åˆ·æ–°æ¨æµä¿¡æ¯<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/8.png" alt="å¼€å§‹æ¨æµ"></p><p>æˆ‘ä»¬å¯ä»¥ç”¨ç”µè„‘ä¸Šçš„VLCè¿™ä¸ªè½¯ä»¶æ¥æµ‹è¯•æ˜¯å¦æ¨æµæˆåŠŸ<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/9.png" alt="VLC"></p><p><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/10.png" alt="æ‰“å¼€æµ"></p><p>OKï¼Œrmtpæ‰“å¼€æ­£å¸¸ï¼Œhlså°±ä¸æ¼”ç¤ºäº†ï¼Œä¸€æ ·çš„<br><img src="/images/2017/09/Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/11.png" alt="rmtpæ‰“å¼€æˆåŠŸ"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½</title>
      <link href="/2017/09/12/iOS-%E7%BB%99%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E6%B7%BB%E5%8A%A0%E7%9B%B4%E6%92%AD%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD/"/>
      <url>/2017/09/12/iOS-%E7%BB%99%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1%E6%B7%BB%E5%8A%A0%E7%9B%B4%E6%92%AD%E8%81%8A%E5%A4%A9%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æŠ½ç©ºç»™ä¹‹å‰åšçš„å¼€æºé¡¹ç›®<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">ã€é«˜ä»¿å¾®ä¿¡ã€‘</a>æ·»åŠ ç›´æ’­åŠŸèƒ½ï¼Œç”±äºæ—¶é—´æœ‰é™ï¼Œåšå¾—ä¸æ˜¯å¾ˆå®Œç¾ï¼Œæœ‰ç©ºå†å»å®Œå–„å§ï¼Œèƒ½ç”¨å°±å¥½~~</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>æŠ½ç©ºç»™ä¹‹å‰åšçš„å¼€æºé¡¹ç›®<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">ã€é«˜ä»¿å¾®ä¿¡ã€‘</a>æ·»åŠ ç›´æ’­åŠŸèƒ½ï¼Œç”±äºæ—¶é—´æœ‰é™ï¼Œåšå¾—ä¸æ˜¯å¾ˆå®Œç¾ï¼Œæœ‰ç©ºå†å»å®Œå–„å§ï¼Œèƒ½ç”¨å°±å¥½~~</p></blockquote><p>åœ¨æ­¤æä¾›å­˜æ”¾äºç™¾åº¦äº‘çš„å®Œæ•´é¡¹ç›®<a href="https://pan.baidu.com/s/1bpB55Bx" target="_blank" rel="noopener">ã€é«˜ä»¿å¾®ä¿¡ã€‘- ç™¾åº¦äº‘</a><br>å¸Œæœ›å„ä½èƒ½åœ¨æˆ‘çš„GitHubä¸ŠçŒ®å‡ºä¸€ä¸ªå®è´µçš„Star <a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">ã€é«˜ä»¿å¾®ä¿¡ã€‘- GitHub</a><br>è°¢è°¢</p><p>æ³¨æ„ï¼šç›´æ’­åŠŸèƒ½çš„ä½¿ç”¨ï¼ˆå¯¹æ–¹éœ€è¦å…ˆè¿›å…¥åˆ°å¯¹åº”çš„èŠå¤©ç•Œé¢ï¼‰</p><blockquote><p>ä¸¤ä¸ªæµ‹è¯•è´¦å·ï¼š lxf lqr  å¯†ç éƒ½æ˜¯123456</p></blockquote><p><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/8.gif" alt="ç›´æ’­èŠå¤©"></p><h2 id="æ¨æµ"><a href="#æ¨æµ" class="headerlink" title="æ¨æµ"></a>æ¨æµ</h2><p>é¦–å…ˆç¬¬ä¸€ä»¶äº‹å½“ç„¶å°±æ˜¯æ­å»ºä¸€ä¸ªæ¨æµæœåŠ¡å™¨ï¼Œè¿™é‡Œè¯·è·³è½¬å‚è€ƒæˆ‘ä¹‹å‰å†™å¥½çš„æ–‡ç« å§<a href="/2017/09/12/Ubuntu-å®‰è£…nginx-æ¥æ­å»ºæ¨æµæœåŠ¡å™¨/">ã€Ubuntu å®‰è£…nginx æ¥æ­å»ºæ¨æµæœåŠ¡å™¨ã€‘</a>ï¼Œè¿™é‡Œæˆ‘çš„æœåŠ¡å™¨çš„ipåœ°å€æ˜¯ï¼š192.168.123.191</p><p>APPä¸Šæ¨æµæˆ‘ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„åº“ <a href="https://github.com/LaiFengiOS/LFLiveKit" target="_blank" rel="noopener">LFLiveKit</a>ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹åº“å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº†å¾ˆå¤šäº‹æƒ…ï¼Œè€Œä¸”è¿˜åŒ…æ‹¬ç¾é¢œ~~ã€‚å½“ç„¶ï¼Œæœ‰æ—¶é—´æˆ‘ä»¬è¿˜æ˜¯è¦å»äº†è§£ä¸€ä¸‹åº•å±‚çš„ä¸œè¥¿ï¼Œè¿™é‡Œå°±å…ˆä¸èµ˜è¿°ï¼Œè¿‡å‡ å¤©æŠ½ç©ºå†åšæ€»ç»“ã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–é…ç½®</span></span><br><span class="line"><span class="keyword">let</span> audioConfiguration = <span class="type">LFLiveAudioConfiguration</span>.<span class="keyword">default</span>()</span><br><span class="line"><span class="keyword">let</span> videoConfiguration = <span class="type">LFLiveVideoConfiguration</span>.defaultConfiguration(<span class="keyword">for</span>: .low2, outputImageOrientation: .portrait)</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–session</span></span><br><span class="line"><span class="keyword">let</span> session = <span class="type">LFLiveSession</span>(audioConfiguration: audioConfiguration, videoConfiguration: videoConfiguration)</span><br><span class="line"><span class="comment">// è®¾ç½®ä»£ç†</span></span><br><span class="line"><span class="comment">// session?.delegate = self</span></span><br><span class="line"><span class="comment">// è®¾ç½®å±•ç¤ºçš„View</span></span><br><span class="line">session?.preView = <span class="keyword">self</span>.view</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stream = <span class="type">LFLiveStreamInfo</span>()</span><br><span class="line">stream.url = <span class="string">"rtmp://192.168.123.191:1935/rtmplive/lxf"</span>; <span class="comment">// æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">session.startLive(stream)</span><br><span class="line"><span class="comment">// å¼€å§‹æ¨æµ</span></span><br><span class="line">session.running = <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="æ‹‰æµ"><a href="#æ‹‰æµ" class="headerlink" title="æ‹‰æµ"></a>æ‹‰æµ</h2><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯Bç«™çš„å¼€æºåº“ <a href="https://github.com/Bilibili/ijkplayer" target="_blank" rel="noopener">ijkplayer</a> </p><p>ä¸ºäº†æ–¹ä¾¿å¯ä»¥ç”¨è¿™ä¸ª <a href="https://github.com/LinXunFeng/IJKFramework" target="_blank" rel="noopener">ç¼–è¯‘å¥½çš„Bç«™å¼€æºåº“</a></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šIJKPlayeré»˜è®¤ä½¿ç”¨çš„æ˜¯è½¯è§£ç (FFMpeng)ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ç¡¬è§£ç éœ€è¦æˆ‘ä»¬è¿›è¡Œç›¸åº”çš„è®¾ç½®<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®"videotoolbox"çš„å€¼ä¸º0ä¸ºè½¯è§£ç (é»˜è®¤)ï¼Œè®¾ç½®ä¸º1åˆ™æ˜¯ç¡¬è§£ç </span></span><br><span class="line"><span class="keyword">let</span> options = <span class="type">IJKFFOptions</span>.byDefault()</span><br><span class="line">options?.setOptionIntValue(<span class="number">1</span>, forKey: <span class="string">"videotoolbox"</span>, of: kIJKFFOptionCategoryPlayer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ijkPlayer = <span class="type">IJKFFMoviePlayerController</span>(contentURLString: <span class="string">"rtmp://192.168.123.191:1935/rtmplive/lxf"</span>, with: options)</span><br><span class="line"><span class="comment">// éœ€ä¿å­˜èµ·æ¥</span></span><br><span class="line"><span class="keyword">self</span>.ijkPlayer = ijkPlayer</span><br><span class="line">ijkPlayer?.view.frame = view.bounds</span><br><span class="line">view.addSubview(ijkPlayer!.view)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡†å¤‡æ’­æ”¾ï¼Œå½“è§†é¢‘å‡†å¤‡å¥½çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡Œæ’­æ”¾</span></span><br><span class="line">ijkPlayer?.prepareToPlay()</span><br></pre></td></tr></table></figure></p><h2 id="å°†IJKPlayeræ‰“åŒ…"><a href="#å°†IJKPlayeræ‰“åŒ…" class="headerlink" title="å°†IJKPlayeræ‰“åŒ…"></a>å°†IJKPlayeræ‰“åŒ…</h2><p>ä»Bç«™çš„gitHubä¸Šä¸‹è½½çš„ <a href="https://github.com/Bilibili/ijkplayer" target="_blank" rel="noopener">ijkplayer</a> éœ€è¦æ‰‹åŠ¨ç¼–è¯‘å‡ºæ¥ï¼Œè·Ÿç€è¯´æ˜èµ°å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°å’¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å®ƒæ‰“åŒ…ï¼Œæ–¹ä¾¿ä½¿ç”¨</p><p>å¦‚æœä½ ä¸è·Ÿç€è¯´æ˜èµ°çš„è¯ä¼šæç¤ºæ‰¾ä¸åˆ° avformat.h è¿™ä¸ªå¤´æ–‡ä»¶<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/1.png" alt="avformat.h"></p><p>è¿™æ—¶ä½ éœ€è¦åœ¨ç»ˆç«¯cdåˆ°ijkplayerè¿™ä¸ªç›®å½•ï¼Œç„¶åæ‰§è¡Œ init-ios.shæ–‡ä»¶ï¼Œå¦‚å›¾</p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/2.png" alt="ç›®å½•"></p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/3.png" alt="init-ios.sh"></p><p>ç„¶åç»è¿‡ä¸€æ®µæ¼«é•¿çš„æ—¶é—´ä¹‹åï¼Œåœ¨iosç›®å½•ä¸‹å°±å¤šå‡ºäº†è¿™äº›ffmpegç›¸å…³çš„ç›®å½•</p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/4.png" alt="ffmpegç›¸å…³ç›®å½•"></p><p>è¿™ä¸ªæ“ä½œæ˜¯åœ¨ä¸‹è½½ffmpegæºç ï¼Œç„¶ç¼ºå¤±çš„avformat.hå°±åœ¨é‡Œé¢</p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/5.png" alt="avformat.h"></p><p>æ‰“å¼€é¡¹ç›® IJKMediaPlayer<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/6.png" alt="æ‰“å¼€é¡¹ç›®"></p><p>è®¾ç½®ä¸º releaseï¼Œè¿™æ ·æ‰“å‡ºæ¥çš„åŒ…ä¼šå°äº›<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/7.png" alt="Edit Scheme"></p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/8.png" alt="release"></p><p>é€‰æ‹©çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ï¼Œå„Command+Bç¼–è¯‘ä¸€æ¬¡<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/9.png" alt="çœŸæœº"><br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/10.png" alt="æ¨¡æ‹Ÿå™¨"></p><p>å³å‡»ï¼ŒShow in Finder<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/11.png" alt=""></p><p>å¦‚å›¾ï¼Œå°±æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å­˜æ”¾ç€çš„å°±æ˜¯æˆ‘ä»¬ç¼–è¯‘å‡ºæ¥çš„åº“<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/12.png" alt="Paste_Image.png"></p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ä¿¡æ¯<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lipo -info IJKMediaFramework</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/13.png" alt="æŸ¥çœ‹æ‰€æ”¯æŒçš„å¤„ç†å™¨"><br>é»˜è®¤æ¨¡æ‹Ÿå™¨ç¼–è¯‘å‡ºæ¥çš„åŒ…æ˜¯ä¸æ”¯æŒi386ï¼Œå¦‚æœå¸Œæœ›æ”¯æŒçš„è¯<br>è¿›å…¥é¡¹ç›®çš„ Build Settingsï¼Œå°† Build Active Architecture Only è®¾ç½®ä¸ºNO<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/14.png" alt="Build Active Architecture Only"></p><p>å¥½ï¼Œç°åœ¨å¯¹ç¼–è¯‘å‡ºæ¥çš„åŒ…è¿›è¡Œåˆå¹¶ï¼Œè¿™æ ·å°±å³æ”¯æŒçœŸæœºï¼Œä¹Ÿæ”¯æŒæ¨¡æ‹Ÿå™¨<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// æ ¼å¼</span><br><span class="line">// lipo -create  path1  path2  -output  frameName</span><br><span class="line"></span><br><span class="line">lipo -create Release-iphoneos/IJKMediaFramework.framework/IJKMediaFramework Release-iphonesimulator/IJKMediaFramework.framework/IJKMediaFramework -output IJKMediaFramework</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/15.png" alt="åˆå¹¶"></p><p>å°†åˆå¹¶å‡ºæ¥çš„IJKMediaFrameworkæ›¿æ¢ IJKMediaFramework.frameworkä¸­çš„IJKMediaFrameworkï¼Œæœ€åå°†æ›¿æ¢å¥½çš„ IJKMediaFramework.framework æ‹–å…¥åˆ°é¡¹ç›®ä¸­ä½¿ç”¨å³å¯ã€‚<br><img src="/images/2017/09/iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½/16.png" alt="æ›¿æ¢"></p><p>æœ€åï¼Œé™„ä¸Šç¼–è¯‘å¥½çš„IJKMediaFramework<br>é“¾æ¥:<a href="https://pan.baidu.com/s/1eRYlJ7W" target="_blank" rel="noopener">https://pan.baidu.com/s/1eRYlJ7W</a> å¯†ç :9iaw</p><div class="github-widget" data-repo="LinXunFeng/LXFWeChat"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†</title>
      <link href="/2017/09/12/iOS-%E6%8F%AD%E9%9C%B2Block%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
      <url>/2017/09/12/iOS-%E6%8F%AD%E9%9C%B2Block%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æƒ³å¿…å¤§å®¶å¯¹blockéƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè™½ç„¶éƒ½ä¼šç”¨ï¼Œä½†æ˜¯ä½ çœŸçš„çŸ¥é“å®ƒçš„åŸç†å—ï¼Ÿæ¯”å¦‚ä¸ºä»€ä¹ˆè¦åŠ ä¸Š__blockï¼Œè¿™ä¸ªä¿®é¥°ç¬¦åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸åŠ ä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿblockåˆæ˜¯å¦‚ä½•å®ç°çš„ç­‰ç­‰ã€‚ã€‚ã€‚è¯¥ç¯‡æ–‡ç« å°±ä¸ºå¤§å®¶æ­æ™“å…³äºBlockçš„å®ç°åŸç†~</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>æƒ³å¿…å¤§å®¶å¯¹blockéƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè™½ç„¶éƒ½ä¼šç”¨ï¼Œä½†æ˜¯ä½ çœŸçš„çŸ¥é“å®ƒçš„åŸç†å—ï¼Ÿæ¯”å¦‚ä¸ºä»€ä¹ˆè¦åŠ ä¸Š__blockï¼Œè¿™ä¸ªä¿®é¥°ç¬¦åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿä¸åŠ ä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿblockåˆæ˜¯å¦‚ä½•å®ç°çš„ç­‰ç­‰ã€‚ã€‚ã€‚è¯¥ç¯‡æ–‡ç« å°±ä¸ºå¤§å®¶æ­æ™“å…³äºBlockçš„å®ç°åŸç†~</p></blockquote><h2 id="æŠ›ç –å¼•ç‰"><a href="#æŠ›ç –å¼•ç‰" class="headerlink" title="æŠ›ç –å¼•ç‰"></a>æŠ›ç –å¼•ç‰</h2><p>å…ˆç»™å‡ºé—®é¢˜ï¼Œå¤§å®¶æ€è€ƒä¸‹ç»“æœå§ï¼Œå¦‚æœåˆ†åˆ«è°ƒç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼Œç»“æœå¦‚ä½•ï¼Ÿ<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> blockFunc1()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">void</span> (^block)() = ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"num equal %d"</span>, num);</span><br><span class="line">    &#125;;</span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> blockFunc2()</span><br><span class="line">&#123;</span><br><span class="line">    __block <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">void</span> (^block)() = ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"num equal %d"</span>, num);</span><br><span class="line">    &#125;;</span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blockFunc1 : num equal 100</span><br><span class="line">blockFunc2 : num equal 200</span><br></pre></td></tr></table></figure></p><p>æ˜¯ä¸æ˜¯æœ‰äººç­”é”™äº†ï¼Ÿå†æ¥ä¸¤ä¸ªå‡½æ•°ã€‚è¿™ä¸¤ä¸ªçš„ç»“æœä¸blockFunc2ä¸€æ ·ï¼Œæ‰“å°å‡ºæ¥çš„ num ä¸º 200<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">void</span> blockFunc3()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> (^block)() = ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"num equal %d"</span>, num);</span><br><span class="line">    &#125;;</span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> blockFunc4()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">void</span> (^block)() = ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"num equal %d"</span>, num);</span><br><span class="line">    &#125;;</span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç–‘é—®ï¼š<br>æˆ‘ä»¬å‘ç°numåšä¸ºå±€éƒ¨å˜é‡æ—¶åŠ ä¸Š _ _block ä¿®é¥°ç¬¦ã€numåšä¸ºå…¨å±€å˜é‡ä»¥åŠnumä¸ºé™æ€å±€éƒ¨å˜é‡æ—¶åœ¨blockä¸­è¾“å‡ºç»“æœæ˜¯ä¸€æ ·çš„ï¼Œçš†ä¸ºè¢«ä¿®æ”¹ä¹‹åçš„å€¼ï¼Œè€Œåšä¸ºå±€éƒ¨å˜é‡å¹¶ä¸”æœªåŠ ä¸Š__blockçš„numåœ¨blockä¸­è¾“å‡ºçš„å€¼å´è¿˜æ˜¯æœªèµ‹å€¼ä¹‹å‰çš„å€¼ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¢ç´¢è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±éœ€è¦çœ‹çœ‹åº•å±‚ç»“æ„æ˜¯å¦‚ä½•å®ç°çš„äº†</p></blockquote><h2 id="æ¢ç´¢å†…éƒ¨åŸç†"><a href="#æ¢ç´¢å†…éƒ¨åŸç†" class="headerlink" title="æ¢ç´¢å†…éƒ¨åŸç†"></a>æ¢ç´¢å†…éƒ¨åŸç†</h2><p>Objective-Cæ˜¯ä¸€ä¸ªå…¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒçš„ä¸€åˆ‡éƒ½æ˜¯åŸºäºruntimeå®ç°çš„ï¼åœ¨è¿è¡Œæ—¶ä¼šå°†OCè½¬æ¢æˆCï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥æŸ¥çœ‹å…³äºblockåœ¨å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„<br>æ–°å»ºä¸€ä¸ªCommand Line Toolé¡¹ç›®ï¼Œå°†ä»¥ä¸Šä»£ç æ”¾å…¥main.mä¸­ï¼Œå¦‚å›¾</p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/1.png" alt="main.m"></p><p>è¿™é‡Œæˆ‘ä»¬æ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œç„¶åå°†ç”¨ä¸‹é¢çš„å‘½ä»¤å°†OCé‡å†™ä¸ºC<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -rewrite-objc main.m</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/2.png" alt="rewrite-objc"><br>è¿™æ—¶æˆ‘ä»¬å¯ä»¥å‘ç°å½“å‰ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªmain.cppæ–‡ä»¶ï¼Œæ‰“å¼€å®ƒå¹¶æ»šåˆ°æœ€ä¸‹é¢<br><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/3.png" alt="æ‰“å¼€main.cpp"></p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/4.png" alt="main.cpp"><br>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°blockFunc1çš„Cè¯­è¨€å®ç°æ–¹æ³•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">blockFunc1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">void</span> (*block)() = ((<span class="keyword">void</span> (*)())&amp;__blockFunc1_block_impl_0((<span class="keyword">void</span> *)__blockFunc1_block_func_0, &amp;__blockFunc1_block_desc_0_DATA, num));</span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    ((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å»æ‰ç±»å‹è½¬æ¢<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">blockFunc1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// *************************é‡ç‚¹å¥***********************</span></span><br><span class="line">    <span class="keyword">void</span> (*block)() = &amp;__blockFunc1_block_impl_0(__blockFunc1_block_func_0, &amp;__blockFunc1_block_desc_0_DATA, num));</span><br><span class="line">    <span class="comment">// *****************************************************</span></span><br><span class="line">    num = <span class="number">200</span>;</span><br><span class="line">    ((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><blockquote><p>blockå®é™…ä¸Šæ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ</p></blockquote><p>è¯¥ç»“æ„ä½“ä¸º<br><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/5.png" alt="__blockFunc1_block_impl_0"></p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¦__blockçš„blockFunc2</p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/6.png" alt="blockFunc2"><br>åœ¨ blockFunc1 ä¸­ï¼ŒblockæŒ‡å‘äº†ä¸€ä¸ªåä¸º<strong>blockFunc1_block_impl_0çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”åœ¨åˆå§‹åŒ–æ—¶è¾“å…¥äº†ä¸‰ä¸ªå‚æ•°(</strong>blockFunc1_block_impl_0æœ€åçš„flagsæœ‰é»˜è®¤å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨ä¼ å‚)ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬å†™çš„numï¼Œä¸blockFunc2ç›¸æ¯”è¾ƒï¼Œè¿™é‡Œçš„numå¹¶æ²¡æœ‰å¸¦*å·ï¼Œæ‰€ä»¥è¯´åœ¨è¿™é‡Œå®ƒåªæ˜¯ä¼ å€¼è€Œéä¼ å€ï¼Œè€Œä¸‹é¢çš„ã€num = 200;ã€‘ä¹Ÿå°±æ²¡ä»€ä¹ˆåµç”¨äº†ã€‚è¿™å°±æ˜¯blockFunc2ã€blockFunc3ä¸blockFunc4ä¸ºä»€ä¹ˆèƒ½æ‰“å°å‡ºnumæ”¹å˜åçš„å€¼ï¼Œè€ŒblockFunc1ä¸è¡Œçš„åŸå› ã€‚</p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/7.png" alt=""></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼š</p><blockquote><p>ç¼–è¯‘å™¨ä¼šå°†blockçš„å†…éƒ¨ä»£ç ç”Ÿæˆå¯¹åº”çš„å‡½æ•°</p></blockquote><p><strong> SO </strong></p><blockquote><p>æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œblockåœ¨å†…éƒ¨ä¼šä½œä¸ºä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå½“è°ƒç”¨blockçš„æ—¶å€™å…¶å®å°±æ˜¯æ ¹æ®blockå¯¹åº”çš„æŒ‡é’ˆæ‰¾åˆ°ç›¸åº”çš„å‡½æ•°ï¼Œè¿›è€Œè¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¼ å…¥è‡ªèº«</p></blockquote><h2 id="blockçš„å®ç°"><a href="#blockçš„å®ç°" class="headerlink" title="__blockçš„å®ç°"></a>__blockçš„å®ç°</h2><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ _ <em>blockï¼Œ</em> _blockä¹Ÿè¢«è½¬æ¢æˆäº†ç»“æ„ä½“ï¼Œå¹¶å«æœ‰5ä¸ªå˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct __Block_byref_num_0 &#123;</span><br><span class="line">  void *__isa;  // isaæŒ‡é’ˆ</span><br><span class="line">__Block_byref_num_0 *__forwarding;  // å®ä¾‹æœ¬èº«</span><br><span class="line"> int __flags; </span><br><span class="line"> int __size;</span><br><span class="line"> int num;  // æˆ‘ä»¬çš„numå€¼</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/iOS - æ­éœ²Blockçš„å†…éƒ¨å®ç°åŸç†/8.png" alt=""><br>å›¾ç‰‡å¯¹åº”ç€blockFunc2ä¸­çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__block int num = 100;</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºnumå¹¶ç”¨__blockä¿®é¥°çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–è¿™äº”ä¸ªå˜é‡<br>å½“æˆ‘ä»¬æ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = 200;</span><br></pre></td></tr></table></figure></p><p>å¯¹åº”ç€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(num.__forwarding-&gt;num) = 200;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢åˆšåˆšæåˆ°è¿‡ _ _forwardingæ˜¯å®ä¾‹æœ¬èº«ï¼Œå³ç±»å‹ç»“æ„ä½“__Block_byref_num_0çš„&amp;numï¼Œå†æ‰¾åˆ°å¯¹åº”çš„numå˜é‡ï¼Œå°†å…¶åŸæ¥çš„100ä¿®æ”¹ä¸º200~~</p><p>åˆ°æ­¤ï¼Œå…³äºBlockå†…éƒ¨å®ç°çš„æ­æ™“ä¹Ÿå°±åˆ°æ­¤ç»“æŸäº†ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½è®©ä½ å¯¹blockæœ‰æ›´æ·±çš„ç†è§£ï¼Œæ„Ÿè°¢ä½ è€å¿ƒçš„é˜…è¯»ï¼</p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</title>
      <link href="/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a>å·²ç»å¯¹Swiftçš„é¢å‘åè®®ç¼–ç¨‹åšäº†ä»‹ç»ï¼Œæ¥ä¸‹æ¥è¯¥ç¯‡æ–‡ç« å°†ä½¿ç”¨é¢å‘åè®®å¼€å‘(POP)æ¥åšä¸‹å®é™…çš„åº”ç”¨</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</a>å·²ç»å¯¹Swiftçš„é¢å‘åè®®ç¼–ç¨‹åšäº†ä»‹ç»ï¼Œæ¥ä¸‹æ¥è¯¥ç¯‡æ–‡ç« å°†ä½¿ç”¨é¢å‘åè®®å¼€å‘(POP)æ¥åšä¸‹å®é™…çš„åº”ç”¨</p></blockquote><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰ViewåŸºæœ¬ä¸Šæ˜¯å¿…é¡»çš„ï¼Œç›¸ä¿¡è¿™å¯¹æˆ‘ä»¬æ¥è¯´éƒ½æ˜¯æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯æ¥å›é¡¾ä¸€ä¸‹ä¸‹~</p><h1 id="é¢å‘å¯¹è±¡å¼€å‘"><a href="#é¢å‘å¯¹è±¡å¼€å‘" class="headerlink" title="é¢å‘å¯¹è±¡å¼€å‘"></a>é¢å‘å¯¹è±¡å¼€å‘</h1><p>1 æ–°å»ºä¸€ä¸ªUIViewçš„FirstTypeView<br><img src="/images/2017/09/iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/1.png" alt="FirstTypeView"></p><p>2 åˆ›å»ºä¸€ä¸ªViewçš„xibæ–‡ä»¶<br><img src="/images/2017/09/iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/2.png" alt="xib"><br>3 è®¾ç½®xibå¯¹åº”çš„classè¿›è¡Œç»‘å®š</p><p><img src="/images/2017/09/iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/3.png" alt="xib class"></p><p>4 åœ¨FirstTypeView.swift ä¸­å®ç°ä¸€ä¸ªç±»æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¤–éƒ¨ç”¨xibæ¥åˆå§‹åŒ–FirstTypeView<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstTypeView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">FirstTypeView</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">loadFromNib</span>() -&gt; <span class="title">FirstTypeView</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Bundle</span>.main.loadNibNamed(<span class="string">"\(self)"</span>, owner: <span class="literal">nil</span>, options: <span class="literal">nil</span>)?.first <span class="keyword">as</span>! <span class="type">FirstTypeView</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨å¤–éƒ¨åªè¦è°ƒç”¨FirstTypeViewçš„loadFromNibæ–¹æ³•å°±å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªViewæ¥ä½¿ç”¨äº†ã€‚å¥½ï¼Œç°åœ¨åˆæœ‰ä¸€ä¸ªç±»SecondTypeViewï¼Œä¹Ÿæ˜¯è¦æ±‚ä½¿ç”¨xibæ¥åˆå§‹åŒ–viewã€‚è¿™æ—¶æˆ‘ä»¬å°±ä¼šæƒ³ï¼Œä¸€æ ·çš„åŠ è½½xibçš„æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±æŠŠå®ƒæŠ½å–å‡ºæ¥æ”¾åˆ°çˆ¶ç±»å°±å¯ä»¥äº†ã€‚è¿™é‡Œçš„çˆ¶ç±»ä»¥BaseView.swiftä¸ºä¾‹<br>çˆ¶ç±»çš„ä¸»è¦å®ç°ä»£ç <br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">BaseView</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">loadFromNib</span>() -&gt; <span class="title">BaseView</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Bundle</span>.main.loadNibNamed(<span class="string">"\(self)"</span>, owner: <span class="literal">nil</span>, options: <span class="literal">nil</span>)?.first <span class="keyword">as</span>! <span class="type">BaseView</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£æˆ‘ä»¬çš„FirstTypeViewå’ŒSecondTypeViewåªéœ€è¦ç›´æ¥ç»§æ‰¿äºBaseViewå°±å¯ä»¥äº†ï¼Œåœ¨å…¶å®ƒåœ°æ–¹åˆå§‹åŒ–viewä¹Ÿå¾ˆæ–¹ä¾¿<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let firstView = FirstTypeView.loadFromNib()</span><br><span class="line">view.addSubview(firstView)</span><br><span class="line"></span><br><span class="line">let secondView = SecondTypeView.loadFromNib()</span><br><span class="line">view.addSubview(secondView)</span><br></pre></td></tr></table></figure></p><p>å¥½ï¼Œç°åœ¨FirstTypeViewé‡Œå£°æ˜äº†ä¸€ä¸ªå±æ€§nameï¼ŒSecondTypeViewå£°æ˜çš„å±æ€§ä¸ºageï¼Œå‡å¦‚æˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨å„è‡ªå¯¹åº”çš„å±æ€§ï¼Œè¿™æ—¶æ˜¯ç›´æ¥ç‚¹ä¸å‡ºæ¥çš„ï¼Œéœ€è¦å…ˆè¿›è¡Œå¼ºè½¬<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstView = <span class="type">FirstTypeView</span>.loadFromNib() <span class="keyword">as</span>! <span class="type">FirstTypeView</span></span><br><span class="line">firstView.name = <span class="string">"LXF"</span></span><br><span class="line">view.addSubview(firstView)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> secondView = <span class="type">SecondTypeView</span>.loadFromNib() <span class="keyword">as</span>! <span class="type">SecondTypeView</span></span><br><span class="line">secondView.age = <span class="number">100</span></span><br><span class="line">view.addSubview(secondView)</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ ·è§‰å¾—ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œè¿˜éœ€è¦è¿›è¡Œå¼ºè½¬ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åœ¨BaseViewé‡Œé¢æå®šå®ƒå‘¢ï¼Ÿå¦‚æœæ˜¯Swift 2.x çš„è¯æ˜¯å¯ä»¥çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">extension BaseView &#123;</span><br><span class="line">    class func loadFromNib() -&gt; Self &#123; // æ³¨æ„è¿™é‡Œæ˜¯å¤§å†™çš„S</span><br><span class="line">        return Bundle.main.loadNibNamed(&quot;\(self)&quot;, owner: nil, options: nil)?.first as! Self</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ç°åœ¨Swift 3.0å·²ç»ä¸æ”¯æŒè¿™ç§å†™æ³•äº†ï¼Œä¼šæŠ¥é”™ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœä½¿ç”¨é¢å‘åè®®çš„å¼€å‘å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p><h2 id="é¢å‘åè®®å¼€å‘"><a href="#é¢å‘åè®®å¼€å‘" class="headerlink" title="é¢å‘åè®®å¼€å‘"></a>é¢å‘åè®®å¼€å‘</h2><blockquote><p>å°†BaseViewåˆ é™¤ï¼ŒFirstTypeViewå’ŒSecondTypeViewæ”¹å›ç»§æ‰¿äºUIView</p></blockquote><p>1 æ–°å»ºä¸€ä¸ªSwiftæ–‡ä»¶ Nibloadable.swift<br><img src="/images/2017/09/iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/4.png" alt="Nibloadable"></p><p>2 å®ç°åè®®æ–¹æ³•</p><p><strong>åè®®ä¸­ä¸å…è®¸å®šä¹‰ç±»æ–¹æ³•ï¼Œéœ€æ”¹ä¸ºé™æ€æ–¹æ³•</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">protocol Nibloadable &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension Nibloadable &#123;</span><br><span class="line">    static func loadFromNib() -&gt; Self &#123;</span><br><span class="line">        return Bundle.main.loadNibNamed(&quot;\(self)&quot;, owner: nil, options: nil)?.first as! Self</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3 éµå®ˆåè®®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class SecondTypeView: UIView, Nibloadable &#123;</span><br><span class="line">    var age: Int = 10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œè€Œä¸”ä½ åœ¨è°ƒç”¨loadFromNibæ–¹æ³•æ—¶å¯ä»¥å‘ç°ï¼Œç±»å‹æ˜¯å¯¹åº”ä¸Šçš„</p><p><img src="/images/2017/09/iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/5.png" alt="loadFromNibåè®®æ–¹æ³•"></p><p>å¥½äº†ï¼Œé¢å‘åè®®å¼€å‘çš„åº”ç”¨å°±è®°å½•åˆ°è¿™é‡Œï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼</p><p><a href="https://github.com/LinXunFeng/LXFPOP" target="_blank" rel="noopener">Demo</a></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰</title>
      <link href="/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2017/09/12/iOS-Swift-%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AE%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡å¼€å‘æ€ç»´æ–¹å¼æ˜¯å°†ç±»ä¸­å®ç°çš„ç›¸ä¼¼æ–¹æ³•æŠ½å–å‡ºæ¥ï¼Œæ¥ç€æ”¾å…¥ä¸€ä¸ªBaseç±»ï¼Œç„¶åç»§æ‰¿äºBaseç±»åå„ä¸ªç±»å³å¯æ‰¾æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ï¼Œä¸ç”¨å†ä¸€ä¸ªä¸ªæ‰‹åŠ¨å®ç°ã€‚<br>æ¯”å¦‚ï¼šä¸€ä¸ªPersonç±»ï¼Œä¸€ä¸ªDogç±»ï¼Œå®ƒä»¬éƒ½æ‹¥æœ‰æ–¹æ³•eatï¼Œé‚£ä¹ˆå°±å¯ä»¥æ–°å»ºä¸€ä¸ªAnimalç±»ï¼Œå°†eatæ–¹æ³•æŠ½å–å‡ºæ¥æ”¾å…¥å…¶ä¸­ï¼Œç„¶åå°†Personç±»å’ŒDogç±»éƒ½ç»§æ‰¿äºAnimalã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœç°åœ¨åˆæœ‰ä¸€ä¸ªRobotç±»ï¼Œä¹Ÿéœ€è¦æ‹¥æœ‰eatæ–¹æ³•ï¼Œè€Œæ­¤æ—¶ä¹Ÿå°†å…¶ç»§æ‰¿äºAnimalçš„è¯æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œäºæ˜¯æˆ‘ä»¬å°±éœ€è¦è½¬æ¢æ€ç»´ï¼Œé¢å‘åè®®å¼€å‘~</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><blockquote><p>OCæ— æ³•åšåˆ°é¢å‘åè®®å¼€å‘ï¼Œè€ŒSwiftå¯ä»¥ï¼Œå› ä¸ºSwiftå¯ä»¥åšåˆ°åè®®æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè€ŒOCä¸è¡Œ</p></blockquote><h2 id="é¢å‘å¯¹è±¡å¼€å‘"><a href="#é¢å‘å¯¹è±¡å¼€å‘" class="headerlink" title="é¢å‘å¯¹è±¡å¼€å‘"></a>é¢å‘å¯¹è±¡å¼€å‘</h2><p>ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡å¼€å‘æ€ç»´æ–¹å¼æ˜¯å°†ç±»ä¸­å®ç°çš„ç›¸ä¼¼æ–¹æ³•æŠ½å–å‡ºæ¥ï¼Œæ¥ç€æ”¾å…¥ä¸€ä¸ªBaseç±»ï¼Œç„¶åç»§æ‰¿äºBaseç±»åå„ä¸ªç±»å³å¯æ‰¾æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ï¼Œä¸ç”¨å†ä¸€ä¸ªä¸ªæ‰‹åŠ¨å®ç°ã€‚<br>æ¯”å¦‚ï¼šä¸€ä¸ªPersonç±»ï¼Œä¸€ä¸ªDogç±»ï¼Œå®ƒä»¬éƒ½æ‹¥æœ‰æ–¹æ³•eatï¼Œé‚£ä¹ˆå°±å¯ä»¥æ–°å»ºä¸€ä¸ªAnimalç±»ï¼Œå°†eatæ–¹æ³•æŠ½å–å‡ºæ¥æ”¾å…¥å…¶ä¸­ï¼Œç„¶åå°†Personç±»å’ŒDogç±»éƒ½ç»§æ‰¿äºAnimalã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœç°åœ¨åˆæœ‰ä¸€ä¸ªRobotç±»ï¼Œä¹Ÿéœ€è¦æ‹¥æœ‰eatæ–¹æ³•ï¼Œè€Œæ­¤æ—¶ä¹Ÿå°†å…¶ç»§æ‰¿äºAnimalçš„è¯æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œäºæ˜¯æˆ‘ä»¬å°±éœ€è¦è½¬æ¢æ€ç»´ï¼Œé¢å‘åè®®å¼€å‘~</p><h2 id="é¢å‘åè®®å¼€å‘"><a href="#é¢å‘åè®®å¼€å‘" class="headerlink" title="é¢å‘åè®®å¼€å‘"></a>é¢å‘åè®®å¼€å‘</h2><p>é¢å‘åè®®å¼€å‘çš„æ ¸å¿ƒæ˜¯ï¼š<strong> æ¨¡å—åŒ–ï¼ˆç»„ä»¶åŒ–ï¼‰ </strong><br>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹åè®®çš„ä¸€èˆ¬ä½¿ç”¨ï¼Œæ–°å»ºä¸€ä¸ªSwiftæ–‡ä»¶LXFProtocol.swift<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line"></span><br><span class="line">protocol LXFProtocol &#123;</span><br><span class="line">    func eat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬çš„Personç±»éµå®ˆåè®®LXFProtocolï¼Œéœ€è¦æˆ‘ä»¬å®ç°åè®®ä¸­çš„æ–¹æ³•ï¼Œå¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Person: NSObject, LXFProtocol &#123;</span><br><span class="line">    func eat() &#123;</span><br><span class="line">        //</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£æˆ‘ä»¬æ¯ä¸ªç±»éƒ½è¿™æ ·åšçš„è¯è·Ÿç›´æ¥å¤åˆ¶ç²˜è´´ä»£ç å¹¶æ²¡ä»€ä¹ˆä¸åŒ~~<br>è€Œå¼€å¤´å·²ç»æåˆ°ä¸€ç‚¹ï¼š</p><blockquote><p>Swiftå¯ä»¥åšåˆ°åè®®æ–¹æ³•çš„å…·ä½“å®ç°</p></blockquote><p>é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªSwiftæ–‡ä»¶Eatable.swiftï¼Œä»¥åŒºåˆ†LXFProtocol.swift<br>Eatable.swiftä¸­çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Foundation</span><br><span class="line"></span><br><span class="line">protocol Eatable &#123;</span><br><span class="line">    // å¯å£°æ˜å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension Eatable &#123;</span><br><span class="line">    func eat() &#123;</span><br><span class="line">        // å®ç°å…·ä½“çš„åŠŸèƒ½</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ‰2ä¸ªæ³¨æ„ç‚¹</p><ul><li>protocolä¸­å¯ä»¥å£°æ˜å˜é‡ï¼Œæ–¹ä¾¿åœ¨åè®®æ–¹æ³•ä¸­ä½¿ç”¨</li><li>åè®®æ–¹æ³•çš„å…·ä½“å®ç°éœ€è¦åœ¨extensionä¸­æ¥å®ç°</li></ul><p>ä½¿Dogç±»éµå®ˆEatable<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Dog: NSObject, Eatable &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶å®ƒåœ°æ–¹è½»æ¾è°ƒç”¨dogçš„eatæ–¹æ³•ï¼ŒPersonç±»ä¸Robotç±»ä¹Ÿæ˜¯å¦‚æ³•ç‚®åˆ¶<br><img src="/images/2017/09/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆä¸€ï¼‰/1.png" alt=""></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡é¢å‘åè®®çš„æ–¹å¼ç»™ç±»å®šåˆ¶ä¸åŒçš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—åŒ–ã€‚å¯ä»¥å‘ç°Swiftçš„é¢å‘åè®®ç¼–ç¨‹è·Ÿc++çš„å¤šç»§æ‰¿å¾ˆç›¸ä¼¼</p><h2 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h2><p>ç°åœ¨çš„è¿™ä¸ªEatableåè®®æ˜¯å¯ä»¥è¢«ä»»æ„éµå®ˆçš„ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¿™ä¹ˆä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬åˆ›å»ºçš„åè®®åªæ˜¯è¢«UIViewControlleréµå®ˆï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ<br>ã€å½“ç„¶ï¼ŒEatableåè®®åªèƒ½è¢«UIViewControlleréµå®ˆå¾ˆæ‰¯æ·¡ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼Œä¸è¦å¤ªåœ¨æ„å’¯~~ã€‘</p><blockquote><p>åœ¨ extension åé¢åŠ ä¸Šçº¦æŸå…³é”®å­—ã€whereã€‘ï¼Œå¹¶æ³¨æ˜è¯¥åè®®åªèƒ½è¢«UIViewControllerè¿™ä¸ªç±»ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰æ‰€éµå®ˆï¼Œè€Œä¸”æ­¤æ—¶æˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°éµå®ˆè¯¥åè®®çš„æ§åˆ¶å™¨çš„view</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//import Foundation</span><br><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">protocol Eatable &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension Eatable where Self : UIViewController &#123;</span><br><span class="line">    func eat() &#123;</span><br><span class="line">        view.backgroundColor = UIColor.red</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/LinXunFeng/LXFPOP" target="_blank" rel="noopener">Demo</a><br>æ¥ä¸‹æ¥ä»¥ä¸€ä¸ªå®é™…åº”ç”¨æ¥å·©å›ºä¸‹å§ <a href="/2017/09/12/iOS-Swift-é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰/">iOS - Swift é¢å‘åè®®ç¼–ç¨‹ï¼ˆäºŒï¼‰</a></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift é«˜ä»¿å¾®ä¿¡</title>
      <link href="/2017/09/12/iOS-Swift-%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1/"/>
      <url>/2017/09/12/iOS-Swift-%E9%AB%98%E4%BB%BF%E5%BE%AE%E4%BF%A1/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ä»2016å¹´12æœˆä»½å¼€å§‹åšåˆ° 2017å¹´2æœˆ16ï¼Œè™½è¯´è¿™ä¸ªé¡¹ç›®çœ‹èµ·æ¥ä¸å¤§ï¼Œä½†æ˜¯é”»ç‚¼äººçš„åœ°æ–¹è¿˜çœŸæ˜¯å¾ˆå¤šçš„ï¼Œå¾®ä¿¡é€šè®¯å½•è”ç³»äººçš„æŒ‰æ‹¼éŸ³æ’åºï¼Œè‡ªå®šä¹‰è¡¨æƒ…é”®ç›˜ä¸­é‡åˆ°çš„åˆ†é¡µæ»šåŠ¨ï¼Œå¾®ä¿¡èŠå¤©ç•Œé¢çš„å›¾ç‰‡æ˜¾ç¤ºã€è¯­éŸ³ä¿¡æ¯çš„åŠ¨ç”»ç­‰ã€‚æŒ‘æˆ˜ç€å„ç§å„æ ·çš„éœ€æ±‚ï¼Œæœ¬äººä¹Ÿå°†é‡åˆ°çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆåšäº†è®°å½•å¹¶æ•´ç†äº†ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½ç»™iOSç¨‹åºå‘˜åŒèƒä»¬å¸¦æ¥å¸®åŠ©ã€‚ç›®å‰åŸºæœ¬çš„èŠå¤©å·²å®Œæˆï¼Œå®ç°äº†ä¸€éƒ¨åˆ†ä¸ªäººä¿¡æ¯çš„ä¿®æ”¹ï¼ŒåŠŸèƒ½æˆ‘ä¼šå°½å¿«å®Œå–„çš„ï¼</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h1 id="LXFWeChat"><a href="#LXFWeChat" class="headerlink" title="LXFWeChat"></a>LXFWeChat</h1><p>Swift 3.0 é«˜ä»¿å¾®ä¿¡</p><blockquote><p>ä¸¤ä¸ªæµ‹è¯•è´¦å·ï¼š lxf lqr  å¯†ç éƒ½æ˜¯123456 </p></blockquote><h2 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h2><p>ç äº‘<br><a href="http://git.oschina.net/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">http://git.oschina.net/LinXunFeng/LXFWeChat</a></p><p>GitHub<br><a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">https://github.com/LinXunFeng/LXFWeChat</a></p><p>åœ¨æ­¤æä¾›å­˜æ”¾äºç™¾åº¦äº‘çš„å®Œæ•´é¡¹ç›®<a href="https://pan.baidu.com/s/1bpB55Bx" target="_blank" rel="noopener">ã€é«˜ä»¿å¾®ä¿¡ã€‘- ç™¾åº¦äº‘</a><br>å¸Œæœ›å„ä½èƒ½åœ¨æˆ‘çš„é¡¹ç›®ä¸ŠçŒ®å‡ºä¸€ä¸ªå®è´µçš„Star<br>è°¢è°¢</p><blockquote><p>ä»2016å¹´12æœˆä»½å¼€å§‹åšåˆ°ç°åœ¨ï¼Œè™½è¯´è¿™ä¸ªé¡¹ç›®çœ‹èµ·æ¥ä¸å¤§ï¼Œä½†æ˜¯é”»ç‚¼äººçš„åœ°æ–¹è¿˜çœŸæ˜¯å¾ˆå¤šçš„ï¼Œå¾®ä¿¡é€šè®¯å½•è”ç³»äººçš„æŒ‰æ‹¼éŸ³æ’åºï¼Œè‡ªå®šä¹‰è¡¨æƒ…é”®ç›˜ä¸­é‡åˆ°çš„åˆ†é¡µæ»šåŠ¨ï¼Œå¾®ä¿¡èŠå¤©ç•Œé¢çš„å›¾ç‰‡æ˜¾ç¤ºã€è¯­éŸ³ä¿¡æ¯çš„åŠ¨ç”»ç­‰ã€‚æŒ‘æˆ˜ç€å„ç§å„æ ·çš„éœ€æ±‚ï¼Œæœ¬äººä¹Ÿå°†é‡åˆ°çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆåšäº†è®°å½•å¹¶æ•´ç†äº†ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½ç»™iOSç¨‹åºå‘˜åŒèƒä»¬å¸¦æ¥å¸®åŠ©ã€‚ç›®å‰åŸºæœ¬çš„èŠå¤©å·²å®Œæˆï¼Œå®ç°äº†ä¸€éƒ¨åˆ†ä¸ªäººä¿¡æ¯çš„ä¿®æ”¹ï¼ŒåŠŸèƒ½æˆ‘ä¼šå°½å¿«å®Œå–„çš„ï¼</p></blockquote><h2 id="æ¨¡ä»¿å¾®ä¿¡çš„å¯¼èˆªæ "><a href="#æ¨¡ä»¿å¾®ä¿¡çš„å¯¼èˆªæ " class="headerlink" title="æ¨¡ä»¿å¾®ä¿¡çš„å¯¼èˆªæ "></a>æ¨¡ä»¿å¾®ä¿¡çš„å¯¼èˆªæ </h2><p>åœ¨navigationBaråº•éƒ¨æ·»åŠ ä¸€ä¸ªæ·»åŠ äº†æ¸å˜å±‚çš„view<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blurBackView = <span class="type">UIView</span>()</span><br><span class="line">blurBackView.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: -<span class="number">20</span>, width: kScreenW, height: <span class="number">64</span>)</span><br><span class="line"><span class="keyword">let</span> gradintLayer = <span class="type">CAGradientLayer</span>()</span><br><span class="line">gradintLayer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: kScreenW, height: <span class="number">64</span>)</span><br><span class="line">gradintLayer.colors = [</span><br><span class="line">    <span class="type">UIColor</span>.hexInt(<span class="number">0x040012</span>).withAlphaComponent(<span class="number">0.76</span>).cgColor,</span><br><span class="line">    <span class="type">UIColor</span>.hexInt(<span class="number">0x040012</span>).withAlphaComponent(<span class="number">0.28</span>).cgColor</span><br><span class="line">]</span><br><span class="line">gradintLayer.startPoint = <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line">gradintLayer.endPoint = <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">1.0</span>)</span><br><span class="line">blurBackView.layer.addSublayer(gradintLayer)</span><br><span class="line">blurBackView.isUserInteractionEnabled = <span class="literal">false</span></span><br><span class="line">blurBackView.alpha = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å¯¼èˆªæ æ ·å¼</span></span><br><span class="line">navigationBar.barStyle = .black</span><br><span class="line">navigationBar.insertSubview(blurBackView, at: <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p><h2 id="è¡¨æƒ…é¢æ¿å’Œæ›´å¤šé¢æ¿"><a href="#è¡¨æƒ…é¢æ¿å’Œæ›´å¤šé¢æ¿" class="headerlink" title="è¡¨æƒ…é¢æ¿å’Œæ›´å¤šé¢æ¿"></a>è¡¨æƒ…é¢æ¿å’Œæ›´å¤šé¢æ¿</h2><p>é‡åˆ°çš„é—®é¢˜æ€»ç»“äº†ä¸€ä¸‹ï¼Œå¯ä»¥å‚è€ƒä¸‹ä»¥ä¸‹æ€»ç»“çš„æ–‡ç« </p><p><a href="http://www.jianshu.com/p/18d7d0f5e3e2" target="_blank" rel="noopener">ã€ŠiOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆã€‹</a></p><p><a href="http://www.jianshu.com/p/60da3b52d64c" target="_blank" rel="noopener">ã€ŠiOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜ã€‹</a></p><h2 id="èŠå¤©ç•Œé¢"><a href="#èŠå¤©ç•Œé¢" class="headerlink" title="èŠå¤©ç•Œé¢"></a>èŠå¤©ç•Œé¢</h2><p><a href="http://www.jianshu.com/p/4c570cd79bd3" target="_blank" rel="noopener">ã€ŠiOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤ºã€‹</a></p><p><a href="http://www.jianshu.com/p/aa139463eb4b" target="_blank" rel="noopener">ã€ŠiOS - Swift UITableViewçš„scrollToRowçš„â€å‘â€ã€‹</a></p><p><a href="http://www.jianshu.com/p/412a2e23b5b6" target="_blank" rel="noopener">ã€ŠiOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—ã€‹</a></p><h2 id="é¦–é¡µ"><a href="#é¦–é¡µ" class="headerlink" title="é¦–é¡µ"></a>é¦–é¡µ</h2><p><a href="http://www.jianshu.com/p/807cddad469a" target="_blank" rel="noopener">ã€ŠiOS - Swift ä»¿å¾®ä¿¡å°çº¢ç‚¹(æ— æ•°å­—)ã€‹</a></p><h2 id="ç›®å‰å®Œæˆçš„åŠŸèƒ½"><a href="#ç›®å‰å®Œæˆçš„åŠŸèƒ½" class="headerlink" title="ç›®å‰å®Œæˆçš„åŠŸèƒ½"></a>ç›®å‰å®Œæˆçš„åŠŸèƒ½</h2><h3 id="å¾®ä¿¡ç•Œé¢"><a href="#å¾®ä¿¡ç•Œé¢" class="headerlink" title="å¾®ä¿¡ç•Œé¢"></a>å¾®ä¿¡ç•Œé¢</h3><ol><li>æ˜¾ç¤ºå³ä¸Šè§’çš„èœå•</li><li>æ˜¾ç¤ºæœ€è¿‘è”ç³»äºº</li><li>æœ€è¿‘è”ç³»äººä¿¡æ¯æœªè¯»æ•°çš„æ˜¾ç¤º</li></ol><h3 id="é€šè®¯å½•ç•Œé¢"><a href="#é€šè®¯å½•ç•Œé¢" class="headerlink" title="é€šè®¯å½•ç•Œé¢"></a>é€šè®¯å½•ç•Œé¢</h3><ol><li>è”ç³»äººçš„æ’åº</li><li>è”ç³»äººæ€»æ•°æ˜¾ç¤º</li></ol><h3 id="å‘ç°ç•Œé¢"><a href="#å‘ç°ç•Œé¢" class="headerlink" title="å‘ç°ç•Œé¢"></a>å‘ç°ç•Œé¢</h3><ol><li>åŠ¨æ€å°çº¢ç‚¹çš„æ˜¾ç¤º</li><li>è´­ç‰©é€‰é¡¹çš„é“¾æ¥è·³è½¬</li></ol><h3 id="æˆ‘ç•Œé¢"><a href="#æˆ‘ç•Œé¢" class="headerlink" title="æˆ‘ç•Œé¢"></a>æˆ‘ç•Œé¢</h3><ol><li>ä¸ªäººå¤´åƒçš„ä¸Šä¼ ä¸è®¾ç½®ï¼ŒåŠå¤´åƒçš„ä¿å­˜</li><li>æˆ‘çš„äºŒç»´ç ç•Œé¢çš„æ˜¾ç¤ºåŠäºŒç»´ç çš„ä¿å­˜</li></ol><h3 id="èŠå¤©ç•Œé¢-1"><a href="#èŠå¤©ç•Œé¢-1" class="headerlink" title="èŠå¤©ç•Œé¢"></a>èŠå¤©ç•Œé¢</h3><ol><li>å°è§†é¢‘çš„å½•åˆ¶ä¸å‘é€</li><li>å°è§†é¢‘çš„æ’­æ”¾</li><li>èŠå¤©æ—¶é—´</li><li>å›¾ç‰‡çš„å‘é€ä¸æ˜¾ç¤º</li><li>æœªå‘é€æˆåŠŸçš„é‡å‘åŠŸèƒ½</li><li>è¯­éŸ³çš„å½•åˆ¶ä¸å‘é€</li><li>è¯­éŸ³çš„æ’­æ”¾åŠ¨æ€æ•ˆæœ</li></ol><h2 id="å·²çŸ¥BUG"><a href="#å·²çŸ¥BUG" class="headerlink" title="å·²çŸ¥BUG"></a>å·²çŸ¥BUG</h2><ul><li>å°è§†é¢‘å’Œå›¾ç‰‡å‘é€å‡ºå»åä¸èƒ½ç«‹å³æ›´æ–°æ˜¾ç¤ºç¼©ç•¥å›¾</li><li>æ›´æ¢å¤´åƒæ¨¡æ‹Ÿå™¨æµ‹è¯•æ­£å¸¸ï¼ŒçœŸæœºæ— æ•ˆã€‚ã€‚</li></ul><h2 id="2017-07-24-æ›´æ–°"><a href="#2017-07-24-æ›´æ–°" class="headerlink" title="2017-07-24 æ›´æ–°"></a>2017-07-24 æ›´æ–°</h2><p>æŠ½ç©ºå‡ºæ¥æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„ç›´æ’­åŠŸèƒ½ï¼ˆå¯¹æ–¹éœ€è¦å…ˆè¿›å…¥åˆ°å¯¹åº”çš„èŠå¤©ç•Œé¢ï¼‰<br>ç›¸å…³åšæ–‡ï¼š<a href="http://www.jianshu.com/p/022b9044decc" target="_blank" rel="noopener">iOS - ç»™é«˜ä»¿å¾®ä¿¡æ·»åŠ ç›´æ’­èŠå¤©åŠŸèƒ½</a><br>éœ€è¦ç”¨åˆ°<a href="https://github.com/LinXunFeng/IJKFramework" target="_blank" rel="noopener">ç¼–è¯‘å¥½çš„Bç«™å¼€æºåº“ijkplayer</a> ï¼Œç”±äºæ‰“åŒ…å¥½çš„æ–‡ä»¶å¤ªå¤§ï¼Œä¼ ä¸ä¸Šæ¥ï¼Œæ‰€ä»¥éœ€è¦å„ä½å»è‡ªå·±ç¼–è¯‘é›†æˆè¿›å»ã€‚</p><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><h3 id="åŠ¨æ€å›¾"><a href="#åŠ¨æ€å›¾" class="headerlink" title="åŠ¨æ€å›¾"></a>åŠ¨æ€å›¾</h3><p><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/1.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/2.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/3.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/4.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/5.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/6.gif" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/7.gif" alt=""></p><h3 id="é™æ€å›¾"><a href="#é™æ€å›¾" class="headerlink" title="é™æ€å›¾"></a>é™æ€å›¾</h3><p><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170206_1.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_1.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_2.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_3.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_4.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_5.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_6.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_7.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_8.png" alt=""><br><img src="https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/Snip20170214_9.png" alt=""></p><div class="github-widget" data-repo="LinXunFeng/LXFWeChat"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swift </tag>
            
            <tag> iOSé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - ARCä¸MRCçš„å•ä¾‹è®¾è®¡æ¨¡å¼</title>
      <link href="/2017/09/12/iOS-ARC%E4%B8%8EMRC%E7%9A%84%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2017/09/12/iOS-ARC%E4%B8%8EMRC%E7%9A%84%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>å•ä¾‹è®¾è®¡æ¨¡å¼(Singleton) å°±æ˜¯ä¿è¯æŸä¸ªç±»åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ä»å§‹åˆ°ç»ˆåªæœ‰ä¸€ä¸ªçš„ä¸€ç§æ–¹æ¡ˆ</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="å•ä¾‹è®¾è®¡æ¨¡å¼-Singleton"><a href="#å•ä¾‹è®¾è®¡æ¨¡å¼-Singleton" class="headerlink" title="å•ä¾‹è®¾è®¡æ¨¡å¼(Singleton)"></a>å•ä¾‹è®¾è®¡æ¨¡å¼(Singleton)</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å°±æ˜¯ä¿è¯æŸä¸ªç±»åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ä»å§‹åˆ°ç»ˆåªæœ‰ä¸€ä¸ªçš„ä¸€ç§æ–¹æ¡ˆ</p><h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><ul><li>èŠ‚çœå†…å­˜å¼€é”€</li><li>ä¿è¯æ•´ä¸ªç¨‹åºä¸­ä½¿ç”¨åŒä¸€ä»½èµ„æº</li></ul><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>é¦–å…ˆå°†æˆ‘ä»¬çš„ç¯å¢ƒè®¾ç½®ä¸ºéARCç¯å¢ƒï¼Œå³MRCï¼Œå¦‚å›¾<br><img src="/images/2017/09/iOS - ARCä¸MRCçš„å•ä¾‹è®¾è®¡æ¨¡å¼/1.png" alt="MRCç¯å¢ƒ"></p><blockquote><p>åœ¨MRCæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¾—è‡ªå·±æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥å¾—é‡å†™ä¸€äº›ä¸èµ„æºåˆ›å»ºä¸é‡Šæ”¾ç›¸å…³çš„æ–¹æ³•ï¼Œä»¥ä¿è¯å•ä¾‹å¯¹è±¡çš„å”¯ä¸€ã€‚</p></blockquote><p>æ–°å»ºä¸€ä¸ªç»§æ‰¿äºNSObjectçš„ç±» LXFFileToolï¼Œæˆ‘ç›´æ¥ä¸Šä»£ç ï¼Œå¹¶å†™ä¸Šæ³¨é‡Š<br>LXFFileTool.h<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LXFFileTool</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedFileTool;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p><p>LXFFileTool.m<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LXFFileTool.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LXFFileTool</span></span></span><br><span class="line"><span class="keyword">static</span> LXFFileTool *_fileTools = <span class="literal">nil</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  allocæ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨allocWithZone:</span></span><br><span class="line"><span class="comment"> *  @param zone ç³»ç»Ÿåˆ†é…ç»™appçš„å†…å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone &#123;</span><br><span class="line">    <span class="keyword">if</span> (_fileTools == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;    <span class="comment">// å®‰å…¨(è¿™ä¸ªä»£ç åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡)</span></span><br><span class="line">            _fileTools = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _fileTools;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">oneway</span> <span class="keyword">void</span>)release &#123;</span><br><span class="line">    <span class="comment">// åœ¨allocWithZoneä¸­ä½¿ç”¨äº†GCDä»¤åˆ›å»ºå¯¹è±¡çš„ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœ_fileToolsè¢«é‡Šæ”¾åˆ™æ— æ³•å†åˆ›å»º</span></span><br><span class="line">    <span class="comment">// é‡å†™releaseæ–¹æ³•ï¼Œé˜²æ­¢_fileToolsè¢«é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡å†™retainæ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)<span class="keyword">retain</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡å†™retainCounté”å®šå¼•ç”¨è®¡æ•°</span></span><br><span class="line">- (<span class="built_in">NSUInteger</span>)retainCount &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡å†™initæ–¹æ³•ï¼Œé˜²æ­¢å•ä¾‹æ‰€æ‹¥æœ‰çš„å±æ€§å€¼è¢«é‡ç½®</span></span><br><span class="line"><span class="comment">// è®©åˆå§‹åŒ–çš„æ–¹æ³•åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œè‡ªç„¶å±æ€§å€¼å°±æ²¡æœ‰æœºä¼šè¢«é‡ç½®</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        _fileTools = [<span class="keyword">super</span> init];  <span class="comment">// initä¼šå…ˆè°ƒç”¨allocæ–¹æ³•</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _fileTools;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¿é€ ç³»ç»Ÿçš„å•ä¾‹åˆ›å»ºæ–¹å¼ï¼Œæä¾›ç±»æ–¹æ³•</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedFileTool &#123;</span><br><span class="line">    <span class="comment">// ç”±äºæˆ‘ä»¬å·²ç»é‡å†™äº†initæ–¹æ³•ä¿è¯äº†å•ä¾‹å¯¹è±¡çš„å”¯ä¸€äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨initæ–¹æ³•å³å¯ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p><blockquote><p>MRCä¸‹å°±æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯åªèƒ½åˆ›å»ºå’Œåˆå§‹åŒ–ä¸€æ¬¡å¯¹è±¡ï¼Œä¸ç»™æœºä¼šé‡Šæ”¾ï¼Œä¹Ÿä¸ç»™æœºä¼šé‡æ–°åˆå§‹åŒ–ï¼Œä»è€Œä¿è¯äº†è¯¥å¯¹è±¡çš„å”¯ä¸€ã€‚</p></blockquote><p>é‚£ç°åœ¨æ¥çœ‹çœ‹ARCä¸‹æ˜¯å¦‚ä½•å®ç°å•ä¾‹çš„å§ã€‚å…¶å®ARCä¸‹ä¸MRCçš„åŒºåˆ«å°±æ˜¯ARCä¸‹æˆ‘ä»¬ä¸ç”¨è‡ªå·±å†æ‰‹åŠ¨å»é‡Šæ”¾èµ„æºäº†ï¼Œä»è€Œä½¿ä»£ç ä¸Šå¤§åŒå°å¼‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LXFFileTool.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LXFFileTool</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> LXFFileTool *_fileTools = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone &#123;</span><br><span class="line">    <span class="keyword">if</span> (_fileTools == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">            _fileTools = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _fileTools;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        _fileTools = [<span class="keyword">super</span> init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _fileTools;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedFileTool &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ‰¹é‡åˆ›å»ºå•ä¾‹"><a href="#æ‰¹é‡åˆ›å»ºå•ä¾‹" class="headerlink" title="æ‰¹é‡åˆ›å»ºå•ä¾‹"></a>æ‰¹é‡åˆ›å»ºå•ä¾‹</h2><blockquote><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ARCä¸MRCä¸‹åˆ†åˆ«æ˜¯å¦‚ä½•åˆ›å»ºå•ä¾‹çš„äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®é‡Œéœ€è¦å¤šä¸ªå•ä¾‹ï¼Œé‚£æˆ‘ä»¬åªèƒ½æŠŠä»£ç å¤åˆ¶ç²˜è´´å†æ”¹æ”¹å°±å®Œäº‹å—ï¼Ÿè¿™æœªå…ä¹Ÿå¤ªéº»çƒ¦äº†å§ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½åšåˆ°å¿«é€Ÿä¸”æ–¹ä¾¿çš„åˆ›å»ºå•ä¾‹å¯¹è±¡å‘¢ï¼Ÿå¯ä»¥çš„ï¼Œåˆ©ç”¨å®</p></blockquote><p>é¦–å…ˆå…ˆè¯´ä¸‹ä¸€äº›å…³äºå®çš„çŸ¥è¯†å§</p><ul><li>ä½¿ç”¨ #define å…³é”®å­—æ¥å®šä¹‰å®</li><li>å®å®šä¹‰åªèƒ½æ˜¯å•è¡Œçš„ï¼Œä¸èƒ½æ¢è¡Œ</li></ul><p>é‚£ç°åœ¨æ¥è®¨è®ºä¸‹ä¸€äº›ç–‘æƒ‘å§ï¼Œä½ è¯´å®åªèƒ½å•è¡Œï¼Œå¯æ˜¯åˆ›å»ºå•ä¾‹çš„ä»£ç å¯æ˜¯æœ‰å¾ˆå¤šè¡Œå‘€ï¼è¿˜æœ‰æˆ‘ä»¬å¦‚ä½•åšåˆ°è‡ªå®šä¹‰ç±»æ–¹æ³•å(å°±æ˜¯ sharedXXX )ï¼Ÿå¥½ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸‹å®ä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šç¬¦å·</p><h3 id="å®çš„ç‰¹æ®Šç¬¦å·"><a href="#å®çš„ç‰¹æ®Šç¬¦å·" class="headerlink" title="å®çš„ç‰¹æ®Šç¬¦å·"></a>å®çš„ç‰¹æ®Šç¬¦å·</h3><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">\</td><td style="text-align:center">ç”¨æ¥è½¬è¯‘æ¢è¡Œç¬¦ï¼Œå³å±è”½æ¢è¡Œç¬¦</td></tr><tr><td style="text-align:center">##</td><td style="text-align:center">å°†ä¸¤ä¸ªç›¸é‚»çš„æ ‡è®°(token)è¿æ¥ä¸ºä¸€ä¸ªå•ç‹¬çš„æ ‡è®°</td></tr></tbody></table><p>æƒ³äº†è§£å…¶å®ƒå…³äºå®çš„é¢„å¤„ç†å‘½ä»¤å¯ä»¥è‡ªè¡Œç™¾åº¦å‚è€ƒâ€Cè¯­è¨€çš„é¢„å¤„ç†å‘½ä»¤â€</p><blockquote><p>ç®€å•æ¥è¯´ï¼Œ\ç”¨äºå–æ¶ˆæ¢è¡Œï¼Œ##ç”¨æ¥è¿æ¥ï¼Œè€Œæˆ‘ä»¬å°±ç”¨##æ¥å®ç°è‡ªå®šä¹‰ç±»æ–¹æ³•å</p></blockquote><p>åˆ›å»ºä¸€ä¸ªå¤´æ–‡ä»¶Singleton.hç”¨æ¥å­˜æ”¾å®å®šä¹‰<br>å…ˆæ¥çœ‹çœ‹å®šä¹‰.hä¸­ sharedXXX æ˜¯å¦‚ä½•é€šè¿‡å®æ¥å®šä¹‰çš„<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .hæ–‡ä»¶çš„å®ç°</span></span><br><span class="line"><span class="meta">#define SingletonH(methodName) + (instancetype)shared##methodName;</span></span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å›åˆ°LXFFileTool.hä¸­ï¼Œç›´æ¥ä¸€è¡Œå®šä¹‰sharedFileToolè¿™ä¸ªç±»æ–¹æ³•<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Singleton.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LXFFileTool</span> : <span class="title">NSObject</span></span></span><br><span class="line">SingletonH(FileTool)</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬åªéœ€è¦å°†æ–¹æ³•åFileToolä¼ å…¥SingletonH()ä¸­å°±å¯ä»¥æ‹¼æ¥ä¸ºsharedFileTool</p><p>é‚£ç°åœ¨å†æ¥çœ‹çœ‹å®šä¹‰.mä¸­åˆ›å»ºå•ä¾‹çš„æ–¹å¼ï¼Œä»¥ARCä¸ºä¾‹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define SingletonM(methodName) \</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance = <span class="literal">nil</span>; \</span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zAone &#123; \</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="literal">nil</span>) &#123; \</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">            _instance = [<span class="keyword">super</span> allocWithZone:zone]; \</span><br><span class="line">        &#125;); \</span><br><span class="line">    &#125; \</span><br><span class="line">    <span class="keyword">return</span> _instance; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123; \</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">        _instance = [<span class="keyword">super</span> init]; \</span><br><span class="line">    &#125;); \</span><br><span class="line">    <span class="keyword">return</span> _instance; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">+ (<span class="keyword">instancetype</span>)shared<span class="meta">##methodName &#123; \</span></span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] init]; \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>åœ¨æ¯ä¸€ä¸ªè¡Œåé¢åŠ ä¸Š(åæ–œæ )å–æ¶ˆæ¢è¡Œï¼Œä½¿ç”¨##æ¥æ‹¼æ¥ä¼ å…¥çš„æ–¹æ³•åï¼Œä½†è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæœ€åä¸€è¡Œä¸èƒ½åŠ åæ–œæ </p></blockquote><p>å›åˆ°LXFFileTool.mä¸­ï¼Œä¸€è¡Œå®ç°åˆ›å»ºå•ä¾‹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LXFFileTool.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LXFFileTool</span></span></span><br><span class="line">SingletonM(FileTool)</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p><p>å¥½ï¼Œç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæˆ‘çš„é¡¹ç›®ä¸­æœ‰ä¸ªåˆ«æ–‡ä»¶æ˜¯éœ€è¦MRCç¯å¢ƒçš„ï¼Œé‚£æˆ‘è¯¥æ€ä¹ˆåŠæ‰èƒ½è®©åˆ›å»ºå•ä¾‹ä¹Ÿæ˜¯å¦‚æ­¤ç®€å•å‘¢ï¼Ÿå¾ˆç®€å•ï¼ŒåŠ ä¸ªåˆ¤æ–­å°±å¥½äº†ï¼Œå¤§è‡´åˆ¤æ–­å¦‚ä¸‹ï¼Œè¯¦æƒ…çœ‹æ–‡ç« æœ€åé™„ä¸Šçš„Demo<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#if __has_feature(objc_arc) // ARC</span></span><br><span class="line"><span class="comment">// å†™ä¸ŠARCä¸‹çš„å®šä¹‰ä»£ç </span></span><br><span class="line"><span class="meta">#else   // éARC</span></span><br><span class="line"><span class="comment">// å†™ä¸ŠMRCä¸‹çš„å®šä¹‰ä»£ç </span></span><br><span class="line"><span class="meta">#endif</span></span><br></pre></td></tr></table></figure></p><blockquote><p>å¥½äº†ï¼Œç°åœ¨ç”¨èµ·æ¥æ˜¯ä¸æ˜¯æ–¹ä¾¿å¤šäº†ï¼Ÿæˆ‘ä»¬åªè¦åˆ›å»ºä¸€ä¸ªç±»ï¼Œç„¶ååœ¨.hæ–‡ä»¶ä¸­å†™SingletonH(XXX)ï¼Œå†åœ¨.mæ–‡ä»¶ä¸­å†™SingletonM(XXX)å°±å¯ä»¥å®ç°å•ä¾‹äº†~</p></blockquote><h3 id="æŒ‡å®šç¯å¢ƒ"><a href="#æŒ‡å®šç¯å¢ƒ" class="headerlink" title="æŒ‡å®šç¯å¢ƒ"></a>æŒ‡å®šç¯å¢ƒ</h3><p>é¡ºä¾¿æä¸‹å¦‚ä½•åœ¨MRCä¸‹æŒ‡å®šæŸä¸ªç±»æ–‡ä»¶ä½¿ç”¨çš„ç¯å¢ƒä¸ºARC<br><img src="/images/2017/09/iOS - ARCä¸MRCçš„å•ä¾‹è®¾è®¡æ¨¡å¼/2.png" alt="æŒ‡å®šç¯å¢ƒ"><br>å¦‚å›¾ï¼Œå¯ä»¥åœ¨ Build Phases -&gt; Compile Sources ä¸­åŒå‡»æŸä¸ªéœ€è¦ARCç¯å¢ƒçš„ç±»æ–‡ä»¶ï¼Œç„¶åå†™ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-fobjc-arc</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æŒ‡å®šMRCï¼Œåˆ™å†™ä¸Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-fno-objc-arc</span><br></pre></td></tr></table></figure></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>æœ€åï¼Œé™„ä¸ŠDemo: <a href="https://github.com/LinXunFeng/LXFSingleton" target="_blank" rel="noopener">LXFSingleton</a></p><div class="github-widget" data-repo="LinXunFeng/LXFSingleton"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—</title>
      <link href="/2017/09/12/iOS-Swift-UIButton%E4%B8%ADImageView%E7%9A%84animationImages%E5%8A%A8%E7%94%BB%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E5%90%8E%EF%BC%8C%E5%9B%BE%E6%A0%87%E5%8F%98%E6%9A%97/"/>
      <url>/2017/09/12/iOS-Swift-UIButton%E4%B8%ADImageView%E7%9A%84animationImages%E5%8A%A8%E7%94%BB%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E5%90%8E%EF%BC%8C%E5%9B%BE%E6%A0%87%E5%8F%98%E6%9A%97/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ å½“è¯¥å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼ŒæŒ‰é’®åœ¨é«˜äº®çŠ¶æ€ä¸‹ï¼Œå›¾ç‰‡ä¼šç»˜åˆ¶æˆé«˜äº®ï¼ˆå‰ææ˜¯æ²¡æœ‰æ‰‹åŠ¨è®¾ç½®é«˜äº®å›¾ç‰‡ï¼‰ã€‚å¹¶ä¸”è¯¥å€¼çš„é»˜è®¤å€¼ä¸ºtrue<br>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å±æ€§adjustsImageWhenHighlightedè®¾ç½®ä¸ºfalseï¼Œä¸è®©ç³»ç»Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬è®¾ç½®é«˜äº®çŠ¶æ€ä¸‹æ˜¾ç¤ºçš„å›¾ç‰‡å³å¯ã€‚</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="æƒ…å†µ"><a href="#æƒ…å†µ" class="headerlink" title="æƒ…å†µ"></a>æƒ…å†µ</h2><p><img src="/images/2017/09/iOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—/1.gif" alt="å˜æš—"><br>è´´å‡ºé‡è¦ä»£ç </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®æŒ‰é’®å›¾ç‰‡åŠ¨ç”»æ•°ç»„</span></span><br><span class="line">voiceButton.imageView?.animationImages = [</span><br><span class="line">    #imageLiteral(resourceName: <span class="string">"message_voice_sender_playing_1"</span>),</span><br><span class="line">    #imageLiteral(resourceName: <span class="string">"message_voice_sender_playing_2"</span>),</span><br><span class="line">    #imageLiteral(resourceName: <span class="string">"message_voice_sender_playing_3"</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹åŠ¨ç”»</span></span><br><span class="line">voiceButton.imageView?.startAnimating()</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœæ­¢åŠ¨ç”»</span></span><br><span class="line">voiceButton.imageView?.stopAnimating()</span><br></pre></td></tr></table></figure><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>è¿™ä¸ªæŒ‰é’®åœ¨ç»“æŸåŠ¨ç”»ä¹‹åä¹‹æ‰€ä»¥ä¼šå˜æš—ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨åŠ¨ç”»ç»“æŸä¹‹åè‡ªåŠ¨æ˜¾ç¤ºä¸ºé«˜äº®å›¾ç‰‡ï¼Œä¸ä¿¡ï¼Ÿé‚£åªå¥½ä¸Šè¯æ®äº†~<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®è¯­éŸ³æŒ‰é’®çš„é«˜äº®å›¾ç‰‡</span></span><br><span class="line">voiceButton.setImage(#imageLiteral(resourceName: <span class="string">"message_voice_sender_normal"</span>), <span class="keyword">for</span>: .highlighted)</span><br></pre></td></tr></table></figure></p><p><img src="/images/2017/09/iOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—/2.gif" alt=""></p><p>é‚£çŸ¥é“åŸå› ä¹‹åå°±å¾ˆå¥½è§£å†³äº†</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ–¹æ¡ˆä¸€ï¼šè®¾ç½®æŒ‰é’®çš„é«˜äº®å›¾ç‰‡"><a href="#æ–¹æ¡ˆä¸€ï¼šè®¾ç½®æŒ‰é’®çš„é«˜äº®å›¾ç‰‡" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šè®¾ç½®æŒ‰é’®çš„é«˜äº®å›¾ç‰‡"></a>æ–¹æ¡ˆä¸€ï¼šè®¾ç½®æŒ‰é’®çš„é«˜äº®å›¾ç‰‡</h3><p>å°†æŒ‰é’®çš„é«˜äº®å›¾ç‰‡ä¸æ™®é€šçŠ¶æ€ä¸‹çš„ä¸€è‡´å³å¯ã€‚è¿™é‡Œå°±å†èµ˜è¿°äº†</p><h3 id="æ–¹æ¡ˆäºŒï¼šadjustsImageWhenHighlighted-false"><a href="#æ–¹æ¡ˆäºŒï¼šadjustsImageWhenHighlighted-false" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šadjustsImageWhenHighlighted = false"></a>æ–¹æ¡ˆäºŒï¼šadjustsImageWhenHighlighted = false</h3><p>åœ¨UIButtonä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå±æ€§<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adjustsImageWhenHighlighted</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜<br><img src="/images/2017/09/iOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—/3.png" alt=""><br>å½“è¯¥å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼ŒæŒ‰é’®åœ¨é«˜äº®çŠ¶æ€ä¸‹ï¼Œå›¾ç‰‡ä¼šç»˜åˆ¶æˆé«˜äº®ï¼ˆå‰ææ˜¯æ²¡æœ‰æ‰‹åŠ¨è®¾ç½®é«˜äº®å›¾ç‰‡ï¼‰ã€‚å¹¶ä¸”è¯¥å€¼çš„é»˜è®¤å€¼ä¸ºtrue<br>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å±æ€§adjustsImageWhenHighlightedè®¾ç½®ä¸ºfalseï¼Œä¸è®©ç³»ç»Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬è®¾ç½®é«˜äº®çŠ¶æ€ä¸‹æ˜¾ç¤ºçš„å›¾ç‰‡å³å¯ã€‚</p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="/images/2017/09/iOS - Swift UIButtonä¸­ImageViewçš„animationImagesåŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾æ ‡å˜æš—/4.gif" alt="å®Œç¾"></p><p>é™„ä¸Šç›¸å…³é¡¹ç›®ï¼š<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">Swift 3.0 é«˜ä»¿å¾®ä¿¡</a></p><div class="github-widget" data-repo="LinXunFeng/LXFWeChat"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Swift 3.0 é«˜ä»¿å–œé©¬æ‹‰é›…FM</title>
      <link href="/2017/09/12/Swift-3-0-%E9%AB%98%E4%BB%BF%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85FM/"/>
      <url>/2017/09/12/Swift-3-0-%E9%AB%98%E4%BB%BF%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85FM/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>åŸºäºSwift 3.0 ç¼–å†™è€Œæˆ,è¿è¡Œç¯å¢ƒè¦æ±‚: Xcode 8.0</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h1 id="é«˜ä»¿å–œé©¬æ‹‰é›…FM"><a href="#é«˜ä»¿å–œé©¬æ‹‰é›…FM" class="headerlink" title="é«˜ä»¿å–œé©¬æ‹‰é›…FM"></a>é«˜ä»¿å–œé©¬æ‹‰é›…FM</h1><p>gitHub: <a href="https://github.com/LinXunFeng/LXFFM" target="_blank" rel="noopener">https://github.com/LinXunFeng/LXFFM</a></p><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>åŸºäºSwift 3.0 ç¼–å†™è€Œæˆ,è¿è¡Œç¯å¢ƒè¦æ±‚: Xcode 8.0</p><h2 id="LXFFM"><a href="#LXFFM" class="headerlink" title="LXFFM"></a>LXFFM</h2><p>åŸOCç‰ˆ: <a href="https://github.com/Eastwu5788/XMLYFM" target="_blank" rel="noopener">https://github.com/Eastwu5788/XMLYFM</a><br>ä»åŸç‰ˆä½œè€…çš„æºä»£ç ä¸Šå­¦åˆ°äº†å¾ˆå¤š,ååˆ†æ„Ÿè°¢.<br>ç”±äºåªæ˜¯æœ¬äººOCè½¬Swiftçš„è¯•ç»ƒé¡¹ç›®,æ‰€ä»¥æœ‰äº›å†…å®¹å¹¶æ²¡æœ‰å®ç°,å“ˆå“ˆ</p><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/1.gif" alt="æ¨è"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/2.gif" alt="åˆ†ç±»"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/3.gif" alt="å¹¿æ’­"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/4.gif" alt="æ¦œå•"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/5.gif" alt="ä¸»æ’­"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/6.gif" alt="è®¢é˜…å¬"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/7.gif" alt="ä¸‹è½½å¬"></p><p><img src="https://github.com/LinXunFeng/LXFFM/raw/master/Screenshots/8.gif" alt="æˆ‘çš„"></p><div class="github-widget" data-repo="LinXunFeng/LXFFM"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift UITableViewçš„scrollToRowçš„å‘</title>
      <link href="/2017/09/12/iOS-Swift-UITableView%E7%9A%84scrollToRow%E7%9A%84%E5%9D%91/"/>
      <url>/2017/09/12/iOS-Swift-UITableView%E7%9A%84scrollToRow%E7%9A%84%E5%9D%91/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>ä»Šå¤©é„™äººä½¿ç”¨SnapKitæ¥å¸ƒå±€cellï¼Œç„¶åç”¨scrollToRowæ¥æ»šåˆ°åº•éƒ¨å°±é‡åˆ°äº†ä¸€ä¸ªå¾ˆå¥‡è‘©çš„ç°è±¡ã€‚<br>æˆ‘è®¾ç½®äº†åœ¨é”®ç›˜å¼¹å‡ºåèŠå¤©æ¶ˆæ¯åˆ—è¡¨ä¼šè‡ªåŠ¨æ»šåˆ°åº•éƒ¨ã€‚<br>1.éšä¾¿è¾“å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œç‚¹å‘é€åï¼Œåœ¨èŠå¤©æ¶ˆæ¯åˆ—è¡¨ä¸­å¹¶æ²¡æœ‰æ»šåˆ°æœ€æ–°æ¶ˆæ¯é‚£ä¸€è¡Œã€‚<br>2.é€€å‡ºé”®ç›˜ä¸åšä»»ä½•æ“ä½œå†æ‰“å¼€é”®ç›˜ä¹Ÿæ˜¯æ»šåˆ°åˆšæ‰é‚£é‡Œ(å³æœ€æ–°æ¶ˆæ¯çš„ä¸Šä¸€æ¡æ‰€åœ¨ä½ç½®)<br>3.åªæœ‰åœ¨é€€å‡ºé”®ç›˜åæŠŠèŠå¤©æ¶ˆæ¯åˆ—è¡¨çš„æ¶ˆæ¯å‘ä¸Šæ‹‰ä¸€ç‚¹è·ç¦»éœ²å‡ºæœ€æ–°æ¶ˆæ¯æ‰€åœ¨çš„cellä¹‹åï¼Œå†ç‚¹å‡»æ‰æœ‰ç”¨</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨tableViewä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åˆ°scrollToRowè¿™ä¸ªæ¥æ§åˆ¶tableViewæ»šåˆ°æŒ‡å®šçš„æŸä¸€è¡Œã€‚ä¸€èˆ¬å†™æ³•å¦‚ä¸‹æ‰€ç¤º<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: æ»šåˆ°åº•éƒ¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scrollToBottom</span><span class="params">(animated: Bool = <span class="literal">false</span>)</span></span> &#123;</span><br><span class="line">Â  Â  <span class="keyword">if</span> dataArr.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">Â  Â  Â  Â  tableView.scrollToRow(at: <span class="type">IndexPath</span>(row: dataArr.<span class="built_in">count</span> - <span class="number">1</span>, section: <span class="number">0</span>), at: .bottom, animated: animated)</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æƒ…å†µ"><a href="#æƒ…å†µ" class="headerlink" title="æƒ…å†µ"></a>æƒ…å†µ</h2><p>ä»Šå¤©é„™äººä½¿ç”¨SnapKitæ¥å¸ƒå±€cellï¼Œç„¶åç”¨scrollToRowæ¥æ»šåˆ°åº•éƒ¨å°±é‡åˆ°äº†ä¸€ä¸ªå¾ˆå¥‡è‘©çš„ç°è±¡ã€‚<br>æˆ‘è®¾ç½®äº†åœ¨é”®ç›˜å¼¹å‡ºåèŠå¤©æ¶ˆæ¯åˆ—è¡¨ä¼šè‡ªåŠ¨æ»šåˆ°åº•éƒ¨ã€‚<br>1.éšä¾¿è¾“å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œç‚¹å‘é€åï¼Œåœ¨èŠå¤©æ¶ˆæ¯åˆ—è¡¨ä¸­å¹¶æ²¡æœ‰æ»šåˆ°æœ€æ–°æ¶ˆæ¯é‚£ä¸€è¡Œã€‚<br>2.é€€å‡ºé”®ç›˜ä¸åšä»»ä½•æ“ä½œå†æ‰“å¼€é”®ç›˜ä¹Ÿæ˜¯æ»šåˆ°åˆšæ‰é‚£é‡Œ(å³æœ€æ–°æ¶ˆæ¯çš„ä¸Šä¸€æ¡æ‰€åœ¨ä½ç½®)<br>3.åªæœ‰åœ¨é€€å‡ºé”®ç›˜åæŠŠèŠå¤©æ¶ˆæ¯åˆ—è¡¨çš„æ¶ˆæ¯å‘ä¸Šæ‹‰ä¸€ç‚¹è·ç¦»éœ²å‡ºæœ€æ–°æ¶ˆæ¯æ‰€åœ¨çš„cellä¹‹åï¼Œå†ç‚¹å‡»æ‰æœ‰ç”¨<br><img src="/images/2017/09/iOS - Swift UITableViewçš„scrollToRowçš„&quot;å‘&quot;/1.gif" alt=""></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åœ¨æ— å¥ˆä¹‹ä¸‹ï¼Œç»è¿‡äº†ä¸€æ­¥æ­¥çš„æ¢ç´¢ï¼Œç»ˆäºå‘ç°äº†é—®é¢˜çš„æ‰€åœ¨<br>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä¸€ä¸‹scrollToRowæ‰§è¡Œåä¼šè°ƒç”¨å“ªäº›å‡½æ•°åŠé¡ºåº<br><strong>ä¼šè°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•</strong><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span></span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, heightForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">CGFloat</span></span><br></pre></td></tr></table></figure><h3 id="æ­¥éª¤ä¸€"><a href="#æ­¥éª¤ä¸€" class="headerlink" title="æ­¥éª¤ä¸€"></a>æ­¥éª¤ä¸€</h3><p>æˆ‘åœ¨ heightForRow ä¸­å†™äº†å…·ä½“çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æŠŠé«˜åº¦å†™æ­»ï¼Œä¸å†æ˜¯åŠ¨æ€è·å–ã€‚æ¥ç€æ‰§è¡Œç¨‹åºå¾—åˆ°å¦‚ä¸‹ç»“æœ<br>æ¯”å¦‚æˆ‘åŸæœ¬æœ‰10æ¡æ•°æ®ï¼Œç°åœ¨åŠ å…¥äº†ä¸€æ¡åæ‰§è¡Œäº†scrollToRowï¼Œå®ƒä¼š<br>1.å…ˆè°ƒç”¨ heightForRow 11æ¬¡ï¼Œ<strong>å³åŒ…æ‹¬æœ€æ–°åŠ å…¥çš„é‚£ä¸€æ¡</strong><br>2.ç„¶åå†è°ƒç”¨ cellForRow<br>3.æœ€ååœ¨è°ƒä¸€æ¬¡ heightForRow<br>åé¢çš„2å’Œ3æ˜¯é’ˆå¯¹æœ€æ–°æ¶ˆæ¯çš„</p><h3 id="æ­¥éª¤äºŒ"><a href="#æ­¥éª¤äºŒ" class="headerlink" title="æ­¥éª¤äºŒ"></a>æ­¥éª¤äºŒ</h3><p>æˆ‘åœ¨ heightForRow ä¸­ä¸å†å†™æ­»é«˜åº¦ï¼Œè€Œæ˜¯ä»æ¨¡å‹æ•°æ®ä¸­åŠ¨æ€è·å–é«˜åº¦(é«˜åº¦æ˜¯åœ¨cellå¸ƒå±€åè·å–çš„ï¼Œå†èµ‹å€¼åˆ°æ¨¡å‹æ•°æ®ä¸­çš„cellHeightå˜é‡)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œç¨‹åºå¾—åˆ°è¿™ä¸ªç»“æœï¼šè°ƒç”¨ heightForRow 11æ¬¡ï¼Œç„¶åå°±æ²¡äº†</span><br></pre></td></tr></table></figure></p><p>å¥½å§ï¼Œé—®é¢˜å°±å‡ºç°åœ¨å¯¹heightForRowçš„ç¬¬11æ¬¡è°ƒç”¨ï¼Œå‰10æ¬¡éƒ½æœ‰è¿”å›å…·ä½“çš„é«˜åº¦ï¼Œè€Œæœ€åä¸€æ¬¡æ˜¯0~ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p><strong>ç°åœ¨æ¸…æ¥šäº†ï¼Œè¦æƒ³åœ¨è°ƒç”¨ scrollToRow åˆ°æŒ‡å®šçš„é‚£ä¸€è¡Œï¼Œå‰ææ¡ä»¶æ˜¯é‚£ä¸€è¡Œçš„é«˜åº¦ä¸èƒ½ä¸º0ã€‚</strong><br>æ‰€ä»¥åœ¨ä¸Šé¢çš„æƒ…å†µä¸­ï¼Œå‘é€å®Œæ¶ˆæ¯åï¼Œæœ€æ–°æ¶ˆæ¯çš„cellçš„ç¡®æ˜¯æ’å…¥åˆ°äº†tableViewï¼Œä¹Ÿæœ‰æ˜¾ç¤ºå‡ºæ¥(åé¢æˆ‘è‡ªå·±æµ‹çš„)ï¼Œä½†å°±æ˜¯æ— æ³•æ»šåˆ°æœ€æ–°æ¶ˆæ¯é‚£ä¸€è¡Œï¼Œå°±æ˜¯å› ä¸º heightForRow è¿”å›çš„é«˜åº¦ä¸º0<br>åœ¨ä¸Šé¢çš„æƒ…å†µä¸­ï¼Œå‘ä¸Šæ‹‰ä¸€ç‚¹è·ç¦»éœ²å‡ºcellåscrollToRowæ‰æœ‰æ•ˆå°±æ˜¯å› ä¸ºæ­¤æ—¶heightForRowè¿”å›çš„é«˜åº¦ä¸å†ä¸º0</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æŒ‰æœ¬äººè‡ªèº«çš„æƒ…å†µæ¥è¯´ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•</p><h3 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h3><p>åœ¨ä¼ å…¥çš„æ¨¡å‹æ•°æ®ä¸­ç»™äºˆæ˜ç¡®è®¡ç®—å‡ºæ¥çš„æ•°å€¼å°±å¥½ã€‚</p><h3 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h3><p>æˆ‘ä½¿ç”¨SnapKitæ¥è‡ªåŠ¨å¸ƒå±€cellçš„ä½ç½®ç„¶åå†æ¥è·å–é«˜åº¦ï¼Œè¿™åšæ³•ä¸»è¦å°±æ˜¯ä¸ºäº†é¿å…è¿ç®—ã€‚æ‰€ä»¥æˆ‘ä¸é€‰ç”¨ç¬¬ä¸€ç§è§£å†³æ–¹æ³•<br>å¥½äº†ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dataArræ˜¯ç”¨æ¥å­˜æ”¾æ¨¡å‹çš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(row: dataArr.<span class="built_in">count</span> - <span class="number">1</span>, section: <span class="number">0</span>)</span><br><span class="line"><span class="comment">// è°ƒç”¨tableViewçš„æ•°æ®æºåŠæ³•</span></span><br><span class="line"><span class="number">_</span> = <span class="keyword">self</span>.tableView(tableView, cellForRowAt: indexPath)</span><br></pre></td></tr></table></figure></p><p>åœ¨æ’å…¥æœ€æ–°æ¶ˆæ¯åï¼Œè°ƒç”¨tableViewçš„æ•°æ®æºæ–¹æ³•æ¥è®©å®ƒå…ˆå¯¹cellè¿›è¡Œå¸ƒå±€ï¼Œè¿™æ ·å°±è·å–åˆ°äº†cellçš„é«˜åº¦ï¼Œç„¶åå†æ‰§è¡Œ scrollToRow å°±å¥½äº†ã€‚<br><img src="/images/2017/09/iOS - Swift UITableViewçš„scrollToRowçš„&quot;å‘&quot;/2.gif" alt="å®Œç¾"></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º</title>
      <link href="/2017/09/12/iOS-Swift-%E4%BB%BF%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA/"/>
      <url>/2017/09/12/iOS-Swift-%E4%BB%BF%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>å…¶å®åŸç†æ¯”è¾ƒç®€å•ï¼Œå‡†å¤‡ä¸€å¼ å›¾ç‰‡MaskImgaeï¼Œå…ˆå¯¹å…¶è¿›è¡Œæ‹‰ä¼¸ï¼Œç„¶åæŒ‰ç…§å…¶è½®å»“å¯¹å›¾ç‰‡è¿›è¡Œè£å‰ªå°±è¡Œäº†</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><p>å¦‚å›¾æ‰€ç¤ºï¼Œå›¾ç‰‡å·¦ä¾§æœ‰ä¸ªå°ç®­å¤´<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/1.png" alt="æ•ˆæœå›¾"></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å…¶å®åŸç†æ¯”è¾ƒç®€å•ï¼Œå‡†å¤‡ä¸€å¼ å›¾ç‰‡MaskImgaeï¼Œå…ˆå¯¹å…¶è¿›è¡Œæ‹‰ä¼¸ï¼Œç„¶åæŒ‰ç…§å…¶è½®å»“å¯¹å›¾ç‰‡è¿›è¡Œè£å‰ªå°±è¡Œäº†<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/2.png" alt="MaskImgae"></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>è¿™é‡Œæ‘˜é‡ç‚¹è¯´ï¼Œå¸ƒå±€ä»€ä¹ˆçš„æŒ‰è‡ªå·±æ„æ„¿å»å¼„å§ã€‚æˆ‘å›ºå®šäº†å›¾ç‰‡çš„æ˜¾ç¤ºå¤§å°ä¸º 102 * 152</p><h3 id="1ã€å¯¹MaskImgaeè¿›è¡Œæ‹‰ä¼¸"><a href="#1ã€å¯¹MaskImgaeè¿›è¡Œæ‹‰ä¼¸" class="headerlink" title="1ã€å¯¹MaskImgaeè¿›è¡Œæ‹‰ä¼¸"></a>1ã€å¯¹MaskImgaeè¿›è¡Œæ‹‰ä¼¸</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®æ‹‰ä¼¸èŒƒå›´</span></span><br><span class="line"><span class="keyword">let</span> stretchInsets = <span class="type">UIEdgeInsetsMake</span>(<span class="number">30</span>, <span class="number">28</span>, <span class="number">23</span>, <span class="number">28</span>)</span><br><span class="line"><span class="comment">// å¾…æ‹‰ä¼¸çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">let</span> stretchImage = <span class="type">UIImage</span>(named: <span class="string">"SenderImageNodeMask"</span>)</span><br><span class="line"><span class="comment">// è¿›è¡Œæ‹‰ä¼¸</span></span><br><span class="line"><span class="keyword">let</span> bubbleMaskImage = stretchImage.resizableImage(withCapInsets: stretchInsets, resizingMode: .stretch)</span><br></pre></td></tr></table></figure><p>æ‹‰ä¼¸çš„æ•ˆæœå¦‚å›¾<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/3.png" alt="æ‹‰ä¼¸æ•ˆæœ"></p><h3 id="2ã€å¯¹imageViewè®¾ç½®è£å‰ªåŒºåŸŸ"><a href="#2ã€å¯¹imageViewè®¾ç½®è£å‰ªåŒºåŸŸ" class="headerlink" title="2ã€å¯¹imageViewè®¾ç½®è£å‰ªåŒºåŸŸ"></a>2ã€å¯¹imageViewè®¾ç½®è£å‰ªåŒºåŸŸ</h3><p>è¿™é‡Œæˆ‘çš„ imageView å«   chatImgView<br>ä¸Šé¢çš„æ‹‰ä¼¸æ•ˆæœå›¾æ˜¯ä¸´æ—¶æŠŠæ‹‰ä¼¸å¥½çš„å›¾ç‰‡èµ‹å€¼ç»™äº†chatImgViewï¼Œåªæ˜¯ä¸ºäº†ç»™å¤§å®¶çœ‹åˆ°æ•ˆæœè€Œå·²ï¼Œå„ä½çœ‹å®˜å¦‚æœæœ‰èµ‹å€¼è¯·è®°å¾—æ”¹å›æ¥~~</p><p><strong>å¥½ï¼Œä¸‹é¢è¿›è¡Œè£å‰ª</strong><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–°å»ºä¸€ä¸ªå›¾å±‚</span></span><br><span class="line"><span class="keyword">let</span> layer = <span class="type">CALayer</span>()</span><br><span class="line"><span class="comment">// è®¾ç½®å›¾å±‚æ˜¾ç¤ºçš„å†…å®¹ä¸ºæ‹‰ä¼¸è¿‡çš„MaskImgae</span></span><br><span class="line">layer.contents = bubbleMaskImage.cgImage</span><br><span class="line"><span class="comment">// è®¾ç½®æ‹‰ä¼¸èŒƒå›´(æ³¨æ„ï¼šè¿™é‡ŒcontentsCenterçš„CGRectæ˜¯æ¯”ä¾‹ï¼ˆä¸æ˜¯ç»å¯¹åæ ‡ï¼‰)</span></span><br><span class="line">layer.contentsCenter = <span class="keyword">self</span>.<span class="type">CGRectCenterRectForResizableImage</span>(bubbleMaskImage)</span><br><span class="line"><span class="comment">// è®¾ç½®å›¾å±‚å¤§å°ä¸chatImgViewç›¸åŒ</span></span><br><span class="line">layer.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">102</span>, height: <span class="number">152</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æ¯”ä¾‹</span></span><br><span class="line">layer.contentsScale = <span class="type">UIScreen</span>.main.scale</span><br><span class="line"><span class="comment">// è®¾ç½®ä¸é€æ˜åº¦</span></span><br><span class="line">layer.opacity = <span class="number">1</span></span><br><span class="line"><span class="comment">// è®¾ç½®è£å‰ªèŒƒå›´</span></span><br><span class="line"><span class="keyword">self</span>.chatImgView.layer.mask = layer</span><br><span class="line"><span class="comment">// è®¾ç½®è£å‰ªæ‰è¶…å‡ºçš„åŒºåŸŸ</span></span><br><span class="line"><span class="keyword">self</span>.chatImgView.layer.masksToBounds = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CGRectCenterRectForResizableImage</span><span class="params">(<span class="number">_</span> image: UIImage)</span></span> -&gt; <span class="type">CGRect</span> &#123;</span><br><span class="line">    <span class="comment">// LXFLog("\(image.capInsets)")</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„image.capInsetså°±æ˜¯UIEdgeInsetsMake(30, 28, 23, 28)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">CGRect</span>(</span><br><span class="line">        x: image.capInsets.<span class="keyword">left</span> / image.size.width,</span><br><span class="line">        y: image.capInsets.top / image.size.height,</span><br><span class="line">        width: (image.size.width - image.capInsets.<span class="keyword">right</span> - image.capInsets.<span class="keyword">left</span>) / image.size.width,</span><br><span class="line">        height: (image.size.height - image.capInsets.bottom - image.capInsets.top) / image.size.height</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†</p><h2 id="è§£é‡Šä¸€ä¸‹ä¸‹"><a href="#è§£é‡Šä¸€ä¸‹ä¸‹" class="headerlink" title="è§£é‡Šä¸€ä¸‹ä¸‹"></a>è§£é‡Šä¸€ä¸‹ä¸‹</h2><h3 id="UIEdgeInsetsMake"><a href="#UIEdgeInsetsMake" class="headerlink" title="UIEdgeInsetsMake"></a>UIEdgeInsetsMake</h3><p>MaskImgae çš„å¤§å°ä¸º 56 * 50<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIEdgeInsetsMake(top: CGFloat, left: CGFloat, bottom: CGFloat, right: CGFloat)</span></span><br><span class="line"><span class="type">UIEdgeInsetsMake</span>(<span class="number">30</span>, <span class="number">28</span>, <span class="number">23</span>, <span class="number">28</span>)</span><br></pre></td></tr></table></figure></p><p>çº¢è‰²èŒƒå›´å°±æ˜¯è¦æ‹‰ä¼¸çš„èŒƒå›´(éšæ‰‹ä¸€æ‰£ï¼Œä¸å¤ªå‡†ç¡®ï¼Œæ„æ€æ„æ€ä¸‹å°±å¥½äº†~~)<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/4.png" alt="æ‹‰ä¼¸åŒºåŸŸ"></p><h3 id="contentsCenter"><a href="#contentsCenter" class="headerlink" title="contentsCenter"></a>contentsCenter</h3><p>è¿™æ˜¯å¯¹æŸä¸ªåŒºåŸŸè¿›è¡Œå…¨é¢æ‹‰ä¼¸ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯é»˜è®¤å€¼ä¸º<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">1</span>, height: <span class="number">1</span>)</span><br></pre></td></tr></table></figure></p><p>å°±æ˜¯ç›´æ¥è¿›è¡Œç¼©æ”¾<br>é‚£æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œå¦‚æœä¸å¯¹contentsCenterè¿™ä¸ªå€¼è¿›è¡Œè®¾ç½®ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœ<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/5.png" alt="ç›´æ¥æ‹‰ä¼¸"><br>æˆ‘ä»¬æ¥çœ‹ä¸‹å®˜æ–¹è§£é‡Š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> contentsCenter: <span class="type">CGRect</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line"><span class="type">Description</span></span><br><span class="line"><span class="type">The</span> rectangle that defines how the layer contents are scaled</span><br><span class="line"><span class="keyword">if</span> the layerâ€™s contents are resized. <span class="type">Animatable</span>.</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘ï¼šå¦‚æœå›¾å±‚çš„å†…å®¹æ˜¯é‡æ–°è®¾ç½®äº†å°ºå¯¸çš„ï¼Œé‚£å®šä¹‰çš„è¿™ä¸ªçŸ©å½¢(contentsCenter)æ˜¯ä¸ºäº†å‘Šè¯‰å›¾å±‚ï¼Œå›¾å±‚çš„å†…å®¹æ˜¯å¦‚ä½•è¢«ç¼©æ”¾çš„</p><p>é‚£æ˜äº†ï¼Œæˆ‘ä»¬çš„å›¾ç‰‡æ˜¯è¢«æ‹‰ä¼¸åå†ç»˜åˆ¶åˆ°layerä¸Šçš„ï¼Œä¸ºäº†æ­£ç¡®æ˜¾ç¤ºæˆ‘ä»¬çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¾—å‘Šè¯‰layerå®ƒæ˜¯æ€ä¹ˆè¢«è¿›è¡Œæ‹‰ä¼¸çš„ã€‚æ˜¯çš„ï¼Œå°±æ˜¯ä¸‹é¢ä»£ç æ‰€æŒ‡å®šçš„èŒƒå›´<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIEdgeInsetsMake</span>(<span class="number">30</span>, <span class="number">28</span>, <span class="number">23</span>, <span class="number">28</span>)</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ï¼Œæ­£å¦‚ä¸Šé¢æåˆ°è¿‡çš„ï¼ŒcontentsCenteræ‰€è¦èµ‹å€¼çš„CGRectæ˜¯æ¯”ä¾‹ï¼Œä¸æ˜¯ç»å¯¹åæ ‡ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¾—é€šè¿‡(30, 28, 23, 28)è·å–æ¯”ä¾‹å€¼ï¼Œè½¬æ¢æ–¹æ³•å·²ç»åœ¨ä¸Šé¢ç»™å‡ºäº†ï¼Œå°±æ˜¯CGRectCenterRectForResizableImage<br>æˆ‘ä»¬æ¥æ‰“å°ä¸‹ image.capInsetsçš„å†…å®¹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LXFLog</span>(<span class="string">"\(image.capInsets)"</span>)</span><br><span class="line"><span class="type">LXFLog</span>(<span class="string">"\(image.capInsets.top)"</span>)</span><br><span class="line"><span class="type">LXFLog</span>(<span class="string">"\(image.capInsets.bottom)"</span>)</span><br><span class="line"><span class="type">LXFLog</span>(<span class="string">"\(image.capInsets.left)"</span>)</span><br><span class="line"><span class="type">LXFLog</span>(<span class="string">"\(image.capInsets.right)"</span>)</span><br></pre></td></tr></table></figure></p><p>æ‰“å°ç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UIEdgeInsets(top: 30.0, left: 28.0, bottom: 23.0, right: 28.0)</span><br><span class="line">30.0</span><br><span class="line">23.0</span><br><span class="line">28.0</span><br><span class="line">28.0</span><br></pre></td></tr></table></figure></p><p>å¥½ï¼Œç°åœ¨ç»“åˆ ä¸‹é¢çš„å›¾ ä¸ CGRectCenterRectForResizableImage æ–¹æ³•ä¸­çš„ä»£ç å°±å¾ˆæ˜ç¡®æ¯”ä¾‹æ˜¯æ€ä¹ˆå–åˆ°çš„äº†<br><img src="/images/2017/09/iOS - Swift ä»¿å¾®ä¿¡èŠå¤©å›¾ç‰‡æ˜¾ç¤º/6.png" alt="æ‹‰ä¼¸åŒºåŸŸ"></p><p>é™„ä¸Šç›¸å…³é¡¹ç›®ï¼š<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">Swift 3.0 é«˜ä»¿å¾®ä¿¡</a></p><div class="github-widget" data-repo="LinXunFeng/LXFWeChat"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜</title>
      <link href="/2017/09/12/iOS-Swift-UICollectionView%E6%A8%AA%E5%90%91%E5%88%86%E9%A1%B5%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2017/09/12/iOS-Swift-UICollectionView%E6%A8%AA%E5%90%91%E5%88%86%E9%A1%B5%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è§£å†³ï¼Œæ•°æ®åªæœ‰11ä¸ªï¼Œè¦åˆ†ä¸¤é¡µéœ€è¦16ä¸ªï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç›´æ¥æ·»åŠ æ•°æ®åˆ°16ä¸ªï¼Œç„¶ååœ¨dataSourceä¸­è¿”å›cellæ—¶è¿›è¡Œåˆ¤æ–­åŠå¤„ç†å³å¯ã€‚ä¸è¿‡å¯¹äºç°åœ¨æ¥è¯´å¤ªå°é¢˜å¤§åšäº†ï¼Œæˆ‘é€‰ç¬¬äºŒç§æ–¹å¼~</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h1 id="UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜"><a href="#UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜" class="headerlink" title="UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜"></a>UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜</h1><h2 id="æƒ…å†µ"><a href="#æƒ…å†µ" class="headerlink" title="æƒ…å†µ"></a>æƒ…å†µ</h2><p>ç›´æ¥çœ‹å›¾<br><img src="/images/2017/09/iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜/1.png" alt="æ»šå‰"><br><img src="/images/2017/09/iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜/2.png" alt="æ»šå"><br>å·²ç»è®¾ç½®collectionViewçš„isPagingEnabledä¸ºtrueäº†ï¼Œå¯æ˜¯å‡ºç°äº†è¿™ç§æƒ…å†µï¼ŒåŸå› å°±æ˜¯collectionViewçš„contentSizeä¸å¤Ÿã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;UICollectionView: 0x7fc565076000; </span><br><span class="line">frame = (0 0; 375 197); </span><br><span class="line">clipsToBounds = YES; </span><br><span class="line">gestureRecognizers = &lt;NSArray: 0x6180000557e0&gt;; </span><br><span class="line">layer = &lt;CALayer: 0x61000022a5a0&gt;; </span><br><span class="line">contentOffset: &#123;187.5, 0&#125;; </span><br><span class="line">contentSize: &#123;562.5, 192.25&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è§£å†³ï¼Œæ•°æ®åªæœ‰11ä¸ªï¼Œè¦åˆ†ä¸¤é¡µéœ€è¦16ä¸ªï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç›´æ¥æ·»åŠ æ•°æ®åˆ°16ä¸ªï¼Œç„¶ååœ¨dataSourceä¸­è¿”å›cellæ—¶è¿›è¡Œåˆ¤æ–­åŠå¤„ç†å³å¯ã€‚ä¸è¿‡å¯¹äºç°åœ¨æ¥è¯´å¤ªå°é¢˜å¤§åšäº†ï¼Œæˆ‘é€‰ç¬¬äºŒç§æ–¹å¼~</p><h3 id="ç›´æ¥ä¿®æ”¹contentSize"><a href="#ç›´æ¥ä¿®æ”¹contentSize" class="headerlink" title="ç›´æ¥ä¿®æ”¹contentSize"></a>ç›´æ¥ä¿®æ”¹contentSize</h3><p>æˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿äºUICollectionViewFlowLayoutçš„Layout(LXFChatMoreCollectionLayout)ï¼Œè®©UICollectionViewåœ¨åˆ›å»ºçš„æ—¶å€™ä½¿ç”¨äº†å®ƒ</p><p>åœ¨ LXFChatMoreCollectionLayout.swift ä¸­æˆ‘ä»¬éœ€è¦é‡å†™çˆ¶ç±»çš„collectionViewContentSizeï¼Œå°†contentSizeå–å‡ºæ¥ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„newSizeå°±å¯ä»¥äº†ä»£ç å¦‚ä¸‹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">var</span> collectionViewContentSize: <span class="type">CGSize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> size: <span class="type">CGSize</span> = <span class="keyword">super</span>.collectionViewContentSize</span><br><span class="line">    <span class="keyword">let</span> collectionViewWidth: <span class="type">CGFloat</span> = <span class="keyword">self</span>.collectionView!.frame.size.width</span><br><span class="line">    <span class="keyword">let</span> nbOfScreen: <span class="type">Int</span> = <span class="type">Int</span>(ceil(size.width / collectionViewWidth))</span><br><span class="line">    <span class="keyword">let</span> newSize: <span class="type">CGSize</span> = <span class="type">CGSize</span>(width: collectionViewWidth * <span class="type">CGFloat</span>(nbOfScreen), height: size.height)</span><br><span class="line">    <span class="keyword">return</span> newSize</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨ï¼šceilå‡½æ•°çš„ä½œç”¨æ˜¯æ±‚ä¸å°äºç»™å®šå®æ•°çš„æœ€å°æ•´æ•°ã€‚ceil(2)=ceil(1.2)=cei(1.5)=2.00</p><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="/images/2017/09/iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µçš„é—®é¢˜/3.png" alt=""></p><p>è‡³äºå¦‚ä½•è®©itemæ°´å¹³å¸ƒå±€ï¼Œè¯·å‚è€ƒ<a href="/2017/09/12/[iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ](http://linxunfeng.top/2017/09/12/iOS-Swift-UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ/">ã€ŠiOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆã€‹</a></p><p>é™„ä¸Šç›¸å…³é¡¹ç›®ï¼š<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">Swift 3.0 é«˜ä»¿å¾®ä¿¡</a></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - Swift UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ</title>
      <link href="/2017/09/12/iOS-Swift-UICollectionView%E6%A8%AA%E5%90%91%E5%88%86%E9%A1%B5%E6%BB%9A%E5%8A%A8%EF%BC%8Ccell%E5%B7%A6%E5%8F%B3%E6%8E%92%E7%89%88/"/>
      <url>/2017/09/12/iOS-Swift-UICollectionView%E6%A8%AA%E5%90%91%E5%88%86%E9%A1%B5%E6%BB%9A%E5%8A%A8%EF%BC%8Ccell%E5%B7%A6%E5%8F%B3%E6%8E%92%E7%89%88/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>æœ€è¿‘åœ¨åšè¡¨æƒ…é”®ç›˜æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ç”¨UICollectionViewæ¥å¸ƒå±€è¡¨æƒ…ï¼Œä½¿ç”¨æ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œä½†åœ¨æœ€åä¸€é¡µå‡ºç°äº†å¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µ</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="æƒ…å†µ"><a href="#æƒ…å†µ" class="headerlink" title="æƒ…å†µ"></a>æƒ…å†µ</h2><p>æœ€è¿‘åœ¨åšè¡¨æƒ…é”®ç›˜æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ç”¨UICollectionViewæ¥å¸ƒå±€è¡¨æƒ…ï¼Œä½¿ç”¨æ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œä½†åœ¨æœ€åä¸€é¡µå‡ºç°äº†å¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µ<br><img src="/images/2017/09/iOS-Swift-UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ/1.png" alt="åªæ˜¾ç¤ºä¸€åŠ"></p><h3 id="æƒ…å†µåˆ†æå›¾"><a href="#æƒ…å†µåˆ†æå›¾" class="headerlink" title="æƒ…å†µåˆ†æå›¾"></a>æƒ…å†µåˆ†æå›¾</h3><p>æ˜¯çš„ï¼Œç°åœ¨çš„itemåˆ†å¸ƒå°±æ˜¯è¿™ä¸ªé¬¼æ ·å­<br><img src="/images/2017/09/iOS-Swift-UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ/2.jpeg" alt="ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³"><br>ç°åœ¨æƒ³è¦åšçš„ï¼Œå°±æ˜¯å°†ç°åœ¨è¿™ä¸ªé¬¼æ ·å­å˜æˆå¦å¤–ä¸€ç§æ ·å­ï¼Œå¦‚å›¾<br><img src="/images/2017/09/iOS-Swift-UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ/3.jpeg" alt="ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹"><br>é‚£æ€ä¹ˆåŠï¼Ÿåªå¥½é‡æ–°å¸ƒå±€itemäº†</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æˆ‘æ˜¯è‡ªå®šäº†ä¸€ä¸ªLayout(LXFChatEmotionCollectionLayout)ï¼Œè®©UICollectionViewåœ¨åˆ›å»ºçš„æ—¶å€™ä½¿ç”¨äº†å®ƒ</p><p>åœ¨ LXFChatEmotionCollectionLayout.swift ä¸­</p><h3 id="æ·»åŠ ä¸€ä¸ªå±æ€§æ¥ä¿å­˜æ‰€æœ‰itemçš„attributes"><a href="#æ·»åŠ ä¸€ä¸ªå±æ€§æ¥ä¿å­˜æ‰€æœ‰itemçš„attributes" class="headerlink" title="æ·»åŠ ä¸€ä¸ªå±æ€§æ¥ä¿å­˜æ‰€æœ‰itemçš„attributes"></a>æ·»åŠ ä¸€ä¸ªå±æ€§æ¥ä¿å­˜æ‰€æœ‰itemçš„attributes</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜æ‰€æœ‰itemçš„attributes</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> attributesArr: [<span class="type">UICollectionViewLayoutAttributes</span>] = []</span><br></pre></td></tr></table></figure><h3 id="é‡æ–°å¸ƒå±€"><a href="#é‡æ–°å¸ƒå±€" class="headerlink" title="é‡æ–°å¸ƒå±€"></a>é‡æ–°å¸ƒå±€</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK:- é‡æ–°å¸ƒå±€</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.prepare()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> itemWH: <span class="type">CGFloat</span> = kScreenW / <span class="type">CGFloat</span>(kEmotionCellNumberOfOneRow)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®itemSize</span></span><br><span class="line">    itemSize = <span class="type">CGSize</span>(width: itemWH, height: itemWH)</span><br><span class="line">    minimumLineSpacing = <span class="number">0</span></span><br><span class="line">    minimumInteritemSpacing = <span class="number">0</span></span><br><span class="line">    scrollDirection = .horizontal</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®collectionViewå±æ€§</span></span><br><span class="line">    collectionView?.isPagingEnabled = <span class="literal">true</span></span><br><span class="line">    collectionView?.showsHorizontalScrollIndicator = <span class="literal">false</span></span><br><span class="line">    collectionView?.showsVerticalScrollIndicator = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">let</span> insertMargin = (collectionView!.bounds.height - <span class="number">3</span> * itemWH) * <span class="number">0.5</span></span><br><span class="line">    collectionView?.contentInset = <span class="type">UIEdgeInsetsMake</span>(insertMargin, <span class="number">0</span>, insertMargin, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// é‡ç‚¹åœ¨è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">var</span> page = <span class="number">0</span></span><br><span class="line">    <span class="keyword">let</span> itemsCount = collectionView?.numberOfItems(inSection: <span class="number">0</span>) ?? <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> itemIndex <span class="keyword">in</span> <span class="number">0</span>..&lt;itemsCount &#123;</span><br><span class="line">        <span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: itemIndex, section: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">let</span> attributes = <span class="type">UICollectionViewLayoutAttributes</span>(forCellWith: indexPath)</span><br><span class="line">        </span><br><span class="line">        page = itemIndex / (kEmotionCellNumberOfOneRow * kEmotionCellRow)</span><br><span class="line">        <span class="comment">// é€šè¿‡ä¸€ç³»åˆ—è®¡ç®—, å¾—åˆ°x, yå€¼</span></span><br><span class="line">        <span class="keyword">let</span> x = itemSize.width * <span class="type">CGFloat</span>(itemIndex % <span class="type">Int</span>(kEmotionCellNumberOfOneRow)) + (<span class="type">CGFloat</span>(page) * kScreenW)</span><br><span class="line">        <span class="keyword">let</span> y = itemSize.height * <span class="type">CGFloat</span>((itemIndex - page * kEmotionCellRow * kEmotionCellNumberOfOneRow) / kEmotionCellNumberOfOneRow)</span><br><span class="line">        </span><br><span class="line">        attributes.frame = <span class="type">CGRect</span>(x: x, y: y, width: itemSize.width, height: itemSize.height)</span><br><span class="line">        <span class="comment">// æŠŠæ¯ä¸€ä¸ªæ–°çš„å±æ€§ä¿å­˜èµ·æ¥</span></span><br><span class="line">        attributesArr.append(attributes)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿”å›æ‰€æœ‰å½“å‰å¯è§çš„Attributes"><a href="#è¿”å›æ‰€æœ‰å½“å‰å¯è§çš„Attributes" class="headerlink" title="è¿”å›æ‰€æœ‰å½“å‰å¯è§çš„Attributes"></a>è¿”å›æ‰€æœ‰å½“å‰å¯è§çš„Attributes</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutAttributesForElements</span><span class="params">(<span class="keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="type">UICollectionViewLayoutAttributes</span>]? &#123;</span><br><span class="line">    <span class="keyword">var</span> rectAttributes: [<span class="type">UICollectionViewLayoutAttributes</span>] = []</span><br><span class="line">    <span class="number">_</span> = attributesArr.<span class="built_in">map</span>(&#123;</span><br><span class="line">        <span class="keyword">if</span> rect.<span class="built_in">contains</span>($<span class="number">0</span>.frame) &#123;</span><br><span class="line">            rectAttributes.append($<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> rectAttributes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤§åŠŸå‘Šæˆ"><a href="#å¤§åŠŸå‘Šæˆ" class="headerlink" title="å¤§åŠŸå‘Šæˆ"></a>å¤§åŠŸå‘Šæˆ</h2><p><img src="/images/2017/09/iOS-Swift-UICollectionViewæ¨ªå‘åˆ†é¡µæ»šåŠ¨ï¼Œcellå·¦å³æ’ç‰ˆ/4.gif" alt=""></p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> kEmotionCellNumberOfOneRow = <span class="number">8</span></span><br><span class="line"><span class="keyword">let</span> kEmotionCellRow = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LXFChatEmotionCollectionLayout</span>: <span class="title">UICollectionViewFlowLayout</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜æ‰€æœ‰item</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> attributesArr: [<span class="type">UICollectionViewLayoutAttributes</span>] = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK:- é‡æ–°å¸ƒå±€</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.prepare()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> itemWH: <span class="type">CGFloat</span> = kScreenW / <span class="type">CGFloat</span>(kEmotionCellNumberOfOneRow)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¾ç½®itemSize</span></span><br><span class="line">        itemSize = <span class="type">CGSize</span>(width: itemWH, height: itemWH)</span><br><span class="line">        minimumLineSpacing = <span class="number">0</span></span><br><span class="line">        minimumInteritemSpacing = <span class="number">0</span></span><br><span class="line">        scrollDirection = .horizontal</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¾ç½®collectionViewå±æ€§</span></span><br><span class="line">        collectionView?.isPagingEnabled = <span class="literal">true</span></span><br><span class="line">        collectionView?.showsHorizontalScrollIndicator = <span class="literal">false</span></span><br><span class="line">        collectionView?.showsVerticalScrollIndicator = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">let</span> insertMargin = (collectionView!.bounds.height - <span class="number">3</span> * itemWH) * <span class="number">0.5</span></span><br><span class="line">        collectionView?.contentInset = <span class="type">UIEdgeInsetsMake</span>(insertMargin, <span class="number">0</span>, insertMargin, <span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> page = <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> itemsCount = collectionView?.numberOfItems(inSection: <span class="number">0</span>) ?? <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> itemIndex <span class="keyword">in</span> <span class="number">0</span>..&lt;itemsCount &#123;</span><br><span class="line">            <span class="keyword">let</span> indexPath = <span class="type">IndexPath</span>(item: itemIndex, section: <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">let</span> attributes = <span class="type">UICollectionViewLayoutAttributes</span>(forCellWith: indexPath)</span><br><span class="line">            </span><br><span class="line">            page = itemIndex / (kEmotionCellNumberOfOneRow * kEmotionCellRow)</span><br><span class="line">            <span class="comment">// é€šè¿‡ä¸€ç³»åˆ—è®¡ç®—, å¾—åˆ°x, yå€¼</span></span><br><span class="line">            <span class="keyword">let</span> x = itemSize.width * <span class="type">CGFloat</span>(itemIndex % <span class="type">Int</span>(kEmotionCellNumberOfOneRow)) + (<span class="type">CGFloat</span>(page) * kScreenW)</span><br><span class="line">            <span class="keyword">let</span> y = itemSize.height * <span class="type">CGFloat</span>((itemIndex - page * kEmotionCellRow * kEmotionCellNumberOfOneRow) / kEmotionCellNumberOfOneRow)</span><br><span class="line">            </span><br><span class="line">            attributes.frame = <span class="type">CGRect</span>(x: x, y: y, width: itemSize.width, height: itemSize.height)</span><br><span class="line">            <span class="comment">// æŠŠæ¯ä¸€ä¸ªæ–°çš„å±æ€§ä¿å­˜èµ·æ¥</span></span><br><span class="line">            attributesArr.append(attributes)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">layoutAttributesForElements</span><span class="params">(<span class="keyword">in</span> rect: CGRect)</span></span> -&gt; [<span class="type">UICollectionViewLayoutAttributes</span>]? &#123;</span><br><span class="line">        <span class="keyword">var</span> rectAttributes: [<span class="type">UICollectionViewLayoutAttributes</span>] = []</span><br><span class="line">        <span class="number">_</span> = attributesArr.<span class="built_in">map</span>(&#123;</span><br><span class="line">            <span class="keyword">if</span> rect.<span class="built_in">contains</span>($<span class="number">0</span>.frame) &#123;</span><br><span class="line">                rectAttributes.append($<span class="number">0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> rectAttributes</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™„ä¸Šç›¸å…³é¡¹ç›®ï¼š<a href="https://github.com/LinXunFeng/LXFWeChat" target="_blank" rel="noopener">Swift 3.0 é«˜ä»¿å¾®ä¿¡</a></p><div class="github-widget" data-repo="LinXunFeng/LXFWeChat"></div></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - é€šè¿‡runtimeè·å–æŸä¸ªç±»ä¸­æ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•</title>
      <link href="/2017/09/12/iOS-%E9%80%9A%E8%BF%87runtime%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E7%B1%BB%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E6%96%B9%E6%B3%95/"/>
      <url>/2017/09/12/iOS-%E9%80%9A%E8%BF%87runtime%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E7%B1%BB%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>è‹¹æœå®˜æ–¹çš„ç±»ä¸­åªæä¾›ç»™æˆ‘ä»¬ä¸€å°éƒ¨åˆ†æˆå‘˜å˜é‡å’Œæ–¹æ³•,ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çš„æ°å¥½å°±æ²¡æœ‰æä¾›,è¿™æ ·å°±ä¼šä»¤å¼€å‘äººå‘˜ååˆ†æ‡Šæ¼äº†,é‚£æ€æ ·æ‰èƒ½è·å–è¯¥ç±»ä¸­æ‰€æœ‰çš„å˜é‡åŠæ–¹æ³•,ç”¨æ¥æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸å¯¹åº”çš„å˜é‡å’Œæ–¹æ³•å‘¢?<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‹¹æœè‡ªå¸¦çš„ è¿è¡Œæ—¶(runtime) æ¥è·å–<br>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><p>è‹¹æœå®˜æ–¹çš„ç±»ä¸­åªæä¾›ç»™æˆ‘ä»¬ä¸€å°éƒ¨åˆ†æˆå‘˜å˜é‡å’Œæ–¹æ³•,ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çš„æ°å¥½å°±æ²¡æœ‰æä¾›,è¿™æ ·å°±ä¼šä»¤å¼€å‘äººå‘˜ååˆ†æ‡Šæ¼äº†,é‚£æ€æ ·æ‰èƒ½è·å–è¯¥ç±»ä¸­æ‰€æœ‰çš„å˜é‡åŠæ–¹æ³•,ç”¨æ¥æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸å¯¹åº”çš„å˜é‡å’Œæ–¹æ³•å‘¢?<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‹¹æœè‡ªå¸¦çš„ è¿è¡Œæ—¶(runtime) æ¥è·å–</p><h2 id="è¿è¡Œæ—¶-Runtime"><a href="#è¿è¡Œæ—¶-Runtime" class="headerlink" title="è¿è¡Œæ—¶(Runtime):"></a>è¿è¡Œæ—¶(Runtime):</h2><ul><li>è‹¹æœå®˜æ–¹ä¸€å¥—<a href="http://lib.csdn.net/base/c" target="_blank" rel="noopener">Cè¯­è¨€</a>åº“ </li><li>èƒ½åšå¾ˆå¤šåº•å±‚æ“ä½œ(æ¯”å¦‚è®¿é—®éšè—çš„ä¸€äº›æˆå‘˜å˜é‡\æˆå‘˜æ–¹æ³•â€¦.)</li></ul><p>ä»¥ä¸‹ä»¥ UITextField ä¸ºä¾‹</p><h3 id="ä¸€-åŒ…å«è¿è¡Œæ—¶å¤´æ–‡ä»¶"><a href="#ä¸€-åŒ…å«è¿è¡Œæ—¶å¤´æ–‡ä»¶" class="headerlink" title="ä¸€. åŒ…å«è¿è¡Œæ—¶å¤´æ–‡ä»¶"></a>ä¸€. åŒ…å«è¿è¡Œæ—¶å¤´æ–‡ä»¶</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#importÂ <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="äºŒ-è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡"><a href="#äºŒ-è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡" class="headerlink" title="äºŒ. è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡"></a>äºŒ. è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// æ‹·è´å‡ºæ‰€èƒ¡çš„æˆå‘˜å˜é‡åˆ—è¡¨</span></span><br><span class="line">Ivar *ivars = class_copyIvarList([<span class="built_in">UITextField</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">    <span class="comment">// å–å‡ºæˆå‘˜å˜é‡</span></span><br><span class="line">    Ivar ivar = *(ivars + i);</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// æ‰“å°æˆå‘˜å˜é‡åå­—</span></span><br><span class="line">    LXFLog(<span class="string">@"%s"</span>, ivar_getName(ivar));</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// æ‰“å°æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹</span></span><br><span class="line">    LXFLog(<span class="string">@"%s"</span>, ivar_getTypeEncoding(ivar));</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// é‡Šæ”¾</span></span><br><span class="line">free(ivars);</span><br></pre></td></tr></table></figure><p>Swiftçš„å†™æ³•å¦‚ä¸‹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">UInt32</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> ivars = class_copyIvarList(<span class="type">UIViewController</span>.<span class="keyword">self</span>, &amp;<span class="built_in">count</span>)!</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="built_in">count</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> namePoint = ivar_getName(ivars[<span class="type">Int</span>(i)])!</span><br><span class="line">    <span class="keyword">let</span> name = <span class="type">String</span>(cString: namePoint)</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸‰-è·å–æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•"><a href="#ä¸‰-è·å–æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•" class="headerlink" title="ä¸‰. è·å–æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•"></a>ä¸‰. è·å–æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•</h3><p>// ä¸‹é¢çš„UITextFieldæ”¹ä¸ºä½ æƒ³è·å–æ‰€æœ‰å±æ€§çš„ç±»å<br>// methCount: è¿™ä¸ªç±»æ‰€æœ‰å±æ€§çš„ä¸ªæ•°<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> methCount = <span class="number">0</span>;</span><br><span class="line">Method *meths = class_copyMethodList([<span class="built_in">UITextField</span> <span class="keyword">class</span>], &amp;methCount);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methCount; i++) &#123;</span><br><span class="line">        </span><br><span class="line">    Method meth = meths[i];</span><br><span class="line">        </span><br><span class="line">    SEL sel = method_getName(meth);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name = sel_getName(sel);</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, name);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">free(meths);</span><br></pre></td></tr></table></figure></p><p>æœ€å,é€šè¿‡KVCçš„æ–¹å¼ç»™ç›¸åº”çš„æˆå‘˜å˜é‡èµ‹å€¼å³å¯!<br>å¦‚:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹ç‚¹ä½æ–‡å­—é¢œè‰²</span></span><br><span class="line"><span class="built_in">UILabel</span> *placeholderLabel = [<span class="keyword">self</span> valueForKeyPath:<span class="string">@"_placeholderLabel"</span>];</span><br><span class="line">placeholderLabel.textColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"><span class="comment">// æˆ–è€…è¿™æ ·</span></span><br><span class="line">[<span class="keyword">self</span> setValue:[<span class="built_in">UIColor</span> grayColor] forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</span><br></pre></td></tr></table></figure></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - å®ç°UINavigationå…¨å±åŠ¨è¿”å›(äºŒ)</title>
      <link href="/2017/09/12/iOS-%E5%AE%9E%E7%8E%B0UINavigation%E5%85%A8%E5%B1%8F%E5%8A%A8%E8%BF%94%E5%9B%9E-%E4%BA%8C/"/>
      <url>/2017/09/12/iOS-%E5%AE%9E%E7%8E%B0UINavigation%E5%85%A8%E5%B1%8F%E5%8A%A8%E8%BF%94%E5%9B%9E-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> <p>åœ¨ <a href="/2017/09/11/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-ä¸€">iOS - å®ç°UINavigationå…¨å±æ»‘åŠ¨è¿”å›(ä¸€)</a> ä¸­æˆ‘ä»¬å®ç°äº†æ»‘åŠ¨è¿”å›çš„åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å…¨å±æ»‘åŠ¨è¿”å›ï¼Œå¾—åœ¨å·¦ä¾§è¾¹ç¼˜è½»æ‰«æ‰èƒ½æ»‘åŠ¨è¿”å›~UINavigationControllerè‡ªå¸¦çš„åªèƒ½åœ¨è¾¹ç¼˜è½»æ‰«æ‰èƒ½æ»‘åŠ¨è¿”å›ï¼Œè¿™ç”¨æˆ·ä½“éªŒæ˜¯ä¸å¥½çš„ï¼Œæ¥ä¸‹æ¥å®ç°å…¨å±æ»‘åŠ¨è¿”å›!</p><p>+<a id="more"></a></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>åœ¨ <a href="/2017/09/11/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-ä¸€/">iOS - å®ç°UINavigationå…¨å±æ»‘åŠ¨è¿”å›(ä¸€)</a> ä¸­æˆ‘ä»¬å®ç°äº†æ»‘åŠ¨è¿”å›çš„åŠŸèƒ½ï¼Œä½†ä¸æ˜¯å…¨å±æ»‘åŠ¨è¿”å›ï¼Œå¾—åœ¨å·¦ä¾§è¾¹ç¼˜è½»æ‰«æ‰èƒ½æ»‘åŠ¨è¿”å›~UINavigationControllerè‡ªå¸¦çš„åªèƒ½åœ¨è¾¹ç¼˜è½»æ‰«æ‰èƒ½æ»‘åŠ¨è¿”å›ï¼Œè¿™ç”¨æˆ·ä½“éªŒæ˜¯ä¸å¥½çš„ï¼Œæ¥ä¸‹æ¥å®ç°å…¨å±æ»‘åŠ¨è¿”å›!</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ—¢ç„¶è‡ªå¸¦çš„æ»‘åŠ¨è¿”å›åªèƒ½æ˜¯åœ¨è¾¹ç¼˜ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½ä¿®æ”¹ä½¿å®ƒè§¦æ‘¸èŒƒå›´å˜å¤§ç”šè‡³å…¨å±å‘¢ï¼Ÿå…ˆæ¥çœ‹ä¸‹ç³»ç»Ÿæ‰‹åŠ¿æœ‰æ²¡æœ‰æä¾›å±æ€§æˆ–æ–¹æ³•ä¾›æˆ‘ä»¬ä½¿ç”¨<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.interactivePopGestureRecognizer);</span><br></pre></td></tr></table></figure></p><p>æ‰“å°ä¿¡æ¯ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;UIScreenEdgePanGestureRecognizer: 0x7fd542611e20; state = Possible;</span></span><br><span class="line"><span class="comment"> delaysTouchesBegan = YES; view = &lt;UILayoutContainerView 0x7fd542706300&gt;; target= </span></span><br><span class="line"><span class="comment">&lt;(action=handleNavigationTransition:, target=&lt;_UINavigationInteractiveTransition </span></span><br><span class="line"><span class="comment">0x7fd542611ce0&gt;)&gt;&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p><p>åŸæ¥ç³»ç»Ÿæ‰‹åŠ¿çš„ç±»å‹ä¸º UIScreenEdgePanGestureRecognizer ï¼Œè½¬åˆ°å®šä¹‰ï¼Œå‘ç°æœ‰ä¸€ä¸ªå±æ€§<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIRectEdge</span> edges</span><br></pre></td></tr></table></figure></p><p>æ˜¯ä¸ªç»“æ„ä½“<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">UIRectEdge</span>) &#123; </span><br><span class="line">   <span class="built_in">UIRectEdgeNone</span> = <span class="number">0</span>,</span><br><span class="line">   <span class="built_in">UIRectEdgeTop</span> = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line">   <span class="built_in">UIRectEdgeLeft</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">   <span class="built_in">UIRectEdgeBottom</span> = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">   <span class="built_in">UIRectEdgeRight</span> = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">   <span class="built_in">UIRectEdgeAll</span> = <span class="built_in">UIRectEdgeTop</span> | <span class="built_in">UIRectEdgeLeft</span> | <span class="built_in">UIRectEdgeBottom</span> | <span class="built_in">UIRectEdgeRight</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åªæä¾›äº†è¿™å‡ æ ·ï¼Œéƒ½æ˜¯è¾¹ç¼˜çš„ï¼Œè¿™æ ·å°±åªå¥½å¦å¯»ä»–è·¯äº†ã€‚<br>æ—¢ç„¶æ²¡æœ‰æä¾›æ–¹å¼ç»™æˆ‘ä»¬ç°å®è¦æ±‚ï¼Œé‚£æˆ‘ä»¬å°±è‡ªå·±æ·»åŠ ä¸€ä¸ªæ‹–åŠ¨æ‰‹åŠ¿ UIPanGestureRecognizeræ¥æ›¿å®ƒæ‰§è¡Œæ»‘åŠ¨è¿”å›åŠŸèƒ½ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:target action:<span class="keyword">@selector</span>(handleNavigationTransition:)];</span><br><span class="line">[<span class="keyword">self</span>.view addGestureRecognizer:pan];</span><br></pre></td></tr></table></figure></p><p>æ·»åŠ ä¸€ä¸ªæ‹–åŠ¨æ‰‹åŠ¿ï¼Œè®©ä»–æ‰§è¡Œç³»ç»Ÿæ‰‹åŠ¿çš„æ“ä½œï¼Œè°ƒç”¨handleNavigationTransition:æ–¹æ³•ï¼ˆåˆšæ‰æ‰“å°çš„ä¿¡æ¯ä¸­å¯ä»¥å¾—çŸ¥ï¼‰ï¼Œç°åœ¨çš„é—®é¢˜å°±æ˜¯targetæ˜¯è°ï¼Ÿ<br>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹UIScreenEdgePanGestureRecognizerä¸­æ˜¯å¦æœ‰çº¿ç´¢å‘¢ï¼Ÿ<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIScreenEdgePanGestureRecognizer</span> *gest = <span class="keyword">self</span>.interactivePopGestureRecognizer;</span><br></pre></td></tr></table></figure></p><p>æ‰¾äº†åŠå¤©æ²¡æ‰¾ç€ï¼Œä½†æ˜¯UIScreenEdgePanGestureRecognizerç»§æ‰¿äºUIPanGestureRecognizerï¼Œè€ŒUIPanGestureRecognizeråˆç»§æ‰¿äºUIGestureRecognizerï¼Œåœ¨UIGestureRecognizeræä¾›çš„æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºä¸€å®šæœ‰targetï¼Œè€Œä¸”è¿˜æ˜¯å¼ºå¼•ç”¨çš„ç§æœ‰å±æ€§ï¼é‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨OCå¼ºå¤§çš„æ€æ‰‹é”KVCæ¥å¾—åˆ°è¿™ä¸ªå±æ€§ï¼Œä½†æ˜¯å‰ææ˜¯æˆ‘ä»¬å¾—çŸ¥é“targetæ‰€æŒ‡å±æ€§æ˜¯ä»€ä¹ˆåå­—<br>å‚ç…§æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="/2017/09/12/iOS-é€šè¿‡runtimeè·å–æŸä¸ªç±»ä¸­æ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•">iOS - é€šè¿‡runtimeè·å–æŸä¸ªç±»ä¸­æ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•</a><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OC runtime æœºåˆ¶</span></span><br><span class="line"><span class="comment">// åªèƒ½åŠ¨æ€è·å–å½“å‰ç±»çš„æˆå‘˜å±æ€§ï¼Œä¸èƒ½è·å–å…¶å­ç±»ï¼Œæˆ–è€…çˆ¶ç±»çš„å±æ€§</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;<span class="comment">// æ‹·è´å‡ºæ‰€èƒ¡çš„æˆå‘˜å˜é‡åˆ—è¡¨</span></span><br><span class="line">Ivar *ivars = class_copyIvarList([<span class="built_in">UIGestureRecognizer</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;count; i++) &#123;</span><br><span class="line">   <span class="comment">// å–å‡ºæˆå‘˜å˜é‡</span></span><br><span class="line">   Ivar ivar = *(ivars + i); </span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ‰“å°æˆå‘˜å˜é‡åå­—</span></span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, ivar_getName(ivar)); </span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ‰“å°æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹</span></span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, ivar_getTypeEncoding(ivar));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// é‡Šæ”¾</span></span><br><span class="line"> free(ivars);</span><br></pre></td></tr></table></figure></p><p>åœ¨æ‰“å°ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†UIGestureRecognizerçš„ç§æœ‰å±æ€§ _targetsï¼Œæ˜¯ä¸ªæ•°ç»„ï¼Œè€Œä¸”åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ çš„ç±»å‹å¦‚å›¾æ‰€ç¤º<br><img src="/images/2017/09/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-äºŒ/1.png" alt="target"><br>é‚£å°±å¥½åŠäº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°targetäº†<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *targets = [gest valueForKeyPath:<span class="string">@"_targets"</span>]; <span class="comment">// æ‰“å°å¯ä»¥å‘ç°é‡Œé¢å°±ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="keyword">id</span> target = [targets[<span class="number">0</span>] valueForKeyPath:<span class="string">@"_target"</span>];</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å°±å·®ä¸å¤šå®ç°å…¨å±æ»‘åŠ¨è¿”å›çš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰ä¸ªbug<br><img src="/images/2017/09/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-äºŒ/2.gif" alt="å‘å³æ»‘åŠ¨ï¼Œæ¥ç€ç‚¹å‡»Button"><br>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨æœ€åé‡Œå›åˆ°æ ¹æ§åˆ¶å™¨ç•Œé¢åæˆ‘å†ä¸€æ¬¡å‘å³æ»‘åŠ¨ï¼Œæ¥ç€ç‚¹å‡»Buttonï¼Œå®ƒæ²¡æœ‰å°†FirstVCå¼¹å‡ºï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„bugï¼Œé‚£æˆ‘ä»¬ç°åœ¨åœ¨åšçš„ï¼Œå°±æ˜¯åœ¨æ ¹æ§åˆ¶å™¨ä¸è®©æ»‘åŠ¨è¿”å›ç”Ÿæ•ˆï¼Œå³ç¦ç”¨æ‰‹åŠ¿ã€‚<br>ç›‘å¬æ‰‹åŠ¿ï¼Œéµå®ˆåè®®UIGestureRecognizerDelegateï¼Œå®ç°ä»£ç†æ–¹æ³•</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å½“å‰æ§åˆ¶å™¨æ˜¯æ˜¯æ ¹æ§åˆ¶å™¨æ—¶ä¸è®©ç§»é™¤å½“å‰æ§åˆ¶å™¨(æ¢å¥è¯è¯´å°±æ˜¯ç¦æ­¢æ‰‹åŠ¿)</span></span><br><span class="line">pan.delegate = <span class="keyword">self</span>;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - UIGestureRecognizerDelegate// å½“å¼€å§‹æ»‘åŠ¨æ—¶è°ƒç”¨</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="built_in">UIGestureRecognizer</span> *)gestureRecognizer &#123;</span><br><span class="line">   <span class="comment">// å½“ä¸ºæ ¹æ§åˆ¶å™¨æ˜¯ä¸è®©ç§»é™¤å½“å‰æ§åˆ¶å™¨ï¼Œéæ ¹æ§åˆ¶å™¨æ—¶å…è®¸ç§»é™¤</span></span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.viewControllers.count);</span><br><span class="line">   <span class="built_in">BOOL</span> open = <span class="keyword">self</span>.viewControllers.count &gt; <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">return</span> open;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€åè¯´ä¸¤å¥"><a href="#æœ€åè¯´ä¸¤å¥" class="headerlink" title="æœ€åè¯´ä¸¤å¥"></a>æœ€åè¯´ä¸¤å¥</h2><p>è¿™æ ·å°±å¯ä»¥å…¨å±æ»‘åŠ¨äº†ï¼Œä¸è¿‡è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æ·»åŠ æ‰‹åŠ¿çš„ä¹ æƒ¯<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIPanGestureRecognizer</span> *myPan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pan)];</span><br><span class="line">[<span class="keyword">self</span>.view addGestureRecognizer:myPan];</span><br><span class="line">myPan.delegate = <span class="keyword">self</span>;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬åœ¨æ·»åŠ æ‰‹åŠ¿æ—¶è®¾ç½®äº†targetä¸ºselfï¼Œè€Œdelegateä¹Ÿä¸ºself<br>é‚£æ˜¯ä¸æ˜¯å¯ä»¥æ¨æ–­å‡ºç³»ç»Ÿæ‰‹åŠ¿çš„delegateå°±æ˜¯æˆ‘ä»¬åˆšåˆšæƒ³è¦çš„targetå‘¢ï¼Œç­”æ¡ˆæ˜¯æ˜¯çš„<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> target = <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥æˆ‘ä»¬çš„targetå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è·å¾—ï¼Œä¸ç”¨KVCçš„æ–¹å¼<br>å“¦ï¼Œæœ€ååˆ«å¿˜äº†ç¦ç”¨ç³»ç»Ÿæ‰‹åŠ¿<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¦æ­¢ç³»ç»Ÿçš„æ‰‹åŠ¿</span></span><br><span class="line"><span class="keyword">self</span>.interactivePopGestureRecognizer.enabled = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†å…¨å±æ»‘åŠ¨è¿”å›çš„åŠŸèƒ½äº†~</p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><blockquote><p>Objective-C</p></blockquote><p>è®°å¾—éµå®ˆåè®®ï¼š UIGestureRecognizerDelegate<br>LXFNavigationController.m<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">   [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   <span class="comment">// ç³»ç»Ÿçš„æ‰‹åŠ¿</span></span><br><span class="line">   <span class="built_in">UIScreenEdgePanGestureRecognizer</span> *gest = <span class="keyword">self</span>.interactivePopGestureRecognizer;</span><br><span class="line">   <span class="comment">// target</span></span><br><span class="line">   <span class="keyword">id</span> target = <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate;</span><br><span class="line">   <span class="comment">// ç¦æ­¢ç³»ç»Ÿçš„æ‰‹åŠ¿ </span></span><br><span class="line">   <span class="keyword">self</span>.interactivePopGestureRecognizer.enabled = <span class="literal">NO</span>;</span><br><span class="line">   <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:target action:<span class="keyword">@selector</span>(handleNavigationTransition:)];</span><br><span class="line">   [<span class="keyword">self</span>.view addGestureRecognizer:pan]; </span><br><span class="line">   <span class="comment">// ç›‘å¬ä»£ç†</span></span><br><span class="line">   pan.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - UIGestureRecognizerDelegate</span></span><br><span class="line"><span class="comment">// å½“å¼€å§‹æ»‘åŠ¨æ—¶è°ƒç”¨</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="built_in">UIGestureRecognizer</span> *)gestureRecognizer &#123;</span><br><span class="line">   <span class="comment">// å½“ä¸ºæ ¹æ§åˆ¶å™¨æ˜¯ä¸è®©ç§»é™¤å½“å‰æ§åˆ¶å™¨ï¼Œéæ ¹æ§åˆ¶å™¨æ—¶å…è®¸ç§»é™¤</span></span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, <span class="keyword">self</span>.viewControllers.count);</span><br><span class="line">   <span class="built_in">BOOL</span> open = <span class="keyword">self</span>.viewControllers.count &gt; <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">return</span> open;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Swift</p></blockquote><p>LXFNavigationController.swift<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">override func viewDidLoad() &#123;</span><br><span class="line">    super.viewDidLoad()</span><br><span class="line">    </span><br><span class="line">    guard let targets = interactivePopGestureRecognizer!.value(forKey: &quot;_targets&quot;) as? [NSObject] else &#123; return &#125;</span><br><span class="line">    let targetObjc = targets.first</span><br><span class="line">    let target = targetObjc?.value(forKey: &quot;target&quot;)</span><br><span class="line">    let action = Selector((&quot;handleNavigationTransition:&quot;))</span><br><span class="line">    </span><br><span class="line">    let panGes = UIPanGestureRecognizer(target: target, action: action)</span><br><span class="line">    view.addGestureRecognizer(panGes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></the></excerpt>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Swift </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>iOS - å®ç°UINavigationå…¨å±åŠ¨è¿”å›(ä¸€)</title>
      <link href="/2017/09/11/iOS-%E5%AE%9E%E7%8E%B0UINavigation%E5%85%A8%E5%B1%8F%E5%8A%A8%E8%BF%94%E5%9B%9E-%E4%B8%80/"/>
      <url>/2017/09/11/iOS-%E5%AE%9E%E7%8E%B0UINavigation%E5%85%A8%E5%B1%8F%E5%8A%A8%E8%BF%94%E5%9B%9E-%E4%B8%80/</url>
      <content type="html"><![CDATA[<p><excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""><br>interactivePopGestureRecognizer æ˜¯UINavigationControllerè‡ªå¸¦æ‰‹åŠ¿ï¼Œå½“æˆ‘ä»¬è‡ªå®šä¹‰äº†å¯¼èˆªæ¡çš„è¿”å›æŒ‰é’®åï¼Œè¿™ä¸ªæ‰‹åŠ¿å°±è‡ªåŠ¨å¤±æ•ˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•æ»‘åŠ¨è¿”å›ã€‚<br>+<a id="more"></a></excerpt></p><the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡=""><h2 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h2><p>interactivePopGestureRecognizer æ˜¯UINavigationControllerè‡ªå¸¦æ‰‹åŠ¿ï¼Œå½“æˆ‘ä»¬è‡ªå®šä¹‰äº†å¯¼èˆªæ¡çš„è¿”å›æŒ‰é’®åï¼Œè¿™ä¸ªæ‰‹åŠ¿å°±è‡ªåŠ¨å¤±æ•ˆäº†ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•æ»‘åŠ¨è¿”å›ã€‚</p><h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¸å¾—ä¸è‡ªå®šä¹‰å¯¼èˆªæ¡çš„è¿”å›æŒ‰é’®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿè¦æ»‘åŠ¨è¿”å›ä¸Šä¸€çº§çš„æ•ˆæœã€‚</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ—¢ç„¶è‡ªåŠ¨å¤±æ•ˆï¼Œé‚£æˆ‘ä»¬å°±å‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆã€‚</p><ul><li>åœ¨éæ ¹æ§åˆ¶å™¨ä¸‹ç”Ÿæ•ˆ(ç”¨äºæ»‘åŠ¨è¿”å›ä¸Šä¸€çº§)</li><li>åœ¨æ ¹æ§åˆ¶å™¨ä¸‹å¤±æ•ˆ(é˜²æ­¢æ ¹æ§åˆ¶å™¨è¢«ç§»é™¤ï¼Œå½“ç„¶ç³»ç»Ÿä¸ä¼šè®©æˆ‘ä»¬æŠŠå®ƒç§»é™¤ï¼Œåªæ˜¯ä¼šå‡ºç°bug)<br><img src="/images/2017/09/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-ä¸€/1.png" alt="è‹¹æœå®˜æ–¹æ–‡æ¡£è¯´æ˜">ç¿»è¯‘ï¼šç¬¬ä¸€ä¸ªè¢«æ·»åŠ çš„æ§åˆ¶å™¨æˆä¸ºæ°¸è¿œä¸ä¼šè¢«å‡ºæ ˆçš„æ ¹æ§åˆ¶å™¨</li></ul><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>è‡ªå®šä¹‰ä¸€ä¸ª UINavigationController ï¼Œå³ç»§æ‰¿äº UINavigationController ï¼Œåå­—ä¸º LXFNavigationController ï¼Œå°†ä»£ç†è®¾ä¸ºè‡ªå·±ï¼Œéµå®ˆåè®® UINavigationControllerDelegate ï¼Œå®ç°ä»£ç†æ–¹æ³• navigationController:didShowViewController:animated:</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>LXFNavigationController.m</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ç³»ç»Ÿæ‰‹åŠ¿ä»£ç† */</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> popGesture;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line"> [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®°å½•ç³»ç»Ÿæ‰‹åŠ¿ä»£ç†</span></span><br><span class="line">  <span class="keyword">self</span>.popGesture = <span class="keyword">self</span>.interactivePopGestureRecognizer;</span><br><span class="line">  <span class="keyword">self</span>.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - UINavigationControllerDelegate</span></span><br><span class="line"><span class="comment">// å½“æ§åˆ¶å™¨æ˜¾ç¤ºå®Œæ¯•çš„æ—¶å€™è°ƒç”¨</span></span><br><span class="line">- (<span class="keyword">void</span>)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController didShowViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ® æ ˆ å…ˆè¿›åå‡º</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.viewControllers[<span class="number">0</span>] == viewController) &#123; <span class="comment">// æ ¹æ§åˆ¶å™¨</span></span><br><span class="line">        <span class="comment">// è¿˜åŸä»£ç†</span></span><br><span class="line">        <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate = <span class="keyword">self</span>.popGesture;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// éæ§åˆ¶å™¨</span></span><br><span class="line">        <span class="comment">// æ¸…ç©ºæ‰‹åŠ¿ä»£ç†å°±èƒ½å®ç°æ»‘åŠ¨è¿”å›ï¼ŒiOS6ä¸æ”¯æŒ</span></span><br><span class="line">        <span class="keyword">self</span>.interactivePopGestureRecognizer.delegate = <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ§åˆ¶å™¨ä¸ºæ ¹æ§åˆ¶å™¨ï¼Œåˆ™ä½¿æ‰‹åŠ¿å¤±æ•ˆï¼Œä¸ç„¶æ‰‹åŠ¿ä¼šå°†æ ¹æ§åˆ¶å™¨ç§»é™¤</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.viewControllers.count == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.interactivePopGestureRecognizer.enabled = <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.interactivePopGestureRecognizer.enabled = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/2017/09/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-ä¸€/2.gif" alt="åªæœ‰å·¦ä¾§è¾¹ç¼˜æ»‘åŠ¨æ‰æœ‰æ•ˆ"></p><p><a href="https://github.com/LinXunFeng/LXFNavigationControllerDemo" target="_blank" rel="noopener">é™„ä¸ŠDemo</a></p><h3 id="æœ€åè¯´ä¸¤å¥"><a href="#æœ€åè¯´ä¸¤å¥" class="headerlink" title="æœ€åè¯´ä¸¤å¥"></a>æœ€åè¯´ä¸¤å¥</h3><p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ³¨æ„äº†ï¼Œç°åœ¨å®ç°çš„æ˜¯æ»‘åŠ¨è¿”å›åŠŸèƒ½ï¼Œå¹¶æ²¡æœ‰å…¨å±æ»‘åŠ¨è¿”å›~~æ¥ä¸‹æ¥çœ‹ä¸‹ä¸€ç¯‡å§<br> <a href="/2017/09/12/iOS-å®ç°UINavigationå…¨å±åŠ¨è¿”å›-äºŒ/">iOS - å®ç°UINavigationå…¨å±æ»‘åŠ¨è¿”å›(äºŒ)</a></p><div class="github-widget" data-repo="LinXunFeng/LXFNavigationControllerDemo"></div></the>]]></content>
      
      <categories>
          
          <category> iOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> iOS </tag>
            
            <tag> Swift </tag>
            
            <tag> Objective-C </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
