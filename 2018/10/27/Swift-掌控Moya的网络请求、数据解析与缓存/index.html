<!DOCTYPE HTML>
<html lang="">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="LinXunFengâ€˜s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://linxunfeng.top">
    <!--SEO-->





<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>Swift æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜ | LinXunFengâ€˜s Blog</title>


    <link rel="alternate" href="/atom.xml" title="LinXunFengâ€˜s Blog" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_5c2b44ddf1f55668630000b8 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D5c2b44ddf1f55668630000b8%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>





	<script>
		(function(i, s, o, g, r, a, m) {
		    i['GoogleAnalyticsObject'] = r;
		    i[r] = i[r] || function() {
		        (i[r].q = i[r].q || []).push(arguments)
		    }, i[r].l = 1 * new Date();
		    a = s.createElement(o),
		    m = s.getElementsByTagName(o)[0];
		    a.async = 1;
		    a.src = g;
		    m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-131541294-1', 'auto');
		ga('send', 'pageview');
	</script>


	<script type="text/javascript" src="http://tajs.qq.com/stats?sId=66150761" charset="UTF-8"></script>

    
    <meta name="baidu-site-verification" content="9LgZ2AlWYS">


    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">ä½ ä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œä¸ºäº†ä½ æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œè¯·æ›´æ–°æµè§ˆå™¨çš„ç‰ˆæœ¬æˆ–è€…ä½¿ç”¨å…¶ä»–ç°ä»£æµè§ˆå™¨ï¼Œæ¯”å¦‚Chromeã€Firefoxã€Safariç­‰ã€‚</div>
<![endif]-->

<body>
    <header class="main-header" style="background-image:url(/./img/background/banner.jpeg)">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="LinXunFeng">
            <img src="/img/avatar.jpg" alt="logoå¤´åƒ" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippetä¸»é¢˜,ä»æœªå¦‚æ­¤ç®€å•æœ‰è¶£</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet åšå®¢ä¸»é¢˜" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://linxunfeng.top">LinXunFengâ€˜s Blog</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>é¦–é¡µ</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/iOS/"><i class="fa "></i>iOS</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Python/"><i class="fa "></i>Python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Linux/"><i class="fa "></i>Linux</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Algorithm/"><i class="fa "></i>ç®—æ³•</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Others/"><i class="fa "></i>å…¶å®ƒ</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Swift æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜">
            
	            Swift æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS">
            iOS
        </a>
    </span>
    

    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
                    <a href="/tags/iOS" title="iOS">
                        iOS
                    </a>
                
                    <a href="/tags/Swift" title="Swift">
                        Swift
                    </a>
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/10/27</span>
        </span>
        
            <span class="fa-wrap">
                <i class="fa fa-eye"></i>
                <span id="busuanzi_value_page_pv"></span>
            </span>
        
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <excerpt in="" index="" |="" é¦–é¡µæ‘˜è¦=""> 

<ul>
<li><code>Moya</code> åœ¨Swiftå¼€å‘ä¸­èµ·ç€é‡è¦çš„ç½‘ç»œäº¤äº’ä½œç”¨ï¼Œä½†æ˜¯è¿˜æœ‰ä¸å¦‚ä¹‹å¤„ï¼Œæ¯”å¦‚ç½‘ç»œä¸å¯ç”¨æ—¶ï¼Œè¿”å›çš„ <code>Response</code> ä¸º <code>nil</code>ï¼Œè¿™æ—¶è¿˜å¾—å»è§£æç›¸åº”çš„ <code>Error</code></li>
<li><code>Codable</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è§£ææ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å£°æ˜çš„å±æ€§ç±»å‹ä¸jsonä¸­çš„ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£å¸¸è§£æ; è€Œä¸”å¯¹äºæ¨¡å‹ä¸­è‡ªå®šä¹‰å±æ€§åçš„å¤„ç†ä¹Ÿååˆ†ç¹ç</li>
</ul>
<p>+<a id="more"></a></p>
<the rest="" of="" contents="" |="" ä½™ä¸‹å…¨æ–‡="">



<ul>
<li><code>Moya</code> åœ¨Swiftå¼€å‘ä¸­èµ·ç€é‡è¦çš„ç½‘ç»œäº¤äº’ä½œç”¨ï¼Œä½†æ˜¯è¿˜æœ‰ä¸å¦‚ä¹‹å¤„ï¼Œæ¯”å¦‚ç½‘ç»œä¸å¯ç”¨æ—¶ï¼Œè¿”å›çš„ <code>Response</code> ä¸º <code>nil</code>ï¼Œè¿™æ—¶è¿˜å¾—å»è§£æç›¸åº”çš„ <code>Error</code></li>
<li><code>Codable</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è§£ææ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å£°æ˜çš„å±æ€§ç±»å‹ä¸jsonä¸­çš„ä¸ä¸€è‡´ï¼Œå°†æ— æ³•æ­£å¸¸è§£æ; è€Œä¸”å¯¹äºæ¨¡å‹ä¸­è‡ªå®šä¹‰å±æ€§åçš„å¤„ç†ä¹Ÿååˆ†ç¹ç</li>
</ul>
<p>è§£å†³çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä¸è¿‡æˆ‘æ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨ <code>MoyaMapper</code> ï¼Œä¸ä»…å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿˜æä¾›äº†å¤šç§<code>æ¨¡å‹è½¬æ¢</code>ã€<code>æ•°æ®äº’è½¬</code>ã€<code>å¤šç§æ•°æ®ç±»å‹ä»»æ„å­˜å‚¨</code>çš„ä¾¿æ·æ–¹æ³•ã€‚æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜ç®€ç›´æ˜“å¦‚åæŒã€‚</p>
<blockquote>
<p><code>MoyaMapper</code>æ˜¯åŸºäºMoyaå’ŒSwiftyJSONå°è£…çš„å·¥å…·ï¼Œä»¥Moyaçš„pluginçš„æ–¹å¼æ¥å®ç°é—´æ¥è§£æï¼Œæ”¯æŒRxSwift</p>
<p> GitHub: <a href="https://github.com/MoyaMapper/MoyaMapper" target="_blank" rel="noopener">MoyaMapper</a></p>
<p>ğŸ“– è¯¦ç»†çš„ä½¿ç”¨è¯·æŸ¥çœ‹æ‰‹å†Œ <a href="https://moyamapper.github.io/" target="_blank" rel="noopener">https://MoyaMapper.github.io</a></p>
</blockquote>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul>
<li>æ”¯æŒ<code>json</code> è½¬ <code>Model</code> è‡ªåŠ¨æ˜ å°„ ä¸ è‡ªå®šä¹‰æ˜ å°„</li>
<li>æ— è§† <code>json</code> ä¸­å€¼çš„ç±»å‹ï¼Œ<code>Model</code> ä¸­å±æ€§å£°æ˜çš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå®ƒå°±æ˜¯ä»€ä¹ˆç±»å‹</li>
<li>æ”¯æŒ <code>Data</code> <code>å­—å…¸</code> <code>JSON</code> <code>jsonå­—ç¬¦ä¸²</code> <code>Model</code> äº’è½¬</li>
<li>æ’ä»¶æ–¹å¼ï¼Œå…¨æ–¹ä½ä¿éšœ<code>Moya.Response</code>ï¼Œæ‹’ç»å„ç§ç½‘ç»œé—®é¢˜å¯¼è‡´ <code>Response</code> ä¸º <code>nil</code>ï¼Œå°†å„å¼å„æ ·çš„åŸå› å¯¼è‡´çš„æ•°æ®åŠ è½½å¤±è´¥è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨ <code>Response</code></li>
<li>å¯é€‰ - æ”¯æŒæ•°æ®éšæ„ç¼“å­˜( <code>JSON</code> ã€ <code>Number</code> ã€<code>String</code>ã€ <code>Bool</code>ã€ <code>Moya.Response</code> )</li>
<li>å¯é€‰ - æ”¯æŒç½‘ç»œè¯·æ±‚ç¼“å­˜</li>
</ul>
<h2 id="æ•°æ®è§£æ"><a href="#æ•°æ®è§£æ" class="headerlink" title="æ•°æ®è§£æ"></a>æ•°æ®è§£æ</h2><h5 id="ä¸€ã€æ’ä»¶æ³¨å…¥"><a href="#ä¸€ã€æ’ä»¶æ³¨å…¥" class="headerlink" title="ä¸€ã€æ’ä»¶æ³¨å…¥"></a>ä¸€ã€æ’ä»¶æ³¨å…¥</h5><p>é™„ï¼š<a href="https://moyamapper.github.io/plugin/" target="_blank" rel="noopener">æ’ä»¶ MoyaMapperPlugin çš„è¯¦ç»†ä½¿ç”¨</a></p>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p>
<p>1ã€å®šä¹‰é€‚ç”¨äºé¡¹ç›®æ¥å£çš„ <code>ModelableParameterType</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// statusCodeKeyã€tipStrKeyã€ modelKey å¯ä»¥ä»»æ„æŒ‡å®šçº§åˆ«çš„è·¯å¾„ï¼Œå¦‚ï¼š "error&gt;used"</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NetParameter</span> : <span class="title">ModelableParameterType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> successValue = <span class="string">"000"</span></span><br><span class="line">    <span class="keyword">var</span> statusCodeKey = <span class="string">"retStatus"</span></span><br><span class="line">    <span class="keyword">var</span> tipStrKey = <span class="string">"retMsg"</span></span><br><span class="line">    <span class="keyword">var</span> modelKey = <span class="string">"retBody"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€åœ¨ <code>MoyaProvider</code> ä¸­ä½¿ç”¨ <code>MoyaMapperPlugin</code> æ’ä»¶ï¼Œå¹¶æŒ‡å®š <code>ModelableParameterType</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lxfNetTool = <span class="type">MoyaProvider</span>&lt;<span class="type">LXFNetworkTool</span>&gt;(plugins: [<span class="type">MoyaMapperPlugin</span>(<span class="type">NetParameter</span>())])</span><br></pre></td></tr></table></figure>
<p>â— ä½¿ç”¨ <code>MoyaMapperPlugin</code> æ’ä»¶æ˜¯æ•´ä¸ª <code>MoyaMapper</code>  çš„æ ¸å¿ƒæ‰€åœ¨ï¼</p>
<h5 id="äºŒã€Modelå£°æ˜"><a href="#äºŒã€Modelå£°æ˜" class="headerlink" title="äºŒã€Modelå£°æ˜"></a>äºŒã€Modelå£°æ˜</h5><blockquote>
<p><code>Model</code> éœ€éµå®ˆ <code>Modelable</code> åè®®</p>
<ul>
<li><code>MoyaMapper</code> æ”¯æŒæ¨¡å‹è‡ªåŠ¨æ˜ å°„ å’Œ è‡ªå®šä¹‰æ˜ å°„</li>
<li>ä¸éœ€è¦è€ƒè™‘æºjsonæ•°æ®çš„çœŸå®ç±»å‹ï¼Œè¿™é‡Œç»Ÿä¸€æŒ‰ <code>Model</code> ä¸­å±æ€§å£°æ˜çš„ç±»å‹è¿›è¡Œè½¬æ¢</li>
</ul>
</blockquote>
<p>1ã€ä¸€èˆ¬æƒ…å†µä¸‹å¦‚ä¸‹å†™æ³•å³å¯</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CompanyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> catchPhrase : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€å¦‚æœè‡ªå®šä¹‰æ˜ å°„ï¼Œåˆ™å¯ä»¥å®ç°æ–¹æ³• <code>mutating func mapping(_ json: JSON)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CompanyModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> catchPhrase : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">mapping</span><span class="params">(<span class="number">_</span> json: JSON)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = json[<span class="string">"nickname"</span>].stringValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€æ”¯æŒæ¨¡å‹åµŒå¥—</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserModel</span>: <span class="title">Modelable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> id : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> company : <span class="type">CompanyModel</span> = <span class="type">CompanyModel</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä¸‰ã€Response-è§£æ"><a href="#ä¸‰ã€Response-è§£æ" class="headerlink" title="ä¸‰ã€Response è§£æ"></a>ä¸‰ã€Response è§£æ</h5><blockquote>
<p>1ã€ä»¥ä¸‹ç¤ºä¾‹çš†ä½¿ç”¨äº† <code>MoyaMapperPlugin</code> ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®š <code>è§£æè·¯å¾„</code></p>
<p>2ã€å¦‚æœæ²¡æœ‰ä½¿ç”¨ <code>MoyaMapperPlugin</code> åˆ™éœ€è¦æŒ‡å®š <code>è§£æè·¯å¾„</code>ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸è§£æ</p>
<p>ps:  <code>è§£æè·¯å¾„</code> å¯ä»¥ä½¿ç”¨ <code>a&gt;b</code> è¿™ç§å½¢å¼æ¥è§£å†³å¤šçº§è·¯å¾„çš„é—®é¢˜</p>
</blockquote>
<p>è§£ææ–¹æ³•å¦‚ä¸‹åˆ—è¡¨æ‰€ç¤º</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ–¹æ³•</th>
<th style="text-align:left">æè¿° (æ”¯æŒRxSwift)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">toJSON</td>
<td style="text-align:left">Response è½¬ JSON ( <a href="https://moyamapper.github.io/core/toJSON/" target="_blank" rel="noopener">toJSON</a>   <a href="https://moyamapper.github.io/rx/toJSON/" target="_blank" rel="noopener">rx.toJSON</a>)</td>
</tr>
<tr>
<td style="text-align:center">fetchString</td>
<td style="text-align:left">è·å–æŒ‡å®šè·¯å¾„çš„å­—ç¬¦ä¸²( <a href="https://moyamapper.github.io/core/fetchString/" target="_blank" rel="noopener">fetchString</a>   <a href="https://moyamapper.github.io/rx/fetchString/" target="_blank" rel="noopener">rx.fetchString</a>)</td>
</tr>
<tr>
<td style="text-align:center">fetchJSONString</td>
<td style="text-align:left">è·å–æŒ‡å®šè·¯å¾„çš„åŸå§‹jsonå­—ç¬¦ä¸² ( <a href="https://moyamapper.github.io/core/fetchJSONString/" target="_blank" rel="noopener">fetchJSONString</a>   <a href="https://moyamapper.github.io/rx/fetchJSONString/" target="_blank" rel="noopener">rx.fetchJSONString</a> )</td>
</tr>
<tr>
<td style="text-align:center">mapResult</td>
<td style="text-align:left">Response -&gt; MoyaMapperResult   <code>(Bool, String)</code> ( <a href="https://moyamapper.github.io/core/mapResult/" target="_blank" rel="noopener">mapResult</a>   <a href="https://moyamapper.github.io/rx/mapResult/" target="_blank" rel="noopener">rx.mapResult</a> )</td>
</tr>
<tr>
<td style="text-align:center">mapObject</td>
<td style="text-align:left">Response -&gt; Model ( <a href="https://moyamapper.github.io/core/mapObject/" target="_blank" rel="noopener">mapObject</a>   <a href="https://moyamapper.github.io/rx/mapObject/" target="_blank" rel="noopener">rx.mapObject</a>)</td>
</tr>
<tr>
<td style="text-align:center">mapObjResult</td>
<td style="text-align:left">Response -&gt; (MoyaMapperResult, Model) ( <a href="https://moyamapper.github.io/core/mapObjResult/" target="_blank" rel="noopener">mapObjResult</a>   <a href="https://moyamapper.github.io/rx/mapObjResult/" target="_blank" rel="noopener">rx.mapObjResult</a>)</td>
</tr>
<tr>
<td style="text-align:center">mapArray</td>
<td style="text-align:left">Response -&gt; [Model] ( <a href="https://moyamapper.github.io/core/mapArray/" target="_blank" rel="noopener">mapArray</a>  <a href="https://moyamapper.github.io/rx/mapArray/" target="_blank" rel="noopener">rx.mapArray</a>)</td>
</tr>
<tr>
<td style="text-align:center">mapArrayResult</td>
<td style="text-align:left">Response -&gt; (MoyaMapperResult, [Model]) ( <a href="https://moyamapper.github.io/core/mapArrayResult/" target="_blank" rel="noopener">mapArrayResult</a>   <a href="https://moyamapper.github.io/rx/mapArrayResult/" target="_blank" rel="noopener">rx.mapArrayResult</a>)</td>
</tr>
</tbody>
</table>
<p>â—é™¤äº† <code>fetchJSONString</code> çš„é»˜è®¤è§£æè·¯å¾„æ˜¯<code>æ ¹è·¯å¾„</code>ä¹‹å¤–ï¼Œå…¶å®ƒæ–¹æ³•çš„é»˜è®¤è§£æè·¯å¾„ä¸ºæ’ä»¶å¯¹è±¡ä¸­çš„ <code>modelKey</code></p>
<p>å¦‚æœæ¥å£è¯·æ±‚å <code>json</code> çš„æ•°æ®ç»“æ„ä¸ä¸‹å›¾ç±»ä¼¼ï¼Œåˆ™ä½¿ç”¨ <code>MoyaMapper</code> æ˜¯æœ€åˆé€‚ä¸è¿‡äº†</p>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> model = response.mapObject(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name -- \(model.name)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"github -- \(model.github)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°json</span></span><br><span class="line"><span class="built_in">print</span>(response.fetchJSONString())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapObject(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line">    .subscribe(onSuccess: &#123; (model) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"name -- \(model.name)"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"github -- \(model.github)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<p>é™„ï¼š <a href="https://moyamapper.github.io/core/fetchJSONString/" target="_blank" rel="noopener">fetchJSONStringçš„è¯¦ç»†ä½¿ç”¨</a></p>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-array.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> models = response.mapArray(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="keyword">let</span> name = models[<span class="number">0</span>].name</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"count -- \(models.count)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name -- \(name)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å° json æ¨¡å‹æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªçš„name</span></span><br><span class="line"><span class="built_in">print</span>(response.fetchString(keys: [<span class="number">0</span>, <span class="string">"name"</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapArray(<span class="type">MMModel</span>.<span class="keyword">self</span>)</span><br><span class="line">    .subscribe(onSuccess: &#123; models <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> name = models[<span class="number">0</span>].name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"count -- \(models.count)"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"name -- \(name)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<p>é™„ï¼š<a href="https://moyamapper.github.io/core/mapArray/" target="_blank" rel="noopener">mapArrayçš„è¯¦ç»†ä½¿ç”¨è¯´æ˜</a></p>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/fail.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="keyword">let</span> (isSuccess, tipStr) = response.mapResult()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"isSuccess -- \(isSuccess)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tipStr -- \(tipStr)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line">rxRequest.mapResult()</span><br><span class="line">    .subscribe(onSuccess: &#123; (isSuccess, tipStr) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"isSuccess -- \(isSuccess)"</span>) <span class="comment">// æ˜¯å¦ä¸º "000"</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"retMsg -- \(retMsg)"</span>) <span class="comment">// "ç¼ºå°‘å¿…è¦å‚æ•°"</span></span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<p>é™„ï¼š<a href="https://moyamapper.github.io/core/mapResult/" target="_blank" rel="noopener">mapResultçš„è¯¦ç»†ä½¿ç”¨è¯´æ˜</a></p>
<h2 id="ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ"><a href="#ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ" class="headerlink" title="ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ"></a>ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ</h2><blockquote>
<p>åœ¨APPçš„å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°å„ç§å„æ ·çš„ç½‘ç»œè¯·æ±‚ç»“æœï¼Œå¦‚:æœåŠ¡å™¨æŒ‚äº†ã€æ‰‹æœºæ— ç½‘ç»œï¼Œæ­¤æ—¶ <code>Moya</code> è¿”å›çš„ <code>Response</code> ä¸º nilï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¾—ä¸å»åˆ¤æ–­ <code>Error</code>ã€‚ä½†æ˜¯ä½¿ç”¨ <code>MoyaMapperPlugin</code> å°±å¯ä»¥è®©æˆ‘ä»¬åªå…³æ³¨ <code>Response</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MoyaMapperPlugin çš„åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">ModelableParameterType</span>&gt;(</span><br><span class="line">    <span class="number">_</span> type: <span class="type">T</span>,</span><br><span class="line">    transformError: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type : <span class="type">ModelableParameterType</span>  ç”¨äºå®šä¹‰å­—æ®µè·¯å¾„ï¼Œåšä¸ºå…¨å±€è§£ææ•°æ®çš„ä¾æ®</span><br><span class="line">transformError : <span class="type">Bool</span>  æ˜¯å¦å½“ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢è¯·æ±‚ç»“æœï¼Œé»˜è®¤ä¸º <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å½“è¯·æ±‚å¤±è´¥çš„æ—¶å€™ï¼Œæ­¤æ—¶çš„ <code>result.response</code> ä¸º <code>nil</code>ï¼Œæ ¹æ®<code>transformError</code>æ˜¯å¦ä¸º<code>true</code> åˆ¤æ–­æ˜¯å¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>response</code> å¹¶è¿”å›å‡ºå»ã€‚</li>
</ul>
<p>â¡ æœ¬æ¥å¯ä»¥è¯·æ±‚åˆ°çš„æ•°æ®å†…å®¹</p>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/success-obj.png" alt=""></p>
<p>â¡ ç°åœ¨å…³é—­ç½‘ç»œï¼Œå†è¯·æ±‚æ•°æ®</p>
<ul>
<li><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå³ä¸åšä»»ä½•ä¸å¤„ç†çš„æ—¶å€™ï¼Œ <code>Response</code> ä¸º <code>nil</code> </p>
</li>
<li><p>ç»è¿‡ <code>MoyaMapperPlugin</code> å¤„ç†çš„åå¯å¾—åˆ°è½¬æ¢åçš„ <code>Response</code> ï¼Œå¦‚å›¾</p>
</li>
</ul>
<p><img src="http://linxunfeng.github.io/images/2018/10/Swift-æŒæ§Moyaçš„ç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æä¸ç¼“å­˜/plugin.png" alt=""></p>
<p>è¿™é‡Œå°†è¯·æ±‚å¤±è´¥è¿›è¡Œäº†ç»Ÿä¸€å¤„ç†ï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨è¿˜æ˜¯è‡ªèº«ç½‘ç»œçš„é—®é¢˜ï¼Œ<code>retStatus</code> éƒ½ä¸º MMStatusCode.loadFailï¼Œä½†æ˜¯ errorDescription ä¼šä¿æŒåŸæ¥çš„æ ·å­å¹¶èµ‹å€¼ç»™ <code>retMsg</code>ã€‚</p>
<blockquote>
<ul>
<li><code>retStatus</code> å€¼ä¼šä»æšä¸¾ <code>MMStatusCode</code> ä¸­å–  <code>loadFail.rawValue</code> ï¼Œå³ <code>700</code> </li>
<li>å– ç±»å‹ä¸º <code>ModelableParameterType</code>  çš„ <code>type</code> ä¸­ <code>statusCodeKey</code> æ‰€æŒ‡å®šçš„å€¼ ä¸ºé”®åï¼Œ<code>retMsg</code>ä¹ŸåŒç†</li>
</ul>
</blockquote>
<p>ps: è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡åˆ¤æ–­ <code>retStatus</code> æˆ– <code>response.statusCode</code> æ˜¯å¦ä¸ <code>MMStatusCode.loadFail.rawValue</code> ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåŠ è½½å¤±è´¥çš„ç©ºç™½é¡µå ä½å›¾</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">MMStatusCode</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> cache = <span class="number">230</span></span><br><span class="line">    <span class="keyword">case</span> loadFail = <span class="number">700</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æšä¸¾ <code>MMStatusCode</code> ä¸­é™¤äº† <code>loadFail</code> ï¼Œè¿˜æœ‰ <code>cache</code>ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ <code>loadFail</code> åœ¨æ•°æ®åŠ è½½å¤±è´¥çš„æ—¶å€™ä¼šå‡ºç°ï¼Œé‚£ <code>cache</code> æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‡ºæ¥å‘¢ï¼Ÿä¸æ€¥ï¼Œçœ‹ä¸‹ä¸€èŠ‚å°±çŸ¥é“äº†ã€‚</p>
<h2 id="æ•°æ®ç¼“å­˜"><a href="#æ•°æ®ç¼“å­˜" class="headerlink" title="æ•°æ®ç¼“å­˜"></a>æ•°æ®ç¼“å­˜</h2><h5 id="ä¸€ã€åŸºæœ¬ä½¿ç”¨"><a href="#ä¸€ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ä¸€ã€åŸºæœ¬ä½¿ç”¨"></a>ä¸€ã€åŸºæœ¬ä½¿ç”¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç¼“å­˜</span><br><span class="line">@discardableResult</span><br><span class="line">MMCache.shared.cache`XXX`(value : XXX, key: String, cacheContainer: MMCache.CacheContainer = .RAM)  -&gt; Bool</span><br><span class="line">// å–èˆ</span><br><span class="line">MMCache.shared.fetch`XXX`Cache(key: String, cacheContainer: MMCache.CacheContainer = .RAM)</span><br></pre></td></tr></table></figure>
<p>ç¼“å­˜æˆåŠŸä¼šè¿”å›ä¸€ä¸ª <code>Bool</code> å€¼ï¼Œè¿™é‡Œå¯ä¸æ¥æ”¶</p>
<table>
<thead>
<tr>
<th>XXX æ‰€æ”¯æŒç±»å‹</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Bool</td>
<td>-</td>
</tr>
<tr>
<td>Float</td>
<td>-</td>
</tr>
<tr>
<td>Double</td>
<td>-</td>
</tr>
<tr>
<td>String</td>
<td>-</td>
</tr>
<tr>
<td>JSON</td>
<td>-</td>
</tr>
<tr>
<td>Modelable</td>
<td>[Modelable]</td>
</tr>
<tr>
<td>Moya.Response</td>
<td>-</td>
</tr>
<tr>
<td>Int</td>
<td>UInt</td>
</tr>
<tr>
<td>Int8</td>
<td>UInt8</td>
</tr>
<tr>
<td>Int16</td>
<td>UInt16</td>
</tr>
<tr>
<td>Int32</td>
<td>UInt32</td>
</tr>
<tr>
<td>Int64</td>
<td>UInt64</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…¶ä¸­ï¼Œé™¤äº† <code>Moya.Response</code> ä¹‹å¤–ï¼Œå…¶å®ƒç±»å‹çš†æ˜¯é€šè¿‡ <code>JSON</code> æ¥å®ç°ç¼“å­˜</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³æ¸…é™¤è¿™äº›ç±»å‹çš„ç¼“å­˜ï¼Œåªéœ€è¦è°ƒç”¨å¦‚ä¸‹æ–¹æ³•å³å¯</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@discardableResult</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeJSONCache</span><span class="params">(<span class="number">_</span> key: String, cacheContainer: MMCache.CacheContainer = .RAM)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@discardableResult</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllJSONCache</span><span class="params">(cacheContainer: MMCache.CacheContainer = .RAM)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>æ¸…é™¤ <code>Moya.Response</code> åˆ™ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@discardableResult</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeResponseCache</span><span class="params">(<span class="number">_</span> key: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@discardableResult</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeAllResponseCache</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>å†æ¥çœ‹çœ‹MMCache.CacheContainer</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CacheContainer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">RAM</span> 	<span class="comment">// åªç¼“å­˜äºå†…å­˜çš„å®¹å™¨</span></span><br><span class="line">    <span class="keyword">case</span> hybrid <span class="comment">// ç¼“å­˜äºå†…å­˜ä¸ç£ç›˜çš„å®¹å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸¤ç§å®¹å™¨äº’ä¸ç›¸é€šï¼Œå³ å³ä½¿keyç›¸åŒï¼Œä½¿ç”¨ <code>hybrid</code> æ¥ç¼“å­˜åï¼Œå†é€šè¿‡ <code>RAM</code> å–å€¼æ˜¯å–ä¸åˆ°çš„ã€‚</p>
</blockquote>
<ul>
<li>RAM : ä»…ç¼“å­˜äºå†…å­˜ä¹‹ä¸­ï¼Œç¼“å­˜çš„æ•°æ®åœ¨APPä½¿ç”¨æœŸé—´ä¸€ç›´å­˜åœ¨</li>
<li>hybrid ï¼šç¼“å­˜äºå†…å­˜ä¸ç£ç›˜ä¸­ï¼ŒAPPé‡å¯åä¹Ÿå¯ä»¥è·å–åˆ°æ•°æ®</li>
</ul>
<h5 id="äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚"><a href="#äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚" class="headerlink" title="äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚"></a>äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚</h5><p>å†…éƒ¨ç¼“å­˜è¿‡ç¨‹ï¼š</p>
<ol>
<li>APPé¦–æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œæ•°æ®å°†ç¼“å­˜èµ·æ¥</li>
<li>APPå†æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šå…ˆè¿”å›ç¼“å­˜çš„æ•°æ®ï¼Œç­‰è¯·æ±‚æˆåŠŸåå†è¿”å›ç½‘ç»œæ•°æ®</li>
<li>å…¶å®ƒæƒ…å†µåªä¼šåŠ è½½ç½‘ç»œæ•°æ®</li>
<li>æ¯æ¬¡æˆåŠŸè¯·æ±‚åˆ°æ•°æ®åï¼Œéƒ½ä¼šå¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡Œæ›´æ–°</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cacheRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> target: Target, </span></span></span><br><span class="line"><span class="function"><span class="params">    cacheType: MMCache.CacheKeyType = .<span class="keyword">default</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    callbackQueue: DispatchQueue? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    progress: Moya.ProgressBlock? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    completion: @escaping Moya.Completion</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Cancellable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rx</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cacheRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="number">_</span> target: Base.Target, </span></span></span><br><span class="line"><span class="function"><span class="params">    callbackQueue: DispatchQueue? = <span class="literal">nil</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    cacheType: MMCache.CacheKeyType = .<span class="keyword">default</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Response</span>&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®é™…ä¸Šæ˜¯å¯¹ <code>Moya</code> è¯·æ±‚åçš„ <code>Response</code> è¿›è¡Œç¼“å­˜ã€‚ å…¶å®ä¸ <code>Moya</code> è‡ªå¸¦çš„æ–¹æ³•ç›¸æ¯”è¾ƒåªå¤šäº†ä¸€ä¸ªå‚æ•° <code>cacheType: MMCache.CacheKeyType</code> ï¼Œå®šä¹‰ç€ç¼“å­˜ä¸­çš„ <code>key</code> ï¼Œé»˜è®¤ä¸º <code>default</code> </p>
</blockquote>
<p>ä¸‹é¢æ˜¯ <code>MMCache.CacheKeyType</code> çš„å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> let cacheKey = [method]baseURL/path</span><br><span class="line"> </span><br><span class="line"> - default : cacheKey + &quot;?&quot; + parameters</span><br><span class="line"> - base : cacheKey</span><br><span class="line"> - custom : cacheKey + &quot;?&quot; + customKey</span><br><span class="line"> */</span><br><span class="line">public enum CacheKeyType &#123;</span><br><span class="line">    case `default`</span><br><span class="line">    case base</span><br><span class="line">    case custom(String)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœä½ æƒ³ç¼“å­˜<code>å¤šé¡µ</code>åˆ—è¡¨æ•°æ®çš„<code>æœ€æ–°ä¸€é¡µ</code>æ•°æ®ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>default</code> æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸º <code>default</code> ä½¿ç”¨çš„ <code>key</code> åŒ…å«äº† <code>pageIndex</code>ï¼Œè¿™æ ·å°±è¾¾ä¸åˆ°åªç¼“å­˜ <code>æœ€æ–°ä¸€é¡µæ•°æ®</code> çš„ç›®çš„ï¼Œ æ‰€ä»¥è¿™é‡Œåº”è¯¥ä½¿ç”¨ <code>base</code> æˆ–è€… <code>custom(String)</code> </p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥æ¥è¯•ä¸€ä¸‹å¸¦ç¼“å­˜çš„è¯·æ±‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * APPç¬¬ä¸€æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œæ•°æ®å°†ç¼“å­˜èµ·æ¥</span></span><br><span class="line"><span class="comment"> * APPå†æ¬¡å¯åŠ¨å¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šå…ˆåŠ è½½ç¼“å­˜ï¼Œå†åŠ è½½ç½‘ç»œæ•°æ®</span></span><br><span class="line"><span class="comment"> * å…¶å®ƒæƒ…å†µåªä¼šåŠ è½½ç½‘ç»œæ•°æ®</span></span><br><span class="line"><span class="comment"> * æ¯æ¬¡æˆåŠŸè¯·æ±‚åˆ°æ•°æ®éƒ½ä¼šè¿›è¡Œæ•°æ®æ›´æ–°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">lxfNetTool.rx.cacheRequest(.data(type: .all, size: <span class="number">10</span>, index: <span class="number">1</span>))</span><br><span class="line">    .subscribe(onNext: &#123; response <span class="keyword">in</span></span><br><span class="line">        log.debug(<span class="string">"statusCode -- \(response.statusCode)"</span>)</span><br><span class="line">    &#125;).disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹å¼</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">let _ = lxfNetTool.cacheRequest(.data(type: .all, size: 10, index: 1)) &#123; result in</span></span><br><span class="line"><span class="comment">    guard let resp = result.value else &#123; return &#125;</span></span><br><span class="line"><span class="comment">    log.debug("statusCode -- \(resp.statusCode)")</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// é¦–æ¬¡ä½¿ç”¨APP</span><br><span class="line">statusCode -- 200</span><br><span class="line"></span><br><span class="line">// å…³é—­å¹¶é‡æ–°æ‰“å¼€APPï¼Œå†è¯·æ±‚ä¸€ä¸‹</span><br><span class="line">statusCode -- 230</span><br><span class="line">statusCode -- 200</span><br><span class="line"></span><br><span class="line">// ç„¶åå†è¯·æ±‚ä¸€ä¸‹</span><br><span class="line">statusCode -- 200</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>230</code> å°±æ˜¯ <code>MMStatusCode.cache.rawValue</code></p>
<h2 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h2><ul>
<li>é»˜è®¤å®‰è£…</li>
</ul>
<p>MoyaMapperé»˜è®¤åªå®‰è£…Coreä¸‹çš„æ–‡ä»¶<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper'</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>RxSwiftæ‹“å±•</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/Rx'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼“å­˜æ‹“å±•</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/MMCache'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Rxç¼“å­˜</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="string">'MoyaMapper/RxCache'</span></span><br></pre></td></tr></table></figure></li>
</ul>
</the></excerpt>
    </div>
    
        <div class="reward">
    <div class="reward-wrap">èµ
        <div class="reward-box">
            
                <span class="reward-type">
                    <img class="alipay" src="http://linxunfeng.github.io/img/pay/alipay.png"><b>æ”¯ä»˜å®æ‰“èµ</b>
                </span>
            
            
                <span class="reward-type">
                    <img class="wechat" src="http://linxunfeng.github.io/img/pay/wechat.png"><b>å¾®ä¿¡æ‰“èµ</b>
                </span>
            
        </div>
    </div>
    <p class="reward-tip">èµèµæ˜¯ä¸è€æµæ°“çš„é¼“åŠ±</p>
</div>


    
    <div class="post-footer">
        <div>
            
                è½¬è½½å£°æ˜ï¼šå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒ,éå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ Â© <a href="http://linxunfeng.top/" target="_blank">LinXunFeng</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2019/01/01/Others/FQ-Terminalä¸‹çš„ä»£ç†å·¥å…·ProxyChains-NG/" class="pre-post btn btn-default" title="FQ-Terminalä¸‹çš„ä»£ç†å·¥å…·ProxyChains-NG">
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">ä¸Šä¸€ç¯‡</span>
            <span class="hidden-xs">FQ-Terminalä¸‹çš„ä»£ç†å·¥å…·ProxyChains-NG</span>
        </a>
    
    
        <a href="/2018/10/24/Swift-ä¼˜é›…çš„é€‚é…å¤§å°/" class="next-post btn btn-default" title="Swift ä¼˜é›…çš„é€‚é…å¤§å°">
            <span class="hidden-lg">ä¸‹ä¸€ç¯‡</span>
            <span class="hidden-xs">Swift ä¼˜é›…çš„é€‚é…å¤§å°</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
    
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: '0rTljoibiQOAeo1tQ9qXExq9-gzGzoHsz',
            appKey: '2N2gdmSHN6mIGpbmX8duHv6X',
            placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§',
            notify: true,
            verify: false,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: ''.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">Table of Contents</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ç‰¹ç‚¹"><span class="toc-text">ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ•°æ®è§£æ"><span class="toc-text">æ•°æ®è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ä¸€ã€æ’ä»¶æ³¨å…¥"><span class="toc-text">ä¸€ã€æ’ä»¶æ³¨å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#äºŒã€Modelå£°æ˜"><span class="toc-text">äºŒã€Modelå£°æ˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ä¸‰ã€Response-è§£æ"><span class="toc-text">ä¸‰ã€Response è§£æ</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ"><span class="toc-text">ç»Ÿä¸€å¤„ç†ç½‘ç»œè¯·æ±‚ç»“æœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ•°æ®ç¼“å­˜"><span class="toc-text">æ•°æ®ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ä¸€ã€åŸºæœ¬ä½¿ç”¨"><span class="toc-text">ä¸€ã€åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚"><span class="toc-text">äºŒã€ç¼“å­˜ç½‘ç»œè¯·æ±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CocoaPods"><span class="toc-text">CocoaPods</span></a></li>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>

<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>



    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
        Total:
        <strong id="busuanzi_value_site_pv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
        &nbsp; | &nbsp;
        Visitors:
        <strong id="busuanzi_value_site_uv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2017
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>






    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>